import{m as x,g as He}from"./mithril-DD6GaBKN.js";import"./shoelace-KxcTQJ1i.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const Ne={view:({attrs:h})=>x("a.github-corner",{href:h.link,"aria-label":"View source on GitHub",title:"View source on GitHub",target:"_blank"},x("svg",{width:80,height:80,viewBox:"0 0 250 250","aria-hidden":"true"},[x("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),x("path.octo-arm",{fill:"currentColor",style:"transform-origin: 130px 106px;",d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"}),x("path.octo-body",{fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})]))};class de{generators=new Map;register(e,t,r){this.generators.has(e)&&console.warn(`Generator "${e}" is already registered, overwriting`),this.generators.set(e,{factory:t,uiMetadata:r})}create(e){const t=this.generators.get(e.name);if(!t)throw new Error(`Unknown generator "${e.name}". Is it registered?`);return t.factory(e)}getAvailableGenerators(){return Array.from(this.generators.values()).sort((e,t)=>e.uiMetadata.sortHint-t.uiMetadata.sortHint).map(e=>({name:e.uiMetadata.name,displayName:e.uiMetadata.displayName}))}getUIMetadata(e){return this.generators.get(e)?.uiMetadata}getDefaultConfig(e,t,r){const i={name:e,width:t,height:r},s=this.getUIMetadata(e);if(s)for(const n of s.controls)i[n.name]=n.defaultValue;return i}}const te=new de,ge=new de,K=new de;function Fe(h){return function(){let e=h+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}async function pe(h){const{width:e,height:t,pieceSize:r}=h,{pointConfig:i,pieceConfig:s,tabConfig:n}=h,a=te.create(i),o=ge.create(s),l=K.create(n),u=h.seed??new Date().getTime(),c=Fe(u),d=a.generatePoints({width:e,height:t,pieceSize:r,random:c});console.log(`Generated ${d.length} points`);const g=o.generatePieces(d,{random:c});console.log(`Generated ${g.pieces.size} pieces`);for(const f of g.edges.values())f.heRight!==-1&&l.addTab(f,{topology:g,random:c});const p={created:new Date().toISOString(),seed:u,vertices:g.vertices,boundary:g.boundary,pieces:g.pieces,edges:g.edges,halfEdges:g.halfEdges};return Promise.resolve(p)}function me(h,e,t,r=!1){const i=e.getContext("2d");if(!i){console.error("Could not get 2D context from canvas");return}i.clearRect(0,0,e.width,e.height),i.strokeStyle=t,i.lineWidth=1,i.beginPath();for(const s of h.edges.values()){const n=h.halfEdges.get(s.heLeft);if(n)if(i.moveTo(n.origin[0],n.origin[1]),n.segments)for(const a of n.segments)switch(a.type){case"bezier":i.bezierCurveTo(a.p1[0],a.p1[1],a.p2[0],a.p2[1],a.p3[0],a.p3[1]);break;case"line":i.lineTo(a.p[0],a.p[1]);break}else{let a;n.twin!==-1?a=h.halfEdges.get(n.twin).origin:a=h.halfEdges.get(n.next).origin,i.lineTo(a[0],a[1])}}if(i.stroke(),r){i.fillStyle="red";for(const s of h.pieces.values()){const[n,a]=s.site;i.beginPath(),i.arc(n,a,3,0,2*Math.PI),i.fill()}}}function Re(h,e,t,r){const s=[];for(const o of h.edges.values()){const l=h.halfEdges.get(o.heLeft);if(l)if(s.push(`M ${l.origin[0].toFixed(3)} ${l.origin[1].toFixed(3)}`),l.segments)for(const u of l.segments)switch(u.type){case"bezier":s.push(`C ${u.p1[0].toFixed(3)} ${u.p1[1].toFixed(3)}, ${u.p2[0].toFixed(3)} ${u.p2[1].toFixed(3)}, ${u.p3[0].toFixed(3)} ${u.p3[1].toFixed(3)}`);break;case"line":s.push(`L ${u.p[0].toFixed(3)} ${u.p[1].toFixed(3)}`);break}else{let u;l.twin!==-1?u=h.halfEdges.get(l.twin).origin:u=h.halfEdges.get(l.next).origin,s.push(`L ${u[0].toFixed(3)} ${u[1].toFixed(3)}`)}}const n=s.join(" ");return`
<svg
  width="${e}"
  height="${t}"
  viewBox="0 0 ${e} ${t}"
  xmlns="http://www.w3.org/2000/svg"
  version="1.1"
>
  <path
    d="${n}"
    fill="none"
    stroke="${r}"
    stroke-width="1"
    vector-effect="non-scaling-stroke"
  />
</svg>
  `.trim()}const Ue=()=>{const h={canvas:null};return{oncreate:({dom:e,attrs:t})=>{if(h.canvas=e.querySelector("canvas.puzzle"),!h.canvas){console.log("couldn't get canvas element");return}me(t.puzzle,h.canvas,t.color)},onupdate:({attrs:e})=>{if(!h.canvas){console.log("couldn't get canvas element");return}me(e.puzzle,h.canvas,e.color)},view:({attrs:e})=>x(".puzzle-stack",[x("img.background",{width:e.width,height:e.height,src:e.imageUrl}),x("canvas.puzzle",{width:e.width,height:e.height})])}},qe=()=>{const h={previousSeed:0,previousWidth:0,previousHeight:0,previousColor:"",svg:""};return{view:({attrs:e})=>((e.puzzle.seed!==h.previousSeed||e.width!==h.previousWidth||e.height!==h.previousHeight||e.color!==h.previousColor)&&(h.previousSeed=e.puzzle.seed,h.previousWidth=e.width,h.previousHeight=e.height,h.previousColor=e.color,h.svg=Re(e.puzzle,e.width,e.height,e.color)),x(".svg-container",{className:e.className},x.trust(h.svg)))}},Ve=()=>({view:({attrs:h})=>x("sl-checkbox.boolean-input",{"help-text":h.config.helpText,disabled:h.disabled,checked:h.value,"onsl-change":e=>{const r=e.target.checked;h.onChange(r)}},h.config.label)}),je=()=>({view:({attrs:h})=>x("sl-input.number-input",{label:h.config.label,"help-text":h.config.helpText,type:"number",inputmode:"numeric",size:"small",disabled:h.disabled,value:h.value,min:h.config.min,max:h.config.max,"onsl-change":e=>{const r=e.target.valueAsNumber;h.onChange(isNaN(r)?void 0:r)}})}),We=()=>({view:({attrs:h})=>x("sl-range.range-input",{label:h.config.label,"help-text":h.config.helpText,disabled:h.disabled,value:h.value,min:h.config.min,max:h.config.max,step:h.config.step,"onsl-change":e=>{const r=e.target.value;h.onChange(isNaN(r)?void 0:r)}})}),Oe=()=>({view:({attrs:h})=>x("sl-input.string-input",{label:h.config.label,"help-text":h.config.helpText,type:"text",inputmode:"text",size:"small",disabled:h.disabled,value:h.value,"onsl-change":e=>{const r=e.target.value;h.onChange(r.length>0?r:void 0)}})}),Ke=()=>({oncreate:({dom:h,attrs:e})=>{h.querySelector("sl-tab-group").show(e.generator)},onupdate:({dom:h,attrs:e})=>{h.querySelector("sl-tab-group").show(e.generator)},view:({attrs:h})=>{const e=h.registry.getAvailableGenerators();return x(".generator-picker",x("sl-tab-group",{"onsl-tab-show":t=>{const r=t.detail.name;h.generator!==r&&h.onGeneratorChange(r)}},[...e.map(t=>{const r=h.registry.getUIMetadata(t.name),i=x("sl-tab",{slot:"nav",panel:t.name},t.displayName),s=x("sl-tab-panel",{name:t.name},x(".controls",[r?.description?x("p",r.description):null,...r?.controls.map(n=>{switch(n.type){case"range":return x(We,{config:n,value:h.config?.[n.name]??n.defaultValue,onChange:a=>{h.onConfigChange(n.name,a)}});case"boolean":return x(Ve,{config:n,value:(h.config?.[n.name]??n.defaultValue)===!0,onChange:a=>{h.onConfigChange(n.name,a)}});case"number":return x(je,{config:n,value:h.config?.[n.name]??n.defaultValue,onChange:a=>{h.onConfigChange(n.name,a)}});case"string":return x(Oe,{config:n,value:h.config?.[n.name]??n.defaultValue,onChange:a=>{h.onConfigChange(n.name,a)}})}})??[],!r?.description&&r?.controls.length==0?x("p","No controls for this strategy."):null]));return[i,s]})]))}});var ie,ye;function Ae(){if(ye)return ie;ye=1;function h(t){var r=t.length,i=1,s=new Array(r),n;for(n=r;n>0;n--)s[n-1]=i,i=i*t[n-1];return{stride:s,data:new Uint32Array(i)}}function e(t){var r=t.length,i=1,s=new Array(r),n=[],a,o;for(a=r;a>0;a--)s[a-1]=i,i=i*t[a-1];for(o=0;o<i;o++)n.push([]);return{stride:s,data:n}}return ie={integer:h,array:e},ie}var ne,be;function Ge(){if(be)return ne;be=1,ne=h;function h(e,t){var r=new Array(e),i=Math.floor(e/2)<<1,s=0,n,a,o,l,u;for(u=0;u<i;u+=2)n=-2*Math.log(t()),a=Math.sqrt(n),o=2*Math.PI*t(),s+=n,r[u]=a*Math.cos(o),r[u+1]=a*Math.sin(o);if(e%2){var c=Math.sqrt(-2*Math.log(t()))*Math.cos(2*Math.PI*t());r[e-1]=c,s+=Math.pow(c,2)}for(l=1/Math.sqrt(s),u=0;u<e;++u)r[u]*=l;return r}return ne}var se,ve;function Be(){return ve||(ve=1,se=function(e,t){e=e||1,t=t||2;for(var r=e*2+1,i=Math.pow(r,t)-1,s=new Array(i),n=0;n<i;n++)for(var a=s[n]=new Array(t),o=n<i/2?n:n+1,l=1;l<=t;l++){var u=o%Math.pow(r,l);a[l-1]=u/Math.pow(r,l-1)-e,o-=u}return s}),se}var oe,we;function Ie(){if(we)return oe;we=1;var h=Be();function e(i){var s=h(2,i),n=[],a;for(s=s.filter(function(o){for(var l=0,u=0;u<i;u++)l+=Math.pow(Math.max(0,Math.abs(o[u])-1),2);return l<i}),a=0;a<i;a++)n.push(0);return s.push(n),s.sort(function(o,l){var u=0,c=0,d;for(d=0;d<i;d++)u+=Math.pow(o[d],2),c+=Math.pow(l[d],2);return u<c?-1:u>c?1:0}),s}var t={};function r(i){return t[i]||(t[i]=e(i)),t[i]}return oe=r,oe}var re,_e;function Xe(){if(_e)return re;_e=1;var h=Ae().integer,e=Ge(),t=Ie();function r(s,n){for(var a=0,o=0;o<s.length;o++)a+=Math.pow(s[o]-n[o],2);return a}function i(s,n){if(typeof s.distanceFunction=="function")throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=s.shape,this.minDistance=s.minDistance,this.maxDistance=s.maxDistance||s.minDistance*2,this.maxTries=Math.ceil(Math.max(1,s.tries||30)),this.rng=n||Math.random;for(var a=0,o=0;o<this.shape.length;o++)a=Math.max(a,this.shape[o]);var l=Math.max(1,a/128|0),u=1e-14*l;this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+u,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=t(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var o=0;o<this.dimension;o++)this.gridShape.push(Math.ceil(this.shape[o]/this.cellSize));this.grid=h(this.gridShape)}return i.prototype.shape=null,i.prototype.dimension=null,i.prototype.minDistance=null,i.prototype.maxDistance=null,i.prototype.minDistancePlusEpsilon=null,i.prototype.squaredMinDistance=null,i.prototype.deltaDistance=null,i.prototype.cellSize=null,i.prototype.maxTries=null,i.prototype.rng=null,i.prototype.neighbourhood=null,i.prototype.currentPoint=null,i.prototype.processList=null,i.prototype.samplePoints=null,i.prototype.gridShape=null,i.prototype.grid=null,i.prototype.addRandomPoint=function(){for(var s=new Array(this.dimension),n=0;n<this.dimension;n++)s[n]=this.rng()*this.shape[n];return this.directAddPoint(s)},i.prototype.addPoint=function(s){var n,a=!0;if(s.length===this.dimension)for(n=0;n<this.dimension&&a;n++)a=s[n]>=0&&s[n]<this.shape[n];else a=!1;return a?this.directAddPoint(s):null},i.prototype.directAddPoint=function(s){var n=0,a=this.grid.stride,o;for(this.processList.push(s),this.samplePoints.push(s),o=0;o<this.dimension;o++)n+=(s[o]/this.cellSize|0)*a[o];return this.grid.data[n]=this.samplePoints.length,s},i.prototype.inNeighbourhood=function(s){var n=this.dimension,a=this.grid.stride,o,l,u,c,d;for(o=0;o<this.neighbourhood.length;o++){for(l=0,u=0;u<n;u++){if(c=(s[u]/this.cellSize|0)+this.neighbourhood[o][u],c<0||c>=this.gridShape[u]){l=-1;break}l+=c*a[u]}if(l!==-1&&this.grid.data[l]!==0&&(d=this.samplePoints[this.grid.data[l]-1],r(s,d)<this.squaredMinDistance))return!0}return!1},i.prototype.next=function(){for(var s,n,a,o,l,u,c;this.processList.length>0;){for(this.currentPoint===null&&(this.currentPoint=this.processList.shift()),o=this.currentPoint,s=0;s<this.maxTries;s++){for(u=!0,a=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),this.dimension===2?(n=this.rng()*Math.PI*2,l=[Math.cos(n),Math.sin(n)]):l=e(this.dimension,this.rng),c=0;u&&c<this.dimension;c++)l[c]=o[c]+l[c]*a,u=l[c]>=0&&l[c]<this.shape[c];if(u&&!this.inNeighbourhood(l))return this.directAddPoint(l)}s===this.maxTries&&(this.currentPoint=null)}return null},i.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},i.prototype.getAllPoints=function(){return this.samplePoints},i.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")},i.prototype.reset=function(){var s=this.grid.data,n=0;for(n=0;n<s.length;n++)s[n]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0},re=i,re}var ae,xe;function Ye(){if(xe)return ae;xe=1;var h=Ae().array,e=Ge(),t=Ie();function r(s,n){for(var a=0,o=0;o<s.length;o++)a+=Math.pow(s[o]-n[o],2);return Math.sqrt(a)}function i(s,n){if(typeof s.distanceFunction!="function")throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=s.shape,this.minDistance=s.minDistance,this.maxDistance=s.maxDistance||s.minDistance*2,this.maxTries=Math.ceil(Math.max(1,s.tries||30)),this.distanceFunction=s.distanceFunction,this.bias=Math.max(0,Math.min(1,s.bias||0)),this.rng=n||Math.random;for(var a=0,o=0;o<this.shape.length;o++)a=Math.max(a,this.shape[o]);var l=Math.max(1,a/128|0),u=1e-14*l;this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+u,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=t(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var o=0;o<this.dimension;o++)this.gridShape.push(Math.ceil(this.shape[o]/this.cellSize));this.grid=h(this.gridShape)}return i.prototype.shape=null,i.prototype.dimension=null,i.prototype.minDistance=null,i.prototype.maxDistance=null,i.prototype.minDistancePlusEpsilon=null,i.prototype.deltaDistance=null,i.prototype.cellSize=null,i.prototype.maxTries=null,i.prototype.distanceFunction=null,i.prototype.bias=null,i.prototype.rng=null,i.prototype.neighbourhood=null,i.prototype.currentPoint=null,i.prototype.currentDistance=null,i.prototype.processList=null,i.prototype.samplePoints=null,i.prototype.sampleDistance=null,i.prototype.gridShape=null,i.prototype.grid=null,i.prototype.addRandomPoint=function(){for(var s=new Array(this.dimension),n=0;n<this.dimension;n++)s[n]=this.rng()*this.shape[n];return this.directAddPoint(s)},i.prototype.addPoint=function(s){var n,a=!0;if(s.length===this.dimension)for(n=0;n<this.dimension&&a;n++)a=s[n]>=0&&s[n]<this.shape[n];else a=!1;return a?this.directAddPoint(s):null},i.prototype.directAddPoint=function(s){var n=0,a=this.grid.stride,o=this.samplePoints.length,l;for(this.processList.push(o),this.samplePoints.push(s),this.sampleDistance.push(this.distanceFunction(s)),l=0;l<this.dimension;l++)n+=(s[l]/this.cellSize|0)*a[l];return this.grid.data[n].push(o),s},i.prototype.inNeighbourhood=function(s){var n=this.dimension,a=this.grid.stride,o,l,u,c,d,g,p=this.distanceFunction(s);for(o=0;o<this.neighbourhood.length;o++){for(l=0,u=0;u<n;u++){if(c=(s[u]/this.cellSize|0)+this.neighbourhood[o][u],c<0||c>=this.gridShape[u]){l=-1;break}l+=c*a[u]}if(l!==-1&&this.grid.data[l].length>0)for(var f=0;f<this.grid.data[l].length;f++){d=this.samplePoints[this.grid.data[l][f]],g=this.sampleDistance[this.grid.data[l][f]];var y=Math.min(g,p),m=Math.max(g,p),b=y+(m-y)*this.bias;if(r(s,d)<this.minDistance+this.deltaDistance*b)return!0}}return!1},i.prototype.next=function(){for(var s,n,a,o,l,u,c,d;this.processList.length>0;){if(this.currentPoint===null){var g=this.processList.shift();this.currentPoint=this.samplePoints[g],this.currentDistance=this.sampleDistance[g]}for(o=this.currentPoint,l=this.currentDistance,s=0;s<this.maxTries;s++){for(c=!0,a=this.minDistancePlusEpsilon+this.deltaDistance*(l+(1-l)*this.bias),this.dimension===2?(n=this.rng()*Math.PI*2,u=[Math.cos(n),Math.sin(n)]):u=e(this.dimension,this.rng),d=0;c&&d<this.dimension;d++)u[d]=o[d]+u[d]*a,c=u[d]>=0&&u[d]<this.shape[d];if(c&&!this.inNeighbourhood(u))return this.directAddPoint(u)}s===this.maxTries&&(this.currentPoint=null)}return null},i.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},i.prototype.getAllPoints=function(){return this.samplePoints},i.prototype.getAllPointsWithDistance=function(){var s=new Array(this.samplePoints.length),n=0,a=0,o;for(n=0;n<this.samplePoints.length;n++){for(o=new Array(this.dimension+1),a=0;a<this.dimension;a++)o[a]=this.samplePoints[n][a];o[this.dimension]=this.sampleDistance[n],s[n]=o}return s},i.prototype.reset=function(){var s=this.grid.data,n=0;for(n=0;n<s.length;n++)s[n]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0},ae=i,ae}var le,Pe;function Je(){if(Pe)return le;Pe=1;var h=Xe(),e=Ye();function t(r,i){this.shape=r.shape,typeof r.distanceFunction=="function"?this.implementation=new e(r,i):this.implementation=new h(r,i)}return t.prototype.implementation=null,t.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()},t.prototype.addPoint=function(r){return this.implementation.addPoint(r)},t.prototype.next=function(){return this.implementation.next()},t.prototype.fill=function(){return this.implementation.fill()},t.prototype.getAllPoints=function(){return this.implementation.getAllPoints()},t.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()},t.prototype.reset=function(){this.implementation.reset()},le=t,le}var Ze=Je();const Qe=He(Ze),J="PoissonPointGenerator",et={name:J,displayName:"Poisson",description:"Generate seed points using Poisson disk sampling. Has an organic look.",sortHint:1,controls:[]},tt=h=>({generatePoints(t){const{width:r,height:i,pieceSize:s,random:n}=t;return new Qe({shape:[r,i],minDistance:s,tries:20},n).fill()}});te.register(J,tt,et);const F=11102230246251565e-32,L=134217729,it=(3+8*F)*F;function he(h,e,t,r,i){let s,n,a,o,l=e[0],u=r[0],c=0,d=0;u>l==u>-l?(s=l,l=e[++c]):(s=u,u=r[++d]);let g=0;if(c<h&&d<t)for(u>l==u>-l?(n=l+s,a=s-(n-l),l=e[++c]):(n=u+s,a=s-(n-u),u=r[++d]),s=n,a!==0&&(i[g++]=a);c<h&&d<t;)u>l==u>-l?(n=s+l,o=n-s,a=s-(n-o)+(l-o),l=e[++c]):(n=s+u,o=n-s,a=s-(n-o)+(u-o),u=r[++d]),s=n,a!==0&&(i[g++]=a);for(;c<h;)n=s+l,o=n-s,a=s-(n-o)+(l-o),l=e[++c],s=n,a!==0&&(i[g++]=a);for(;d<t;)n=s+u,o=n-s,a=s-(n-o)+(u-o),u=r[++d],s=n,a!==0&&(i[g++]=a);return(s!==0||g===0)&&(i[g++]=s),g}function nt(h,e){let t=e[0];for(let r=1;r<h;r++)t+=e[r];return t}function B(h){return new Float64Array(h)}const st=(3+16*F)*F,ot=(2+12*F)*F,rt=(9+64*F)*F*F,q=B(4),De=B(8),Me=B(12),Te=B(16),H=B(4);function at(h,e,t,r,i,s,n){let a,o,l,u,c,d,g,p,f,y,m,b,w,P,z,A,S,C;const v=h-i,D=t-i,_=e-s,M=r-s;P=v*M,d=L*v,g=d-(d-v),p=v-g,d=L*M,f=d-(d-M),y=M-f,z=p*y-(P-g*f-p*f-g*y),A=_*D,d=L*_,g=d-(d-_),p=_-g,d=L*D,f=d-(d-D),y=D-f,S=p*y-(A-g*f-p*f-g*y),m=z-S,c=z-m,q[0]=z-(m+c)+(c-S),b=P+m,c=b-P,w=P-(b-c)+(m-c),m=w-A,c=w-m,q[1]=w-(m+c)+(c-A),C=b+m,c=C-b,q[2]=b-(C-c)+(m-c),q[3]=C;let G=nt(4,q),I=ot*n;if(G>=I||-G>=I||(c=h-v,a=h-(v+c)+(c-i),c=t-D,l=t-(D+c)+(c-i),c=e-_,o=e-(_+c)+(c-s),c=r-M,u=r-(M+c)+(c-s),a===0&&o===0&&l===0&&u===0)||(I=rt*n+it*Math.abs(G),G+=v*u+M*a-(_*l+D*o),G>=I||-G>=I))return G;P=a*M,d=L*a,g=d-(d-a),p=a-g,d=L*M,f=d-(d-M),y=M-f,z=p*y-(P-g*f-p*f-g*y),A=o*D,d=L*o,g=d-(d-o),p=o-g,d=L*D,f=d-(d-D),y=D-f,S=p*y-(A-g*f-p*f-g*y),m=z-S,c=z-m,H[0]=z-(m+c)+(c-S),b=P+m,c=b-P,w=P-(b-c)+(m-c),m=w-A,c=w-m,H[1]=w-(m+c)+(c-A),C=b+m,c=C-b,H[2]=b-(C-c)+(m-c),H[3]=C;const $=he(4,q,4,H,De);P=v*u,d=L*v,g=d-(d-v),p=v-g,d=L*u,f=d-(d-u),y=u-f,z=p*y-(P-g*f-p*f-g*y),A=_*l,d=L*_,g=d-(d-_),p=_-g,d=L*l,f=d-(d-l),y=l-f,S=p*y-(A-g*f-p*f-g*y),m=z-S,c=z-m,H[0]=z-(m+c)+(c-S),b=P+m,c=b-P,w=P-(b-c)+(m-c),m=w-A,c=w-m,H[1]=w-(m+c)+(c-A),C=b+m,c=C-b,H[2]=b-(C-c)+(m-c),H[3]=C;const T=he($,De,4,H,Me);P=a*u,d=L*a,g=d-(d-a),p=a-g,d=L*u,f=d-(d-u),y=u-f,z=p*y-(P-g*f-p*f-g*y),A=o*l,d=L*o,g=d-(d-o),p=o-g,d=L*l,f=d-(d-l),y=l-f,S=p*y-(A-g*f-p*f-g*y),m=z-S,c=z-m,H[0]=z-(m+c)+(c-S),b=P+m,c=b-P,w=P-(b-c)+(m-c),m=w-A,c=w-m,H[1]=w-(m+c)+(c-A),C=b+m,c=C-b,H[2]=b-(C-c)+(m-c),H[3]=C;const k=he(T,Me,4,H,Te);return Te[k-1]}function X(h,e,t,r,i,s){const n=(e-s)*(t-i),a=(h-i)*(r-s),o=n-a,l=Math.abs(n+a);return Math.abs(o)>=st*l?o:-at(h,e,t,r,i,s,l)}const ze=Math.pow(2,-52),Y=new Uint32Array(512);class Z{static from(e,t=dt,r=gt){const i=e.length,s=new Float64Array(i*2);for(let n=0;n<i;n++){const a=e[n];s[2*n]=t(a),s[2*n+1]=r(a)}return new Z(s)}constructor(e){const t=e.length>>1;if(t>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const r=Math.max(2*t-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:r,_hullTri:i,_hullHash:s}=this,n=e.length>>1;let a=1/0,o=1/0,l=-1/0,u=-1/0;for(let v=0;v<n;v++){const D=e[2*v],_=e[2*v+1];D<a&&(a=D),_<o&&(o=_),D>l&&(l=D),_>u&&(u=_),this._ids[v]=v}const c=(a+l)/2,d=(o+u)/2;let g,p,f;for(let v=0,D=1/0;v<n;v++){const _=ce(c,d,e[2*v],e[2*v+1]);_<D&&(g=v,D=_)}const y=e[2*g],m=e[2*g+1];for(let v=0,D=1/0;v<n;v++){if(v===g)continue;const _=ce(y,m,e[2*v],e[2*v+1]);_<D&&_>0&&(p=v,D=_)}let b=e[2*p],w=e[2*p+1],P=1/0;for(let v=0;v<n;v++){if(v===g||v===p)continue;const D=ct(y,m,b,w,e[2*v],e[2*v+1]);D<P&&(f=v,P=D)}let z=e[2*f],A=e[2*f+1];if(P===1/0){for(let _=0;_<n;_++)this._dists[_]=e[2*_]-e[0]||e[2*_+1]-e[1];j(this._ids,this._dists,0,n-1);const v=new Uint32Array(n);let D=0;for(let _=0,M=-1/0;_<n;_++){const G=this._ids[_],I=this._dists[G];I>M&&(v[D++]=G,M=I)}this.hull=v.subarray(0,D),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(X(y,m,b,w,z,A)<0){const v=p,D=b,_=w;p=f,b=z,w=A,f=v,z=D,A=_}const S=ut(y,m,b,w,z,A);this._cx=S.x,this._cy=S.y;for(let v=0;v<n;v++)this._dists[v]=ce(e[2*v],e[2*v+1],S.x,S.y);j(this._ids,this._dists,0,n-1),this._hullStart=g;let C=3;r[g]=t[f]=p,r[p]=t[g]=f,r[f]=t[p]=g,i[g]=0,i[p]=1,i[f]=2,s.fill(-1),s[this._hashKey(y,m)]=g,s[this._hashKey(b,w)]=p,s[this._hashKey(z,A)]=f,this.trianglesLen=0,this._addTriangle(g,p,f,-1,-1,-1);for(let v=0,D,_;v<this._ids.length;v++){const M=this._ids[v],G=e[2*M],I=e[2*M+1];if(v>0&&Math.abs(G-D)<=ze&&Math.abs(I-_)<=ze||(D=G,_=I,M===g||M===p||M===f))continue;let $=0;for(let U=0,Le=this._hashKey(G,I);U<this._hashSize&&($=s[(Le+U)%this._hashSize],!($!==-1&&$!==r[$]));U++);$=t[$];let T=$,k;for(;k=r[T],X(G,I,e[2*T],e[2*T+1],e[2*k],e[2*k+1])>=0;)if(T=k,T===$){T=-1;break}if(T===-1)continue;let N=this._addTriangle(T,M,r[T],-1,-1,i[T]);i[M]=this._legalize(N+2),i[T]=N,C++;let E=r[T];for(;k=r[E],X(G,I,e[2*E],e[2*E+1],e[2*k],e[2*k+1])<0;)N=this._addTriangle(E,M,k,i[M],-1,i[E]),i[M]=this._legalize(N+2),r[E]=E,C--,E=k;if(T===$)for(;k=t[T],X(G,I,e[2*k],e[2*k+1],e[2*T],e[2*T+1])<0;)N=this._addTriangle(k,M,T,-1,i[T],i[k]),this._legalize(N+2),i[k]=N,r[T]=T,C--,T=k;this._hullStart=t[M]=T,r[T]=t[E]=M,r[M]=E,s[this._hashKey(G,I)]=M,s[this._hashKey(e[2*T],e[2*T+1])]=T}this.hull=new Uint32Array(C);for(let v=0,D=this._hullStart;v<C;v++)this.hull[v]=D,D=r[D];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(lt(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:r,coords:i}=this;let s=0,n=0;for(;;){const a=r[e],o=e-e%3;if(n=o+(e+2)%3,a===-1){if(s===0)break;e=Y[--s];continue}const l=a-a%3,u=o+(e+1)%3,c=l+(a+2)%3,d=t[n],g=t[e],p=t[u],f=t[c];if(ht(i[2*d],i[2*d+1],i[2*g],i[2*g+1],i[2*p],i[2*p+1],i[2*f],i[2*f+1])){t[e]=f,t[a]=d;const m=r[c];if(m===-1){let w=this._hullStart;do{if(this._hullTri[w]===c){this._hullTri[w]=e;break}w=this._hullPrev[w]}while(w!==this._hullStart)}this._link(e,m),this._link(a,r[n]),this._link(n,c);const b=l+(a+1)%3;s<Y.length&&(Y[s++]=b)}else{if(s===0)break;e=Y[--s]}}return n}_link(e,t){this._halfedges[e]=t,t!==-1&&(this._halfedges[t]=e)}_addTriangle(e,t,r,i,s,n){const a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,n),this.trianglesLen+=3,a}}function lt(h,e){const t=h/(Math.abs(h)+Math.abs(e));return(e>0?3-t:1+t)/4}function ce(h,e,t,r){const i=h-t,s=e-r;return i*i+s*s}function ht(h,e,t,r,i,s,n,a){const o=h-n,l=e-a,u=t-n,c=r-a,d=i-n,g=s-a,p=o*o+l*l,f=u*u+c*c,y=d*d+g*g;return o*(c*y-f*g)-l*(u*y-f*d)+p*(u*g-c*d)<0}function ct(h,e,t,r,i,s){const n=t-h,a=r-e,o=i-h,l=s-e,u=n*n+a*a,c=o*o+l*l,d=.5/(n*l-a*o),g=(l*u-a*c)*d,p=(n*c-o*u)*d;return g*g+p*p}function ut(h,e,t,r,i,s){const n=t-h,a=r-e,o=i-h,l=s-e,u=n*n+a*a,c=o*o+l*l,d=.5/(n*l-a*o),g=h+(l*u-a*c)*d,p=e+(n*c-o*u)*d;return{x:g,y:p}}function j(h,e,t,r){if(r-t<=20)for(let i=t+1;i<=r;i++){const s=h[i],n=e[s];let a=i-1;for(;a>=t&&e[h[a]]>n;)h[a+1]=h[a--];h[a+1]=s}else{const i=t+r>>1;let s=t+1,n=r;W(h,i,s),e[h[t]]>e[h[r]]&&W(h,t,r),e[h[s]]>e[h[r]]&&W(h,s,r),e[h[t]]>e[h[s]]&&W(h,t,s);const a=h[s],o=e[a];for(;;){do s++;while(e[h[s]]<o);do n--;while(e[h[n]]>o);if(n<s)break;W(h,s,n)}h[t+1]=h[n],h[n]=a,r-s+1>=n-t?(j(h,e,s,r),j(h,e,t,n-1)):(j(h,e,t,n-1),j(h,e,s,r))}}function W(h,e,t){const r=h[e];h[e]=h[t],h[t]=r}function dt(h){return h[0]}function gt(h){return h[1]}const Se=1e-6;class R{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,r){e=+e,t=+t,r=+r;const i=e+r,s=t;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>Se||Math.abs(this._y1-s)>Se)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${e-r},${t}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(e,t,r,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class ue{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class ft{constructor(e,[t,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=i,this.xmin=t,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:r},vectors:i}=this;let s,n;const a=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let f=0,y=0,m=r.length,b,w;f<m;f+=3,y+=2){const P=r[f]*2,z=r[f+1]*2,A=r[f+2]*2,S=e[P],C=e[P+1],v=e[z],D=e[z+1],_=e[A],M=e[A+1],G=v-S,I=D-C,$=_-S,T=M-C,k=(G*T-I*$)*2;if(Math.abs(k)<1e-9){if(s===void 0){s=n=0;for(const E of t)s+=e[E*2],n+=e[E*2+1];s/=t.length,n/=t.length}const N=1e9*Math.sign((s-S)*T-(n-C)*$);b=(S+_)/2-N*T,w=(C+M)/2+N*$}else{const N=1/k,E=G*G+I*I,U=$*$+T*T;b=S+(T*E-I*U)*N,w=C+(G*U-$*E)*N}a[y]=b,a[y+1]=w}let o=t[t.length-1],l,u=o*4,c,d=e[2*o],g,p=e[2*o+1];i.fill(0);for(let f=0;f<t.length;++f)o=t[f],l=u,c=d,g=p,u=o*4,d=e[2*o],p=e[2*o+1],i[l+2]=i[u]=g-p,i[l+3]=i[u+1]=d-c}render(e){const t=e==null?e=new R:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:n,vectors:a}=this;if(s.length<=1)return null;for(let u=0,c=r.length;u<c;++u){const d=r[u];if(d<u)continue;const g=Math.floor(u/3)*2,p=Math.floor(d/3)*2,f=n[g],y=n[g+1],m=n[p],b=n[p+1];this._renderSegment(f,y,m,b,e)}let o,l=s[s.length-1];for(let u=0;u<s.length;++u){o=l,l=s[u];const c=Math.floor(i[l]/3)*2,d=n[c],g=n[c+1],p=o*4,f=this._project(d,g,a[p+2],a[p+3]);f&&this._renderSegment(d,g,f[0],f[1],e)}return t&&t.value()}renderBounds(e){const t=e==null?e=new R:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const r=t==null?t=new R:void 0,i=this._clip(e);if(i===null||!i.length)return;t.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let n=2;n<s;n+=2)(i[n]!==i[n-2]||i[n+1]!==i[n-1])&&t.lineTo(i[n],i[n+1]);return t.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,r=e.length/2;t<r;++t){const i=this.cellPolygon(t);i&&(i.index=t,yield i)}}cellPolygon(e){const t=new ue;return this.renderCell(e,t),t.value()}_renderSegment(e,t,r,i,s){let n;const a=this._regioncode(e,t),o=this._regioncode(r,i);a===0&&o===0?(s.moveTo(e,t),s.lineTo(r,i)):(n=this._clipSegment(e,t,r,i,a,o))&&(s.moveTo(n[0],n[1]),s.lineTo(n[2],n[3]))}contains(e,t,r){return t=+t,t!==t||(r=+r,r!==r)?!1:this.delaunay._step(e,t,r)===e}*neighbors(e){const t=this._clip(e);if(t)for(const r of this.delaunay.neighbors(e)){const i=this._clip(r);if(i){e:for(let s=0,n=t.length;s<n;s+=2)for(let a=0,o=i.length;a<o;a+=2)if(t[s]===i[a]&&t[s+1]===i[a+1]&&t[(s+2)%n]===i[(a+o-2)%o]&&t[(s+3)%n]===i[(a+o-1)%o]){yield r;break e}}}}_cell(e){const{circumcenters:t,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,n=r[e];if(n===-1)return null;const a=[];let o=n;do{const l=Math.floor(o/3);if(a.push(t[l*2],t[l*2+1]),o=o%3===2?o-2:o+1,s[o]!==e)break;o=i[o]}while(o!==n&&o!==-1);return a}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(t===null)return null;const{vectors:r}=this,i=e*4;return this._simplify(r[i]||r[i+1]?this._clipInfinite(e,t,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(e,t))}_clipFinite(e,t){const r=t.length;let i=null,s,n,a=t[r-2],o=t[r-1],l,u=this._regioncode(a,o),c,d=0;for(let g=0;g<r;g+=2)if(s=a,n=o,a=t[g],o=t[g+1],l=u,u=this._regioncode(a,o),l===0&&u===0)c=d,d=0,i?i.push(a,o):i=[a,o];else{let p,f,y,m,b;if(l===0){if((p=this._clipSegment(s,n,a,o,l,u))===null)continue;[f,y,m,b]=p}else{if((p=this._clipSegment(a,o,s,n,u,l))===null)continue;[m,b,f,y]=p,c=d,d=this._edgecode(f,y),c&&d&&this._edge(e,c,d,i,i.length),i?i.push(f,y):i=[f,y]}c=d,d=this._edgecode(m,b),c&&d&&this._edge(e,c,d,i,i.length),i?i.push(m,b):i=[m,b]}if(i)c=d,d=this._edgecode(i[0],i[1]),c&&d&&this._edge(e,c,d,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,r,i,s,n){const a=s<n;for(a&&([e,t,r,i,s,n]=[r,i,e,t,n,s]);;){if(s===0&&n===0)return a?[r,i,e,t]:[e,t,r,i];if(s&n)return null;let o,l,u=s||n;u&8?(o=e+(r-e)*(this.ymax-t)/(i-t),l=this.ymax):u&4?(o=e+(r-e)*(this.ymin-t)/(i-t),l=this.ymin):u&2?(l=t+(i-t)*(this.xmax-e)/(r-e),o=this.xmax):(l=t+(i-t)*(this.xmin-e)/(r-e),o=this.xmin),s?(e=o,t=l,s=this._regioncode(e,t)):(r=o,i=l,n=this._regioncode(r,i))}}_clipInfinite(e,t,r,i,s,n){let a=Array.from(t),o;if((o=this._project(a[0],a[1],r,i))&&a.unshift(o[0],o[1]),(o=this._project(a[a.length-2],a[a.length-1],s,n))&&a.push(o[0],o[1]),a=this._clipFinite(e,a))for(let l=0,u=a.length,c,d=this._edgecode(a[u-2],a[u-1]);l<u;l+=2)c=d,d=this._edgecode(a[l],a[l+1]),c&&d&&(l=this._edge(e,c,d,a,l),u=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,r,i,s){for(;t!==r;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin;break}(i[s]!==n||i[s+1]!==a)&&this.contains(e,n,a)&&(i.splice(s,0,n,a),s+=2)}return s}_project(e,t,r,i){let s=1/0,n,a,o;if(i<0){if(t<=this.ymin)return null;(n=(this.ymin-t)/i)<s&&(o=this.ymin,a=e+(s=n)*r)}else if(i>0){if(t>=this.ymax)return null;(n=(this.ymax-t)/i)<s&&(o=this.ymax,a=e+(s=n)*r)}if(r>0){if(e>=this.xmax)return null;(n=(this.xmax-e)/r)<s&&(a=this.xmax,o=t+(s=n)*i)}else if(r<0){if(e<=this.xmin)return null;(n=(this.xmin-e)/r)<s&&(a=this.xmin,o=t+(s=n)*i)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){const r=(t+2)%e.length,i=(t+4)%e.length;(e[t]===e[r]&&e[r]===e[i]||e[t+1]===e[r+1]&&e[r+1]===e[i+1])&&(e.splice(r,2),t-=2)}e.length||(e=null)}return e}}const pt=2*Math.PI,V=Math.pow;function mt(h){return h[0]}function yt(h){return h[1]}function bt(h){const{triangles:e,coords:t}=h;for(let r=0;r<e.length;r+=3){const i=2*e[r],s=2*e[r+1],n=2*e[r+2];if((t[n]-t[i])*(t[s+1]-t[i+1])-(t[s]-t[i])*(t[n+1]-t[i+1])>1e-10)return!1}return!0}function vt(h,e,t){return[h+Math.sin(h+e)*t,e+Math.cos(h-e)*t]}class fe{static from(e,t=mt,r=yt,i){return new fe("length"in e?wt(e,t,r,i):Float64Array.from(_t(e,t,r,i)))}constructor(e){this._delaunator=new Z(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&bt(e)){this.collinear=Int32Array.from({length:t.length/2},(d,g)=>g).sort((d,g)=>t[2*d]-t[2*g]||t[2*d+1]-t[2*g+1]);const o=this.collinear[0],l=this.collinear[this.collinear.length-1],u=[t[2*o],t[2*o+1],t[2*l],t[2*l+1]],c=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let d=0,g=t.length/2;d<g;++d){const p=vt(t[2*d],t[2*d+1],c);t[2*d]=p[0],t[2*d+1]=p[1]}this._delaunator=new Z(t)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,n=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let o=0,l=r.length;o<l;++o){const u=s[o%3===2?o-2:o+1];(r[o]===-1||n[u]===-1)&&(n[u]=o)}for(let o=0,l=i.length;o<l;++o)a[i[o]]=o;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],n[i[0]]=1,i.length===2&&(n[i[1]]=0,this.triangles[1]=i[1],this.triangles[2]=i[1]))}voronoi(e){return new ft(this,e)}*neighbors(e){const{inedges:t,hull:r,_hullIndex:i,halfedges:s,triangles:n,collinear:a}=this;if(a){const c=a.indexOf(e);c>0&&(yield a[c-1]),c<a.length-1&&(yield a[c+1]);return}const o=t[e];if(o===-1)return;let l=o,u=-1;do{if(yield u=n[l],l=l%3===2?l-2:l+1,n[l]!==e)return;if(l=s[l],l===-1){const c=r[(i[e]+1)%r.length];c!==u&&(yield c);return}}while(l!==o)}find(e,t,r=0){if(e=+e,e!==e||(t=+t,t!==t))return-1;const i=r;let s;for(;(s=this._step(r,e,t))>=0&&s!==r&&s!==i;)r=s;return s}_step(e,t,r){const{inedges:i,hull:s,_hullIndex:n,halfedges:a,triangles:o,points:l}=this;if(i[e]===-1||!l.length)return(e+1)%(l.length>>1);let u=e,c=V(t-l[e*2],2)+V(r-l[e*2+1],2);const d=i[e];let g=d;do{let p=o[g];const f=V(t-l[p*2],2)+V(r-l[p*2+1],2);if(f<c&&(c=f,u=p),g=g%3===2?g-2:g+1,o[g]!==e)break;if(g=a[g],g===-1){if(g=s[(n[e]+1)%s.length],g!==p&&V(t-l[g*2],2)+V(r-l[g*2+1],2)<c)return g;break}}while(g!==d);return u}render(e){const t=e==null?e=new R:void 0,{points:r,halfedges:i,triangles:s}=this;for(let n=0,a=i.length;n<a;++n){const o=i[n];if(o<n)continue;const l=s[n]*2,u=s[o]*2;e.moveTo(r[l],r[l+1]),e.lineTo(r[u],r[u+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){t===void 0&&(!e||typeof e.moveTo!="function")&&(t=e,e=null),t=t==null?2:+t;const r=e==null?e=new R:void 0,{points:i}=this;for(let s=0,n=i.length;s<n;s+=2){const a=i[s],o=i[s+1];e.moveTo(a+t,o),e.arc(a,o,t,0,pt)}return r&&r.value()}renderHull(e){const t=e==null?e=new R:void 0,{hull:r,points:i}=this,s=r[0]*2,n=r.length;e.moveTo(i[s],i[s+1]);for(let a=1;a<n;++a){const o=2*r[a];e.lineTo(i[o],i[o+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new ue;return this.renderHull(e),e.value()}renderTriangle(e,t){const r=t==null?t=new R:void 0,{points:i,triangles:s}=this,n=s[e*=3]*2,a=s[e+1]*2,o=s[e+2]*2;return t.moveTo(i[n],i[n+1]),t.lineTo(i[a],i[a+1]),t.lineTo(i[o],i[o+1]),t.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,r=e.length/3;t<r;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new ue;return this.renderTriangle(e,t),t.value()}}function wt(h,e,t,r){const i=h.length,s=new Float64Array(i*2);for(let n=0;n<i;++n){const a=h[n];s[n*2]=e.call(r,a,n,h),s[n*2+1]=t.call(r,a,n,h)}return s}function*_t(h,e,t,r){let i=0;for(const s of h)yield e.call(r,s,i,h),yield t.call(r,s,i,h),++i}let xt=0;function Ce(){return xt++}const Q="VoronoiPieceGenerator",Pt={name:Q,displayName:"Voronoi",description:"Construct pieces by building a Voronoi diagram from the seed points",sortHint:1,controls:[]};function Dt(h){if(h.length===0)return[0,0,0,0];let e=h[0][0],t=h[0][1],r=e,i=t;for(let s=1;s<h.length;s++){const n=h[s];e=Math.min(e,n[0]),t=Math.min(t,n[1]),r=Math.max(r,n[0]),i=Math.max(i,n[1])}return[e,t,r,i]}function Mt(h,e){const t=h.length;for(let r=0;r<t;r++){const i=e.get(h[r]);i.next=h[(r+1)%t],i.prev=h[(r-1+t)%t]}}function O(h){return`${h[0].toPrecision(7)},${h[1].toPrecision(7)}`}function Tt(h,e){return Math.abs(h[0]-e[0])<1e-6&&Math.abs(h[1]-e[1])<1e-6}const zt=h=>{const{width:e,height:t}=h;return{generatePieces(i,s){const a=fe.from(i).voronoi([0,0,e,t]),o={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[]},l=new Map;for(let c=0;c<i.length;c++){const d=i[c],g=a.cellPolygon(c);if(!g)continue;const p={id:c,site:d,halfEdge:-1,bbox:Dt(g)},f=[];for(let y=0;y<g.length-1;y++){const m=g[y],b=g[y+1];if(Tt(m,b))continue;const w={id:Ce(),origin:m,twin:-1,next:-1,prev:-1,piece:c};o.halfEdges.set(w.id,w),f.push(w.id);const P=`${O(m)}-${O(b)}`;l.set(P,w.id)}f.length!==0&&(Mt(f,o.halfEdges),p.halfEdge=f[0],o.pieces.set(c,p))}for(const c of o.halfEdges.values()){if(c.twin!==-1)continue;const d=o.halfEdges.get(c.next),g=c.origin,p=d.origin,f=`${O(p)}-${O(g)}`,y=l.get(f),m=Ce();let b;if(y!==void 0){const w=o.halfEdges.get(y);c.twin=w.id,w.twin=c.id,b={id:m,heLeft:c.id,heRight:w.id}}else b={id:m,heLeft:c.id,heRight:-1},o.boundary.push(m);o.edges.set(m,b)}const u=new Map;for(const c of o.halfEdges.values()){const d=O(c.origin);u.has(d)||u.set(d,c.origin)}return o.vertices=Array.from(u.values()),o}}};ge.register(Q,zt,Pt);const ee="TraditionalTabGenerator",St={name:ee,displayName:"Traditional",description:"Generate a traditional rounded tab for each edge.",sortHint:1,controls:[{type:"range",name:"size",label:"Tab Size",defaultValue:20,min:1,max:100,step:1,helpText:"Size of each tab as a percent relative to its edge length"},{type:"range",name:"jitter",label:"Randomness",defaultValue:8,min:0,max:100,step:1,helpText:"Adds randomness to the tab shape. 0 means completely uniform tabs"},{type:"number",name:"minTabSize",label:"Minimum Tab Size",optional:!0,helpText:"If provided, tabs will not generate on edges shorter than this value"},{type:"number",name:"maxTabSize",label:"Maximum Tab Width",optional:!0,helpText:"If provided, the width of a tab's features will be clamped to this value"}]};function Ct(h,e,t,r,i,s=!1,n){const a=e[0]-h[0],o=e[1]-h[1],l=Math.hypot(a,o);if(l===0)throw new Error("Edge has zero length");const u=[a/l,o/l],c=[-u[1],u[0]],d=(_,M)=>[h[0]+(u[0]*_+c[0]*M)*l,h[1]+(u[1]*_+c[1]*M)*l],g=r/100,p=()=>(i()*2-1)*g,f=p(),y=p(),m=p(),b=p(),w=p();let P=t/200;n&&4*P*l>n&&(P=n/(4*l));const z=s?-1:1,S=[[0,0],[.2,f],[.5+y+b,z*(-P+m)],[.5-P+y,z*(P+m)],[.5-2*P+y-b,z*(3*P+m)],[.5+2*P+y-b,z*(3*P+m)],[.5+P+y,z*(P+m)],[.5+y+b,z*(-P+m)],[.8,w],[1,0]].map(([_,M])=>d(_,M)),C={type:"bezier",p1:S[1],p2:S[2],p3:S[3]},v={type:"bezier",p1:S[4],p2:S[5],p3:S[6]},D={type:"bezier",p1:S[7],p2:S[8],p3:S[9]};return[C,v,D]}function At(h,e){return{type:"bezier",p1:h.p2,p2:h.p1,p3:e}}const Gt=h=>{const{size:e=20,jitter:t=8,minTabSize:r,maxTabSize:i}=h;return{addTab(n,a){const{topology:o,random:l}=a,u=o.halfEdges.get(n.heLeft),c=o.halfEdges.get(n.heRight);if(!u||!c)return;const d=u.origin,g=c.origin;if(r&&Math.hypot(g[0]-d[0],g[1]-d[1])<r)return;const p=l()>.5,f=Ct(d,g,e,t,l,p,i);if(f.length===0)return;const y=[];for(let m=f.length-1;m>=0;m--){const b=f[m],w=m>0?f[m-1].p3:d;y.push(At(b,w))}u.segments=f,c.segments=y}}};K.register(ee,Gt,St);const ke="GridJitterPointGenerator",It={name:ke,displayName:"Grid",description:"Generate seed points on a grid with optional random jitter. Has a regular, uniform look.",sortHint:2,controls:[{type:"range",name:"jitter",label:"Randomness",min:0,max:100,step:5,defaultValue:50,helpText:"Amount of jitter to apply to each grid point (0 to 100%)"}]},kt=h=>{const{jitter:e=50}=h;return{generatePoints(r){const{width:i,height:s,pieceSize:n,random:a}=r,o=[];for(let l=0;l<i;l+=n)for(let u=0;u<s;u+=n){const c=[l+n/2,u+n/2];e>0&&(c[0]+=(a()-.5)*(e/100)*n,c[1]+=(a()-.5)*(e/100)*n),o.push(c)}return o}}};te.register(ke,kt,It);const $e="NullTabGenerator",$t={name:$e,displayName:"None",description:"Do not generate tabs. Piece boundaries will be straight edges.",sortHint:3,controls:[]},Et=h=>({addTab(t,r){}});K.register($e,Et,$t);const Ee="TriangleTabGenerator",Lt={name:Ee,displayName:"Triangle",description:"Generate simple triangular tabs.",sortHint:2,controls:[{type:"range",name:"tabHeightRatio",label:"Tab Height",optional:!0,min:0,max:100,step:1,defaultValue:20,helpText:'Determines how "tall" the tab is relative to the length of the edge as a percent'}]},Ht=h=>{const{tabHeightRatio:e=20}=h;return{addTab(r,i){const{topology:s,random:n}=i,a=s.halfEdges.get(r.heLeft),o=s.halfEdges.get(r.heRight);if(!a||!o){console.warn("Could not find half-edges for a given internal edge:",r.id);return}const l=a.origin,u=o.origin,c=[u[0]-l[0],u[1]-l[1]],d=Math.sqrt(c[0]**2+c[1]**2);if(d<1e-6)return;const g=[c[0]/d,c[1]/d],p=[-g[1],g[0]],f=[l[0]+c[0]/2,l[1]+c[1]/2],y=n()>.5?1:-1,m=d*(e/100)*y,b=[f[0]+p[0]*m,f[1]+p[1]*m],w={type:"bezier",p1:b,p2:b,p3:u},P=[f[0]-p[0]*m,f[1]-p[1]*m],z={type:"bezier",p1:P,p2:P,p3:l};a.segments=[w],o.segments=[z]}}};K.register(Ee,Ht,Lt);const Nt=()=>{const t=J,r={name:J,width:800,height:600},i=Q,s={name:Q,width:800,height:600},n=ee,a={name:ee,width:800,height:600},o={seed:new Date().getTime()%10240,canvasWidth:800,canvasHeight:600,distance:40,color:"#333333",dirty:!0,generators:{point:{label:"Seed Point Generator",registry:te,name:t,config:r},piece:{label:"Piece Generator",registry:ge,name:i,config:s},tab:{label:"Tab Generator",registry:K,name:n,config:a}},puzzle:void 0,imageUrl:void 0};return{oncreate:()=>{pe({width:o.canvasWidth,height:o.canvasHeight,pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(l=>{o.puzzle=l,x.redraw()}).catch(l=>{console.error(l)})},onupdate:()=>{o.dirty&&(o.dirty=!1,pe({width:o.canvasWidth,height:o.canvasHeight,pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(l=>{o.puzzle=l,x.redraw()}).catch(l=>{console.error(l)}))},onremove:()=>{o.imageUrl&&(URL.revokeObjectURL(o.imageUrl),o.imageUrl=void 0)},view:()=>x(".page",[x(Ne,{link:"https://github.com/weevilgenius/puzzle-generator"}),x("h1","Puzzle Generator"),x(".container",[o.puzzle&&x(Ue,{width:o.canvasWidth,height:o.canvasHeight,color:o.color,imageUrl:o.imageUrl,puzzle:o.puzzle}),x(".controls",[x("label.button",["Choose Image",x("input[type=file]#image-upload",{accept:"image/*",style:{display:"none"},onchange:l=>{const u=l.target.files?.[0];u?.type.startsWith("image/")&&(o.imageUrl&&URL.revokeObjectURL(o.imageUrl),o.imageUrl=URL.createObjectURL(u))}})]),x("label",["Seed: ",x("input[type=number]",{value:o.seed,onchange:l=>{o.seed=parseInt(l.target.value),o.dirty=!0}})]),x("label",["Piece size: ",x("input[type=number]",{value:o.distance,onchange:l=>{o.distance=parseInt(l.target.value),o.dirty=!0}})]),x("label",["Color: ",x("input[type=color]",{value:o.color,onchange:l=>{const u=l.target;o.color=u.value}})]),...Object.entries(o.generators).map(([l,u])=>x("label",[u.label+":",x(Ke,{generator:u.name,registry:u.registry,config:u.config,onGeneratorChange:c=>{c!=u.name&&(console.log(`${l} generator changed to ${c}`),u.name=c,o.generators[l].config=u.registry.getDefaultConfig(c,o.canvasWidth,o.canvasHeight),o.dirty=!0,x.redraw())},onConfigChange:(c,d)=>{console.log(`${l} generator config "${c}" changed to ${String(d)}`),u.config[c]=d,o.dirty=!0,x.redraw()}})]))])]),o.puzzle&&x(qe,{className:"hidden",width:o.canvasWidth,height:o.canvasHeight,puzzle:o.puzzle,color:o.color})])}};x.mount(document.body,Nt);
//# sourceMappingURL=index-DXIAoApd.js.map
