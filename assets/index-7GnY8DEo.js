import{m as J,g as co,a as is}from"./mithril-CdZ0BR3D.js";import{r as fo}from"./webawesome-DgEd3PYa.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))l(c);new MutationObserver(c=>{for(const u of c)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function r(c){const u={};return c.integrity&&(u.integrity=c.integrity),c.referrerPolicy&&(u.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?u.credentials="include":c.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(c){if(c.ep)return;c.ep=!0;const u=r(c);fetch(c.href,u)}})();const po={view:({attrs:o})=>J("a.github-corner",{href:o.link,"aria-label":"View source on GitHub",title:"View source on GitHub",target:"_blank"},J("svg",{width:80,height:80,viewBox:"0 0 250 250","aria-hidden":"true"},[J("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),J("path.octo-arm",{fill:"currentColor",style:"transform-origin: 130px 106px;",d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"}),J("path.octo-body",{fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})]))},go={view:()=>{const o=J.route.get();return J("nav.navigation",[J("div.nav-links",J("wa-radio-group",{orientation:"horizontal",value:o,onchange:s=>{s.redraw=!1;const r=s.target;J.route.set(String(r.value))}},[J("wa-radio",{appearance:"button",value:"/puzzle"},"Puzzle Generator"),J("wa-radio",{appearance:"button",value:"/test"},"Test Harness")]))])}},Cs=50,Ss=5,mo=Ss*Ss,vo=.1,_o=10,Ar=1,yo=.025,xo=[.25,.5,1,2,4],bo=["25%","50%","100%","200%","400%"];function wo(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ir={exports:{}};const Co={},So=Object.freeze(Object.defineProperty({__proto__:null,default:Co},Symbol.toStringTag,{value:"Module"})),Ps=co(So);var gn={exports:{}},Po=gn.exports,ks;function ko(){return ks||(ks=1,(function(o,s){(function(r,l){l(s)})(Po,(function(r){var l=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],c=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],u="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࢗ-࢟࣊-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄ఼ా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ೳഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-໎໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜕ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠏-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿ-ᫎᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷿‌‍‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯・꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿･",d="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࡰ-ࢇࢉ-ࢎࢠ-ࣉऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౝౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೝೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜑᜟ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭌᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲊᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꟍꟐꟑꟓꟕ-Ƛꟲ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",g={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},x="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",C={5:x,"5module":x+" export import",6:x+" const class extends export import super"},L=/^in(stanceof)?$/,A=new RegExp("["+d+"]"),q=new RegExp("["+d+u+"]");function E(n,p){for(var I=65536,F=0;F<p.length;F+=2){if(I+=p[F],I>n)return!1;if(I+=p[F+1],I>=n)return!0}return!1}function Q(n,p){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&A.test(String.fromCharCode(n)):p===!1?!1:E(n,c)}function X(n,p){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&q.test(String.fromCharCode(n)):p===!1?!1:E(n,c)||E(n,l)}var j=function(p,I){I===void 0&&(I={}),this.label=p,this.keyword=I.keyword,this.beforeExpr=!!I.beforeExpr,this.startsExpr=!!I.startsExpr,this.isLoop=!!I.isLoop,this.isAssign=!!I.isAssign,this.prefix=!!I.prefix,this.postfix=!!I.postfix,this.binop=I.binop||null,this.updateContext=null};function $(n,p){return new j(n,{beforeExpr:!0,binop:p})}var he={beforeExpr:!0},re={startsExpr:!0},ye={};function ue(n,p){return p===void 0&&(p={}),p.keyword=n,ye[n]=new j(n,p)}var M={num:new j("num",re),regexp:new j("regexp",re),string:new j("string",re),name:new j("name",re),privateId:new j("privateId",re),eof:new j("eof"),bracketL:new j("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new j("]"),braceL:new j("{",{beforeExpr:!0,startsExpr:!0}),braceR:new j("}"),parenL:new j("(",{beforeExpr:!0,startsExpr:!0}),parenR:new j(")"),comma:new j(",",he),semi:new j(";",he),colon:new j(":",he),dot:new j("."),question:new j("?",he),questionDot:new j("?."),arrow:new j("=>",he),template:new j("template"),invalidTemplate:new j("invalidTemplate"),ellipsis:new j("...",he),backQuote:new j("`",re),dollarBraceL:new j("${",{beforeExpr:!0,startsExpr:!0}),eq:new j("=",{beforeExpr:!0,isAssign:!0}),assign:new j("_=",{beforeExpr:!0,isAssign:!0}),incDec:new j("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new j("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:$("||",1),logicalAND:$("&&",2),bitwiseOR:$("|",3),bitwiseXOR:$("^",4),bitwiseAND:$("&",5),equality:$("==/!=/===/!==",6),relational:$("</>/<=/>=",7),bitShift:$("<</>>/>>>",8),plusMin:new j("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:$("%",10),star:$("*",10),slash:$("/",10),starstar:new j("**",{beforeExpr:!0}),coalesce:$("??",1),_break:ue("break"),_case:ue("case",he),_catch:ue("catch"),_continue:ue("continue"),_debugger:ue("debugger"),_default:ue("default",he),_do:ue("do",{isLoop:!0,beforeExpr:!0}),_else:ue("else",he),_finally:ue("finally"),_for:ue("for",{isLoop:!0}),_function:ue("function",re),_if:ue("if"),_return:ue("return",he),_switch:ue("switch"),_throw:ue("throw",he),_try:ue("try"),_var:ue("var"),_const:ue("const"),_while:ue("while",{isLoop:!0}),_with:ue("with"),_new:ue("new",{beforeExpr:!0,startsExpr:!0}),_this:ue("this",re),_super:ue("super",re),_class:ue("class",re),_extends:ue("extends",he),_export:ue("export"),_import:ue("import",re),_null:ue("null",re),_true:ue("true",re),_false:ue("false",re),_in:ue("in",{beforeExpr:!0,binop:7}),_instanceof:ue("instanceof",{beforeExpr:!0,binop:7}),_typeof:ue("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ue("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ue("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},de=/\r\n?|\n|\u2028|\u2029/,_e=new RegExp(de.source,"g");function pe(n){return n===10||n===13||n===8232||n===8233}function Ce(n,p,I){I===void 0&&(I=n.length);for(var F=p;F<I;F++){var Z=n.charCodeAt(F);if(pe(Z))return F<I-1&&Z===13&&n.charCodeAt(F+1)===10?F+2:F+1}return-1}var ke=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Se=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Oe=Object.prototype,Pe=Oe.hasOwnProperty,Je=Oe.toString,me=Object.hasOwn||(function(n,p){return Pe.call(n,p)}),Ke=Array.isArray||(function(n){return Je.call(n)==="[object Array]"}),rt=Object.create(null);function Ve(n){return rt[n]||(rt[n]=new RegExp("^(?:"+n.replace(/ /g,"|")+")$"))}function tt(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var Kt=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Bt=function(p,I){this.line=p,this.column=I};Bt.prototype.offset=function(p){return new Bt(this.line,this.column+p)};var $t=function(p,I,F){this.start=I,this.end=F,p.sourceFile!==null&&(this.source=p.sourceFile)};function Ki(n,p){for(var I=1,F=0;;){var Z=Ce(n,F,p);if(Z<0)return new Bt(I,p-F);++I,F=Z}}var ft={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},vi=!1;function $i(n){var p={};for(var I in ft)p[I]=n&&me(n,I)?n[I]:ft[I];if(p.ecmaVersion==="latest"?p.ecmaVersion=1e8:p.ecmaVersion==null?(!vi&&typeof console=="object"&&console.warn&&(vi=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),p.ecmaVersion=11):p.ecmaVersion>=2015&&(p.ecmaVersion-=2009),p.allowReserved==null&&(p.allowReserved=p.ecmaVersion<5),(!n||n.allowHashBang==null)&&(p.allowHashBang=p.ecmaVersion>=14),Ke(p.onToken)){var F=p.onToken;p.onToken=function(Z){return F.push(Z)}}return Ke(p.onComment)&&(p.onComment=Yi(p,p.onComment)),p}function Yi(n,p){return function(I,F,Z,le,fe,Ie){var Le={type:I?"Block":"Line",value:F,start:Z,end:le};n.locations&&(Le.loc=new $t(this,fe,Ie)),n.ranges&&(Le.range=[Z,le]),p.push(Le)}}var st=1,ot=2,ut=4,On=8,oi=16,Nn=32,_i=64,Rn=128,Jt=256,yi=512,Ni=st|ot|Jt;function Ri(n,p){return ot|(n?ut:0)|(p?On:0)}var dt=0,xi=1,it=2,Qi=3,$e=4,e=5,i=function(p,I,F){this.options=p=$i(p),this.sourceFile=p.sourceFile,this.keywords=Ve(C[p.ecmaVersion>=6?6:p.sourceType==="module"?"5module":5]);var Z="";p.allowReserved!==!0&&(Z=g[p.ecmaVersion>=6?6:p.ecmaVersion===5?5:3],p.sourceType==="module"&&(Z+=" await")),this.reservedWords=Ve(Z);var le=(Z?Z+" ":"")+g.strict;this.reservedWordsStrict=Ve(le),this.reservedWordsStrictBind=Ve(le+" "+g.strictBind),this.input=String(I),this.containsEsc=!1,F?(this.pos=F,this.lineStart=this.input.lastIndexOf(`
`,F-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(de).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=M.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=p.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&p.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(st),this.regexpState=null,this.privateNameStack=[]},a={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};i.prototype.parse=function(){var p=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(p)},a.inFunction.get=function(){return(this.currentVarScope().flags&ot)>0},a.inGenerator.get=function(){return(this.currentVarScope().flags&On)>0},a.inAsync.get=function(){return(this.currentVarScope().flags&ut)>0},a.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var p=this.scopeStack[n],I=p.flags;if(I&(Jt|yi))return!1;if(I&ot)return(I&ut)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},a.allowSuper.get=function(){var n=this.currentThisScope(),p=n.flags;return(p&_i)>0||this.options.allowSuperOutsideMethod},a.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Rn)>0},a.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},a.allowNewDotTarget.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var p=this.scopeStack[n],I=p.flags;if(I&(Jt|yi)||I&ot&&!(I&oi))return!0}return!1},a.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&Jt)>0},i.extend=function(){for(var p=[],I=arguments.length;I--;)p[I]=arguments[I];for(var F=this,Z=0;Z<p.length;Z++)F=p[Z](F);return F},i.parse=function(p,I){return new this(I,p).parse()},i.parseExpressionAt=function(p,I,F){var Z=new this(F,p,I);return Z.nextToken(),Z.parseExpression()},i.tokenizer=function(p,I){return new this(I,p)},Object.defineProperties(i.prototype,a);var h=i.prototype,f=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;h.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){Se.lastIndex=n,n+=Se.exec(this.input)[0].length;var p=f.exec(this.input.slice(n));if(!p)return!1;if((p[1]||p[2])==="use strict"){Se.lastIndex=n+p[0].length;var I=Se.exec(this.input),F=I.index+I[0].length,Z=this.input.charAt(F);return Z===";"||Z==="}"||de.test(I[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(Z)||Z==="!"&&this.input.charAt(F+1)==="=")}n+=p[0].length,Se.lastIndex=n,n+=Se.exec(this.input)[0].length,this.input[n]===";"&&n++}},h.eat=function(n){return this.type===n?(this.next(),!0):!1},h.isContextual=function(n){return this.type===M.name&&this.value===n&&!this.containsEsc},h.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1},h.expectContextual=function(n){this.eatContextual(n)||this.unexpected()},h.canInsertSemicolon=function(){return this.type===M.eof||this.type===M.braceR||de.test(this.input.slice(this.lastTokEnd,this.start))},h.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},h.semicolon=function(){!this.eat(M.semi)&&!this.insertSemicolon()&&this.unexpected()},h.afterTrailingComma=function(n,p){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),p||this.next(),!0},h.expect=function(n){this.eat(n)||this.unexpected()},h.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var m=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};h.checkPatternErrors=function(n,p){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var I=p?n.parenthesizedAssign:n.parenthesizedBind;I>-1&&this.raiseRecoverable(I,p?"Assigning to rvalue":"Parenthesized pattern")}},h.checkExpressionErrors=function(n,p){if(!n)return!1;var I=n.shorthandAssign,F=n.doubleProto;if(!p)return I>=0||F>=0;I>=0&&this.raise(I,"Shorthand property assignments are valid only in destructuring patterns"),F>=0&&this.raiseRecoverable(F,"Redefinition of __proto__ property")},h.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},h.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var v=i.prototype;v.parseTopLevel=function(n){var p=Object.create(null);for(n.body||(n.body=[]);this.type!==M.eof;){var I=this.parseStatement(null,!0,p);n.body.push(I)}if(this.inModule)for(var F=0,Z=Object.keys(this.undefinedExports);F<Z.length;F+=1){var le=Z[F];this.raiseRecoverable(this.undefinedExports[le].start,"Export '"+le+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var _={kind:"loop"},y={kind:"switch"};v.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Se.lastIndex=this.pos;var p=Se.exec(this.input),I=this.pos+p[0].length,F=this.input.charCodeAt(I);if(F===91||F===92)return!0;if(n)return!1;if(F===123||F>55295&&F<56320)return!0;if(Q(F,!0)){for(var Z=I+1;X(F=this.input.charCodeAt(Z),!0);)++Z;if(F===92||F>55295&&F<56320)return!0;var le=this.input.slice(I,Z);if(!L.test(le))return!0}return!1},v.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Se.lastIndex=this.pos;var n=Se.exec(this.input),p=this.pos+n[0].length,I;return!de.test(this.input.slice(this.pos,p))&&this.input.slice(p,p+8)==="function"&&(p+8===this.input.length||!(X(I=this.input.charCodeAt(p+8))||I>55295&&I<56320))},v.isUsingKeyword=function(n,p){if(this.options.ecmaVersion<17||!this.isContextual(n?"await":"using"))return!1;Se.lastIndex=this.pos;var I=Se.exec(this.input),F=this.pos+I[0].length;if(de.test(this.input.slice(this.pos,F)))return!1;if(n){var Z=F+5,le;if(this.input.slice(F,Z)!=="using"||Z===this.input.length||X(le=this.input.charCodeAt(Z))||le>55295&&le<56320)return!1;Se.lastIndex=Z;var fe=Se.exec(this.input);if(fe&&de.test(this.input.slice(Z,Z+fe[0].length)))return!1}if(p){var Ie=F+2,Le;if(this.input.slice(F,Ie)==="of"&&(Ie===this.input.length||!X(Le=this.input.charCodeAt(Ie))&&!(Le>55295&&Le<56320)))return!1}var He=this.input.charCodeAt(F);return Q(He,!0)||He===92},v.isAwaitUsing=function(n){return this.isUsingKeyword(!0,n)},v.isUsing=function(n){return this.isUsingKeyword(!1,n)},v.parseStatement=function(n,p,I){var F=this.type,Z=this.startNode(),le;switch(this.isLet(n)&&(F=M._var,le="let"),F){case M._break:case M._continue:return this.parseBreakContinueStatement(Z,F.keyword);case M._debugger:return this.parseDebuggerStatement(Z);case M._do:return this.parseDoStatement(Z);case M._for:return this.parseForStatement(Z);case M._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(Z,!1,!n);case M._class:return n&&this.unexpected(),this.parseClass(Z,!0);case M._if:return this.parseIfStatement(Z);case M._return:return this.parseReturnStatement(Z);case M._switch:return this.parseSwitchStatement(Z);case M._throw:return this.parseThrowStatement(Z);case M._try:return this.parseTryStatement(Z);case M._const:case M._var:return le=le||this.value,n&&le!=="var"&&this.unexpected(),this.parseVarStatement(Z,le);case M._while:return this.parseWhileStatement(Z);case M._with:return this.parseWithStatement(Z);case M.braceL:return this.parseBlock(!0,Z);case M.semi:return this.parseEmptyStatement(Z);case M._export:case M._import:if(this.options.ecmaVersion>10&&F===M._import){Se.lastIndex=this.pos;var fe=Se.exec(this.input),Ie=this.pos+fe[0].length,Le=this.input.charCodeAt(Ie);if(Le===40||Le===46)return this.parseExpressionStatement(Z,this.parseExpression())}return this.options.allowImportExportEverywhere||(p||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),F===M._import?this.parseImport(Z):this.parseExport(Z,I);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(Z,!0,!n);var He=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(He)return p&&this.options.sourceType==="script"&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),He==="await using"&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(Z,!1,He),this.semicolon(),this.finishNode(Z,"VariableDeclaration");var Ye=this.value,at=this.parseExpression();return F===M.name&&at.type==="Identifier"&&this.eat(M.colon)?this.parseLabeledStatement(Z,Ye,at,n):this.parseExpressionStatement(Z,at)}},v.parseBreakContinueStatement=function(n,p){var I=p==="break";this.next(),this.eat(M.semi)||this.insertSemicolon()?n.label=null:this.type!==M.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var F=0;F<this.labels.length;++F){var Z=this.labels[F];if((n.label==null||Z.name===n.label.name)&&(Z.kind!=null&&(I||Z.kind==="loop")||n.label&&I))break}return F===this.labels.length&&this.raise(n.start,"Unsyntactic "+p),this.finishNode(n,I?"BreakStatement":"ContinueStatement")},v.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")},v.parseDoStatement=function(n){return this.next(),this.labels.push(_),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(M._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(M.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")},v.parseForStatement=function(n){this.next();var p=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(_),this.enterScope(0),this.expect(M.parenL),this.type===M.semi)return p>-1&&this.unexpected(p),this.parseFor(n,null);var I=this.isLet();if(this.type===M._var||this.type===M._const||I){var F=this.startNode(),Z=I?"let":this.value;return this.next(),this.parseVar(F,!0,Z),this.finishNode(F,"VariableDeclaration"),this.parseForAfterInit(n,F,p)}var le=this.isContextual("let"),fe=!1,Ie=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(Ie){var Le=this.startNode();return this.next(),Ie==="await using"&&this.next(),this.parseVar(Le,!0,Ie),this.finishNode(Le,"VariableDeclaration"),this.parseForAfterInit(n,Le,p)}var He=this.containsEsc,Ye=new m,at=this.start,wt=p>-1?this.parseExprSubscripts(Ye,"await"):this.parseExpression(!0,Ye);return this.type===M._in||(fe=this.options.ecmaVersion>=6&&this.isContextual("of"))?(p>-1?(this.type===M._in&&this.unexpected(p),n.await=!0):fe&&this.options.ecmaVersion>=8&&(wt.start===at&&!He&&wt.type==="Identifier"&&wt.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(n.await=!1)),le&&fe&&this.raise(wt.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(wt,!1,Ye),this.checkLValPattern(wt),this.parseForIn(n,wt)):(this.checkExpressionErrors(Ye,!0),p>-1&&this.unexpected(p),this.parseFor(n,wt))},v.parseForAfterInit=function(n,p,I){return(this.type===M._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&p.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===M._in?I>-1&&this.unexpected(I):n.await=I>-1),this.parseForIn(n,p)):(I>-1&&this.unexpected(I),this.parseFor(n,p))},v.parseFunctionStatement=function(n,p,I){return this.next(),this.parseFunction(n,T|(I?0:z),!1,p)},v.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(M._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")},v.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(M.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")},v.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(M.braceL),this.labels.push(y),this.enterScope(0);for(var p,I=!1;this.type!==M.braceR;)if(this.type===M._case||this.type===M._default){var F=this.type===M._case;p&&this.finishNode(p,"SwitchCase"),n.cases.push(p=this.startNode()),p.consequent=[],this.next(),F?p.test=this.parseExpression():(I&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),I=!0,p.test=null),this.expect(M.colon)}else p||this.unexpected(),p.consequent.push(this.parseStatement(null));return this.exitScope(),p&&this.finishNode(p,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")},v.parseThrowStatement=function(n){return this.next(),de.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var b=[];v.parseCatchClauseParam=function(){var n=this.parseBindingAtom(),p=n.type==="Identifier";return this.enterScope(p?Nn:0),this.checkLValPattern(n,p?$e:it),this.expect(M.parenR),n},v.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===M._catch){var p=this.startNode();this.next(),this.eat(M.parenL)?p.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),p.param=null,this.enterScope(0)),p.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(p,"CatchClause")}return n.finalizer=this.eat(M._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")},v.parseVarStatement=function(n,p,I){return this.next(),this.parseVar(n,!1,p,I),this.semicolon(),this.finishNode(n,"VariableDeclaration")},v.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(_),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")},v.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")},v.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")},v.parseLabeledStatement=function(n,p,I,F){for(var Z=0,le=this.labels;Z<le.length;Z+=1){var fe=le[Z];fe.name===p&&this.raise(I.start,"Label '"+p+"' is already declared")}for(var Ie=this.type.isLoop?"loop":this.type===M._switch?"switch":null,Le=this.labels.length-1;Le>=0;Le--){var He=this.labels[Le];if(He.statementStart===n.start)He.statementStart=this.start,He.kind=Ie;else break}return this.labels.push({name:p,kind:Ie,statementStart:this.start}),n.body=this.parseStatement(F?F.indexOf("label")===-1?F+"label":F:"label"),this.labels.pop(),n.label=I,this.finishNode(n,"LabeledStatement")},v.parseExpressionStatement=function(n,p){return n.expression=p,this.semicolon(),this.finishNode(n,"ExpressionStatement")},v.parseBlock=function(n,p,I){for(n===void 0&&(n=!0),p===void 0&&(p=this.startNode()),p.body=[],this.expect(M.braceL),n&&this.enterScope(0);this.type!==M.braceR;){var F=this.parseStatement(null);p.body.push(F)}return I&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(p,"BlockStatement")},v.parseFor=function(n,p){return n.init=p,this.expect(M.semi),n.test=this.type===M.semi?null:this.parseExpression(),this.expect(M.semi),n.update=this.type===M.parenR?null:this.parseExpression(),this.expect(M.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")},v.parseForIn=function(n,p){var I=this.type===M._in;return this.next(),p.type==="VariableDeclaration"&&p.declarations[0].init!=null&&(!I||this.options.ecmaVersion<8||this.strict||p.kind!=="var"||p.declarations[0].id.type!=="Identifier")&&this.raise(p.start,(I?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=p,n.right=I?this.parseExpression():this.parseMaybeAssign(),this.expect(M.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,I?"ForInStatement":"ForOfStatement")},v.parseVar=function(n,p,I,F){for(n.declarations=[],n.kind=I;;){var Z=this.startNode();if(this.parseVarId(Z,I),this.eat(M.eq)?Z.init=this.parseMaybeAssign(p):!F&&I==="const"&&!(this.type===M._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!F&&(I==="using"||I==="await using")&&this.options.ecmaVersion>=17&&this.type!==M._in&&!this.isContextual("of")?this.raise(this.lastTokEnd,"Missing initializer in "+I+" declaration"):!F&&Z.id.type!=="Identifier"&&!(p&&(this.type===M._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):Z.init=null,n.declarations.push(this.finishNode(Z,"VariableDeclarator")),!this.eat(M.comma))break}return n},v.parseVarId=function(n,p){n.id=p==="using"||p==="await using"?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(n.id,p==="var"?xi:it,!1)};var T=1,z=2,P=4;v.parseFunction=function(n,p,I,F,Z){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!F)&&(this.type===M.star&&p&z&&this.unexpected(),n.generator=this.eat(M.star)),this.options.ecmaVersion>=8&&(n.async=!!F),p&T&&(n.id=p&P&&this.type!==M.name?null:this.parseIdent(),n.id&&!(p&z)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?xi:it:Qi));var le=this.yieldPos,fe=this.awaitPos,Ie=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(n.async,n.generator)),p&T||(n.id=this.type===M.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,I,!1,Z),this.yieldPos=le,this.awaitPos=fe,this.awaitIdentPos=Ie,this.finishNode(n,p&T?"FunctionDeclaration":"FunctionExpression")},v.parseFunctionParams=function(n){this.expect(M.parenL),n.params=this.parseBindingList(M.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},v.parseClass=function(n,p){this.next();var I=this.strict;this.strict=!0,this.parseClassId(n,p),this.parseClassSuper(n);var F=this.enterClassBody(),Z=this.startNode(),le=!1;for(Z.body=[],this.expect(M.braceL);this.type!==M.braceR;){var fe=this.parseClassElement(n.superClass!==null);fe&&(Z.body.push(fe),fe.type==="MethodDefinition"&&fe.kind==="constructor"?(le&&this.raiseRecoverable(fe.start,"Duplicate constructor in the same class"),le=!0):fe.key&&fe.key.type==="PrivateIdentifier"&&S(F,fe)&&this.raiseRecoverable(fe.key.start,"Identifier '#"+fe.key.name+"' has already been declared"))}return this.strict=I,this.next(),n.body=this.finishNode(Z,"ClassBody"),this.exitClassBody(),this.finishNode(n,p?"ClassDeclaration":"ClassExpression")},v.parseClassElement=function(n){if(this.eat(M.semi))return null;var p=this.options.ecmaVersion,I=this.startNode(),F="",Z=!1,le=!1,fe="method",Ie=!1;if(this.eatContextual("static")){if(p>=13&&this.eat(M.braceL))return this.parseClassStaticBlock(I),I;this.isClassElementNameStart()||this.type===M.star?Ie=!0:F="static"}if(I.static=Ie,!F&&p>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===M.star)&&!this.canInsertSemicolon()?le=!0:F="async"),!F&&(p>=9||!le)&&this.eat(M.star)&&(Z=!0),!F&&!le&&!Z){var Le=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?fe=Le:F=Le)}if(F?(I.computed=!1,I.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),I.key.name=F,this.finishNode(I.key,"Identifier")):this.parseClassElementName(I),p<13||this.type===M.parenL||fe!=="method"||Z||le){var He=!I.static&&B(I,"constructor"),Ye=He&&n;He&&fe!=="method"&&this.raise(I.key.start,"Constructor can't have get/set modifier"),I.kind=He?"constructor":fe,this.parseClassMethod(I,Z,le,Ye)}else this.parseClassField(I);return I},v.isClassElementNameStart=function(){return this.type===M.name||this.type===M.privateId||this.type===M.num||this.type===M.string||this.type===M.bracketL||this.type.keyword},v.parseClassElementName=function(n){this.type===M.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)},v.parseClassMethod=function(n,p,I,F){var Z=n.key;n.kind==="constructor"?(p&&this.raise(Z.start,"Constructor can't be a generator"),I&&this.raise(Z.start,"Constructor can't be an async method")):n.static&&B(n,"prototype")&&this.raise(Z.start,"Classes may not have a static property named prototype");var le=n.value=this.parseMethod(p,I,F);return n.kind==="get"&&le.params.length!==0&&this.raiseRecoverable(le.start,"getter should have no params"),n.kind==="set"&&le.params.length!==1&&this.raiseRecoverable(le.start,"setter should have exactly one param"),n.kind==="set"&&le.params[0].type==="RestElement"&&this.raiseRecoverable(le.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")},v.parseClassField=function(n){return B(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&B(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(M.eq)?(this.enterScope(yi|_i),n.value=this.parseMaybeAssign(),this.exitScope()):n.value=null,this.semicolon(),this.finishNode(n,"PropertyDefinition")},v.parseClassStaticBlock=function(n){n.body=[];var p=this.labels;for(this.labels=[],this.enterScope(Jt|_i);this.type!==M.braceR;){var I=this.parseStatement(null);n.body.push(I)}return this.next(),this.exitScope(),this.labels=p,this.finishNode(n,"StaticBlock")},v.parseClassId=function(n,p){this.type===M.name?(n.id=this.parseIdent(),p&&this.checkLValSimple(n.id,it,!1)):(p===!0&&this.unexpected(),n.id=null)},v.parseClassSuper=function(n){n.superClass=this.eat(M._extends)?this.parseExprSubscripts(null,!1):null},v.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared},v.exitClassBody=function(){var n=this.privateNameStack.pop(),p=n.declared,I=n.used;if(this.options.checkPrivateFields)for(var F=this.privateNameStack.length,Z=F===0?null:this.privateNameStack[F-1],le=0;le<I.length;++le){var fe=I[le];me(p,fe.name)||(Z?Z.used.push(fe):this.raiseRecoverable(fe.start,"Private field '#"+fe.name+"' must be declared in an enclosing class"))}};function S(n,p){var I=p.key.name,F=n[I],Z="true";return p.type==="MethodDefinition"&&(p.kind==="get"||p.kind==="set")&&(Z=(p.static?"s":"i")+p.kind),F==="iget"&&Z==="iset"||F==="iset"&&Z==="iget"||F==="sget"&&Z==="sset"||F==="sset"&&Z==="sget"?(n[I]="true",!1):F?!0:(n[I]=Z,!1)}function B(n,p){var I=n.computed,F=n.key;return!I&&(F.type==="Identifier"&&F.name===p||F.type==="Literal"&&F.value===p)}v.parseExportAllDeclaration=function(n,p){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(p,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==M.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ExportAllDeclaration")},v.parseExport=function(n,p){if(this.next(),this.eat(M.star))return this.parseExportAllDeclaration(n,p);if(this.eat(M._default))return this.checkExport(p,"default",this.lastTokStart),n.declaration=this.parseExportDefaultDeclaration(),this.finishNode(n,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())n.declaration=this.parseExportDeclaration(n),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(p,n.declaration.declarations):this.checkExport(p,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[]);else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(p),this.eatContextual("from"))this.type!==M.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause());else{for(var I=0,F=n.specifiers;I<F.length;I+=1){var Z=F[I];this.checkUnreserved(Z.local),this.checkLocalExport(Z.local),Z.local.type==="Literal"&&this.raise(Z.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[])}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")},v.parseExportDeclaration=function(n){return this.parseStatement(null)},v.parseExportDefaultDeclaration=function(){var n;if(this.type===M._function||(n=this.isAsyncFunction())){var p=this.startNode();return this.next(),n&&this.next(),this.parseFunction(p,T|P,!1,n)}else if(this.type===M._class){var I=this.startNode();return this.parseClass(I,"nullableID")}else{var F=this.parseMaybeAssign();return this.semicolon(),F}},v.checkExport=function(n,p,I){n&&(typeof p!="string"&&(p=p.type==="Identifier"?p.name:p.value),me(n,p)&&this.raiseRecoverable(I,"Duplicate export '"+p+"'"),n[p]=!0)},v.checkPatternExport=function(n,p){var I=p.type;if(I==="Identifier")this.checkExport(n,p,p.start);else if(I==="ObjectPattern")for(var F=0,Z=p.properties;F<Z.length;F+=1){var le=Z[F];this.checkPatternExport(n,le)}else if(I==="ArrayPattern")for(var fe=0,Ie=p.elements;fe<Ie.length;fe+=1){var Le=Ie[fe];Le&&this.checkPatternExport(n,Le)}else I==="Property"?this.checkPatternExport(n,p.value):I==="AssignmentPattern"?this.checkPatternExport(n,p.left):I==="RestElement"&&this.checkPatternExport(n,p.argument)},v.checkVariableExport=function(n,p){if(n)for(var I=0,F=p;I<F.length;I+=1){var Z=F[I];this.checkPatternExport(n,Z.id)}},v.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},v.parseExportSpecifier=function(n){var p=this.startNode();return p.local=this.parseModuleExportName(),p.exported=this.eatContextual("as")?this.parseModuleExportName():p.local,this.checkExport(n,p.exported,p.exported.start),this.finishNode(p,"ExportSpecifier")},v.parseExportSpecifiers=function(n){var p=[],I=!0;for(this.expect(M.braceL);!this.eat(M.braceR);){if(I)I=!1;else if(this.expect(M.comma),this.afterTrailingComma(M.braceR))break;p.push(this.parseExportSpecifier(n))}return p},v.parseImport=function(n){return this.next(),this.type===M.string?(n.specifiers=b,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===M.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ImportDeclaration")},v.parseImportSpecifier=function(){var n=this.startNode();return n.imported=this.parseModuleExportName(),this.eatContextual("as")?n.local=this.parseIdent():(this.checkUnreserved(n.imported),n.local=n.imported),this.checkLValSimple(n.local,it),this.finishNode(n,"ImportSpecifier")},v.parseImportDefaultSpecifier=function(){var n=this.startNode();return n.local=this.parseIdent(),this.checkLValSimple(n.local,it),this.finishNode(n,"ImportDefaultSpecifier")},v.parseImportNamespaceSpecifier=function(){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLValSimple(n.local,it),this.finishNode(n,"ImportNamespaceSpecifier")},v.parseImportSpecifiers=function(){var n=[],p=!0;if(this.type===M.name&&(n.push(this.parseImportDefaultSpecifier()),!this.eat(M.comma)))return n;if(this.type===M.star)return n.push(this.parseImportNamespaceSpecifier()),n;for(this.expect(M.braceL);!this.eat(M.braceR);){if(p)p=!1;else if(this.expect(M.comma),this.afterTrailingComma(M.braceR))break;n.push(this.parseImportSpecifier())}return n},v.parseWithClause=function(){var n=[];if(!this.eat(M._with))return n;this.expect(M.braceL);for(var p={},I=!0;!this.eat(M.braceR);){if(I)I=!1;else if(this.expect(M.comma),this.afterTrailingComma(M.braceR))break;var F=this.parseImportAttribute(),Z=F.key.type==="Identifier"?F.key.name:F.key.value;me(p,Z)&&this.raiseRecoverable(F.key.start,"Duplicate attribute key '"+Z+"'"),p[Z]=!0,n.push(F)}return n},v.parseImportAttribute=function(){var n=this.startNode();return n.key=this.type===M.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(M.colon),this.type!==M.string&&this.unexpected(),n.value=this.parseExprAtom(),this.finishNode(n,"ImportAttribute")},v.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===M.string){var n=this.parseLiteral(this.value);return Kt.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)},v.adaptDirectivePrologue=function(n){for(var p=0;p<n.length&&this.isDirectiveCandidate(n[p]);++p)n[p].directive=n[p].expression.raw.slice(1,-1)},v.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var O=i.prototype;O.toAssignable=function(n,p,I){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",I&&this.checkPatternErrors(I,!0);for(var F=0,Z=n.properties;F<Z.length;F+=1){var le=Z[F];this.toAssignable(le,p),le.type==="RestElement"&&(le.argument.type==="ArrayPattern"||le.argument.type==="ObjectPattern")&&this.raise(le.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,p);break;case"ArrayExpression":n.type="ArrayPattern",I&&this.checkPatternErrors(I,!0),this.toAssignableList(n.elements,p);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,p),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,p);break;case"ParenthesizedExpression":this.toAssignable(n.expression,p,I);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!p)break;default:this.raise(n.start,"Assigning to rvalue")}else I&&this.checkPatternErrors(I,!0);return n},O.toAssignableList=function(n,p){for(var I=n.length,F=0;F<I;F++){var Z=n[F];Z&&this.toAssignable(Z,p)}if(I){var le=n[I-1];this.options.ecmaVersion===6&&p&&le&&le.type==="RestElement"&&le.argument.type!=="Identifier"&&this.unexpected(le.argument.start)}return n},O.parseSpread=function(n){var p=this.startNode();return this.next(),p.argument=this.parseMaybeAssign(!1,n),this.finishNode(p,"SpreadElement")},O.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==M.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")},O.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case M.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(M.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case M.braceL:return this.parseObj(!0)}return this.parseIdent()},O.parseBindingList=function(n,p,I,F){for(var Z=[],le=!0;!this.eat(n);)if(le?le=!1:this.expect(M.comma),p&&this.type===M.comma)Z.push(null);else{if(I&&this.afterTrailingComma(n))break;if(this.type===M.ellipsis){var fe=this.parseRestBinding();this.parseBindingListItem(fe),Z.push(fe),this.type===M.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else Z.push(this.parseAssignableListItem(F))}return Z},O.parseAssignableListItem=function(n){var p=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(p),p},O.parseBindingListItem=function(n){return n},O.parseMaybeDefault=function(n,p,I){if(I=I||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(M.eq))return I;var F=this.startNodeAt(n,p);return F.left=I,F.right=this.parseMaybeAssign(),this.finishNode(F,"AssignmentPattern")},O.checkLValSimple=function(n,p,I){p===void 0&&(p=dt);var F=p!==dt;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(F?"Binding ":"Assigning to ")+n.name+" in strict mode"),F&&(p===it&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),I&&(me(I,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),I[n.name]=!0),p!==e&&this.declareName(n.name,p,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":F&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return F&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,p,I);default:this.raise(n.start,(F?"Binding":"Assigning to")+" rvalue")}},O.checkLValPattern=function(n,p,I){switch(p===void 0&&(p=dt),n.type){case"ObjectPattern":for(var F=0,Z=n.properties;F<Z.length;F+=1){var le=Z[F];this.checkLValInnerPattern(le,p,I)}break;case"ArrayPattern":for(var fe=0,Ie=n.elements;fe<Ie.length;fe+=1){var Le=Ie[fe];Le&&this.checkLValInnerPattern(Le,p,I)}break;default:this.checkLValSimple(n,p,I)}},O.checkLValInnerPattern=function(n,p,I){switch(p===void 0&&(p=dt),n.type){case"Property":this.checkLValInnerPattern(n.value,p,I);break;case"AssignmentPattern":this.checkLValPattern(n.left,p,I);break;case"RestElement":this.checkLValPattern(n.argument,p,I);break;default:this.checkLValPattern(n,p,I)}};var V=function(p,I,F,Z,le){this.token=p,this.isExpr=!!I,this.preserveSpace=!!F,this.override=Z,this.generator=!!le},k={b_stat:new V("{",!1),b_expr:new V("{",!0),b_tmpl:new V("${",!1),p_stat:new V("(",!1),p_expr:new V("(",!0),q_tmpl:new V("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new V("function",!1),f_expr:new V("function",!0),f_expr_gen:new V("function",!0,!1,null,!0),f_gen:new V("function",!1,!1,null,!0)},R=i.prototype;R.initialContext=function(){return[k.b_stat]},R.curContext=function(){return this.context[this.context.length-1]},R.braceIsBlock=function(n){var p=this.curContext();return p===k.f_expr||p===k.f_stat?!0:n===M.colon&&(p===k.b_stat||p===k.b_expr)?!p.isExpr:n===M._return||n===M.name&&this.exprAllowed?de.test(this.input.slice(this.lastTokEnd,this.start)):n===M._else||n===M.semi||n===M.eof||n===M.parenR||n===M.arrow?!0:n===M.braceL?p===k.b_stat:n===M._var||n===M._const||n===M.name?!1:!this.exprAllowed},R.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var p=this.context[n];if(p.token==="function")return p.generator}return!1},R.updateContext=function(n){var p,I=this.type;I.keyword&&n===M.dot?this.exprAllowed=!1:(p=I.updateContext)?p.call(this,n):this.exprAllowed=I.beforeExpr},R.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)},M.parenR.updateContext=M.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===k.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr},M.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?k.b_stat:k.b_expr),this.exprAllowed=!0},M.dollarBraceL.updateContext=function(){this.context.push(k.b_tmpl),this.exprAllowed=!0},M.parenL.updateContext=function(n){var p=n===M._if||n===M._for||n===M._with||n===M._while;this.context.push(p?k.p_stat:k.p_expr),this.exprAllowed=!0},M.incDec.updateContext=function(){},M._function.updateContext=M._class.updateContext=function(n){n.beforeExpr&&n!==M._else&&!(n===M.semi&&this.curContext()!==k.p_stat)&&!(n===M._return&&de.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===M.colon||n===M.braceL)&&this.curContext()===k.b_stat)?this.context.push(k.f_expr):this.context.push(k.f_stat),this.exprAllowed=!1},M.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0},M.backQuote.updateContext=function(){this.curContext()===k.q_tmpl?this.context.pop():this.context.push(k.q_tmpl),this.exprAllowed=!1},M.star.updateContext=function(n){if(n===M._function){var p=this.context.length-1;this.context[p]===k.f_expr?this.context[p]=k.f_expr_gen:this.context[p]=k.f_gen}this.exprAllowed=!0},M.name.updateContext=function(n){var p=!1;this.options.ecmaVersion>=6&&n!==M.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(p=!0),this.exprAllowed=p};var w=i.prototype;w.checkPropClash=function(n,p,I){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var F=n.key,Z;switch(F.type){case"Identifier":Z=F.name;break;case"Literal":Z=String(F.value);break;default:return}var le=n.kind;if(this.options.ecmaVersion>=6){Z==="__proto__"&&le==="init"&&(p.proto&&(I?I.doubleProto<0&&(I.doubleProto=F.start):this.raiseRecoverable(F.start,"Redefinition of __proto__ property")),p.proto=!0);return}Z="$"+Z;var fe=p[Z];if(fe){var Ie;le==="init"?Ie=this.strict&&fe.init||fe.get||fe.set:Ie=fe.init||fe[le],Ie&&this.raiseRecoverable(F.start,"Redefinition of property")}else fe=p[Z]={init:!1,get:!1,set:!1};fe[le]=!0}},w.parseExpression=function(n,p){var I=this.start,F=this.startLoc,Z=this.parseMaybeAssign(n,p);if(this.type===M.comma){var le=this.startNodeAt(I,F);for(le.expressions=[Z];this.eat(M.comma);)le.expressions.push(this.parseMaybeAssign(n,p));return this.finishNode(le,"SequenceExpression")}return Z},w.parseMaybeAssign=function(n,p,I){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var F=!1,Z=-1,le=-1,fe=-1;p?(Z=p.parenthesizedAssign,le=p.trailingComma,fe=p.doubleProto,p.parenthesizedAssign=p.trailingComma=-1):(p=new m,F=!0);var Ie=this.start,Le=this.startLoc;(this.type===M.parenL||this.type===M.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var He=this.parseMaybeConditional(n,p);if(I&&(He=I.call(this,He,Ie,Le)),this.type.isAssign){var Ye=this.startNodeAt(Ie,Le);return Ye.operator=this.value,this.type===M.eq&&(He=this.toAssignable(He,!1,p)),F||(p.parenthesizedAssign=p.trailingComma=p.doubleProto=-1),p.shorthandAssign>=He.start&&(p.shorthandAssign=-1),this.type===M.eq?this.checkLValPattern(He):this.checkLValSimple(He),Ye.left=He,this.next(),Ye.right=this.parseMaybeAssign(n),fe>-1&&(p.doubleProto=fe),this.finishNode(Ye,"AssignmentExpression")}else F&&this.checkExpressionErrors(p,!0);return Z>-1&&(p.parenthesizedAssign=Z),le>-1&&(p.trailingComma=le),He},w.parseMaybeConditional=function(n,p){var I=this.start,F=this.startLoc,Z=this.parseExprOps(n,p);if(this.checkExpressionErrors(p))return Z;if(this.eat(M.question)){var le=this.startNodeAt(I,F);return le.test=Z,le.consequent=this.parseMaybeAssign(),this.expect(M.colon),le.alternate=this.parseMaybeAssign(n),this.finishNode(le,"ConditionalExpression")}return Z},w.parseExprOps=function(n,p){var I=this.start,F=this.startLoc,Z=this.parseMaybeUnary(p,!1,!1,n);return this.checkExpressionErrors(p)||Z.start===I&&Z.type==="ArrowFunctionExpression"?Z:this.parseExprOp(Z,I,F,-1,n)},w.parseExprOp=function(n,p,I,F,Z){var le=this.type.binop;if(le!=null&&(!Z||this.type!==M._in)&&le>F){var fe=this.type===M.logicalOR||this.type===M.logicalAND,Ie=this.type===M.coalesce;Ie&&(le=M.logicalAND.binop);var Le=this.value;this.next();var He=this.start,Ye=this.startLoc,at=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,Z),He,Ye,le,Z),wt=this.buildBinary(p,I,n,at,Le,fe||Ie);return(fe&&this.type===M.coalesce||Ie&&(this.type===M.logicalOR||this.type===M.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(wt,p,I,F,Z)}return n},w.buildBinary=function(n,p,I,F,Z,le){F.type==="PrivateIdentifier"&&this.raise(F.start,"Private identifier can only be left side of binary expression");var fe=this.startNodeAt(n,p);return fe.left=I,fe.operator=Z,fe.right=F,this.finishNode(fe,le?"LogicalExpression":"BinaryExpression")},w.parseMaybeUnary=function(n,p,I,F){var Z=this.start,le=this.startLoc,fe;if(this.isContextual("await")&&this.canAwait)fe=this.parseAwait(F),p=!0;else if(this.type.prefix){var Ie=this.startNode(),Le=this.type===M.incDec;Ie.operator=this.value,Ie.prefix=!0,this.next(),Ie.argument=this.parseMaybeUnary(null,!0,Le,F),this.checkExpressionErrors(n,!0),Le?this.checkLValSimple(Ie.argument):this.strict&&Ie.operator==="delete"&&N(Ie.argument)?this.raiseRecoverable(Ie.start,"Deleting local variable in strict mode"):Ie.operator==="delete"&&U(Ie.argument)?this.raiseRecoverable(Ie.start,"Private fields can not be deleted"):p=!0,fe=this.finishNode(Ie,Le?"UpdateExpression":"UnaryExpression")}else if(!p&&this.type===M.privateId)(F||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),fe=this.parsePrivateIdent(),this.type!==M._in&&this.unexpected();else{if(fe=this.parseExprSubscripts(n,F),this.checkExpressionErrors(n))return fe;for(;this.type.postfix&&!this.canInsertSemicolon();){var He=this.startNodeAt(Z,le);He.operator=this.value,He.prefix=!1,He.argument=fe,this.checkLValSimple(fe),this.next(),fe=this.finishNode(He,"UpdateExpression")}}if(!I&&this.eat(M.starstar))if(p)this.unexpected(this.lastTokStart);else return this.buildBinary(Z,le,fe,this.parseMaybeUnary(null,!1,!1,F),"**",!1);else return fe};function N(n){return n.type==="Identifier"||n.type==="ParenthesizedExpression"&&N(n.expression)}function U(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&U(n.expression)||n.type==="ParenthesizedExpression"&&U(n.expression)}w.parseExprSubscripts=function(n,p){var I=this.start,F=this.startLoc,Z=this.parseExprAtom(n,p);if(Z.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return Z;var le=this.parseSubscripts(Z,I,F,!1,p);return n&&le.type==="MemberExpression"&&(n.parenthesizedAssign>=le.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=le.start&&(n.parenthesizedBind=-1),n.trailingComma>=le.start&&(n.trailingComma=-1)),le},w.parseSubscripts=function(n,p,I,F,Z){for(var le=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,fe=!1;;){var Ie=this.parseSubscript(n,p,I,F,le,fe,Z);if(Ie.optional&&(fe=!0),Ie===n||Ie.type==="ArrowFunctionExpression"){if(fe){var Le=this.startNodeAt(p,I);Le.expression=Ie,Ie=this.finishNode(Le,"ChainExpression")}return Ie}n=Ie}},w.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(M.arrow)},w.parseSubscriptAsyncArrow=function(n,p,I,F){return this.parseArrowExpression(this.startNodeAt(n,p),I,!0,F)},w.parseSubscript=function(n,p,I,F,Z,le,fe){var Ie=this.options.ecmaVersion>=11,Le=Ie&&this.eat(M.questionDot);F&&Le&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var He=this.eat(M.bracketL);if(He||Le&&this.type!==M.parenL&&this.type!==M.backQuote||this.eat(M.dot)){var Ye=this.startNodeAt(p,I);Ye.object=n,He?(Ye.property=this.parseExpression(),this.expect(M.bracketR)):this.type===M.privateId&&n.type!=="Super"?Ye.property=this.parsePrivateIdent():Ye.property=this.parseIdent(this.options.allowReserved!=="never"),Ye.computed=!!He,Ie&&(Ye.optional=Le),n=this.finishNode(Ye,"MemberExpression")}else if(!F&&this.eat(M.parenL)){var at=new m,wt=this.yieldPos,Ci=this.awaitPos,ii=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yt=this.parseExprList(M.parenR,this.options.ecmaVersion>=8,!1,at);if(Z&&!Le&&this.shouldParseAsyncArrow())return this.checkPatternErrors(at,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=wt,this.awaitPos=Ci,this.awaitIdentPos=ii,this.parseSubscriptAsyncArrow(p,I,Yt,fe);this.checkExpressionErrors(at,!0),this.yieldPos=wt||this.yieldPos,this.awaitPos=Ci||this.awaitPos,this.awaitIdentPos=ii||this.awaitIdentPos;var li=this.startNodeAt(p,I);li.callee=n,li.arguments=Yt,Ie&&(li.optional=Le),n=this.finishNode(li,"CallExpression")}else if(this.type===M.backQuote){(Le||le)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var hi=this.startNodeAt(p,I);hi.tag=n,hi.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(hi,"TaggedTemplateExpression")}return n},w.parseExprAtom=function(n,p,I){this.type===M.slash&&this.readRegexp();var F,Z=this.potentialArrowAt===this.start;switch(this.type){case M._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),F=this.startNode(),this.next(),this.type===M.parenL&&!this.allowDirectSuper&&this.raise(F.start,"super() call outside constructor of a subclass"),this.type!==M.dot&&this.type!==M.bracketL&&this.type!==M.parenL&&this.unexpected(),this.finishNode(F,"Super");case M._this:return F=this.startNode(),this.next(),this.finishNode(F,"ThisExpression");case M.name:var le=this.start,fe=this.startLoc,Ie=this.containsEsc,Le=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ie&&Le.name==="async"&&!this.canInsertSemicolon()&&this.eat(M._function))return this.overrideContext(k.f_expr),this.parseFunction(this.startNodeAt(le,fe),0,!1,!0,p);if(Z&&!this.canInsertSemicolon()){if(this.eat(M.arrow))return this.parseArrowExpression(this.startNodeAt(le,fe),[Le],!1,p);if(this.options.ecmaVersion>=8&&Le.name==="async"&&this.type===M.name&&!Ie&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return Le=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(M.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(le,fe),[Le],!0,p)}return Le;case M.regexp:var He=this.value;return F=this.parseLiteral(He.value),F.regex={pattern:He.pattern,flags:He.flags},F;case M.num:case M.string:return this.parseLiteral(this.value);case M._null:case M._true:case M._false:return F=this.startNode(),F.value=this.type===M._null?null:this.type===M._true,F.raw=this.type.keyword,this.next(),this.finishNode(F,"Literal");case M.parenL:var Ye=this.start,at=this.parseParenAndDistinguishExpression(Z,p);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(at)&&(n.parenthesizedAssign=Ye),n.parenthesizedBind<0&&(n.parenthesizedBind=Ye)),at;case M.bracketL:return F=this.startNode(),this.next(),F.elements=this.parseExprList(M.bracketR,!0,!0,n),this.finishNode(F,"ArrayExpression");case M.braceL:return this.overrideContext(k.b_expr),this.parseObj(!1,n);case M._function:return F=this.startNode(),this.next(),this.parseFunction(F,0);case M._class:return this.parseClass(this.startNode(),!1);case M._new:return this.parseNew();case M.backQuote:return this.parseTemplate();case M._import:return this.options.ecmaVersion>=11?this.parseExprImport(I):this.unexpected();default:return this.parseExprAtomDefault()}},w.parseExprAtomDefault=function(){this.unexpected()},w.parseExprImport=function(n){var p=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===M.parenL&&!n)return this.parseDynamicImport(p);if(this.type===M.dot){var I=this.startNodeAt(p.start,p.loc&&p.loc.start);return I.name="import",p.meta=this.finishNode(I,"Identifier"),this.parseImportMeta(p)}else this.unexpected()},w.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(M.parenR)?n.options=null:(this.expect(M.comma),this.afterTrailingComma(M.parenR)?n.options=null:(n.options=this.parseMaybeAssign(),this.eat(M.parenR)||(this.expect(M.comma),this.afterTrailingComma(M.parenR)||this.unexpected())));else if(!this.eat(M.parenR)){var p=this.start;this.eat(M.comma)&&this.eat(M.parenR)?this.raiseRecoverable(p,"Trailing comma is not allowed in import()"):this.unexpected(p)}return this.finishNode(n,"ImportExpression")},w.parseImportMeta=function(n){this.next();var p=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),p&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")},w.parseLiteral=function(n){var p=this.startNode();return p.value=n,p.raw=this.input.slice(this.start,this.end),p.raw.charCodeAt(p.raw.length-1)===110&&(p.bigint=p.value!=null?p.value.toString():p.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(p,"Literal")},w.parseParenExpression=function(){this.expect(M.parenL);var n=this.parseExpression();return this.expect(M.parenR),n},w.shouldParseArrow=function(n){return!this.canInsertSemicolon()},w.parseParenAndDistinguishExpression=function(n,p){var I=this.start,F=this.startLoc,Z,le=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var fe=this.start,Ie=this.startLoc,Le=[],He=!0,Ye=!1,at=new m,wt=this.yieldPos,Ci=this.awaitPos,ii;for(this.yieldPos=0,this.awaitPos=0;this.type!==M.parenR;)if(He?He=!1:this.expect(M.comma),le&&this.afterTrailingComma(M.parenR,!0)){Ye=!0;break}else if(this.type===M.ellipsis){ii=this.start,Le.push(this.parseParenItem(this.parseRestBinding())),this.type===M.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else Le.push(this.parseMaybeAssign(!1,at,this.parseParenItem));var Yt=this.lastTokEnd,li=this.lastTokEndLoc;if(this.expect(M.parenR),n&&this.shouldParseArrow(Le)&&this.eat(M.arrow))return this.checkPatternErrors(at,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=wt,this.awaitPos=Ci,this.parseParenArrowList(I,F,Le,p);(!Le.length||Ye)&&this.unexpected(this.lastTokStart),ii&&this.unexpected(ii),this.checkExpressionErrors(at,!0),this.yieldPos=wt||this.yieldPos,this.awaitPos=Ci||this.awaitPos,Le.length>1?(Z=this.startNodeAt(fe,Ie),Z.expressions=Le,this.finishNodeAt(Z,"SequenceExpression",Yt,li)):Z=Le[0]}else Z=this.parseParenExpression();if(this.options.preserveParens){var hi=this.startNodeAt(I,F);return hi.expression=Z,this.finishNode(hi,"ParenthesizedExpression")}else return Z},w.parseParenItem=function(n){return n},w.parseParenArrowList=function(n,p,I,F){return this.parseArrowExpression(this.startNodeAt(n,p),I,!1,F)};var H=[];w.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===M.dot){var p=this.startNodeAt(n.start,n.loc&&n.loc.start);p.name="new",n.meta=this.finishNode(p,"Identifier"),this.next();var I=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),I&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var F=this.start,Z=this.startLoc;return n.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),F,Z,!0,!1),this.eat(M.parenL)?n.arguments=this.parseExprList(M.parenR,this.options.ecmaVersion>=8,!1):n.arguments=H,this.finishNode(n,"NewExpression")},w.parseTemplateElement=function(n){var p=n.isTagged,I=this.startNode();return this.type===M.invalidTemplate?(p||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),I.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):I.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),I.tail=this.type===M.backQuote,this.finishNode(I,"TemplateElement")},w.parseTemplate=function(n){n===void 0&&(n={});var p=n.isTagged;p===void 0&&(p=!1);var I=this.startNode();this.next(),I.expressions=[];var F=this.parseTemplateElement({isTagged:p});for(I.quasis=[F];!F.tail;)this.type===M.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(M.dollarBraceL),I.expressions.push(this.parseExpression()),this.expect(M.braceR),I.quasis.push(F=this.parseTemplateElement({isTagged:p}));return this.next(),this.finishNode(I,"TemplateLiteral")},w.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===M.name||this.type===M.num||this.type===M.string||this.type===M.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===M.star)&&!de.test(this.input.slice(this.lastTokEnd,this.start))},w.parseObj=function(n,p){var I=this.startNode(),F=!0,Z={};for(I.properties=[],this.next();!this.eat(M.braceR);){if(F)F=!1;else if(this.expect(M.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(M.braceR))break;var le=this.parseProperty(n,p);n||this.checkPropClash(le,Z,p),I.properties.push(le)}return this.finishNode(I,n?"ObjectPattern":"ObjectExpression")},w.parseProperty=function(n,p){var I=this.startNode(),F,Z,le,fe;if(this.options.ecmaVersion>=9&&this.eat(M.ellipsis))return n?(I.argument=this.parseIdent(!1),this.type===M.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(I,"RestElement")):(I.argument=this.parseMaybeAssign(!1,p),this.type===M.comma&&p&&p.trailingComma<0&&(p.trailingComma=this.start),this.finishNode(I,"SpreadElement"));this.options.ecmaVersion>=6&&(I.method=!1,I.shorthand=!1,(n||p)&&(le=this.start,fe=this.startLoc),n||(F=this.eat(M.star)));var Ie=this.containsEsc;return this.parsePropertyName(I),!n&&!Ie&&this.options.ecmaVersion>=8&&!F&&this.isAsyncProp(I)?(Z=!0,F=this.options.ecmaVersion>=9&&this.eat(M.star),this.parsePropertyName(I)):Z=!1,this.parsePropertyValue(I,n,F,Z,le,fe,p,Ie),this.finishNode(I,"Property")},w.parseGetterSetter=function(n){var p=n.key.name;this.parsePropertyName(n),n.value=this.parseMethod(!1),n.kind=p;var I=n.kind==="get"?0:1;if(n.value.params.length!==I){var F=n.value.start;n.kind==="get"?this.raiseRecoverable(F,"getter should have no params"):this.raiseRecoverable(F,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")},w.parsePropertyValue=function(n,p,I,F,Z,le,fe,Ie){(I||F)&&this.type===M.colon&&this.unexpected(),this.eat(M.colon)?(n.value=p?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,fe),n.kind="init"):this.options.ecmaVersion>=6&&this.type===M.parenL?(p&&this.unexpected(),n.method=!0,n.value=this.parseMethod(I,F),n.kind="init"):!p&&!Ie&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==M.comma&&this.type!==M.braceR&&this.type!==M.eq?((I||F)&&this.unexpected(),this.parseGetterSetter(n)):this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((I||F)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Z),p?n.value=this.parseMaybeDefault(Z,le,this.copyNode(n.key)):this.type===M.eq&&fe?(fe.shorthandAssign<0&&(fe.shorthandAssign=this.start),n.value=this.parseMaybeDefault(Z,le,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.kind="init",n.shorthand=!0):this.unexpected()},w.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(M.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(M.bracketR),n.key;n.computed=!1}return n.key=this.type===M.num||this.type===M.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},w.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)},w.parseMethod=function(n,p,I){var F=this.startNode(),Z=this.yieldPos,le=this.awaitPos,fe=this.awaitIdentPos;return this.initFunction(F),this.options.ecmaVersion>=6&&(F.generator=n),this.options.ecmaVersion>=8&&(F.async=!!p),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(p,F.generator)|_i|(I?Rn:0)),this.expect(M.parenL),F.params=this.parseBindingList(M.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(F,!1,!0,!1),this.yieldPos=Z,this.awaitPos=le,this.awaitIdentPos=fe,this.finishNode(F,"FunctionExpression")},w.parseArrowExpression=function(n,p,I,F){var Z=this.yieldPos,le=this.awaitPos,fe=this.awaitIdentPos;return this.enterScope(Ri(I,!1)|oi),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!I),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(p,!0),this.parseFunctionBody(n,!0,!1,F),this.yieldPos=Z,this.awaitPos=le,this.awaitIdentPos=fe,this.finishNode(n,"ArrowFunctionExpression")},w.parseFunctionBody=function(n,p,I,F){var Z=p&&this.type!==M.braceL,le=this.strict,fe=!1;if(Z)n.body=this.parseMaybeAssign(F),n.expression=!0,this.checkParams(n,!1);else{var Ie=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!le||Ie)&&(fe=this.strictDirective(this.end),fe&&Ie&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Le=this.labels;this.labels=[],fe&&(this.strict=!0),this.checkParams(n,!le&&!fe&&!p&&!I&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,e),n.body=this.parseBlock(!1,void 0,fe&&!le),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=Le}this.exitScope()},w.isSimpleParamList=function(n){for(var p=0,I=n;p<I.length;p+=1){var F=I[p];if(F.type!=="Identifier")return!1}return!0},w.checkParams=function(n,p){for(var I=Object.create(null),F=0,Z=n.params;F<Z.length;F+=1){var le=Z[F];this.checkLValInnerPattern(le,xi,p?null:I)}},w.parseExprList=function(n,p,I,F){for(var Z=[],le=!0;!this.eat(n);){if(le)le=!1;else if(this.expect(M.comma),p&&this.afterTrailingComma(n))break;var fe=void 0;I&&this.type===M.comma?fe=null:this.type===M.ellipsis?(fe=this.parseSpread(F),F&&this.type===M.comma&&F.trailingComma<0&&(F.trailingComma=this.start)):fe=this.parseMaybeAssign(!1,F),Z.push(fe)}return Z},w.checkUnreserved=function(n){var p=n.start,I=n.end,F=n.name;if(this.inGenerator&&F==="yield"&&this.raiseRecoverable(p,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&F==="await"&&this.raiseRecoverable(p,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&Ni)&&F==="arguments"&&this.raiseRecoverable(p,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(F==="arguments"||F==="await")&&this.raise(p,"Cannot use "+F+" in class static initialization block"),this.keywords.test(F)&&this.raise(p,"Unexpected keyword '"+F+"'"),!(this.options.ecmaVersion<6&&this.input.slice(p,I).indexOf("\\")!==-1)){var Z=this.strict?this.reservedWordsStrict:this.reservedWords;Z.test(F)&&(!this.inAsync&&F==="await"&&this.raiseRecoverable(p,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(p,"The keyword '"+F+"' is reserved"))}},w.parseIdent=function(n){var p=this.parseIdentNode();return this.next(!!n),this.finishNode(p,"Identifier"),n||(this.checkUnreserved(p),p.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=p.start)),p},w.parseIdentNode=function(){var n=this.startNode();return this.type===M.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,(n.name==="class"||n.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=M.name):this.unexpected(),n},w.parsePrivateIdent=function(){var n=this.startNode();return this.type===M.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n)),n},w.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var p=this.startNode();return this.next(),this.type===M.semi||this.canInsertSemicolon()||this.type!==M.star&&!this.type.startsExpr?(p.delegate=!1,p.argument=null):(p.delegate=this.eat(M.star),p.argument=this.parseMaybeAssign(n)),this.finishNode(p,"YieldExpression")},w.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var p=this.startNode();return this.next(),p.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(p,"AwaitExpression")};var D=i.prototype;D.raise=function(n,p){var I=Ki(this.input,n);p+=" ("+I.line+":"+I.column+")",this.sourceFile&&(p+=" in "+this.sourceFile);var F=new SyntaxError(p);throw F.pos=n,F.loc=I,F.raisedAt=this.pos,F},D.raiseRecoverable=D.raise,D.curPosition=function(){if(this.options.locations)return new Bt(this.curLine,this.pos-this.lineStart)};var G=i.prototype,K=function(p){this.flags=p,this.var=[],this.lexical=[],this.functions=[]};G.enterScope=function(n){this.scopeStack.push(new K(n))},G.exitScope=function(){this.scopeStack.pop()},G.treatFunctionsAsVarInScope=function(n){return n.flags&ot||!this.inModule&&n.flags&st},G.declareName=function(n,p,I){var F=!1;if(p===it){var Z=this.currentScope();F=Z.lexical.indexOf(n)>-1||Z.functions.indexOf(n)>-1||Z.var.indexOf(n)>-1,Z.lexical.push(n),this.inModule&&Z.flags&st&&delete this.undefinedExports[n]}else if(p===$e){var le=this.currentScope();le.lexical.push(n)}else if(p===Qi){var fe=this.currentScope();this.treatFunctionsAsVar?F=fe.lexical.indexOf(n)>-1:F=fe.lexical.indexOf(n)>-1||fe.var.indexOf(n)>-1,fe.functions.push(n)}else for(var Ie=this.scopeStack.length-1;Ie>=0;--Ie){var Le=this.scopeStack[Ie];if(Le.lexical.indexOf(n)>-1&&!(Le.flags&Nn&&Le.lexical[0]===n)||!this.treatFunctionsAsVarInScope(Le)&&Le.functions.indexOf(n)>-1){F=!0;break}if(Le.var.push(n),this.inModule&&Le.flags&st&&delete this.undefinedExports[n],Le.flags&Ni)break}F&&this.raiseRecoverable(I,"Identifier '"+n+"' has already been declared")},G.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)},G.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},G.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var p=this.scopeStack[n];if(p.flags&(Ni|yi|Jt))return p}},G.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var p=this.scopeStack[n];if(p.flags&(Ni|yi|Jt)&&!(p.flags&oi))return p}};var Y=function(p,I,F){this.type="",this.start=I,this.end=0,p.options.locations&&(this.loc=new $t(p,F)),p.options.directSourceFile&&(this.sourceFile=p.options.directSourceFile),p.options.ranges&&(this.range=[I,0])},ie=i.prototype;ie.startNode=function(){return new Y(this,this.start,this.startLoc)},ie.startNodeAt=function(n,p){return new Y(this,n,p)};function W(n,p,I,F){return n.type=p,n.end=I,this.options.locations&&(n.loc.end=F),this.options.ranges&&(n.range[1]=I),n}ie.finishNode=function(n,p){return W.call(this,n,p,this.lastTokEnd,this.lastTokEndLoc)},ie.finishNodeAt=function(n,p,I,F){return W.call(this,n,p,I,F)},ie.copyNode=function(n){var p=new Y(this,n.start,this.startLoc);for(var I in n)p[I]=n[I];return p};var te="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",ne="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ae=ne+" Extended_Pictographic",oe=ae,ce=oe+" EBase EComp EMod EPres ExtPict",we=ce,Ee=we,Me={9:ne,10:ae,11:oe,12:ce,13:we,14:Ee},Ne="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",ve={9:"",10:"",11:"",12:"",13:"",14:Ne},xe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ze="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",De=ze+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Re=De+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Be=Re+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Fe=Be+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",Ge=Fe+" "+te,Xe={9:ze,10:De,11:Re,12:Be,13:Fe,14:Ge},Ue={};function vt(n){var p=Ue[n]={binary:Ve(Me[n]+" "+xe),binaryOfStrings:Ve(ve[n]),nonBinary:{General_Category:Ve(xe),Script:Ve(Xe[n])}};p.nonBinary.Script_Extensions=p.nonBinary.Script,p.nonBinary.gc=p.nonBinary.General_Category,p.nonBinary.sc=p.nonBinary.Script,p.nonBinary.scx=p.nonBinary.Script_Extensions}for(var pt=0,xt=[9,10,11,12,13,14];pt<xt.length;pt+=1){var gt=xt[pt];vt(gt)}var Ae=i.prototype,lt=function(p,I){this.parent=p,this.base=I||this};lt.prototype.separatedFrom=function(p){for(var I=this;I;I=I.parent)for(var F=p;F;F=F.parent)if(I.base===F.base&&I!==F)return!0;return!1},lt.prototype.sibling=function(){return new lt(this.parent,this.base)};var ht=function(p){this.parser=p,this.validFlags="gim"+(p.options.ecmaVersion>=6?"uy":"")+(p.options.ecmaVersion>=9?"s":"")+(p.options.ecmaVersion>=13?"d":"")+(p.options.ecmaVersion>=15?"v":""),this.unicodeProperties=Ue[p.options.ecmaVersion>=14?14:p.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};ht.prototype.reset=function(p,I,F){var Z=F.indexOf("v")!==-1,le=F.indexOf("u")!==-1;this.start=p|0,this.source=I+"",this.flags=F,Z&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=le&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=le&&this.parser.options.ecmaVersion>=9)},ht.prototype.raise=function(p){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+p)},ht.prototype.at=function(p,I){I===void 0&&(I=!1);var F=this.source,Z=F.length;if(p>=Z)return-1;var le=F.charCodeAt(p);if(!(I||this.switchU)||le<=55295||le>=57344||p+1>=Z)return le;var fe=F.charCodeAt(p+1);return fe>=56320&&fe<=57343?(le<<10)+fe-56613888:le},ht.prototype.nextIndex=function(p,I){I===void 0&&(I=!1);var F=this.source,Z=F.length;if(p>=Z)return Z;var le=F.charCodeAt(p),fe;return!(I||this.switchU)||le<=55295||le>=57344||p+1>=Z||(fe=F.charCodeAt(p+1))<56320||fe>57343?p+1:p+2},ht.prototype.current=function(p){return p===void 0&&(p=!1),this.at(this.pos,p)},ht.prototype.lookahead=function(p){return p===void 0&&(p=!1),this.at(this.nextIndex(this.pos,p),p)},ht.prototype.advance=function(p){p===void 0&&(p=!1),this.pos=this.nextIndex(this.pos,p)},ht.prototype.eat=function(p,I){return I===void 0&&(I=!1),this.current(I)===p?(this.advance(I),!0):!1},ht.prototype.eatChars=function(p,I){I===void 0&&(I=!1);for(var F=this.pos,Z=0,le=p;Z<le.length;Z+=1){var fe=le[Z],Ie=this.at(F,I);if(Ie===-1||Ie!==fe)return!1;F=this.nextIndex(F,I)}return this.pos=F,!0},Ae.validateRegExpFlags=function(n){for(var p=n.validFlags,I=n.flags,F=!1,Z=!1,le=0;le<I.length;le++){var fe=I.charAt(le);p.indexOf(fe)===-1&&this.raise(n.start,"Invalid regular expression flag"),I.indexOf(fe,le+1)>-1&&this.raise(n.start,"Duplicate regular expression flag"),fe==="u"&&(F=!0),fe==="v"&&(Z=!0)}this.options.ecmaVersion>=15&&F&&Z&&this.raise(n.start,"Invalid regular expression flag")};function _t(n){for(var p in n)return!0;return!1}Ae.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&_t(n.groupNames)&&(n.switchN=!0,this.regexp_pattern(n))},Ae.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames=Object.create(null),n.backReferenceNames.length=0,n.branchID=null,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var p=0,I=n.backReferenceNames;p<I.length;p+=1){var F=I[p];n.groupNames[F]||n.raise("Invalid named capture referenced")}},Ae.regexp_disjunction=function(n){var p=this.options.ecmaVersion>=16;for(p&&(n.branchID=new lt(n.branchID,null)),this.regexp_alternative(n);n.eat(124);)p&&(n.branchID=n.branchID.sibling()),this.regexp_alternative(n);p&&(n.branchID=n.branchID.parent),this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")},Ae.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););},Ae.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1},Ae.regexp_eatAssertion=function(n){var p=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=p}if(n.eat(40)&&n.eat(63)){var I=!1;if(this.options.ecmaVersion>=9&&(I=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!I,!0}return n.pos=p,!1},Ae.regexp_eatQuantifier=function(n,p){return p===void 0&&(p=!1),this.regexp_eatQuantifierPrefix(n,p)?(n.eat(63),!0):!1},Ae.regexp_eatQuantifierPrefix=function(n,p){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,p)},Ae.regexp_eatBracedQuantifier=function(n,p){var I=n.pos;if(n.eat(123)){var F=0,Z=-1;if(this.regexp_eatDecimalDigits(n)&&(F=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(Z=n.lastIntValue),n.eat(125)))return Z!==-1&&Z<F&&!p&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!p&&n.raise("Incomplete quantifier"),n.pos=I}return!1},Ae.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)},Ae.regexp_eatReverseSolidusAtomEscape=function(n){var p=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=p}return!1},Ae.regexp_eatUncapturingGroup=function(n){var p=n.pos;if(n.eat(40)){if(n.eat(63)){if(this.options.ecmaVersion>=16){var I=this.regexp_eatModifiers(n),F=n.eat(45);if(I||F){for(var Z=0;Z<I.length;Z++){var le=I.charAt(Z);I.indexOf(le,Z+1)>-1&&n.raise("Duplicate regular expression modifiers")}if(F){var fe=this.regexp_eatModifiers(n);!I&&!fe&&n.current()===58&&n.raise("Invalid regular expression modifiers");for(var Ie=0;Ie<fe.length;Ie++){var Le=fe.charAt(Ie);(fe.indexOf(Le,Ie+1)>-1||I.indexOf(Le)>-1)&&n.raise("Duplicate regular expression modifiers")}}}}if(n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}}n.pos=p}return!1},Ae.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1},Ae.regexp_eatModifiers=function(n){for(var p="",I=0;(I=n.current())!==-1&&Ot(I);)p+=tt(I),n.advance();return p};function Ot(n){return n===105||n===109||n===115}Ae.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)},Ae.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1},Ae.regexp_eatSyntaxCharacter=function(n){var p=n.current();return Gt(p)?(n.lastIntValue=p,n.advance(),!0):!1};function Gt(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}Ae.regexp_eatPatternCharacters=function(n){for(var p=n.pos,I=0;(I=n.current())!==-1&&!Gt(I);)n.advance();return n.pos!==p},Ae.regexp_eatExtendedPatternCharacter=function(n){var p=n.current();return p!==-1&&p!==36&&!(p>=40&&p<=43)&&p!==46&&p!==63&&p!==91&&p!==94&&p!==124?(n.advance(),!0):!1},Ae.regexp_groupSpecifier=function(n){if(n.eat(63)){this.regexp_eatGroupName(n)||n.raise("Invalid group");var p=this.options.ecmaVersion>=16,I=n.groupNames[n.lastStringValue];if(I)if(p)for(var F=0,Z=I;F<Z.length;F+=1){var le=Z[F];le.separatedFrom(n.branchID)||n.raise("Duplicate capture group name")}else n.raise("Duplicate capture group name");p?(I||(n.groupNames[n.lastStringValue]=[])).push(n.branchID):n.groupNames[n.lastStringValue]=!0}},Ae.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1},Ae.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=tt(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=tt(n.lastIntValue);return!0}return!1},Ae.regexp_eatRegExpIdentifierStart=function(n){var p=n.pos,I=this.options.ecmaVersion>=11,F=n.current(I);return n.advance(I),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,I)&&(F=n.lastIntValue),Rt(F)?(n.lastIntValue=F,!0):(n.pos=p,!1)};function Rt(n){return Q(n,!0)||n===36||n===95}Ae.regexp_eatRegExpIdentifierPart=function(n){var p=n.pos,I=this.options.ecmaVersion>=11,F=n.current(I);return n.advance(I),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,I)&&(F=n.lastIntValue),Dt(F)?(n.lastIntValue=F,!0):(n.pos=p,!1)};function Dt(n){return X(n,!0)||n===36||n===95||n===8204||n===8205}Ae.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)},Ae.regexp_eatBackReference=function(n){var p=n.pos;if(this.regexp_eatDecimalEscape(n)){var I=n.lastIntValue;if(n.switchU)return I>n.maxBackReference&&(n.maxBackReference=I),!0;if(I<=n.numCapturingParens)return!0;n.pos=p}return!1},Ae.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1},Ae.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)},Ae.regexp_eatCControlLetter=function(n){var p=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=p}return!1},Ae.regexp_eatZero=function(n){return n.current()===48&&!ui(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1},Ae.regexp_eatControlEscape=function(n){var p=n.current();return p===116?(n.lastIntValue=9,n.advance(),!0):p===110?(n.lastIntValue=10,n.advance(),!0):p===118?(n.lastIntValue=11,n.advance(),!0):p===102?(n.lastIntValue=12,n.advance(),!0):p===114?(n.lastIntValue=13,n.advance(),!0):!1},Ae.regexp_eatControlLetter=function(n){var p=n.current();return Pt(p)?(n.lastIntValue=p%32,n.advance(),!0):!1};function Pt(n){return n>=65&&n<=90||n>=97&&n<=122}Ae.regexp_eatRegExpUnicodeEscapeSequence=function(n,p){p===void 0&&(p=!1);var I=n.pos,F=p||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var Z=n.lastIntValue;if(F&&Z>=55296&&Z<=56319){var le=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var fe=n.lastIntValue;if(fe>=56320&&fe<=57343)return n.lastIntValue=(Z-55296)*1024+(fe-56320)+65536,!0}n.pos=le,n.lastIntValue=Z}return!0}if(F&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&Mt(n.lastIntValue))return!0;F&&n.raise("Invalid unicode escape"),n.pos=I}return!1};function Mt(n){return n>=0&&n<=1114111}Ae.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var p=n.current();return p!==99&&(!n.switchN||p!==107)?(n.lastIntValue=p,n.advance(),!0):!1},Ae.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var p=n.current();if(p>=49&&p<=57){do n.lastIntValue=10*n.lastIntValue+(p-48),n.advance();while((p=n.current())>=48&&p<=57);return!0}return!1};var jt=0,yt=1,kt=2;Ae.regexp_eatCharacterClassEscape=function(n){var p=n.current();if(Dn(p))return n.lastIntValue=-1,n.advance(),yt;var I=!1;if(n.switchU&&this.options.ecmaVersion>=9&&((I=p===80)||p===112)){n.lastIntValue=-1,n.advance();var F;if(n.eat(123)&&(F=this.regexp_eatUnicodePropertyValueExpression(n))&&n.eat(125))return I&&F===kt&&n.raise("Invalid property name"),F;n.raise("Invalid property name")}return jt};function Dn(n){return n===100||n===68||n===115||n===83||n===119||n===87}Ae.regexp_eatUnicodePropertyValueExpression=function(n){var p=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var I=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var F=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,I,F),yt}}if(n.pos=p,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var Z=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,Z)}return jt},Ae.regexp_validateUnicodePropertyNameAndValue=function(n,p,I){me(n.unicodeProperties.nonBinary,p)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[p].test(I)||n.raise("Invalid property value")},Ae.regexp_validateUnicodePropertyNameOrValue=function(n,p){if(n.unicodeProperties.binary.test(p))return yt;if(n.switchV&&n.unicodeProperties.binaryOfStrings.test(p))return kt;n.raise("Invalid property name")},Ae.regexp_eatUnicodePropertyName=function(n){var p=0;for(n.lastStringValue="";Ji(p=n.current());)n.lastStringValue+=tt(p),n.advance();return n.lastStringValue!==""};function Ji(n){return Pt(n)||n===95}Ae.regexp_eatUnicodePropertyValue=function(n){var p=0;for(n.lastStringValue="";Vn(p=n.current());)n.lastStringValue+=tt(p),n.advance();return n.lastStringValue!==""};function Vn(n){return Ji(n)||ui(n)}Ae.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)},Ae.regexp_eatCharacterClass=function(n){if(n.eat(91)){var p=n.eat(94),I=this.regexp_classContents(n);return n.eat(93)||n.raise("Unterminated character class"),p&&I===kt&&n.raise("Negated character class may contain strings"),!0}return!1},Ae.regexp_classContents=function(n){return n.current()===93?yt:n.switchV?this.regexp_classSetExpression(n):(this.regexp_nonEmptyClassRanges(n),yt)},Ae.regexp_nonEmptyClassRanges=function(n){for(;this.regexp_eatClassAtom(n);){var p=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var I=n.lastIntValue;n.switchU&&(p===-1||I===-1)&&n.raise("Invalid character class"),p!==-1&&I!==-1&&p>I&&n.raise("Range out of order in character class")}}},Ae.regexp_eatClassAtom=function(n){var p=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var I=n.current();(I===99||ei(I))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=p}var F=n.current();return F!==93?(n.lastIntValue=F,n.advance(),!0):!1},Ae.regexp_eatClassEscape=function(n){var p=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=p}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)},Ae.regexp_classSetExpression=function(n){var p=yt,I;if(!this.regexp_eatClassSetRange(n))if(I=this.regexp_eatClassSetOperand(n)){I===kt&&(p=kt);for(var F=n.pos;n.eatChars([38,38]);){if(n.current()!==38&&(I=this.regexp_eatClassSetOperand(n))){I!==kt&&(p=yt);continue}n.raise("Invalid character in character class")}if(F!==n.pos)return p;for(;n.eatChars([45,45]);)this.regexp_eatClassSetOperand(n)||n.raise("Invalid character in character class");if(F!==n.pos)return p}else n.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(n)){if(I=this.regexp_eatClassSetOperand(n),!I)return p;I===kt&&(p=kt)}},Ae.regexp_eatClassSetRange=function(n){var p=n.pos;if(this.regexp_eatClassSetCharacter(n)){var I=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassSetCharacter(n)){var F=n.lastIntValue;return I!==-1&&F!==-1&&I>F&&n.raise("Range out of order in character class"),!0}n.pos=p}return!1},Ae.regexp_eatClassSetOperand=function(n){return this.regexp_eatClassSetCharacter(n)?yt:this.regexp_eatClassStringDisjunction(n)||this.regexp_eatNestedClass(n)},Ae.regexp_eatNestedClass=function(n){var p=n.pos;if(n.eat(91)){var I=n.eat(94),F=this.regexp_classContents(n);if(n.eat(93))return I&&F===kt&&n.raise("Negated character class may contain strings"),F;n.pos=p}if(n.eat(92)){var Z=this.regexp_eatCharacterClassEscape(n);if(Z)return Z;n.pos=p}return null},Ae.regexp_eatClassStringDisjunction=function(n){var p=n.pos;if(n.eatChars([92,113])){if(n.eat(123)){var I=this.regexp_classStringDisjunctionContents(n);if(n.eat(125))return I}else n.raise("Invalid escape");n.pos=p}return null},Ae.regexp_classStringDisjunctionContents=function(n){for(var p=this.regexp_classString(n);n.eat(124);)this.regexp_classString(n)===kt&&(p=kt);return p},Ae.regexp_classString=function(n){for(var p=0;this.regexp_eatClassSetCharacter(n);)p++;return p===1?yt:kt},Ae.regexp_eatClassSetCharacter=function(n){var p=n.pos;if(n.eat(92))return this.regexp_eatCharacterEscape(n)||this.regexp_eatClassSetReservedPunctuator(n)?!0:n.eat(98)?(n.lastIntValue=8,!0):(n.pos=p,!1);var I=n.current();return I<0||I===n.lookahead()&&Fn(I)||Bn(I)?!1:(n.advance(),n.lastIntValue=I,!0)};function Fn(n){return n===33||n>=35&&n<=38||n>=42&&n<=44||n===46||n>=58&&n<=64||n===94||n===96||n===126}function Bn(n){return n===40||n===41||n===45||n===47||n>=91&&n<=93||n>=123&&n<=125}Ae.regexp_eatClassSetReservedPunctuator=function(n){var p=n.current();return Di(p)?(n.lastIntValue=p,n.advance(),!0):!1};function Di(n){return n===33||n===35||n===37||n===38||n===44||n===45||n>=58&&n<=62||n===64||n===96||n===126}Ae.regexp_eatClassControlLetter=function(n){var p=n.current();return ui(p)||p===95?(n.lastIntValue=p%32,n.advance(),!0):!1},Ae.regexp_eatHexEscapeSequence=function(n){var p=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=p}return!1},Ae.regexp_eatDecimalDigits=function(n){var p=n.pos,I=0;for(n.lastIntValue=0;ui(I=n.current());)n.lastIntValue=10*n.lastIntValue+(I-48),n.advance();return n.pos!==p};function ui(n){return n>=48&&n<=57}Ae.regexp_eatHexDigits=function(n){var p=n.pos,I=0;for(n.lastIntValue=0;bi(I=n.current());)n.lastIntValue=16*n.lastIntValue+wi(I),n.advance();return n.pos!==p};function bi(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function wi(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}Ae.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var p=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var I=n.lastIntValue;p<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=p*64+I*8+n.lastIntValue:n.lastIntValue=p*8+I}else n.lastIntValue=p;return!0}return!1},Ae.regexp_eatOctalDigit=function(n){var p=n.current();return ei(p)?(n.lastIntValue=p-48,n.advance(),!0):(n.lastIntValue=0,!1)};function ei(n){return n>=48&&n<=55}Ae.regexp_eatFixedHexDigits=function(n,p){var I=n.pos;n.lastIntValue=0;for(var F=0;F<p;++F){var Z=n.current();if(!bi(Z))return n.pos=I,!1;n.lastIntValue=16*n.lastIntValue+wi(Z),n.advance()}return!0};var Ut=function(p){this.type=p.type,this.value=p.value,this.start=p.start,this.end=p.end,p.options.locations&&(this.loc=new $t(p,p.startLoc,p.endLoc)),p.options.ranges&&(this.range=[p.start,p.end])},We=i.prototype;We.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ut(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},We.getToken=function(){return this.next(),new Ut(this)},typeof Symbol<"u"&&(We[Symbol.iterator]=function(){var n=this;return{next:function(){var p=n.getToken();return{done:p.type===M.eof,value:p}}}}),We.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(M.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())},We.readToken=function(n){return Q(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)},We.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var p=this.input.charCodeAt(this.pos+1);return p<=56319||p>=57344?n:(n<<10)+p-56613888},We.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),p=this.pos,I=this.input.indexOf("*/",this.pos+=2);if(I===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=I+2,this.options.locations)for(var F=void 0,Z=p;(F=Ce(this.input,Z,this.pos))>-1;)++this.curLine,Z=this.lineStart=F;this.options.onComment&&this.options.onComment(!0,this.input.slice(p+2,I),p,this.pos,n,this.curPosition())},We.skipLineComment=function(n){for(var p=this.pos,I=this.options.onComment&&this.curPosition(),F=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!pe(F);)F=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(p+n,this.pos),p,this.pos,I,this.curPosition())},We.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&ke.test(String.fromCharCode(n)))++this.pos;else break e}}},We.finishToken=function(n,p){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var I=this.type;this.type=n,this.value=p,this.updateContext(I)},We.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var p=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&p===46?(this.pos+=3,this.finishToken(M.ellipsis)):(++this.pos,this.finishToken(M.dot))},We.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(M.assign,2):this.finishOp(M.slash,1)},We.readToken_mult_modulo_exp=function(n){var p=this.input.charCodeAt(this.pos+1),I=1,F=n===42?M.star:M.modulo;return this.options.ecmaVersion>=7&&n===42&&p===42&&(++I,F=M.starstar,p=this.input.charCodeAt(this.pos+2)),p===61?this.finishOp(M.assign,I+1):this.finishOp(F,I)},We.readToken_pipe_amp=function(n){var p=this.input.charCodeAt(this.pos+1);if(p===n){if(this.options.ecmaVersion>=12){var I=this.input.charCodeAt(this.pos+2);if(I===61)return this.finishOp(M.assign,3)}return this.finishOp(n===124?M.logicalOR:M.logicalAND,2)}return p===61?this.finishOp(M.assign,2):this.finishOp(n===124?M.bitwiseOR:M.bitwiseAND,1)},We.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(M.assign,2):this.finishOp(M.bitwiseXOR,1)},We.readToken_plus_min=function(n){var p=this.input.charCodeAt(this.pos+1);return p===n?p===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||de.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(M.incDec,2):p===61?this.finishOp(M.assign,2):this.finishOp(M.plusMin,1)},We.readToken_lt_gt=function(n){var p=this.input.charCodeAt(this.pos+1),I=1;return p===n?(I=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+I)===61?this.finishOp(M.assign,I+1):this.finishOp(M.bitShift,I)):p===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(p===61&&(I=2),this.finishOp(M.relational,I))},We.readToken_eq_excl=function(n){var p=this.input.charCodeAt(this.pos+1);return p===61?this.finishOp(M.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&p===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(M.arrow)):this.finishOp(n===61?M.eq:M.prefix,1)},We.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var p=this.input.charCodeAt(this.pos+1);if(p===46){var I=this.input.charCodeAt(this.pos+2);if(I<48||I>57)return this.finishOp(M.questionDot,2)}if(p===63){if(n>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(M.assign,3)}return this.finishOp(M.coalesce,2)}}return this.finishOp(M.question,1)},We.readToken_numberSign=function(){var n=this.options.ecmaVersion,p=35;if(n>=13&&(++this.pos,p=this.fullCharCodeAtPos(),Q(p,!0)||p===92))return this.finishToken(M.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+tt(p)+"'")},We.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(M.parenL);case 41:return++this.pos,this.finishToken(M.parenR);case 59:return++this.pos,this.finishToken(M.semi);case 44:return++this.pos,this.finishToken(M.comma);case 91:return++this.pos,this.finishToken(M.bracketL);case 93:return++this.pos,this.finishToken(M.bracketR);case 123:return++this.pos,this.finishToken(M.braceL);case 125:return++this.pos,this.finishToken(M.braceR);case 58:return++this.pos,this.finishToken(M.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(M.backQuote);case 48:var p=this.input.charCodeAt(this.pos+1);if(p===120||p===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(p===111||p===79)return this.readRadixNumber(8);if(p===98||p===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(M.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+tt(n)+"'")},We.finishOp=function(n,p){var I=this.input.slice(this.pos,this.pos+p);return this.pos+=p,this.finishToken(n,I)},We.readRegexp=function(){for(var n,p,I=this.pos;;){this.pos>=this.input.length&&this.raise(I,"Unterminated regular expression");var F=this.input.charAt(this.pos);if(de.test(F)&&this.raise(I,"Unterminated regular expression"),n)n=!1;else{if(F==="[")p=!0;else if(F==="]"&&p)p=!1;else if(F==="/"&&!p)break;n=F==="\\"}++this.pos}var Z=this.input.slice(I,this.pos);++this.pos;var le=this.pos,fe=this.readWord1();this.containsEsc&&this.unexpected(le);var Ie=this.regexpState||(this.regexpState=new ht(this));Ie.reset(I,Z,fe),this.validateRegExpFlags(Ie),this.validateRegExpPattern(Ie);var Le=null;try{Le=new RegExp(Z,fe)}catch{}return this.finishToken(M.regexp,{pattern:Z,flags:fe,value:Le})},We.readInt=function(n,p,I){for(var F=this.options.ecmaVersion>=12&&p===void 0,Z=I&&this.input.charCodeAt(this.pos)===48,le=this.pos,fe=0,Ie=0,Le=0,He=p??1/0;Le<He;++Le,++this.pos){var Ye=this.input.charCodeAt(this.pos),at=void 0;if(F&&Ye===95){Z&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ie===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Le===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ie=Ye;continue}if(Ye>=97?at=Ye-97+10:Ye>=65?at=Ye-65+10:Ye>=48&&Ye<=57?at=Ye-48:at=1/0,at>=n)break;Ie=Ye,fe=fe*n+at}return F&&Ie===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===le||p!=null&&this.pos-le!==p?null:fe};function Vt(n,p){return p?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function qt(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}We.readRadixNumber=function(n){var p=this.pos;this.pos+=2;var I=this.readInt(n);return I==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(I=qt(this.input.slice(p,this.pos)),++this.pos):Q(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(M.num,I)},We.readNumber=function(n){var p=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(p,"Invalid number");var I=this.pos-p>=2&&this.input.charCodeAt(p)===48;I&&this.strict&&this.raise(p,"Invalid number");var F=this.input.charCodeAt(this.pos);if(!I&&!n&&this.options.ecmaVersion>=11&&F===110){var Z=qt(this.input.slice(p,this.pos));return++this.pos,Q(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(M.num,Z)}I&&/[89]/.test(this.input.slice(p,this.pos))&&(I=!1),F===46&&!I&&(++this.pos,this.readInt(10),F=this.input.charCodeAt(this.pos)),(F===69||F===101)&&!I&&(F=this.input.charCodeAt(++this.pos),(F===43||F===45)&&++this.pos,this.readInt(10)===null&&this.raise(p,"Invalid number")),Q(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var le=Vt(this.input.slice(p,this.pos),I);return this.finishToken(M.num,le)},We.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),p;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var I=++this.pos;p=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,p>1114111&&this.invalidStringToken(I,"Code point out of bounds")}else p=this.readHexChar(4);return p},We.readString=function(n){for(var p="",I=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var F=this.input.charCodeAt(this.pos);if(F===n)break;F===92?(p+=this.input.slice(I,this.pos),p+=this.readEscapedChar(!1),I=this.pos):F===8232||F===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(pe(F)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return p+=this.input.slice(I,this.pos++),this.finishToken(M.string,p)};var Ft={};We.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===Ft)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1},We.invalidStringToken=function(n,p){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ft;this.raise(n,p)},We.readTmplToken=function(){for(var n="",p=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var I=this.input.charCodeAt(this.pos);if(I===96||I===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===M.template||this.type===M.invalidTemplate)?I===36?(this.pos+=2,this.finishToken(M.dollarBraceL)):(++this.pos,this.finishToken(M.backQuote)):(n+=this.input.slice(p,this.pos),this.finishToken(M.template,n));if(I===92)n+=this.input.slice(p,this.pos),n+=this.readEscapedChar(!0),p=this.pos;else if(pe(I)){switch(n+=this.input.slice(p,this.pos),++this.pos,I){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(I);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),p=this.pos}else++this.pos}},We.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(M.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")},We.readEscapedChar=function(n){var p=this.input.charCodeAt(++this.pos);switch(++this.pos,p){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return tt(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var I=this.pos-1;this.invalidStringToken(I,"Invalid escape sequence in template string")}default:if(p>=48&&p<=55){var F=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],Z=parseInt(F,8);return Z>255&&(F=F.slice(0,-1),Z=parseInt(F,8)),this.pos+=F.length-1,p=this.input.charCodeAt(this.pos),(F!=="0"||p===56||p===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-F.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(Z)}return pe(p)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(p)}},We.readHexChar=function(n){var p=this.pos,I=this.readInt(16,n);return I===null&&this.invalidStringToken(p,"Bad character escape sequence"),I},We.readWord1=function(){this.containsEsc=!1;for(var n="",p=!0,I=this.pos,F=this.options.ecmaVersion>=6;this.pos<this.input.length;){var Z=this.fullCharCodeAtPos();if(X(Z,F))this.pos+=Z<=65535?1:2;else if(Z===92){this.containsEsc=!0,n+=this.input.slice(I,this.pos);var le=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var fe=this.readCodePoint();(p?Q:X)(fe,F)||this.invalidStringToken(le,"Invalid Unicode escape"),n+=tt(fe),I=this.pos}else break;p=!1}return n+this.input.slice(I,this.pos)},We.readWord=function(){var n=this.readWord1(),p=M.name;return this.keywords.test(n)&&(p=ye[n]),this.finishToken(p,n)};var ti="8.15.0";i.acorn={Parser:i,version:ti,defaultOptions:ft,Position:Bt,SourceLocation:$t,getLineInfo:Ki,Node:Y,TokenType:j,tokTypes:M,keywordTypes:ye,TokContext:V,tokContexts:k,isIdentifierChar:X,isIdentifierStart:Q,Token:Ut,isNewLine:pe,lineBreak:de,lineBreakG:_e,nonASCIIwhitespace:ke};function en(n,p){return i.parse(n,p)}function tn(n,p,I){return i.parseExpressionAt(n,p,I)}function nn(n,p){return i.tokenizer(n,p)}r.Node=Y,r.Parser=i,r.Position=Bt,r.SourceLocation=$t,r.TokContext=V,r.Token=Ut,r.TokenType=j,r.defaultOptions=ft,r.getLineInfo=Ki,r.isIdentifierChar=X,r.isIdentifierStart=Q,r.isNewLine=pe,r.keywordTypes=ye,r.lineBreak=de,r.lineBreakG=_e,r.nonASCIIwhitespace=ke,r.parse=en,r.parseExpressionAt=tn,r.tokContexts=k,r.tokTypes=M,r.tokenizer=nn,r.version=ti}))})(gn,gn.exports)),gn.exports}/*!
 * Paper.js v0.12.18 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jürg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Wed Jul 17 14:57:24 2024 +0200
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jürg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */var Io=ir.exports,Is;function Eo(){return Is||(Is=1,(function(o){(function(s,r){s=s||Ps;var l=s.window,c=s.document,u=new function(){var e=/^(statics|enumerable|beans|preserve)$/,i=[],a=i.slice,h=Object.create,f=Object.getOwnPropertyDescriptor,m=Object.defineProperty,v=i.forEach||function(P,S){for(var B=0,O=this.length;B<O;B++)P.call(S,this[B],B,this)},_=function(P,S){for(var B in this)this.hasOwnProperty(B)&&P.call(S,this[B],B,this)},y=Object.assign||function(P){for(var S=1,B=arguments.length;S<B;S++){var O=arguments[S];for(var V in O)O.hasOwnProperty(V)&&(P[V]=O[V])}return P},b=function(P,S,B){if(P){var O=f(P,"length");(O&&typeof O.value=="number"?v:_).call(P,S,B=B||P)}return B};function T(P,S,B,O,V){var k={};function R(D,G){G=G||(G=f(S,D))&&(G.get?G:G.value),typeof G=="string"&&G[0]==="#"&&(G=P[G.substring(1)]||G);var K=typeof G=="function",Y=G,ie=V||K&&!G.base?G&&G.get?D in P:P[D]:null,W;(!V||!ie)&&(K&&ie&&(G.base=ie),K&&O!==!1&&(W=D.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(k[W[3].toLowerCase()+W[4]]=W[2]),(!Y||K||!Y.get||typeof Y.get!="function"||!z.isPlainObject(Y))&&(Y={value:Y,writable:!0}),(f(P,D)||{configurable:!0}).configurable&&(Y.configurable=!0,Y.enumerable=B??!W),m(P,D,Y))}if(S){for(var w in S)S.hasOwnProperty(w)&&!e.test(w)&&R(w);for(var w in k){var N=k[w],U=P["set"+N],H=P["get"+N]||U&&P["is"+N];H&&(O===!0||H.length===0)&&R(w,{get:H,set:U})}}return P}function z(){for(var P=0,S=arguments.length;P<S;P++){var B=arguments[P];B&&y(this,B)}return this}return T(z,{inject:function(P){if(P){var S=P.statics===!0?P:P.statics,B=P.beans,O=P.preserve;S!==P&&T(this.prototype,P,P.enumerable,B,O),T(this,S,null,B,O)}for(var V=1,k=arguments.length;V<k;V++)this.inject(arguments[V]);return this},extend:function(){for(var P=this,S,B,O=0,V,k=arguments.length;O<k&&!(S&&B);O++)V=arguments[O],S=S||V.initialize,B=B||V.prototype;return S=S||function(){P.apply(this,arguments)},B=S.prototype=B||h(this.prototype),m(B,"constructor",{value:S,writable:!0,configurable:!0}),T(S,this),arguments.length&&this.inject.apply(S,arguments),S.base=P,S}}).inject({enumerable:!1,initialize:z,set:z,inject:function(){for(var P=0,S=arguments.length;P<S;P++){var B=arguments[P];B&&T(this,B,B.enumerable,B.beans,B.preserve)}return this},extend:function(){var P=h(this);return P.inject.apply(P,arguments)},each:function(P,S){return b(this,P,S)},clone:function(){return new this.constructor(this)},statics:{set:y,each:b,create:h,define:m,describe:f,clone:function(P){return y(new P.constructor,P)},isPlainObject:function(P){var S=P!=null&&P.constructor;return S&&(S===Object||S===z||S.name==="Object")},pick:function(P,S){return P!==r?P:S},slice:function(P,S,B){return a.call(P,S,B)}}})};o.exports=u,u.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+u.each(this,function(e,i){if(!/^_/.test(i)){var a=typeof e;this.push(i+": "+(a==="number"?L.instance.number(e):a==="string"?"'"+e+"'":e))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(e){return u.importJSON(e,this)},exportJSON:function(e){return u.exportJSON(this,e)},toJSON:function(){return u.serialize(this)},set:function(e,i){return e&&u.filter(this,e,i,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function e(){var i=e.base.apply(this,arguments),a=i.prototype._class;return a&&!u.exports[a]&&(u.exports[a]=i),i},equals:function(e,i){if(e===i)return!0;if(e&&e.equals)return e.equals(i);if(i&&i.equals)return i.equals(e);if(e&&i&&typeof e=="object"&&typeof i=="object"){if(Array.isArray(e)&&Array.isArray(i)){var a=e.length;if(a!==i.length)return!1;for(;a--;)if(!u.equals(e[a],i[a]))return!1}else{var h=Object.keys(e),a=h.length;if(a!==Object.keys(i).length)return!1;for(;a--;){var f=h[a];if(!(i.hasOwnProperty(f)&&u.equals(e[f],i[f])))return!1}}return!0}return!1},read:function(e,i,a,h){if(this===u){var f=this.peek(e,i);return e.__index++,f}var m=this.prototype,v=m._readIndex,_=i||v&&e.__index||0,y=e.length,b=e[_];if(h=h||y-_,b instanceof this||a&&a.readNull&&b==null&&h<=1)return v&&(e.__index=_+1),b&&a&&a.clone?b.clone():b;if(b=u.create(m),v&&(b.__read=!0),b=b.initialize.apply(b,_>0||_+h<y?u.slice(e,_,_+h):e)||b,v){e.__index=_+b.__read;var T=b.__filtered;T&&(e.__filtered=T,b.__filtered=r),b.__read=r}return b},peek:function(e,i){return e[e.__index=i||e.__index||0]},remain:function(e){return e.length-(e.__index||0)},readList:function(e,i,a,h){for(var f=[],m,v=i||0,_=h?v+h:e.length,y=v;y<_;y++)f.push(Array.isArray(m=e[y])?this.read(m,0,a):this.read(e,y,a,1));return f},readNamed:function(e,i,a,h,f){var m=this.getNamed(e,i),v=m!==r;if(v){var _=e.__filtered;if(!_){var y=this.getSource(e);_=e.__filtered=u.create(y),_.__unfiltered=y}_[i]=r}return this.read(v?[m]:e,a,h,f)},readSupported:function(e,i){var a=this.getSource(e),h=this,f=!1;return a&&Object.keys(a).forEach(function(m){if(m in i){var v=h.readNamed(e,m);v!==r&&(i[m]=v),f=!0}}),f},getSource:function(e){var i=e.__source;if(i===r){var a=e.length===1&&e[0];i=e.__source=a&&u.isPlainObject(a)?a:null}return i},getNamed:function(e,i){var a=this.getSource(e);if(a)return i?a[i]:e.__filtered||a},hasNamed:function(e,i){return!!this.getNamed(e,i)},filter:function(e,i,a,h){var f;function m(T){if(!(a&&T in a)&&!(f&&T in f)){var z=i[T];z!==r&&(e[T]=z)}}if(h){for(var v={},_=0,y,b=h.length;_<b;_++)(y=h[_])in i&&(m(y),v[y]=!0);f=v}return Object.keys(i.__unfiltered||i).forEach(m),e},isPlainValue:function(e,i){return u.isPlainObject(e)||Array.isArray(e)||i&&typeof e=="string"},serialize:function(e,i,a,h){i=i||{};var f=!h,m;if(f&&(i.formatter=new L(i.precision),h={length:0,definitions:{},references:{},add:function(z,P){var S="#"+z._id,B=this.references[S];if(!B){this.length++;var O=P.call(z),V=z._class;V&&O[0]!==V&&O.unshift(V),this.definitions[S]=O,B=this.references[S]=[S]}return B}}),e&&e._serialize){m=e._serialize(i,h);var v=e._class;v&&!e._compactSerialize&&(f||!a)&&m[0]!==v&&m.unshift(v)}else if(Array.isArray(e)){m=[];for(var _=0,y=e.length;_<y;_++)m[_]=u.serialize(e[_],i,a,h)}else if(u.isPlainObject(e)){m={};for(var b=Object.keys(e),_=0,y=b.length;_<y;_++){var T=b[_];m[T]=u.serialize(e[T],i,a,h)}}else typeof e=="number"?m=i.formatter.number(e,i.precision):m=e;return f&&h.length>0?[["dictionary",h.definitions],m]:m},deserialize:function(e,i,a,h,f){var m=e,v=!a,_=v&&e&&e.length&&e[0][0]==="dictionary";if(a=a||{},Array.isArray(e)){var y=e[0],b=y==="dictionary";if(e.length==1&&/^#/.test(y))return a.dictionary[y];y=u.exports[y],m=[];for(var T=y?1:0,z=e.length;T<z;T++)m.push(u.deserialize(e[T],i,a,b,_));if(y){var P=m;i?m=i(y,P,v||f):m=new y(P)}}else if(u.isPlainObject(e)){m={},h&&(a.dictionary=m);for(var S in e)m[S]=u.deserialize(e[S],i,a)}return _?m[1]:m},exportJSON:function(e,i){var a=u.serialize(e,i);return i&&i.asString==!1?a:JSON.stringify(a)},importJSON:function(e,i){return u.deserialize(typeof e=="string"?JSON.parse(e):e,function(a,h,f){var m=f&&i&&i.constructor===a,v=m?i:u.create(a.prototype);if(h.length===1&&v instanceof M&&(m||!(v instanceof _e))){var _=h[0];u.isPlainObject(_)&&(_.insert=!1,m&&(h=h.concat([M.INSERT])))}return(m?v.set:a).apply(v,h),m&&(i=null),v})},push:function(e,i){var a=i.length;if(a<4096)e.push.apply(e,i);else{var h=e.length;e.length+=a;for(var f=0;f<a;f++)e[h+f]=i[f]}return e},splice:function(e,i,a,h){var f=i&&i.length,m=a===r;a=m?e.length:a,a>e.length&&(a=e.length);for(var v=0;v<f;v++)i[v]._index=a+v;if(m)return u.push(e,i),[];var _=[a,h];i&&u.push(_,i);for(var y=e.splice.apply(e,_),v=0,b=y.length;v<b;v++)y[v]._index=r;for(var v=a+f,b=e.length;v<b;v++)e[v]._index=v;return y},capitalize:function(e){return e.replace(/\b[a-z]/g,function(i){return i.toUpperCase()})},camelize:function(e){return e.replace(/-(.)/g,function(i,a){return a.toUpperCase()})},hyphenate:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var d={on:function(e,i){if(typeof e!="string")u.each(e,function(m,v){this.on(v,m)},this);else{var a=this._eventTypes,h=a&&a[e],f=this._callbacks=this._callbacks||{};f=f[e]=f[e]||[],f.indexOf(i)===-1&&(f.push(i),h&&h.install&&f.length===1&&h.install.call(this,e))}return this},off:function(e,i){if(typeof e!="string"){u.each(e,function(v,_){this.off(_,v)},this);return}var a=this._eventTypes,h=a&&a[e],f=this._callbacks&&this._callbacks[e],m;return f&&(!i||(m=f.indexOf(i))!==-1&&f.length===1?(h&&h.uninstall&&h.uninstall.call(this,e),delete this._callbacks[e]):m!==-1&&f.splice(m,1)),this},once:function(e,i){return this.on(e,function a(){i.apply(this,arguments),this.off(e,a)})},emit:function(e,i){var a=this._callbacks&&this._callbacks[e];if(!a)return!1;var h=u.slice(arguments,1),f=i&&i.target&&!i.currentTarget;a=a.slice(),f&&(i.currentTarget=this);for(var m=0,v=a.length;m<v;m++)if(a[m].apply(this,h)==!1){i&&i.stop&&i.stop();break}return f&&delete i.currentTarget,!0},responds:function(e){return!!(this._callbacks&&this._callbacks[e])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(e){var i=this._eventTypes,a=this._callbacks,h=e?"install":"uninstall";if(i){for(var f in a)if(a[f].length>0){var m=i[f],v=m&&m[h];v&&v.call(this,f)}}},statics:{inject:function e(i){var a=i._events;if(a){var h={};u.each(a,function(f,m){var v=typeof f=="string",_=v?f:m,y=u.capitalize(_),b=_.substring(2).toLowerCase();h[b]=v?{}:f,_="_"+_,i["get"+y]=function(){return this[_]},i["set"+y]=function(T){var z=this[_];z&&this.off(b,z),T&&this.on(b,T),this[_]=T}}),i._eventTypes=h}return e.base.apply(this,arguments)}}},g=u.extend({_class:"PaperScope",initialize:function e(){$e=this,this.settings=new u({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var a=dt.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in a||"mozDash"in a,nativeBlendModes:xi.nativeModes},dt.release(a)}if(!this.agent){var h=s.navigator.userAgent.toLowerCase(),f=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(h)||[])[0],m=f==="darwin"?"mac":f,v=i.agent=i.browser={platform:m};m&&(v[m]=!0),h.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(_,y,b,T,z){if(!v.chrome){var P=y==="opera"?T:/^(node|trident)$/.test(y)?z:b;v.version=P,v.versionNumber=parseFloat(P),y={trident:"msie",jsdom:"node"}[y]||y,v.name=y,v[y]=!0}}),v.chrome&&delete v.webkit,v.atom&&delete v.chrome}},version:"0.12.18",getView:function(){var e=this.project;return e&&e._view},getPaper:function(){return this},execute:function(e,i){var a=$e.PaperScript.execute(e,this,i);return ut.updateFocus(),a},install:function(e){var i=this;u.each(["project","view","tool"],function(h){u.define(e,h,{configurable:!0,get:function(){return i[h]}})});for(var a in this)!/^_/.test(a)&&this[a]&&(e[a]=this[a])},setup:function(e){return $e=this,this.project=new ue(e),this},createCanvas:function(e,i){return dt.getCanvas(e,i)},activate:function(){$e=this},clear:function(){for(var e=this.projects,i=this.tools,a=e.length-1;a>=0;a--)e[a].remove();for(var a=i.length-1;a>=0;a--)i[a].remove()},remove:function(){this.clear(),delete g._scopes[this._id]},statics:new function(){function e(i){return i+="Attribute",function(a,h){return a[i](h)||a[i]("data-paper-"+h)}}return{_scopes:{},_id:0,get:function(i){return this._scopes[i]||null},getAttribute:e("get"),hasAttribute:e("has")}}}),x=u.extend(d,{initialize:function(e){this._scope=$e,this._index=this._scope[this._list].push(this)-1,(e||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var e=this._scope[this._reference];return e&&e!==this&&e.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",e),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(u.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),C={findItemBoundsCollisions:function(e,i,a){function h(v){for(var _=new Array(v.length),y=0;y<v.length;y++){var b=v[y].getBounds();_[y]=[b.left,b.top,b.right,b.bottom]}return _}var f=h(e),m=!i||i===e?f:h(i);return this.findBoundsCollisions(f,m,a||0)},findCurveBoundsCollisions:function(e,i,a,h){function f(P){for(var S=Math.min,B=Math.max,O=new Array(P.length),V=0;V<P.length;V++){var k=P[V];O[V]=[S(k[0],k[2],k[4],k[6]),S(k[1],k[3],k[5],k[7]),B(k[0],k[2],k[4],k[6]),B(k[1],k[3],k[5],k[7])]}return O}var m=f(e),v=!i||i===e?m:f(i);if(h){for(var _=this.findBoundsCollisions(m,v,a||0,!1,!0),y=this.findBoundsCollisions(m,v,a||0,!0,!0),b=[],T=0,z=_.length;T<z;T++)b[T]={hor:_[T],ver:y[T]};return b}return this.findBoundsCollisions(m,v,a||0)},findBoundsCollisions:function(e,i,a,h,f){var m=!i||e===i,v=m?e:e.concat(i),_=e.length,y=v.length;function b(Ee,Me,Ne){for(var ve=0,xe=Ee.length;ve<xe;){var ze=xe+ve>>>1;v[Ee[ze]][Me]<Ne?ve=ze+1:xe=ze}return ve-1}for(var T=h?1:0,z=T+2,P=h?0:1,S=P+2,B=new Array(y),O=0;O<y;O++)B[O]=O;B.sort(function(Ee,Me){return v[Ee][T]-v[Me][T]});for(var V=[],k=new Array(_),O=0;O<y;O++){var R=B[O],w=v[R],N=m?R:R-_,U=R<_,H=m||!U,D=U?[]:null;if(V.length){var G=b(V,z,w[T]-a)+1;if(V.splice(0,G),m&&f){D=D.concat(V);for(var K=0;K<V.length;K++){var Y=V[K];k[Y].push(N)}}else for(var ie=w[S],W=w[P],K=0;K<V.length;K++){var Y=V[K],te=v[Y],ne=Y<_,ae=m||Y>=_;(f||(U&&ae||H&&ne)&&ie>=te[P]-a&&W<=te[S]+a)&&(U&&ae&&D.push(m?Y:Y-_),H&&ne&&k[Y].push(N))}}if(U&&(e===i&&D.push(R),k[R]=D),V.length){var oe=w[z],ce=b(V,z,oe);V.splice(ce+1,0,R)}else V.push(R)}for(var O=0;O<k.length;O++){var we=k[O];we&&we.sort(function(Me,Ne){return Me-Ne})}return k}},L=u.extend({initialize:function(e){this.precision=u.pick(e,5),this.multiplier=Math.pow(10,this.precision)},number:function(e){return this.precision<16?Math.round(e*this.multiplier)/this.multiplier:e},pair:function(e,i,a){return this.number(e)+(a||",")+this.number(i)},point:function(e,i){return this.number(e.x)+(i||",")+this.number(e.y)},size:function(e,i){return this.number(e.width)+(i||",")+this.number(e.height)},rectangle:function(e,i){return this.point(e,i)+(i||",")+this.size(e,i)}});L.instance=new L;var A=new function(){var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],i=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],a=Math.abs,h=Math.sqrt,f=Math.pow,m=Math.log2||function(z){return Math.log(z)*Math.LOG2E},v=1e-12,_=112e-18;function y(z,P,S){return z<P?P:z>S?S:z}function b(z,P,S){function B(G){var K=G*134217729,Y=G-K,ie=Y+K,W=G-ie;return[ie,W]}var O=P*P-z*S,V=P*P+z*S;if(a(O)*3<V){var k=B(z),R=B(P),w=B(S),N=P*P,U=R[0]*R[0]-N+2*R[0]*R[1]+R[1]*R[1],H=z*S,D=k[0]*w[0]-H+k[0]*w[1]+k[1]*w[0]+k[1]*w[1];O=N-H+(U-D)}return O}function T(){var z=Math.max.apply(Math,arguments);return z&&(z<1e-8||z>1e8)?f(2,-Math.round(m(z))):0}return{EPSILON:v,MACHINE_EPSILON:_,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(h(2)-1)/3,isZero:function(z){return z>=-v&&z<=v},isMachineZero:function(z){return z>=-_&&z<=_},clamp:y,integrate:function(z,P,S,B){for(var O=e[B-2],V=i[B-2],k=(S-P)*.5,R=k+P,w=0,N=B+1>>1,U=B&1?V[w++]*z(R):0;w<N;){var H=k*O[w];U+=V[w++]*(z(R+H)+z(R-H))}return k*U},findRoot:function(z,P,S,B,O,V,k){for(var R=0;R<V;R++){var w=z(S),N=w/P(S),U=S-N;if(a(N)<k){S=U;break}w>0?(O=S,S=U<=B?(B+O)*.5:U):(B=S,S=U>=O?(B+O)*.5:U)}return y(S,B,O)},solveQuadratic:function(z,P,S,B,O,V){var k,R=1/0;if(a(z)<v){if(a(P)<v)return a(S)<v?-1:0;k=-S/P}else{P*=-.5;var w=b(z,P,S);if(w&&a(w)<_){var N=T(a(z),a(P),a(S));N&&(z*=N,P*=N,S*=N,w=b(z,P,S))}if(w>=-_){var U=w<0?0:h(w),H=P+(P<0?-U:U);H===0?(k=S/z,R=-k):(k=H/z,R=S/H)}}var D=0,G=O==null,K=O-v,Y=V+v;return isFinite(k)&&(G||k>K&&k<Y)&&(B[D++]=G?k:y(k,O,V)),R!==k&&isFinite(R)&&(G||R>K&&R<Y)&&(B[D++]=G?R:y(R,O,V)),D},solveCubic:function(z,P,S,B,O,V,k){var R=T(a(z),a(P),a(S),a(B)),w,N,U,H,D;R&&(z*=R,P*=R,S*=R,B*=R);function G(ce){w=ce;var we=z*w;N=we+P,U=N*w+S,H=(we+N)*w+U,D=U*w+B}if(a(z)<v)z=P,N=S,U=B,w=1/0;else if(a(B)<v)N=P,U=S,w=0;else{G(-(P/z)/3);var K=D/z,Y=f(a(K),1/3),ie=K<0?-1:1,W=-H/z,te=W>0?1.324717957244746*Math.max(Y,h(W)):Y,ne=w-ie*te;if(ne!==w){do G(ne),ne=H===0?w:w-D/H/(1+_);while(ie*ne>ie*w);a(z)*w*w>a(B/w)&&(U=-B/w,N=(U-S)/w)}}var ae=A.solveQuadratic(z,N,U,O,V,k),oe=V==null;return isFinite(w)&&(ae===0||ae>0&&w!==O[0]&&w!==O[1])&&(oe||w>V-v&&w<k+v)&&(O[ae++]=oe?w:y(w,V,k)),ae}}},q={_id:1,_pools:{},get:function(e){if(e){var i=this._pools[e];return i||(i=this._pools[e]={_id:1}),i._id++}else return this._id++}},E=u.extend({_class:"Point",_readIndex:!0,initialize:function(i,a){var h=typeof i,f=this.__read,m=0;if(h==="number"){var v=typeof a=="number";this._set(i,v?a:i),f&&(m=v?2:1)}else if(h==="undefined"||i===null)this._set(0,0),f&&(m=i===null?1:0);else{var _=h==="string"?i.split(/[\s,]+/)||[]:i;m=1,Array.isArray(_)?this._set(+_[0],+(_.length>1?_[1]:_[0])):"x"in _?this._set(_.x||0,_.y||0):"width"in _?this._set(_.width||0,_.height||0):"angle"in _?(this._set(_.length||0,0),this.setAngle(_.angle||0)):(this._set(0,0),m=0)}return f&&(this.__read=m),this},set:"#initialize",_set:function(e,i){return this.x=e,this.y=i,this},equals:function(e){return this===e||e&&(this.x===e.x&&this.y===e.y||Array.isArray(e)&&this.x===e[0]&&this.y===e[1])||!1},clone:function(){return new E(this.x,this.y)},toString:function(){var e=L.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.x),i.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(e){if(this.isZero()){var i=this._angle||0;this._set(Math.cos(i)*e,Math.sin(i)*e)}else{var a=e/this.getLength();A.isZero(a)&&this.getAngle(),this._set(this.x*a,this.y*a)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(e){this.setAngleInRadians.call(this,e*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var e=E.read(arguments),i=this.getLength()*e.getLength();if(A.isZero(i))return NaN;var a=this.dot(e)/i;return Math.acos(a<-1?-1:a>1?1:a)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(e){if(this._angle=e,!this.isZero()){var i=this.getLength();this._set(Math.cos(e)*i,Math.sin(e)*i)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var e=E.read(arguments);return Math.atan2(this.cross(e),this.dot(e))*180/Math.PI},getDistance:function(){var e=arguments,i=E.read(e),a=i.x-this.x,h=i.y-this.y,f=a*a+h*h,m=u.read(e);return m?f:Math.sqrt(f)},normalize:function(e){e===r&&(e=1);var i=this.getLength(),a=i!==0?e/i:0,h=new E(this.x*a,this.y*a);return a>=0&&(h._angle=this._angle),h},rotate:function(e,i){if(e===0)return this.clone();e=e*Math.PI/180;var a=i?this.subtract(i):this,h=Math.sin(e),f=Math.cos(e);return a=new E(a.x*f-a.y*h,a.x*h+a.y*f),i?a.add(i):a},transform:function(e){return e?e._transformPoint(this):this},add:function(){var e=E.read(arguments);return new E(this.x+e.x,this.y+e.y)},subtract:function(){var e=E.read(arguments);return new E(this.x-e.x,this.y-e.y)},multiply:function(){var e=E.read(arguments);return new E(this.x*e.x,this.y*e.y)},divide:function(){var e=E.read(arguments);return new E(this.x/e.x,this.y/e.y)},modulo:function(){var e=E.read(arguments);return new E(this.x%e.x,this.y%e.y)},negate:function(){return new E(-this.x,-this.y)},isInside:function(){return $.read(arguments).contains(this)},isClose:function(){var e=arguments,i=E.read(e),a=u.read(e);return this.getDistance(i)<=a},isCollinear:function(){var e=E.read(arguments);return E.isCollinear(this.x,this.y,e.x,e.y)},isColinear:"#isCollinear",isOrthogonal:function(){var e=E.read(arguments);return E.isOrthogonal(this.x,this.y,e.x,e.y)},isZero:function(){var e=A.isZero;return e(this.x)&&e(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(e){return this.x*(e>1&&e<4?-1:1)>=0&&this.y*(e>2?-1:1)>=0},dot:function(){var e=E.read(arguments);return this.x*e.x+this.y*e.y},cross:function(){var e=E.read(arguments);return this.x*e.y-this.y*e.x},project:function(){var e=E.read(arguments),i=e.isZero()?0:this.dot(e)/e.dot(e);return new E(e.x*i,e.y*i)},statics:{min:function(){var e=arguments,i=E.read(e),a=E.read(e);return new E(Math.min(i.x,a.x),Math.min(i.y,a.y))},max:function(){var e=arguments,i=E.read(e),a=E.read(e);return new E(Math.max(i.x,a.x),Math.max(i.y,a.y))},random:function(){return new E(Math.random(),Math.random())},isCollinear:function(e,i,a,h){return Math.abs(e*h-i*a)<=Math.sqrt((e*e+i*i)*(a*a+h*h))*1e-8},isOrthogonal:function(e,i,a,h){return Math.abs(e*a+i*h)<=Math.sqrt((e*e+i*i)*(a*a+h*h))*1e-8}}},u.each(["round","ceil","floor","abs"],function(e){var i=Math[e];this[e]=function(){return new E(i(this.x),i(this.y))}},{})),Q=E.extend({initialize:function(i,a,h,f){this._x=i,this._y=a,this._owner=h,this._setter=f},_set:function(e,i,a){return this._x=e,this._y=i,a||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),X=u.extend({_class:"Size",_readIndex:!0,initialize:function(i,a){var h=typeof i,f=this.__read,m=0;if(h==="number"){var v=typeof a=="number";this._set(i,v?a:i),f&&(m=v?2:1)}else if(h==="undefined"||i===null)this._set(0,0),f&&(m=i===null?1:0);else{var _=h==="string"?i.split(/[\s,]+/)||[]:i;m=1,Array.isArray(_)?this._set(+_[0],+(_.length>1?_[1]:_[0])):"width"in _?this._set(_.width||0,_.height||0):"x"in _?this._set(_.x||0,_.y||0):(this._set(0,0),m=0)}return f&&(this.__read=m),this},set:"#initialize",_set:function(e,i){return this.width=e,this.height=i,this},equals:function(e){return e===this||e&&(this.width===e.width&&this.height===e.height||Array.isArray(e)&&this.width===e[0]&&this.height===e[1])||!1},clone:function(){return new X(this.width,this.height)},toString:function(){var e=L.instance;return"{ width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.width),i.number(this.height)]},add:function(){var e=X.read(arguments);return new X(this.width+e.width,this.height+e.height)},subtract:function(){var e=X.read(arguments);return new X(this.width-e.width,this.height-e.height)},multiply:function(){var e=X.read(arguments);return new X(this.width*e.width,this.height*e.height)},divide:function(){var e=X.read(arguments);return new X(this.width/e.width,this.height/e.height)},modulo:function(){var e=X.read(arguments);return new X(this.width%e.width,this.height%e.height)},negate:function(){return new X(-this.width,-this.height)},isZero:function(){var e=A.isZero;return e(this.width)&&e(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(e,i){return new X(Math.min(e.width,i.width),Math.min(e.height,i.height))},max:function(e,i){return new X(Math.max(e.width,i.width),Math.max(e.height,i.height))},random:function(){return new X(Math.random(),Math.random())}}},u.each(["round","ceil","floor","abs"],function(e){var i=Math[e];this[e]=function(){return new X(i(this.width),i(this.height))}},{})),j=X.extend({initialize:function(i,a,h,f){this._width=i,this._height=a,this._owner=h,this._setter=f},_set:function(e,i,a){return this._width=e,this._height=i,a||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(e){this._width=e,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(e){this._height=e,this._owner[this._setter](this)}}),$=u.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(i,a,h,f){var m=arguments,v=typeof i,_;if(v==="number"?(this._set(i,a,h,f),_=4):v==="undefined"||i===null?(this._set(0,0,0,0),_=i===null?1:0):m.length===1&&(Array.isArray(i)?(this._set.apply(this,i),_=1):i.x!==r||i.width!==r?(this._set(i.x||0,i.y||0,i.width||0,i.height||0),_=1):i.from===r&&i.to===r&&(this._set(0,0,0,0),u.readSupported(m,this)&&(_=1))),_===r){var y=E.readNamed(m,"from"),b=u.peek(m),T=y.x,z=y.y,P,S;if(b&&b.x!==r||u.hasNamed(m,"to")){var B=E.readNamed(m,"to");P=B.x-T,S=B.y-z,P<0&&(T=B.x,P=-P),S<0&&(z=B.y,S=-S)}else{var O=X.read(m);P=O.width,S=O.height}this._set(T,z,P,S),_=m.__index}var V=m.__filtered;return V&&(this.__filtered=V),this.__read&&(this.__read=_),this},set:"#initialize",_set:function(e,i,a,h){return this.x=e,this.y=i,this.width=a,this.height=h,this},clone:function(){return new $(this.x,this.y,this.width,this.height)},equals:function(e){var i=u.isPlainValue(e)?$.read(arguments):e;return i===this||i&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height||!1},toString:function(){var e=L.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+", width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.x),i.number(this.y),i.number(this.width),i.number(this.height)]},getPoint:function(e){var i=e?E:Q;return new i(this.x,this.y,this,"setPoint")},setPoint:function(){var e=E.read(arguments);this.x=e.x,this.y=e.y},getSize:function(e){var i=e?X:j;return new i(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var e=X.read(arguments),i=this._sx,a=this._sy,h=e.width,f=e.height;i&&(this.x+=(this.width-h)*i),a&&(this.y+=(this.height-f)*a),this.width=h,this.height=f,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(e){if(!this._fw){var i=e-this.x;this.width-=this._sx===.5?i*2:i}this.x=e,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(e){if(!this._fh){var i=e-this.y;this.height-=this._sy===.5?i*2:i}this.y=e,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(e){if(!this._fw){var i=e-this.x;this.width=this._sx===.5?i*2:i}this.x=e-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(e){if(!this._fh){var i=e-this.y;this.height=this._sy===.5?i*2:i}this.y=e-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(e){this._fw||this._sx===.5?this.x=e-this.width/2:(this._sx&&(this.x+=(e-this.x)*2*this._sx),this.width=(e-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(e){this._fh||this._sy===.5?this.y=e-this.height/2:(this._sy&&(this.y+=(e-this.y)*2*this._sy),this.height=(e-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(e){var i=e?E:Q;return new i(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var e=E.read(arguments);return this.setCenterX(e.x),this.setCenterY(e.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(e){return e&&e.width!==r||(Array.isArray(e)?e:arguments).length===4?this._containsRectangle($.read(arguments)):this._containsPoint(E.read(arguments))},_containsPoint:function(e){var i=e.x,a=e.y;return i>=this.x&&a>=this.y&&i<=this.x+this.width&&a<=this.y+this.height},_containsRectangle:function(e){var i=e.x,a=e.y;return i>=this.x&&a>=this.y&&i+e.width<=this.x+this.width&&a+e.height<=this.y+this.height},intersects:function(){var e=$.read(arguments),i=u.read(arguments)||0;return e.x+e.width>this.x-i&&e.y+e.height>this.y-i&&e.x<this.x+this.width+i&&e.y<this.y+this.height+i},intersect:function(){var e=$.read(arguments),i=Math.max(this.x,e.x),a=Math.max(this.y,e.y),h=Math.min(this.x+this.width,e.x+e.width),f=Math.min(this.y+this.height,e.y+e.height);return new $(i,a,h-i,f-a)},unite:function(){var e=$.read(arguments),i=Math.min(this.x,e.x),a=Math.min(this.y,e.y),h=Math.max(this.x+this.width,e.x+e.width),f=Math.max(this.y+this.height,e.y+e.height);return new $(i,a,h-i,f-a)},include:function(){var e=E.read(arguments),i=Math.min(this.x,e.x),a=Math.min(this.y,e.y),h=Math.max(this.x+this.width,e.x),f=Math.max(this.y+this.height,e.y);return new $(i,a,h-i,f-a)},expand:function(){var e=X.read(arguments),i=e.width,a=e.height;return new $(this.x-i/2,this.y-a/2,this.width+i,this.height+a)},scale:function(e,i){return this.expand(this.width*e-this.width,this.height*(i===r?e:i)-this.height)}},u.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(e,i){var a=e.join(""),h=/^[RL]/.test(a);i>=4&&(e[1]+=h?"Y":"X");var f=e[h?0:1],m=e[h?1:0],v="get"+f,_="get"+m,y="set"+f,b="set"+m,T="get"+a,z="set"+a;this[T]=function(P){var S=P?E:Q;return new S(this[v](),this[_](),this,z)},this[z]=function(){var P=E.read(arguments);this[y](P.x),this[b](P.y)}},{beans:!0})),he=$.extend({initialize:function(i,a,h,f,m,v){this._set(i,a,h,f,!0),this._owner=m,this._setter=v},_set:function(e,i,a,h,f){return this._x=e,this._y=i,this._width=a,this._height=h,f||this._owner[this._setter](this),this}},new function(){var e=$.prototype;return u.each(["x","y","width","height"],function(i){var a=u.capitalize(i),h="_"+i;this["get"+a]=function(){return this[h]},this["set"+a]=function(f){this[h]=f,this._dontNotify||this._owner[this._setter](this)}},u.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(i){var a="set"+i;this[a]=function(){this._dontNotify=!0,e[a].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(i){var a=this._owner;a._changeSelection&&a._changeSelection(2,i)}}))}),re=u.extend({_class:"Matrix",initialize:function e(i,a){var h=arguments,f=h.length,m=!0;if(f>=6?this._set.apply(this,h):f===1||f===2?i instanceof e?this._set(i._a,i._b,i._c,i._d,i._tx,i._ty,a):Array.isArray(i)?this._set.apply(this,a?i.concat([a]):i):m=!1:f?m=!1:this.reset(),!m)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(e,i,a,h,f,m,v){return this._a=e,this._b=i,this._c=a,this._d=h,this._tx=f,this._ty=m,v||this._changed(),this},_serialize:function(e,i){return u.serialize(this.getValues(),e,!0,i)},_changed:function(){var e=this._owner;e&&(e._applyMatrix?e.transform(null,!0):e._changed(25))},clone:function(){return new re(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(e){return e===this||e&&this._a===e._a&&this._b===e._b&&this._c===e._c&&this._d===e._d&&this._tx===e._tx&&this._ty===e._ty},toString:function(){var e=L.instance;return"[["+[e.number(this._a),e.number(this._c),e.number(this._tx)].join(", ")+"], ["+[e.number(this._b),e.number(this._d),e.number(this._ty)].join(", ")+"]]"},reset:function(e){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,e||this._changed(),this},apply:function(e,i){var a=this._owner;return a?(a.transform(null,u.pick(e,!0),i),this.isIdentity()):!1},translate:function(){var e=E.read(arguments),i=e.x,a=e.y;return this._tx+=i*this._a+a*this._c,this._ty+=i*this._b+a*this._d,this._changed(),this},scale:function(){var e=arguments,i=E.read(e),a=E.read(e,0,{readNull:!0});return a&&this.translate(a),this._a*=i.x,this._b*=i.x,this._c*=i.y,this._d*=i.y,a&&this.translate(a.negate()),this._changed(),this},rotate:function(e){e*=Math.PI/180;var i=E.read(arguments,1),a=i.x,h=i.y,f=Math.cos(e),m=Math.sin(e),v=a-a*f+h*m,_=h-a*m-h*f,y=this._a,b=this._b,T=this._c,z=this._d;return this._a=f*y+m*T,this._b=f*b+m*z,this._c=-m*y+f*T,this._d=-m*b+f*z,this._tx+=v*y+_*T,this._ty+=v*b+_*z,this._changed(),this},shear:function(){var e=arguments,i=E.read(e),a=E.read(e,0,{readNull:!0});a&&this.translate(a);var h=this._a,f=this._b;return this._a+=i.y*this._c,this._b+=i.y*this._d,this._c+=i.x*h,this._d+=i.x*f,a&&this.translate(a.negate()),this._changed(),this},skew:function(){var e=arguments,i=E.read(e),a=E.read(e,0,{readNull:!0}),h=Math.PI/180,f=new E(Math.tan(i.x*h),Math.tan(i.y*h));return this.shear(f,a)},append:function(e,i){if(e){var a=this._a,h=this._b,f=this._c,m=this._d,v=e._a,_=e._c,y=e._b,b=e._d,T=e._tx,z=e._ty;this._a=v*a+y*f,this._c=_*a+b*f,this._b=v*h+y*m,this._d=_*h+b*m,this._tx+=T*a+z*f,this._ty+=T*h+z*m,i||this._changed()}return this},prepend:function(e,i){if(e){var a=this._a,h=this._b,f=this._c,m=this._d,v=this._tx,_=this._ty,y=e._a,b=e._c,T=e._b,z=e._d,P=e._tx,S=e._ty;this._a=y*a+b*h,this._c=y*f+b*m,this._b=T*a+z*h,this._d=T*f+z*m,this._tx=y*v+b*_+P,this._ty=T*v+z*_+S,i||this._changed()}return this},appended:function(e){return this.clone().append(e)},prepended:function(e){return this.clone().prepend(e)},invert:function(){var e=this._a,i=this._b,a=this._c,h=this._d,f=this._tx,m=this._ty,v=e*h-i*a,_=null;return v&&!isNaN(v)&&isFinite(f)&&isFinite(m)&&(this._a=h/v,this._b=-i/v,this._c=-a/v,this._d=e/v,this._tx=(a*m-h*f)/v,this._ty=(i*f-e*m)/v,_=this),_},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new re(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var e=this._a*this._d-this._c*this._b;return e&&!isNaN(e)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(e,i,a){return arguments.length<3?this._transformPoint(E.read(arguments)):this._transformCoordinates(e,i,a)},_transformPoint:function(e,i,a){var h=e.x,f=e.y;return i||(i=new E),i._set(h*this._a+f*this._c+this._tx,h*this._b+f*this._d+this._ty,a)},_transformCoordinates:function(e,i,a){for(var h=0,f=2*a;h<f;h+=2){var m=e[h],v=e[h+1];i[h]=m*this._a+v*this._c+this._tx,i[h+1]=m*this._b+v*this._d+this._ty}return i},_transformCorners:function(e){var i=e.x,a=e.y,h=i+e.width,f=a+e.height,m=[i,a,h,a,h,f,i,f];return this._transformCoordinates(m,m,4)},_transformBounds:function(e,i,a){for(var h=this._transformCorners(e),f=h.slice(0,2),m=f.slice(),v=2;v<8;v++){var _=h[v],y=v&1;_<f[y]?f[y]=_:_>m[y]&&(m[y]=_)}return i||(i=new $),i._set(f[0],f[1],m[0]-f[0],m[1]-f[1],a)},inverseTransform:function(){return this._inverseTransform(E.read(arguments))},_inverseTransform:function(e,i,a){var h=this._a,f=this._b,m=this._c,v=this._d,_=this._tx,y=this._ty,b=h*v-f*m,T=null;if(b&&!isNaN(b)&&isFinite(_)&&isFinite(y)){var z=e.x-this._tx,P=e.y-this._ty;i||(i=new E),T=i._set((z*v-P*m)/b,(P*h-z*f)/b,a)}return T},decompose:function(){var e=this._a,i=this._b,a=this._c,h=this._d,f=e*h-i*a,m=Math.sqrt,v=Math.atan2,_=180/Math.PI,y,b,T;if(e!==0||i!==0){var z=m(e*e+i*i);y=Math.acos(e/z)*(i>0?1:-1),b=[z,f/z],T=[v(e*a+i*h,z*z),0]}else if(a!==0||h!==0){var P=m(a*a+h*h);y=Math.asin(a/P)*(h>0?1:-1),b=[f/P,P],T=[0,v(e*a+i*h,P*P)]}else y=0,T=b=[0,0];return{translation:this.getTranslation(),rotation:y*_,scaling:new E(b),skewing:new E(T[0]*_,T[1]*_)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new E(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(e){this.isIdentity()||e.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},u.each(["a","b","c","d","tx","ty"],function(e){var i=u.capitalize(e),a="_"+e;this["get"+i]=function(){return this[a]},this["set"+i]=function(h){this[a]=h,this._changed()}},{})),ye=u.extend({_class:"Line",initialize:function(i,a,h,f,m){var v=!1;arguments.length>=4?(this._px=i,this._py=a,this._vx=h,this._vy=f,v=m):(this._px=i.x,this._py=i.y,this._vx=a.x,this._vy=a.y,v=h),v||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new E(this._px,this._py)},getVector:function(){return new E(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(e,i){return ye.intersect(this._px,this._py,this._vx,this._vy,e._px,e._py,e._vx,e._vy,!0,i)},getSide:function(e,i){return ye.getSide(this._px,this._py,this._vx,this._vy,e.x,e.y,!0,i)},getDistance:function(e){return Math.abs(this.getSignedDistance(e))},getSignedDistance:function(e){return ye.getSignedDistance(this._px,this._py,this._vx,this._vy,e.x,e.y,!0)},isCollinear:function(e){return E.isCollinear(this._vx,this._vy,e._vx,e._vy)},isOrthogonal:function(e){return E.isOrthogonal(this._vx,this._vy,e._vx,e._vy)},statics:{intersect:function(e,i,a,h,f,m,v,_,y,b){y||(a-=e,h-=i,v-=f,_-=m);var T=a*_-h*v;if(!A.isMachineZero(T)){var z=e-f,P=i-m,S=(v*P-_*z)/T,B=(a*P-h*z)/T,O=1e-12,V=-O,k=1+O;if(b||V<S&&S<k&&V<B&&B<k)return b||(S=S<=0?0:S>=1?1:S),new E(e+S*a,i+S*h)}},getSide:function(e,i,a,h,f,m,v,_){v||(a-=e,h-=i);var y=f-e,b=m-i,T=y*h-b*a;return!_&&A.isMachineZero(T)&&(T=(y*a+y*a)/(a*a+h*h),T>=0&&T<=1&&(T=0)),T<0?-1:T>0?1:0},getSignedDistance:function(e,i,a,h,f,m,v){return v||(a-=e,h-=i),a===0?h>0?f-e:e-f:h===0?a<0?m-i:i-m:((f-e)*h-(m-i)*a)/(h>a?h*Math.sqrt(1+a*a/(h*h)):a*Math.sqrt(1+h*h/(a*a)))},getDistance:function(e,i,a,h,f,m,v){return Math.abs(ye.getSignedDistance(e,i,a,h,f,m,v))}}}),ue=x.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(i){x.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Yi(null,null,this),this._view=ut.create(this,i||dt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(e,i){return u.serialize(this._children,e,!0,i)},_changed:function(e,i){if(e&1){var a=this._view;a&&(a._needsUpdate=!0,!a._requested&&a._autoUpdate&&a.requestUpdate())}var h=this._changes;if(h&&i){var f=this._changesById,m=i._id,v=f[m];v?v.flags|=e:h.push(f[m]={item:i,flags:e})}},clear:function(){for(var e=this._children,i=e.length-1;i>=0;i--)e[i].remove()},isEmpty:function(){return!this._children.length},remove:function e(){return e.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(e){this._currentStyle.set(e)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new _e({project:this,insert:!0})},getSymbolDefinitions:function(){var e=[],i={};return this.getItems({class:ke,match:function(a){var h=a._definition,f=h._id;return i[f]||(i[f]=!0,e.push(h)),!1}}),e},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var e=this._selectionItems,i=[];for(var a in e){var h=e[a],f=h._selection;f&1&&h.isInserted()?i.push(h):f||this._updateSelection(h)}return i},_updateSelection:function(e){var i=e._id,a=this._selectionItems;e._selection?a[i]!==e&&(this._selectionCount++,a[i]=e):a[i]===e&&(this._selectionCount--,delete a[i])},selectAll:function(){for(var e=this._children,i=0,a=e.length;i<a;i++)e[i].setFullySelected(!0)},deselectAll:function(){var e=this._selectionItems;for(var i in e)e[i].setFullySelected(!1)},addLayer:function(e){return this.insertLayer(r,e)},insertLayer:function(e,i){if(i instanceof _e){i._remove(!1,!0),u.splice(this._children,[i],e,0),i._setProject(this,!0);var a=i._name;a&&i.setName(a),this._changes&&i._changed(5),this._activeLayer||(this._activeLayer=i)}else i=null;return i},_insertItem:function(e,i,a){return i=this.insertLayer(e,i)||(this._activeLayer||this._insertItem(r,new _e(M.NO_INSERT),!0)).insertChild(e,i),a&&i.activate&&i.activate(),i},getItems:function(e){return M._getItems(this,e)},getItem:function(e){return M._getItems(this,e,null,null,!0)[0]||null},importJSON:function(e){this.activate();var i=this._activeLayer;return u.importJSON(e,i&&i.isEmpty()&&i)},removeOn:function(e){var i=this._removeSets;if(i){e==="mouseup"&&(i.mousedrag=null);var a=i[e];if(a){for(var h in a){var f=a[h];for(var m in i){var v=i[m];v&&v!=a&&delete v[f._id]}f.remove()}i[e]=null}}},draw:function(e,i,a){this._updateVersion++,e.save(),i.applyToContext(e);for(var h=this._children,f=new u({offset:new E(0,0),pixelRatio:a,viewMatrix:i.isIdentity()?null:i,matrices:[new re],updateMatrix:!0}),m=0,v=h.length;m<v;m++)h[m].draw(e,f);if(e.restore(),this._selectionCount>0){e.save(),e.strokeWidth=1;var _=this._selectionItems,y=this._scope.settings.handleSize,b=this._updateVersion;for(var T in _)_[T]._drawSelection(e,i,y,_,b);e.restore()}}}),M=u.extend(d,{statics:{extend:function e(i){return i._serializeFields&&(i._serializeFields=u.set({},this.prototype._serializeFields,i._serializeFields)),e.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new re,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var e=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return u.each(e,function(i){this._events[i]={install:function(a){this.getView()._countItemEvent(a,1)},uninstall:function(a){this.getView()._countItemEvent(a,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:e}})},{initialize:function(){},_initialize:function(e,i){var a=e&&u.isPlainObject(e),h=a&&e.internal===!0,f=this._matrix=new re,m=a&&e.project||$e.project,v=$e.settings;return this._id=h?null:q.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&v.applyMatrix,i&&f.translate(i),f._owner=this,this._style=new Yi(m._currentStyle,this,m),h||a&&e.insert==!1||!v.insertItems&&!(a&&e.insert==!0)?this._setProject(m):(a&&e.parent||m)._insertItem(r,this,!0),a&&e!==M.NO_INSERT&&e!==M.INSERT&&this.set(e,{internal:!0,insert:!0,project:!0,parent:!0}),a},_serialize:function(e,i){var a={},h=this;function f(m){for(var v in m){var _=h[v];u.equals(_,v==="leading"?m.fontSize*1.2:m[v])||(a[v]=u.serialize(_,e,v!=="data",i))}}return f(this._serializeFields),this instanceof de||f(this._style._defaults),[this._class,a]},_changed:function(e){var i=this._symbol,a=this._parent||i,h=this._project;e&8&&(this._bounds=this._position=this._decomposed=r),e&16&&(this._globalMatrix=r),a&&e&72&&M._clearBoundsCache(a),e&2&&M._clearBoundsCache(this),h&&h._changed(e,this),i&&i._changed(e)},getId:function(){return this._id},getName:function(){return this._name},setName:function(e){if(this._name&&this._removeNamed(),e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(e&&i){var a=i._children,h=i._namedChildren;(h[e]=h[e]||[]).push(this),e in a||(a[e]=this)}this._name=e||r,this._changed(256)},getStyle:function(){return this._style},setStyle:function(e){this.getStyle().set(e)}},u.each(["locked","visible","blendMode","opacity","guide"],function(e){var i=u.capitalize(e),a="_"+e,h={locked:256,visible:265};this["get"+i]=function(){return this[a]},this["set"+i]=function(f){f!=this[a]&&(this[a]=f,this._changed(h[e]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(e){if(e!==this._selection){this._selection=e;var i=this._project;i&&(i._updateSelection(this),this._changed(257))}},_changeSelection:function(e,i){var a=this._selection;this.setSelection(i?a|e:a&~e)},isSelected:function(){if(this._selectChildren){for(var e=this._children,i=0,a=e.length;i<a;i++)if(e[i].isSelected())return!0}return!!(this._selection&1)},setSelected:function(e){if(this._selectChildren)for(var i=this._children,a=0,h=i.length;a<h;a++)i[a].setSelected(e);this._changeSelection(1,e)},isFullySelected:function(){var e=this._children,i=!!(this._selection&1);if(e&&i){for(var a=0,h=e.length;a<h;a++)if(!e[a].isFullySelected())return!1;return!0}return i},setFullySelected:function(e){var i=this._children;if(i)for(var a=0,h=i.length;a<h;a++)i[a].setFullySelected(e);this._changeSelection(1,e)},isClipMask:function(){return this._clipMask},setClipMask:function(e){this._clipMask!=(e=!!e)&&(this._clipMask=e,e&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(e){this._data=e},getPosition:function(e){var i=e?E:Q,a=this._position||(this._position=this._getPositionFromBounds());return new i(a.x,a.y,this,"setPosition")},setPosition:function(){this.translate(E.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(e){return this._pivot?this._matrix._transformPoint(this._pivot):(e||this.getBounds()).getCenter(!0)},getPivot:function(){var e=this._pivot;return e?new Q(e.x,e.y,this,"setPivot"):null},setPivot:function(){this._pivot=E.read(arguments,0,{clone:!0,readNull:!0}),this._position=r}},u.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(e,i){this[i]=function(a){return this.getBounds(a,e)}},{beans:!0,getBounds:function(e,i){var a=i||e instanceof re,h=u.set({},a?i:e,this._boundsOptions);(!h.stroke||this.getStrokeScaling())&&(h.cacheItem=this);var f=this._getCachedBounds(a&&e,h).rect;return arguments.length?f:new he(f.x,f.y,f.width,f.height,this,"setBounds")},setBounds:function(){var e=$.read(arguments),i=this.getBounds(),a=this._matrix,h=new re,f=e.getCenter();h.translate(f),(e.width!=i.width||e.height!=i.height)&&(a.isInvertible()||(a.set(a._backup||new re().translate(a.getTranslation())),i=this.getBounds()),h.scale(i.width!==0?e.width/i.width:0,i.height!==0?e.height/i.height:0)),f=i.getCenter(),h.translate(-f.x,-f.y),this.transform(h)},_getBounds:function(e,i){var a=this._children;return!a||!a.length?new $:(M._updateBoundsCache(this,i.cacheItem),M._getBounds(a,e,i))},_getBoundsCacheKey:function(e,i){return[e.stroke?1:0,e.handle?1:0,i?1:0].join("")},_getCachedBounds:function(e,i,a){e=e&&e._orNullIfIdentity();var h=i.internal&&!a,f=i.cacheItem,m=h?null:this._matrix._orNullIfIdentity(),v=f&&(!e||e.equals(m))&&this._getBoundsCacheKey(i,h),_=this._bounds;if(M._updateBoundsCache(this._parent||this._symbol,f),v&&_&&v in _){var y=_[v];return{rect:y.rect.clone(),nonscaling:y.nonscaling}}var b=this._getBounds(e||m,i),T=b.rect||b,z=this._style,P=b.nonscaling||z.hasStroke()&&!z.getStrokeScaling();if(v){_||(this._bounds=_={});var y=_[v]={rect:T.clone(),nonscaling:P,internal:h}}return{rect:T,nonscaling:P}},_getStrokeMatrix:function(e,i){var a=this.getStrokeScaling()?null:i&&i.internal?this:this._parent||this._symbol&&this._symbol._item,h=a?a.getViewMatrix().invert():e;return h&&h._shiftless()},statics:{_updateBoundsCache:function(e,i){if(e&&i){var a=i._id,h=e._boundsCache=e._boundsCache||{ids:{},list:[]};h.ids[a]||(h.list.push(i),h.ids[a]=i)}},_clearBoundsCache:function(e){var i=e._boundsCache;if(i){e._bounds=e._position=e._boundsCache=r;for(var a=0,h=i.list,f=h.length;a<f;a++){var m=h[a];m!==e&&(m._bounds=m._position=r,m._boundsCache&&M._clearBoundsCache(m))}}},_getBounds:function(e,i,a){var h=1/0,f=-h,m=h,v=f,_=!1;a=a||{};for(var y=0,b=e.length;y<b;y++){var T=e[y];if(T._visible&&!T.isEmpty(!0)){var z=T._getCachedBounds(i&&i.appended(T._matrix),a,!0),P=z.rect;h=Math.min(P.x,h),m=Math.min(P.y,m),f=Math.max(P.x+P.width,f),v=Math.max(P.y+P.height,v),z.nonscaling&&(_=!0)}}return{rect:isFinite(h)?new $(h,m,f-h,v-m):new $,nonscaling:_}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var e=this._decompose();return e?e.rotation:0},setRotation:function(e){var i=this.getRotation();if(i!=null&&e!=null){var a=this._decomposed;this.rotate(e-i),a&&(a.rotation=e,this._decomposed=a)}},getScaling:function(){var e=this._decompose(),i=e&&e.scaling;return new Q(i?i.x:1,i?i.y:1,this,"setScaling")},setScaling:function(){var e=this.getScaling(),i=E.read(arguments,0,{clone:!0,readNull:!0});if(e&&i&&!e.equals(i)){var a=this.getRotation(),h=this._decomposed,f=new re,m=A.isZero;if(m(e.x)||m(e.y))f.translate(h.translation),a&&f.rotate(a),f.scale(i.x,i.y),this._matrix.set(f);else{var v=this.getPosition(!0);f.translate(v),a&&f.rotate(a),f.scale(i.x/e.x,i.y/e.y),a&&f.rotate(-a),f.translate(v.negate()),this.transform(f)}h&&(h.scaling=i,this._decomposed=h)}},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},getGlobalMatrix:function(e){var i=this._globalMatrix;if(i)for(var a=this._parent,h=[];a;){if(!a._globalMatrix){i=null;for(var f=0,m=h.length;f<m;f++)h[f]._globalMatrix=null;break}h.push(a),a=a._parent}if(!i){i=this._globalMatrix=this._matrix.clone();var a=this._parent;a&&i.prepend(a.getGlobalMatrix(!0))}return e?i:i.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(e){(this._applyMatrix=this._canApplyMatrix&&!!e)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(e,i){if(this._project!==e){this._project&&this._installEvents(!1),this._project=e;for(var a=this._children,h=0,f=a&&a.length;h<f;h++)a[h]._setProject(e);i=!0}i&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function e(i){e.base.call(this,i);for(var a=this._children,h=0,f=a&&a.length;h<f;h++)a[h]._installEvents(i)},getLayer:function(){for(var e=this;e=e._parent;)if(e instanceof _e)return e;return null},getParent:function(){return this._parent},setParent:function(e){return e.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(e){this.removeChildren(),this.addChildren(e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var e=this._getOwner();return e&&e._children[this._index+1]||null},getPreviousSibling:function(){var e=this._getOwner();return e&&e._children[this._index-1]||null},getIndex:function(){return this._index},setIndex:function(e){var i=this._parent,a=i&&i._children;a&&i.insertChildren(e in a?e:r,[this])},equals:function(e){return e===this||e&&this._class===e._class&&this._style.equals(e._style)&&this._matrix.equals(e._matrix)&&this._locked===e._locked&&this._visible===e._visible&&this._blendMode===e._blendMode&&this._opacity===e._opacity&&this._clipMask===e._clipMask&&this._guide===e._guide&&this._equals(e)||!1},_equals:function(e){return u.equals(this._children,e._children)},clone:function(e){var i=new this.constructor(M.NO_INSERT),a=this._children,h=u.pick(e?e.insert:r,e===r||e===!0),f=u.pick(e?e.deep:r,!0);a&&i.copyAttributes(this),(!a||f)&&i.copyContent(this),a||i.copyAttributes(this),h&&i.insertAbove(this);var m=this._name,v=this._parent;if(m&&v){for(var a=v._children,_=m,y=1;a[m];)m=_+" "+y++;m!==_&&i.setName(m)}return i},copyContent:function(e){for(var i=e._children,a=0,h=i&&i.length;a<h;a++)this.addChild(i[a].clone(!1),!0)},copyAttributes:function(e,i){this.setStyle(e._style);for(var a=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],h=0,f=a.length;h<f;h++){var m=a[h];e.hasOwnProperty(m)&&(this[m]=e[m])}i||this._matrix.set(e._matrix,!0),this.setApplyMatrix(e._applyMatrix),this.setPivot(e._pivot),this.setSelection(e._selection);var v=e._data,_=e._name;this._data=v?u.clone(v):null,_&&this.setName(_)},rasterize:function(e,i){var a,h,f;u.isPlainObject(e)?(a=e.resolution,h=e.insert,f=e.raster):(a=e,h=i),f||(f=new Ce(M.NO_INSERT));var m=this.getStrokeBounds(),v=(a||this.getView().getResolution())/72,_=m.getTopLeft().floor(),y=m.getBottomRight().ceil(),b=new X(y.subtract(_)),T=b.multiply(v);if(f.setSize(T,!0),!T.isZero()){var z=f.getContext(!0),P=new re().scale(v).translate(_.negate());z.save(),P.applyToContext(z),this.draw(z,new u({matrices:[P]})),z.restore()}return f._matrix.set(new re().translate(_.add(b.divide(2))).scale(1/v)),(h===r||h)&&f.insertAbove(this),f},contains:function(){var e=this._matrix;return e.isInvertible()&&!!this._contains(e._inverseTransform(E.read(arguments)))},_contains:function(e){var i=this._children;if(i){for(var a=i.length-1;a>=0;a--)if(i[a].contains(e))return!0;return!1}return e.isInside(this.getInternalBounds())},isInside:function(){return $.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Ve.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(e,i){return e instanceof M?this._asPathItem().getIntersections(e._asPathItem(),null,i,!0).length>0:!1}},new function(){function e(){var h=arguments;return this._hitTest(E.read(h),Oe.getOptions(h))}function i(){var h=arguments,f=E.read(h),m=Oe.getOptions(h),v=[];return this._hitTest(f,new u({all:v},m)),v}function a(h,f,m,v){var _=this._children;if(_)for(var y=_.length-1;y>=0;y--){var b=_[y],T=b!==v&&b._hitTest(h,f,m);if(T&&!f.all)return T}return null}return ue.inject({hitTest:e,hitTestAll:i,_hitTest:a}),{hitTest:e,hitTestAll:i,_hitTestChildren:a}},{_hitTest:function(e,i,a){if(this._locked||!this._visible||this._guide&&!i.guides||this.isEmpty())return null;var h=this._matrix,f=a?a.appended(h):this.getGlobalMatrix().prepend(this.getView()._matrix),m=Math.max(i.tolerance,1e-12),v=i._tolerancePadding=new X(Ve._getStrokePadding(m,h._shiftless().invert()));if(e=h._inverseTransform(e),!e||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(v.multiply(2))._containsPoint(e))return null;var _=!(i.guides&&!this._guide||i.selected&&!this.isSelected()||i.type&&i.type!==u.hyphenate(this._class)||i.class&&!(this instanceof i.class)),y=i.match,b=this,T,z;function P(w){return w&&y&&!y(w)&&(w=null),w&&i.all&&i.all.push(w),w}function S(w,N){var U=N?T["get"+N]():b.getPosition();if(e.subtract(U).divide(v).length<=1)return new Oe(w,b,{name:N?u.hyphenate(N):w,point:U})}var B=i.position,O=i.center,V=i.bounds;if(_&&this._parent&&(B||O||V)){if((O||V)&&(T=this.getInternalBounds()),z=B&&S("position")||O&&S("center","Center"),!z&&V)for(var k=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],R=0;R<8&&!z;R++)z=S("bounds",k[R]);z=P(z)}return z||(z=this._hitTestChildren(e,i,f)||_&&P(this._hitTestSelf(e,i,f,this.getStrokeScaling()?null:f._shiftless().invert()))||null),z&&z.point&&(z.point=h.transform(z.point)),z},_hitTestSelf:function(e,i){if(i.fill&&this.hasFill()&&this._contains(e))return new Oe("fill",this)},matches:function(e,i){function a(v,_){for(var y in v)if(v.hasOwnProperty(y)){var b=v[y],T=_[y];if(u.isPlainObject(b)&&u.isPlainObject(T)){if(!a(b,T))return!1}else if(!u.equals(b,T))return!1}return!0}var h=typeof e;if(h==="object"){for(var f in e)if(e.hasOwnProperty(f)&&!this.matches(f,e[f]))return!1;return!0}else{if(h==="function")return e(this);if(e==="match")return i(this);var m=/^(empty|editable)$/.test(e)?this["is"+u.capitalize(e)]():e==="type"?u.hyphenate(this._class):this[e];if(e==="class"){if(typeof i=="function")return this instanceof i;m=this._class}if(typeof i=="function")return!!i(m);if(i){if(i.test)return i.test(m);if(u.isPlainObject(i))return a(i,m)}return u.equals(m,i)}},getItems:function(e){return M._getItems(this,e,this._matrix)},getItem:function(e){return M._getItems(this,e,this._matrix,null,!0)[0]||null},statics:{_getItems:function e(i,a,h,f,m){if(!f){var v=typeof a=="object"&&a,_=v&&v.overlapping,y=v&&v.inside,b=_||y,P=b&&$.read([b]);f={items:[],recursive:v&&v.recursive!==!1,inside:!!y,overlapping:!!_,rect:P,path:_&&new Ve.Rectangle({rectangle:P,insert:!1})},v&&(a=u.filter({},a,{recursive:!0,inside:!0,overlapping:!0}))}var T=i._children,z=f.items,P=f.rect;h=P&&(h||new re);for(var S=0,B=T&&T.length;S<B;S++){var O=T[S],V=h&&h.appended(O._matrix),k=!0;if(P){var b=O.getBounds(V);if(!P.intersects(b))continue;P.contains(b)||f.overlapping&&(b.contains(P)||f.path.intersects(O,V))||(k=!1)}if(k&&O.matches(a)&&(z.push(O),m)||(f.recursive!==!1&&e(O,a,V,f,m),m&&z.length>0))break}return z}}},{importJSON:function(e){var i=u.importJSON(e,this);return i!==this?this.addChild(i):i},addChild:function(e){return this.insertChild(r,e)},insertChild:function(e,i){var a=i?this.insertChildren(e,[i]):null;return a&&a[0]},addChildren:function(e){return this.insertChildren(this._children.length,e)},insertChildren:function(e,i){var a=this._children;if(a&&i&&i.length>0){i=u.slice(i);for(var h={},f=i.length-1;f>=0;f--){var m=i[f],v=m&&m._id;!m||h[v]?i.splice(f,1):(m._remove(!1,!0),h[v]=!0)}u.splice(a,i,e,0);for(var _=this._project,y=_._changes,f=0,b=i.length;f<b;f++){var m=i[f],T=m._name;m._parent=this,m._setProject(_,!0),T&&m.setName(T),y&&m._changed(5)}this._changed(11)}else i=null;return i},_insertItem:"#insertChild",_insertAt:function(e,i){var a=e&&e._getOwner(),h=e!==this&&a?this:null;return h&&(h._remove(!1,!0),a._insertItem(e._index+i,h)),h},insertAbove:function(e){return this._insertAt(e,1)},insertBelow:function(e){return this._insertAt(e,0)},sendToBack:function(){var e=this._getOwner();return e?e._insertItem(0,this):null},bringToFront:function(){var e=this._getOwner();return e?e._insertItem(r,this):null},appendTop:"#addChild",appendBottom:function(e){return this.insertChild(0,e)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(e){return e._insertItem(r,this)},copyTo:function(e){return this.clone(!1).addTo(e)},reduce:function(e){var i=this._children;if(i&&i.length===1){var a=i[0].reduce(e);return this._parent?(a.insertAbove(this),this.remove()):a.remove(),a}return this},_removeNamed:function(){var e=this._getOwner();if(e){var i=e._children,a=e._namedChildren,h=this._name,f=a[h],m=f?f.indexOf(this):-1;m!==-1&&(i[h]==this&&delete i[h],f.splice(m,1),f.length?i[h]=f[0]:delete a[h])}},_remove:function(e,i){var a=this._getOwner(),h=this._project,f=this._index;return this._style&&this._style._dispose(),a?(this._name&&this._removeNamed(),f!=null&&(h._activeLayer===this&&(h._activeLayer=this.getNextSibling()||this.getPreviousSibling()),u.splice(a._children,null,f,1)),this._installEvents(!1),e&&h._changes&&this._changed(5),i&&a._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(e){var i=e&&e.insertBelow(this);return i&&this.remove(),i},removeChildren:function(e,i){if(!this._children)return null;e=e||0,i=u.pick(i,this._children.length);for(var a=u.splice(this._children,null,e,i-e),h=a.length-1;h>=0;h--)a[h]._remove(!0,!1);return a.length>0&&this._changed(11),a},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var e=0,i=this._children.length;e<i;e++)this._children[e]._index=e;this._changed(11)}},isEmpty:function(e){var i=this._children,a=i?i.length:0;if(e){for(var h=0;h<a;h++)if(!i[h].isEmpty(e))return!1;return!0}return!a},isEditable:function(){for(var e=this;e;){if(!e._visible||e._locked)return!1;e=e._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(e){function i(v){var _=[];do _.unshift(v);while(v=v._parent);return _}for(var a=i(this),h=i(e),f=0,m=Math.min(a.length,h.length);f<m;f++)if(a[f]!=h[f])return a[f]._index<h[f]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(e){return this._getOrder(e)===-1},isBelow:function(e){return this._getOrder(e)===1},isParent:function(e){return this._parent===e},isChild:function(e){return e&&e._parent===this},isDescendant:function(e){for(var i=this;i=i._parent;)if(i===e)return!0;return!1},isAncestor:function(e){return e?e.isDescendant(this):!1},isSibling:function(e){return this._parent===e._parent},isGroupedWith:function(e){for(var i=this._parent;i;){if(i._parent&&/^(Group|Layer|CompoundPath)$/.test(i._class)&&e.isDescendant(i))return!0;i=i._parent}return!1}},u.each(["rotate","scale","shear","skew"],function(e){var i=e==="rotate";this[e]=function(){var a=arguments,h=(i?u:E).read(a),f=E.read(a,0,{readNull:!0});return this.transform(new re()[e](h,f||this.getPosition(!0)))}},{translate:function(){var e=new re;return this.transform(e.translate.apply(e,arguments))},transform:function(e,i,a){var h=this._matrix,f=e&&!e.isIdentity(),m=a&&this._canApplyMatrix||this._applyMatrix&&(f||!h.isIdentity()||i&&this._children);if(!f&&!m)return this;if(f){!e.isInvertible()&&h.isInvertible()&&(h._backup=h.getValues()),h.prepend(e,!0);var v=this._style,_=v.getFillColor(!0),y=v.getStrokeColor(!0);_&&_.transform(e),y&&y.transform(e)}if(m&&(m=this._transformContent(h,i,a))){var b=this._pivot;b&&h._transformPoint(b,b,!0),h.reset(!0),a&&this._canApplyMatrix&&(this._applyMatrix=!0)}var T=this._bounds,z=this._position;(f||m)&&this._changed(25);var P=f&&T&&e.decompose();if(P&&P.skewing.isZero()&&P.rotation%90===0){for(var S in T){var B=T[S];if(B.nonscaling)delete T[S];else if(m||!B.internal){var O=B.rect;e._transformBounds(O,O)}}this._bounds=T;var V=T[this._getBoundsCacheKey(this._boundsOptions||{})];V&&(this._position=this._getPositionFromBounds(V.rect))}else f&&z&&this._pivot&&(this._position=e._transformPoint(z,z));return this},_transformContent:function(e,i,a){var h=this._children;if(h){for(var f=0,m=h.length;f<m;f++)h[f].transform(e,i,a);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(E.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(E.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(E.read(arguments))},localToParent:function(){return this._matrix._transformPoint(E.read(arguments))},fitBounds:function(e,i){e=$.read(arguments);var a=this.getBounds(),h=a.height/a.width,f=e.height/e.width,m=(i?h>f:h<f)?e.width/a.width:e.height/a.height,v=new $(new E,new X(a.width*m,a.height*m));v.setCenter(e.getCenter()),this.setBounds(v)}}),{_setStyles:function(e,i,a){var h=this._style,f=this._matrix;if(h.hasFill()&&(e.fillStyle=h.getFillColor().toCanvasStyle(e,f)),h.hasStroke()){e.strokeStyle=h.getStrokeColor().toCanvasStyle(e,f),e.lineWidth=h.getStrokeWidth();var m=h.getStrokeJoin(),v=h.getStrokeCap(),_=h.getMiterLimit();if(m&&(e.lineJoin=m),v&&(e.lineCap=v),_&&(e.miterLimit=_),$e.support.nativeDash){var y=h.getDashArray(),b=h.getDashOffset();y&&y.length&&("setLineDash"in e?(e.setLineDash(y),e.lineDashOffset=b):(e.mozDash=y,e.mozDashOffset=b))}}if(h.hasShadow()){var T=i.pixelRatio||1,z=a._shiftless().prepend(new re().scale(T,T)),P=z.transform(new E(h.getShadowBlur(),0)),S=z.transform(this.getShadowOffset());e.shadowColor=h.getShadowColor().toCanvasStyle(e),e.shadowBlur=P.getLength(),e.shadowOffsetX=S.x,e.shadowOffsetY=S.y}},draw:function(e,i,a){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var h=i.matrices,f=i.viewMatrix,m=this._matrix,v=h[h.length-1].appended(m);if(v.isInvertible()){f=f?f.appended(v):v,h.push(v),i.updateMatrix&&(this._globalMatrix=v);var _=this._blendMode,y=A.clamp(this._opacity,0,1),b=_==="normal",T=xi.nativeModes[_],z=b&&y===1||i.dontStart||i.clip||(T||b&&y<1)&&this._canComposite(),P=i.pixelRatio||1,S,B,O;if(!z){var V=this.getStrokeBounds(f);if(!V.width||!V.height){h.pop();return}O=i.offset,B=i.offset=V.getTopLeft().floor(),S=e,e=dt.getContext(V.getSize().ceil().add(1).multiply(P)),P!==1&&e.scale(P,P)}e.save();var k=a?a.appended(m):this._canScaleStroke&&!this.getStrokeScaling(!0)&&f,R=!z&&i.clipItem,w=!k||R;if(z?(e.globalAlpha=y,T&&(e.globalCompositeOperation=_)):w&&e.translate(-B.x,-B.y),w&&(z?m:f).applyToContext(e),R&&i.clipItem.draw(e,i.extend({clip:!0})),k){e.setTransform(P,0,0,P,0,0);var N=i.offset;N&&e.translate(-N.x,-N.y)}this._draw(e,i,f,k),e.restore(),h.pop(),i.clip&&!i.dontFinish&&e.clip(this.getFillRule()),z||(xi.process(_,e,S,y,B.subtract(O).multiply(P)),dt.release(e),i.offset=O)}}},_isUpdated:function(e){var i=this._parent;if(i instanceof tt)return i._isUpdated(e);var a=this._updateVersion===e;return!a&&i&&i._visible&&i._isUpdated(e)&&(this._updateVersion=e,a=!0),a},_drawSelection:function(e,i,a,h,f){var m=this._selection,v=m&1,_=m&2||v&&this._selectBounds,y=m&4;if(this._drawSelected||(v=!1),(v||_||y)&&this._isUpdated(f)){var b,T=this.getSelectedColor(!0)||(b=this.getLayer())&&b.getSelectedColor(!0),z=i.appended(this.getGlobalMatrix(!0)),P=a/2;if(e.strokeStyle=e.fillStyle=T?T.toCanvasStyle(e):"#009dec",v&&this._drawSelected(e,z,h),y){var S=this.getPosition(!0),B=this._parent,O=B?B.localToGlobal(S):S,V=O.x,k=O.y;e.beginPath(),e.arc(V,k,P,0,Math.PI*2,!0),e.stroke();for(var R=[[0,-1],[1,0],[0,1],[-1,0]],w=P,N=a+1,U=0;U<4;U++){var H=R[U],D=H[0],G=H[1];e.moveTo(V+D*w,k+G*w),e.lineTo(V+D*N,k+G*N),e.stroke()}}if(_){var K=z._transformCorners(this.getInternalBounds());e.beginPath();for(var U=0;U<8;U++)e[U?"lineTo":"moveTo"](K[U],K[++U]);e.closePath(),e.stroke();for(var U=0;U<8;U++)e.fillRect(K[U]-P,K[++U]-P,a,a)}}},_canComposite:function(){return!1}},u.each(["down","drag","up","move"],function(e){this["removeOn"+u.capitalize(e)]=function(){var i={};return i[e]=!0,this.removeOn(i)}},{removeOn:function(e){for(var i in e)if(e[i]){var a="mouse"+i,h=this._project,f=h._removeSets=h._removeSets||{};f[a]=f[a]||{},f[a][this._id]=this}return this}}),{tween:function(e,i,a){a||(a=i,i=e,e=null,a||(a=i,i=null));var h=a&&a.easing,f=a&&a.start,m=a!=null&&(typeof a=="number"?a:a.duration),v=new Ni(this,e,i,m,h,f);function _(y){v._handleFrame(y.time*1e3),v.running||this.off("frame",_)}return m&&this.on("frame",_),v},tweenTo:function(e,i){return this.tween(null,e,i)},tweenFrom:function(e,i){return this.tween(e,null,i)}}),de=M.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(i){this._children=[],this._namedChildren={},this._initialize(i)||this.addChildren(Array.isArray(i)?i:arguments)},_changed:function e(i){e.base.call(this,i),i&2050&&(this._clipItem=r)},_getClipItem:function(){var e=this._clipItem;if(e===r){e=null;for(var i=this._children,a=0,h=i.length;a<h;a++)if(i[a]._clipMask){e=i[a];break}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(e){var i=this.getFirstChild();i&&i.setClipMask(e)},_getBounds:function e(i,a){var h=this._getClipItem();return h?h._getCachedBounds(h._matrix.prepended(i),u.set({},a,{stroke:!1})):e.base.call(this,i,a)},_hitTestChildren:function e(i,a,h){var f=this._getClipItem();return(!f||f.contains(i))&&e.base.call(this,i,a,h,f)},_draw:function(e,i){var a=i.clip,h=!a&&this._getClipItem();i=i.extend({clipItem:h,clip:!1}),a?(e.beginPath(),i.dontStart=i.dontFinish=!0):h&&h.draw(e,i.extend({clip:!0}));for(var f=this._children,m=0,v=f.length;m<v;m++){var _=f[m];_!==h&&_.draw(e,i)}}}),_e=de.extend({_class:"Layer",initialize:function(){de.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function e(){return this._parent?e.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),pe=M.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(i,a){this._initialize(i,a)},_equals:function(e){return this._type===e._type&&this._size.equals(e._size)&&u.equals(this._radius,e._radius)},copyContent:function(e){this.setType(e._type),this.setSize(e._size),this.setRadius(e._radius)},getType:function(){return this._type},setType:function(e){this._type=e},getShape:"#getType",setShape:"#setType",getSize:function(){var e=this._size;return new j(e.width,e.height,this,"setSize")},setSize:function(){var e=X.read(arguments);if(!this._size)this._size=e.clone();else if(!this._size.equals(e)){var i=this._type,a=e.width,h=e.height;i==="rectangle"?this._radius.set(X.min(this._radius,e.divide(2).abs())):i==="circle"?(a=h=(a+h)/2,this._radius=a/2):i==="ellipse"&&this._radius._set(a/2,h/2),this._size._set(a,h),this._changed(9)}},getRadius:function(){var e=this._radius;return this._type==="circle"?e:new j(e.width,e.height,this,"setRadius")},setRadius:function(e){var i=this._type;if(i==="circle"){if(e===this._radius)return;var a=e*2;this._radius=e,this._size._set(a,a)}else if(e=X.read(arguments),!this._radius)this._radius=e.clone();else{if(this._radius.equals(e))return;if(this._radius.set(e),i==="rectangle"){var a=X.max(this._size,e.multiply(2));this._size.set(a)}else i==="ellipse"&&this._size._set(e.width*2,e.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(e){var i=new Ve[u.capitalize(this._type)]({center:new E,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),$e.settings.applyMatrix&&i.setApplyMatrix(!0),(e===r||e)&&i.insertAbove(this),i},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(e,i,a,h){var f=this._style,m=f.hasFill(),v=f.hasStroke(),_=i.dontFinish||i.clip,y=!h;if(m||v||_){var b=this._type,T=this._radius,z=b==="circle";if(i.dontStart||e.beginPath(),y&&z)e.arc(0,0,T,0,Math.PI*2,!0);else{var P=z?T:T.width,S=z?T:T.height,B=this._size,O=B.width,V=B.height;if(y&&b==="rectangle"&&P===0&&S===0)e.rect(-O/2,-V/2,O,V);else{var k=O/2,R=V/2,w=1-.5522847498307936,N=P*w,U=S*w,H=[-k,-R+S,-k,-R+U,-k+N,-R,-k+P,-R,k-P,-R,k-N,-R,k,-R+U,k,-R+S,k,R-S,k,R-U,k-N,R,k-P,R,-k+P,R,-k+N,R,-k,R-U,-k,R-S];h&&h.transform(H,H,32),e.moveTo(H[0],H[1]),e.bezierCurveTo(H[2],H[3],H[4],H[5],H[6],H[7]),k!==P&&e.lineTo(H[8],H[9]),e.bezierCurveTo(H[10],H[11],H[12],H[13],H[14],H[15]),R!==S&&e.lineTo(H[16],H[17]),e.bezierCurveTo(H[18],H[19],H[20],H[21],H[22],H[23]),k!==P&&e.lineTo(H[24],H[25]),e.bezierCurveTo(H[26],H[27],H[28],H[29],H[30],H[31])}}e.closePath()}!_&&(m||v)&&(this._setStyles(e,i,a),m&&(e.fill(f.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),v&&e.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(e,i){var a=new $(this._size).setCenter(0,0),h=this._style,f=i.stroke&&h.hasStroke()&&h.getStrokeWidth();return e&&(a=e._transformBounds(a)),f?a.expand(Ve._getStrokePadding(f,this._getStrokeMatrix(e,i))):a}},new function(){function e(a,h,f){var m=a._radius;if(!m.isZero())for(var v=a._size.divide(2),_=1;_<=4;_++){var y=new E(_>1&&_<4?-1:1,_>2?-1:1),b=y.multiply(v),T=b.subtract(y.multiply(m)),z=new $(f?b.add(y.multiply(f)):b,T);if(z.contains(h))return{point:T,quadrant:_}}}function i(a,h,f,m){var v=a.divide(h);return(!m||v.isInQuadrant(m))&&v.subtract(v.normalize()).multiply(h).divide(f).length<=1}return{_contains:function a(h){if(this._type==="rectangle"){var f=e(this,h);return f?h.subtract(f.point).divide(this._radius).getLength()<=1:a.base.call(this,h)}else return h.divide(this.size).getLength()<=.5},_hitTestSelf:function a(h,f,m,v){var _=!1,y=this._style,b=f.stroke&&y.hasStroke(),T=f.fill&&y.hasFill();if(b||T){var z=this._type,P=this._radius,S=b?y.getStrokeWidth()/2:0,B=f._tolerancePadding.add(Ve._getStrokePadding(S,!y.getStrokeScaling()&&v));if(z==="rectangle"){var O=B.multiply(2),V=e(this,h,O);if(V)_=i(h.subtract(V.point),P,B,V.quadrant);else{var k=new $(this._size).setCenter(0,0),R=k.expand(O),w=k.expand(O.negate());_=R._containsPoint(h)&&!w._containsPoint(h)}}else _=i(h,P,B)}return _?new Oe(b?"stroke":"fill",this):a.base.apply(this,arguments)}}},{statics:new function(){function e(i,a,h,f,m){var v=u.create(pe.prototype);return v._type=i,v._size=h,v._radius=f,v._initialize(u.getNamed(m),a),v}return{Circle:function(){var i=arguments,a=E.readNamed(i,"center"),h=u.readNamed(i,"radius");return e("circle",a,new X(h*2),h,i)},Rectangle:function(){var i=arguments,a=$.readNamed(i,"rectangle"),h=X.min(X.readNamed(i,"radius"),a.getSize(!0).divide(2));return e("rectangle",a.getCenter(!0),a.getSize(!0),h,i)},Ellipse:function(){var i=arguments,a=pe._readEllipse(i),h=a.radius;return e("ellipse",a.center,h.multiply(2),h,i)},_readEllipse:function(i){var a,h;if(u.hasNamed(i,"radius"))a=E.readNamed(i,"center"),h=X.readNamed(i,"radius");else{var f=$.readNamed(i,"rectangle");a=f.getCenter(!0),h=f.getSize(!0).divide(2)}return{center:a,radius:h}}}}}),Ce=M.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(i,a){if(!this._initialize(i,a!==r&&E.read(arguments))){var h,f=typeof i,m=f==="string"?c.getElementById(i):f==="object"?i:null;if(m&&m!==M.NO_INSERT){if(m.getContext||m.naturalHeight!=null)h=m;else if(m){var v=X.read(arguments);v.isZero()||(h=dt.getCanvas(v))}}h?this.setImage(h):this.setSource(i)}this._size||(this._size=new X,this._loaded=!1)},_equals:function(e){return this.getSource()===e.getSource()},copyContent:function(e){var i=e._image,a=e._canvas;if(i)this._setImage(i);else if(a){var h=dt.getCanvas(e._size);h.getContext("2d").drawImage(a,0,0),this._setImage(h)}this._crossOrigin=e._crossOrigin},getSize:function(){var e=this._size;return new j(e?e.width:0,e?e.height:0,this,"setSize")},setSize:function(e,i){var a=X.read(arguments);if(a.equals(this._size))i&&this.clear();else if(a.width>0&&a.height>0){var h=!i&&this.getElement();this._setImage(dt.getCanvas(a)),h&&this.getContext(!0).drawImage(h,0,0,a.width,a.height)}else this._canvas&&dt.release(this._canvas),this._size=a.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(e){this.setSize(e,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(e){this.setSize(this.getWidth(),e)},getLoaded:function(){return this._loaded},isEmpty:function(){var e=this._size;return!e||e.width===0&&e.height===0},getResolution:function(){var e=this._matrix,i=new E(0,0).transform(e),a=new E(1,0).transform(e).subtract(i),h=new E(0,1).transform(e).subtract(i);return new X(72/a.getLength(),72/h.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(e){var i=this;function a(h){var f=i.getView(),m=h&&h.type||"load";f&&i.responds(m)&&($e=f._scope,i.emit(m,new oi(h)))}this._setImage(e),this._loaded?setTimeout(a,0):e&&ot.add(e,{load:function(h){i._setImage(e),a(h)},error:a})},_setImage:function(e){this._canvas&&dt.release(this._canvas),e&&e.getContext?(this._image=null,this._canvas=e,this._loaded=!0):(this._image=e,this._canvas=null,this._loaded=!!(e&&e.src&&e.complete)),this._size=new X(e?e.naturalWidth||e.width:0,e?e.naturalHeight||e.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var e=dt.getContext(this._size);try{this._image&&e.drawImage(this._image,0,0),this._canvas=e.canvas}catch{dt.release(e)}}return this._canvas},setCanvas:"#setImage",getContext:function(e){return this._context||(this._context=this.getCanvas().getContext("2d")),e&&(this._image=null,this._changed(1025)),this._context},setContext:function(e){this._context=e},getSource:function(){var e=this._image;return e&&e.src||this.toDataURL()},setSource:function(e){var i=new s.Image,a=this._crossOrigin;a&&(i.crossOrigin=a),e&&(i.src=e),this.setImage(i)},getCrossOrigin:function(){var e=this._image;return e&&e.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(e){this._crossOrigin=e;var i=this._image;i&&(i.crossOrigin=e)},getSmoothing:function(){return this._smoothing},setSmoothing:function(e){this._smoothing=typeof e=="string"?e:e?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var e=$.read(arguments),i=dt.getContext(e.getSize());return i.drawImage(this.getCanvas(),e.x,e.y,e.width,e.height,0,0,e.width,e.height),i.canvas},getSubRaster:function(){var e=$.read(arguments),i=new Ce(M.NO_INSERT);return i._setImage(this.getSubCanvas(e)),i.translate(e.getCenter().subtract(this.getSize().divide(2))),i._matrix.prepend(this._matrix),i.insertAbove(this),i},toDataURL:function(){var e=this._image,i=e&&e.src;if(/^data:/.test(i))return i;var a=this.getCanvas();return a?a.toDataURL.apply(a,arguments):null},drawImage:function(e){var i=E.read(arguments,1);this.getContext(!0).drawImage(e,i.x,i.y)},getAverageColor:function(e){var i,a;if(e?e instanceof rt?(a=e,i=e.getBounds()):typeof e=="object"&&("width"in e?i=new $(e):"x"in e&&(i=new $(e.x-.5,e.y-.5,1,1))):i=this.getBounds(),!i)return null;var h=32,f=Math.min(i.width,h),m=Math.min(i.height,h),v=Ce._sampleContext;v?v.clearRect(0,0,h+1,h+1):v=Ce._sampleContext=dt.getContext(new X(h)),v.save();var _=new re().scale(f/i.width,m/i.height).translate(-i.x,-i.y);_.applyToContext(v),a&&a.draw(v,new u({clip:!0,matrices:[_]})),this._matrix.applyToContext(v);var y=this.getElement(),b=this._size;y&&v.drawImage(y,-b.width/2,-b.height/2),v.restore();for(var T=v.getImageData(.5,.5,Math.ceil(f),Math.ceil(m)).data,z=[0,0,0],P=0,S=0,B=T.length;S<B;S+=4){var O=T[S+3];P+=O,O/=255,z[0]+=T[S]*O,z[1]+=T[S+1]*O,z[2]+=T[S+2]*O}for(var S=0;S<3;S++)z[S]/=P;return P?ft.read(z):null},getPixel:function(){var e=E.read(arguments),i=this.getContext().getImageData(e.x,e.y,1,1).data;return new ft("rgb",[i[0]/255,i[1]/255,i[2]/255],i[3]/255)},setPixel:function(){var e=arguments,i=E.read(e),a=ft.read(e),h=a._convert("rgb"),f=a._alpha,m=this.getContext(!0),v=m.createImageData(1,1),_=v.data;_[0]=h[0]*255,_[1]=h[1]*255,_[2]=h[2]*255,_[3]=f!=null?f*255:255,m.putImageData(v,i.x,i.y)},clear:function(){var e=this._size;this.getContext(!0).clearRect(0,0,e.width+1,e.height+1)},createImageData:function(){var e=X.read(arguments);return this.getContext().createImageData(e.width,e.height)},getImageData:function(){var e=$.read(arguments);return e.isEmpty()&&(e=new $(this._size)),this.getContext().getImageData(e.x,e.y,e.width,e.height)},putImageData:function(e){var i=E.read(arguments,1);this.getContext(!0).putImageData(e,i.x,i.y)},setImageData:function(e){this.setSize(e),this.getContext(!0).putImageData(e,0,0)},_getBounds:function(e,i){var a=new $(this._size).setCenter(0,0);return e?e._transformBounds(a):a},_hitTestSelf:function(e){if(this._contains(e)){var i=this;return new Oe("pixel",i,{offset:e.add(i._size.divide(2)).round(),color:{get:function(){return i.getPixel(this.offset)}}})}},_draw:function(e,i,a){var h=this.getElement();if(h&&h.width>0&&h.height>0){e.globalAlpha=A.clamp(this._opacity,0,1),this._setStyles(e,i,a);var f=this._smoothing,m=f==="off";st.setPrefixed(e,m?"imageSmoothingEnabled":"imageSmoothingQuality",m?!1:f),e.drawImage(h,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),ke=M.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(i,a){this._initialize(i,a!==r&&E.read(arguments,1))||this.setDefinition(i instanceof Se?i:new Se(i))},_equals:function(e){return this._definition===e._definition},copyContent:function(e){this.setDefinition(e._definition)},getDefinition:function(){return this._definition},setDefinition:function(e){this._definition=e,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(e,i){var a=this._definition._item;return a._getCachedBounds(a._matrix.prepended(e),i)},_hitTestSelf:function(e,i,a){var h=i.extend({all:!1}),f=this._definition._item._hitTest(e,h,a);return f&&(f.item=this),f},_draw:function(e,i){this._definition._item.draw(e,i)}}),Se=u.extend({_class:"SymbolDefinition",initialize:function(i,a){this._id=q.get(),this.project=$e.project,i&&this.setItem(i,a)},_serialize:function(e,i){return i.add(this,function(){return u.serialize([this._class,this._item],e,!1,i)})},_changed:function(e){e&8&&M._clearBoundsCache(this),e&1&&this.project._changed(e)},getItem:function(){return this._item},setItem:function(e,i){e._symbol&&(e=e.clone()),this._item&&(this._item._symbol=null),this._item=e,e.remove(),e.setSelected(!1),i||e.setPosition(new E),e._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(e){return new ke(this,e)},clone:function(){return new Se(this._item.clone(!1))},equals:function(e){return e===this||e&&this._item.equals(e._item)||!1}}),Oe=u.extend({_class:"HitResult",initialize:function(i,a,h){this.type=i,this.item=a,h&&this.inject(h)},statics:{getOptions:function(e){var i=e&&u.read(e);return new u({type:null,tolerance:$e.settings.hitTolerance,fill:!i,stroke:!i,segments:!i,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},i)}}}),Pe=u.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(i,a,h,f,m,v){var _=arguments.length,y,b,T,z;_>0&&(i==null||typeof i=="object"?_===1&&i&&"point"in i?(y=i.point,b=i.handleIn,T=i.handleOut,z=i.selection):(y=i,b=a,T=h,z=f):(y=[i,a],b=h!==r?[h,f]:null,T=m!==r?[m,v]:null)),new Je(y,this,"_point"),new Je(b,this,"_handleIn"),new Je(T,this,"_handleOut"),z&&this.setSelection(z)},_serialize:function(e,i){var a=this._point,h=this._selection,f=h||this.hasHandles()?[a,this._handleIn,this._handleOut]:a;return h&&f.push(h),u.serialize(f,e,!0,i)},_changed:function(e){var i=this._path;if(i){var a=i._curves,h=this._index,f;a&&((!e||e===this._point||e===this._handleIn)&&(f=h>0?a[h-1]:i._closed?a[a.length-1]:null)&&f._changed(),(!e||e===this._point||e===this._handleOut)&&(f=a[h])&&f._changed()),i._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(E.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(E.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(E.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var e=this._handleIn,i=this._handleOut;return!e.isZero()&&!i.isZero()&&e.isCollinear(i)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(e){var i=this._selection,a=this._path;this._selection=e=e||0,a&&e!==i&&(a._updateSelection(this,i,e),a._changed(257))},_changeSelection:function(e,i){var a=this._selection;this.setSelection(i?a|e:a&~e)},isSelected:function(){return!!(this._selection&7)},setSelected:function(e){this._changeSelection(7,e)},getIndex:function(){return this._index!==r?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var e=this._path,i=this._index;return e?(i>0&&!e._closed&&i===e._segments.length-1&&i--,e.getCurves()[i]||null):null},getLocation:function(){var e=this.getCurve();return e?new Ke(e,this===e._segment1?0:1):null},getNext:function(){var e=this._path&&this._path._segments;return e&&(e[this._index+1]||this._path._closed&&e[0])||null},smooth:function(e,i,a){var h=e||{},f=h.type,m=h.factor,v=this.getPrevious(),_=this.getNext(),y=(v||this)._point,b=this._point,T=(_||this)._point,z=y.getDistance(b),P=b.getDistance(T);if(!f||f==="catmull-rom"){var S=m===r?.5:m,B=Math.pow(z,S),O=B*B,V=Math.pow(P,S),k=V*V;if(!i&&v){var R=2*k+3*V*B+O,w=3*V*(V+B);this.setHandleIn(w!==0?new E((k*y._x+R*b._x-O*T._x)/w-b._x,(k*y._y+R*b._y-O*T._y)/w-b._y):new E)}if(!a&&_){var R=2*O+3*B*V+k,w=3*B*(B+V);this.setHandleOut(w!==0?new E((O*T._x+R*b._x-k*y._x)/w-b._x,(O*T._y+R*b._y-k*y._y)/w-b._y):new E)}}else if(f==="geometric"){if(v&&_){var N=y.subtract(T),U=m===r?.4:m,H=U*z/(z+P);i||this.setHandleIn(N.multiply(H)),a||this.setHandleOut(N.multiply(H-U))}}else throw new Error("Smoothing method '"+f+"' not supported.")},getPrevious:function(){var e=this._path&&this._path._segments;return e&&(e[this._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var e=this._path;return e&&this._index===e._segments.length-1||!1},reverse:function(){var e=this._handleIn,i=this._handleOut,a=e.clone();e.set(i),i.set(a)},reversed:function(){return new Pe(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Pe(this._point,this._handleIn,this._handleOut)},equals:function(e){return e===this||e&&this._class===e._class&&this._point.equals(e._point)&&this._handleIn.equals(e._handleIn)&&this._handleOut.equals(e._handleOut)||!1},toString:function(){var e=["point: "+this._point];return this._handleIn.isZero()||e.push("handleIn: "+this._handleIn),this._handleOut.isZero()||e.push("handleOut: "+this._handleOut),"{ "+e.join(", ")+" }"},transform:function(e){this._transformCoordinates(e,new Array(6),!0),this._changed()},interpolate:function(e,i,a){var h=1-a,f=a,m=e._point,v=i._point,_=e._handleIn,y=i._handleIn,b=i._handleOut,T=e._handleOut;this._point._set(h*m._x+f*v._x,h*m._y+f*v._y,!0),this._handleIn._set(h*_._x+f*y._x,h*_._y+f*y._y,!0),this._handleOut._set(h*T._x+f*b._x,h*T._y+f*b._y,!0),this._changed()},_transformCoordinates:function(e,i,a){var h=this._point,f=!a||!this._handleIn.isZero()?this._handleIn:null,m=!a||!this._handleOut.isZero()?this._handleOut:null,v=h._x,_=h._y,y=2;return i[0]=v,i[1]=_,f&&(i[y++]=f._x+v,i[y++]=f._y+_),m&&(i[y++]=m._x+v,i[y++]=m._y+_),e&&(e._transformCoordinates(i,i,y/2),v=i[0],_=i[1],a?(h._x=v,h._y=_,y=2,f&&(f._x=i[y++]-v,f._y=i[y++]-_),m&&(m._x=i[y++]-v,m._y=i[y++]-_)):(f||(i[y++]=v,i[y++]=_),m||(i[y++]=v,i[y++]=_))),i}}),Je=E.extend({initialize:function(i,a,h){var f,m,v;if(!i)f=m=0;else if((f=i[0])!==r)m=i[1];else{var _=i;(f=_.x)===r&&(_=E.read(arguments),f=_.x),m=_.y,v=_.selected}this._x=f,this._y=m,this._owner=a,a[h]=this,v&&this.setSelected(!0)},_set:function(e,i){return this._x=e,this._y=i,this._owner._changed(this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner._changed(this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner._changed(this)},isZero:function(){var e=A.isZero;return e(this._x)&&e(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){var e=this._owner;return this===e._point?1:this===e._handleIn?2:this===e._handleOut?4:0}}),me=u.extend({_class:"Curve",beans:!0,initialize:function(i,a,h,f,m,v,_,y){var b=arguments.length,T,z,P,S,B,O;b===3?(this._path=i,T=a,z=h):b?b===1?"segment1"in i?(T=new Pe(i.segment1),z=new Pe(i.segment2)):"point1"in i?(P=i.point1,B=i.handle1,O=i.handle2,S=i.point2):Array.isArray(i)&&(P=[i[0],i[1]],S=[i[6],i[7]],B=[i[2]-i[0],i[3]-i[1]],O=[i[4]-i[6],i[5]-i[7]]):b===2?(T=new Pe(i),z=new Pe(a)):b===4?(P=i,B=a,O=h,S=f):b===8&&(P=[i,a],S=[_,y],B=[h-i,f-a],O=[m-_,v-y]):(T=new Pe,z=new Pe),this._segment1=T||new Pe(P,null,B),this._segment2=z||new Pe(S,O,null)},_serialize:function(e,i){return u.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],e,!0,i)},_changed:function(){this._length=this._bounds=r},clone:function(){return new me(this._segment1,this._segment2)},toString:function(){var e=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||e.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||e.push("handle2: "+this._segment2._handleIn),e.push("point2: "+this._segment2._point),"{ "+e.join(", ")+" }"},classify:function(){return me.classify(this.getValues())},remove:function(){var e=!1;if(this._path){var i=this._segment2,a=i._handleOut;e=i.remove(),e&&this._segment1._handleOut.set(a)}return e},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(E.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(E.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(E.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(E.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var e=this._path;return e&&this._segment1._index===e._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(e){this.getPoint1().setSelected(e),this.getHandle1().setSelected(e),this.getHandle2().setSelected(e),this.getPoint2().setSelected(e)},getValues:function(e){return me.getValues(this._segment1,this._segment2,e)},getPoints:function(){for(var e=this.getValues(),i=[],a=0;a<8;a+=2)i.push(new E(e[a],e[a+1]));return i}},{getLength:function(){return this._length==null&&(this._length=me.getLength(this.getValues(),0,1)),this._length},getArea:function(){return me.getArea(this.getValues())},getLine:function(){return new ye(this._segment1._point,this._segment2._point)},getPart:function(e,i){return new me(me.getPart(this.getValues(),e,i))},getPartLength:function(e,i){return me.getLength(this.getValues(),e,i)},divideAt:function(e){return this.divideAtTime(e&&e.curve===this?e.time:this.getTimeAt(e))},divideAtTime:function(e,i){var a=1e-8,h=1-a,f=null;if(e>=a&&e<=h){var m=me.subdivide(this.getValues(),e),v=m[0],_=m[1],y=i||this.hasHandles(),b=this._segment1,T=this._segment2,z=this._path;y&&(b._handleOut._set(v[2]-v[0],v[3]-v[1]),T._handleIn._set(_[4]-_[6],_[5]-_[7]));var P=v[6],S=v[7],B=new Pe(new E(P,S),y&&new E(v[4]-P,v[5]-S),y&&new E(_[2]-P,_[3]-S));z?(z.insert(b._index+1,B),f=this.getNext()):(this._segment2=B,this._changed(),f=new me(B,T))}return f},splitAt:function(e){var i=this._path;return i?i.splitAt(e):null},splitAtTime:function(e){return this.splitAt(this.getLocationAtTime(e))},divide:function(e,i){return this.divideAtTime(e===r?.5:i?e:this.getTimeAt(e))},split:function(e,i){return this.splitAtTime(e===r?.5:i?e:this.getTimeAt(e))},reversed:function(){return new me(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(e,i,a,h){var f=e._point,m=e._handleOut,v=i._handleIn,_=i._point,y=f.x,b=f.y,T=_.x,z=_.y,P=h?[y,b,y,b,T,z,T,z]:[y,b,y+m._x,b+m._y,T+v._x,z+v._y,T,z];return a&&a._transformCoordinates(P,P,4),P},subdivide:function(e,i){var a=e[0],h=e[1],f=e[2],m=e[3],v=e[4],_=e[5],y=e[6],b=e[7];i===r&&(i=.5);var T=1-i,z=T*a+i*f,P=T*h+i*m,S=T*f+i*v,B=T*m+i*_,O=T*v+i*y,V=T*_+i*b,k=T*z+i*S,R=T*P+i*B,w=T*S+i*O,N=T*B+i*V,U=T*k+i*w,H=T*R+i*N;return[[a,h,z,P,k,R,U,H],[U,H,w,N,O,V,y,b]]},getMonoCurves:function(e,i){var a=[],h=i?0:1,f=e[h+0],m=e[h+2],v=e[h+4],_=e[h+6];if(f>=m==m>=v&&m>=v==v>=_||me.isStraight(e))a.push(e);else{var y=3*(m-v)-f+_,b=2*(f+v)-4*m,T=m-f,z=1e-8,P=1-z,S=[],B=A.solveQuadratic(y,b,T,S,z,P);if(!B)a.push(e);else{S.sort();var O=S[0],V=me.subdivide(e,O);a.push(V[0]),B>1&&(O=(S[1]-O)/(1-O),V=me.subdivide(V[1],O),a.push(V[0])),a.push(V[1])}}return a},solveCubic:function(e,i,a,h,f,m){var v=e[i],_=e[i+2],y=e[i+4],b=e[i+6],T=0;if(!(v<a&&b<a&&_<a&&y<a||v>a&&b>a&&_>a&&y>a)){var z=3*(_-v),P=3*(y-_)-z,S=b-v-z-P;T=A.solveCubic(S,P,z,v-a,h,f,m)}return T},getTimeOf:function(e,i){var a=new E(e[0],e[1]),h=new E(e[6],e[7]),f=1e-12,m=1e-7,v=i.isClose(a,f)?0:i.isClose(h,f)?1:null;if(v===null)for(var _=[i.x,i.y],y=[],b=0;b<2;b++)for(var T=me.solveCubic(e,b,_[b],y,0,1),z=0;z<T;z++){var P=y[z];if(i.isClose(me.getPoint(e,P),m))return P}return i.isClose(a,m)?0:i.isClose(h,m)?1:null},getNearestTime:function(e,i){if(me.isStraight(e)){var a=e[0],h=e[1],f=e[6],m=e[7],v=f-a,_=m-h,y=v*v+_*_;if(y===0)return 0;var b=((i.x-a)*v+(i.y-h)*_)/y;return b<1e-12?0:b>.999999999999?1:me.getTimeOf(e,new E(a+b*v,h+b*_))}var T=100,z=1/0,P=0;function S(V){if(V>=0&&V<=1){var k=i.getDistance(me.getPoint(e,V),!0);if(k<z)return z=k,P=V,!0}}for(var B=0;B<=T;B++)S(B/T);for(var O=1/(T*2);O>1e-8;)!S(P-O)&&!S(P+O)&&(O/=2);return P},getPart:function(e,i,a){var h=i>a;if(h){var f=i;i=a,a=f}return i>0&&(e=me.subdivide(e,i)[1]),a<1&&(e=me.subdivide(e,(a-i)/(1-i))[0]),h?[e[6],e[7],e[4],e[5],e[2],e[3],e[0],e[1]]:e},isFlatEnough:function(e,i){var a=e[0],h=e[1],f=e[2],m=e[3],v=e[4],_=e[5],y=e[6],b=e[7],T=3*f-2*a-y,z=3*m-2*h-b,P=3*v-2*y-a,S=3*_-2*b-h;return Math.max(T*T,P*P)+Math.max(z*z,S*S)<=16*i*i},getArea:function(e){var i=e[0],a=e[1],h=e[2],f=e[3],m=e[4],v=e[5],_=e[6],y=e[7];return 3*((y-a)*(h+m)-(_-i)*(f+v)+f*(i-m)-h*(a-v)+y*(m+i/3)-_*(v+a/3))/20},getBounds:function(e){for(var i=e.slice(0,2),a=i.slice(),h=[0,0],f=0;f<2;f++)me._addBounds(e[f],e[f+2],e[f+4],e[f+6],f,0,i,a,h);return new $(i[0],i[1],a[0]-i[0],a[1]-i[1])},_addBounds:function(e,i,a,h,f,m,v,_,y){function b(U,H){var D=U-H,G=U+H;D<v[f]&&(v[f]=D),G>_[f]&&(_[f]=G)}m/=2;var T=v[f]+m,z=_[f]-m;if(e<T||i<T||a<T||h<T||e>z||i>z||a>z||h>z)if(i<e!=i<h&&a<e!=a<h)b(e,0),b(h,0);else{var P=3*(i-a)-e+h,S=2*(e+a)-4*i,B=i-e,O=A.solveQuadratic(P,S,B,y),V=1e-8,k=1-V;b(h,0);for(var R=0;R<O;R++){var w=y[R],N=1-w;V<=w&&w<=k&&b(N*N*N*e+3*N*N*w*i+3*N*w*w*a+w*w*w*h,m)}}}}},u.each(["getBounds","getStrokeBounds","getHandleBounds"],function(e){this[e]=function(){this._bounds||(this._bounds={});var i=this._bounds[e];return i||(i=this._bounds[e]=Ve[e]([this._segment1,this._segment2],!1,this._path)),i.clone()}},{}),u.each({isStraight:function(e,i,a,h){if(i.isZero()&&a.isZero())return!0;var f=h.subtract(e);if(f.isZero())return!1;if(f.isCollinear(i)&&f.isCollinear(a)){var m=new ye(e,h),v=1e-7;if(m.getDistance(e.add(i))<v&&m.getDistance(h.add(a))<v){var _=f.dot(f),y=f.dot(i)/_,b=f.dot(a)/_;return y>=0&&y<=1&&b<=0&&b>=-1}}return!1},isLinear:function(e,i,a,h){var f=h.subtract(e).divide(3);return i.equals(f)&&a.negate().equals(f)}},function(e,i){this[i]=function(a){var h=this._segment1,f=this._segment2;return e(h._point,h._handleOut,f._handleIn,f._point,a)},this.statics[i]=function(a,h){var f=a[0],m=a[1],v=a[6],_=a[7];return e(new E(f,m),new E(a[2]-f,a[3]-m),new E(a[4]-v,a[5]-_),new E(v,_),h)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(e){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(e||0)},isCollinear:function(e){return e&&this.isStraight()&&e.isStraight()&&this.getLine().isCollinear(e.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(e,i){return this.getLocationAtTime(i?e:this.getTimeAt(e))},getLocationAtTime:function(e){return e!=null&&e>=0&&e<=1?new Ke(this,e):null},getTimeAt:function(e,i){return me.getTimeAt(this.getValues(),e,i)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var e=E.read(arguments);return e.isZero()?[]:me.getTimesWithTangent(this.getValues(),e)},getOffsetAtTime:function(e){return this.getPartLength(0,e)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(E.read(arguments)))},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getTimeOf:function(){return me.getTimeOf(this.getValues(),E.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var e=E.read(arguments),i=this.getValues(),a=me.getNearestTime(i,e),h=me.getPoint(i,a);return new Ke(this,a,h,null,e.getDistance(h))},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e&&e.getPoint()}},new function(){var e=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return u.each(e,function(i){this[i+"At"]=function(a,h){var f=this.getValues();return me[i](f,h?a:me.getTimeAt(f,a))},this[i+"AtTime"]=function(a){return me[i](this.getValues(),a)}},{statics:{_evaluateMethods:e}})},new function(){function e(h){var f=h[0],m=h[1],v=h[2],_=h[3],y=h[4],b=h[5],T=h[6],z=h[7],P=9*(v-y)+3*(T-f),S=6*(f+y)-12*v,B=3*(v-f),O=9*(_-b)+3*(z-m),V=6*(m+b)-12*_,k=3*(_-m);return function(R){var w=(P*R+S)*R+B,N=(O*R+V)*R+k;return Math.sqrt(w*w+N*N)}}function i(h,f){return Math.max(2,Math.min(16,Math.ceil(Math.abs(f-h)*32)))}function a(h,f,m,v){if(f==null||f<0||f>1)return null;var _=h[0],y=h[1],b=h[2],T=h[3],z=h[4],P=h[5],S=h[6],B=h[7],O=A.isZero;O(b-_)&&O(T-y)&&(b=_,T=y),O(z-S)&&O(P-B)&&(z=S,P=B);var V=3*(b-_),k=3*(z-b)-V,R=S-_-V-k,w=3*(T-y),N=3*(P-T)-w,U=B-y-w-N,H,D;if(m===0)H=f===0?_:f===1?S:((R*f+k)*f+V)*f+_,D=f===0?y:f===1?B:((U*f+N)*f+w)*f+y;else{var G=1e-8,K=1-G;if(f<G?(H=V,D=w):f>K?(H=3*(S-z),D=3*(B-P)):(H=(3*R*f+2*k)*f+V,D=(3*U*f+2*N)*f+w),v){H===0&&D===0&&(f<G||f>K)&&(H=z-b,D=P-T);var Y=Math.sqrt(H*H+D*D);Y&&(H/=Y,D/=Y)}if(m===3){var z=6*R*f+2*k,P=6*U*f+2*N,ie=Math.pow(H*H+D*D,3/2);H=ie!==0?(H*P-D*z)/ie:0,D=0}}return m===2?new E(D,-H):new E(H,D)}return{statics:{classify:function(h){var f=h[0],m=h[1],v=h[2],_=h[3],y=h[4],b=h[5],T=h[6],z=h[7],P=f*(z-b)+m*(y-T)+T*b-z*y,S=v*(m-z)+_*(T-f)+f*z-m*T,B=y*(_-m)+b*(f-v)+v*m-_*f,O=3*B,V=O-S,k=V-S+P,R=Math.sqrt(k*k+V*V+O*O),w=R!==0?1/R:0,N=A.isZero,U="serpentine";k*=w,V*=w,O*=w;function H(Y,ie,W){var te=ie!==r,ne=te&&ie>0&&ie<1,ae=te&&W>0&&W<1;return te&&(!(ne||ae)||Y==="loop"&&!(ne&&ae))&&(Y="arch",ne=ae=!1),{type:Y,roots:ne||ae?ne&&ae?ie<W?[ie,W]:[W,ie]:[ne?ie:W]:null}}if(N(k))return N(V)?H(N(O)?"line":"quadratic"):H(U,O/(3*V));var D=3*V*V-4*k*O;if(N(D))return H("cusp",V/(2*k));var G=D>0?Math.sqrt(D/3):Math.sqrt(-D),K=2*k;return H(D>0?U:"loop",(V+G)/K,(V-G)/K)},getLength:function(h,f,m,v){if(f===r&&(f=0),m===r&&(m=1),me.isStraight(h)){var _=h;m<1&&(_=me.subdivide(_,m)[0],f/=m),f>0&&(_=me.subdivide(_,f)[1]);var y=_[6]-_[0],b=_[7]-_[1];return Math.sqrt(y*y+b*b)}return A.integrate(v||e(h),f,m,i(f,m))},getTimeAt:function(h,f,m){if(m===r&&(m=f<0?1:0),f===0)return m;var v=Math.abs,_=1e-12,y=f>0,b=y?m:0,T=y?1:m,z=e(h),P=me.getLength(h,b,T,z),S=v(f)-P;if(v(S)<_)return y?T:b;if(S>_)return null;var B=f/P,O=0;function V(k){return O+=A.integrate(z,m,k,i(m,k)),m=k,O-f}return A.findRoot(V,z,m+B,b,T,32,1e-12)},getPoint:function(h,f){return a(h,f,0,!1)},getTangent:function(h,f){return a(h,f,1,!0)},getWeightedTangent:function(h,f){return a(h,f,1,!1)},getNormal:function(h,f){return a(h,f,2,!0)},getWeightedNormal:function(h,f){return a(h,f,2,!1)},getCurvature:function(h,f){return a(h,f,3,!1).x},getPeaks:function(h){var f=h[0],m=h[1],v=h[2],_=h[3],y=h[4],b=h[5],T=h[6],z=h[7],P=-f+3*v-3*y+T,S=3*f-6*v+3*y,B=-3*f+3*v,O=-m+3*_-3*b+z,V=3*m-6*_+3*b,k=-3*m+3*_,R=1e-8,w=1-R,N=[];return A.solveCubic(9*(P*P+O*O),9*(P*S+V*O),2*(S*S+V*V)+3*(B*P+k*O),B*S+V*k,N,R,w),N.sort()}}}},new function(){function e(S,B,O,V,k,R,w){var N=!w&&O.getPrevious()===k,U=!w&&O!==k&&O.getNext()===k,H=1e-8,D=1-H;if(V!==null&&V>=(N?H:0)&&V<=(U?D:1)&&R!==null&&R>=(U?H:0)&&R<=(N?D:1)){var G=new Ke(O,V,null,w),K=new Ke(k,R,null,w);G._intersection=K,K._intersection=G,(!B||B(G))&&Ke.insert(S,G,!0)}}function i(S,B,O,V,k,R,w,N,U,H,D,G,K){if(++U>=4096||++N>=40)return U;var Y=1e-9,ie=B[0],W=B[1],te=B[6],ne=B[7],ae=ye.getSignedDistance,oe=ae(ie,W,te,ne,B[2],B[3]),ce=ae(ie,W,te,ne,B[4],B[5]),we=oe*ce>0?3/4:4/9,Ee=we*Math.min(0,oe,ce),Me=we*Math.max(0,oe,ce),Ne=ae(ie,W,te,ne,S[0],S[1]),ve=ae(ie,W,te,ne,S[2],S[3]),xe=ae(ie,W,te,ne,S[4],S[5]),ze=ae(ie,W,te,ne,S[6],S[7]),De=a(Ne,ve,xe,ze),Re=De[0],Be=De[1],Fe,Ge;if(oe===0&&ce===0&&Ne===0&&ve===0&&xe===0&&ze===0||(Fe=h(Re,Be,Ee,Me))==null||(Ge=h(Re.reverse(),Be.reverse(),Ee,Me))==null)return U;var Xe=H+(D-H)*Fe,Ue=H+(D-H)*Ge;if(Math.max(K-G,Ue-Xe)<Y){var vt=(Xe+Ue)/2,pt=(G+K)/2;e(k,R,w?V:O,w?pt:vt,w?O:V,w?vt:pt)}else{S=me.getPart(S,Fe,Ge);var xt=K-G;if(Ge-Fe>.8)if(Ue-Xe>xt){var gt=me.subdivide(S,.5),vt=(Xe+Ue)/2;U=i(B,gt[0],V,O,k,R,!w,N,U,G,K,Xe,vt),U=i(B,gt[1],V,O,k,R,!w,N,U,G,K,vt,Ue)}else{var gt=me.subdivide(B,.5),pt=(G+K)/2;U=i(gt[0],S,V,O,k,R,!w,N,U,G,pt,Xe,Ue),U=i(gt[1],S,V,O,k,R,!w,N,U,pt,K,Xe,Ue)}else xt===0||xt>=Y?U=i(B,S,V,O,k,R,!w,N,U,G,K,Xe,Ue):U=i(S,B,O,V,k,R,w,N,U,Xe,Ue,G,K)}return U}function a(S,B,O,V){var k=[0,S],R=[1/3,B],w=[2/3,O],N=[1,V],U=B-(2*S+V)/3,H=O-(S+2*V)/3,D;if(U*H<0)D=[[k,R,N],[k,w,N]];else{var G=U/H;D=[G>=2?[k,R,N]:G<=.5?[k,w,N]:[k,R,w,N],[k,N]]}return(U||H)<0?D.reverse():D}function h(S,B,O,V){return S[0][1]<O?f(S,!0,O):B[0][1]>V?f(B,!1,V):S[0][0]}function f(S,B,O){for(var V=S[0][0],k=S[0][1],R=1,w=S.length;R<w;R++){var N=S[R][0],U=S[R][1];if(B?U>=O:U<=O)return U===O?N:V+(O-k)*(N-V)/(U-k);V=N,k=U}return null}function m(S,B,O,V,k){var R=A.isZero;if(R(V)&&R(k)){var w=me.getTimeOf(S,new E(B,O));return w===null?[]:[w]}for(var N=Math.atan2(-k,V),U=Math.sin(N),H=Math.cos(N),D=[],G=[],K=0;K<8;K+=2){var Y=S[K]-B,ie=S[K+1]-O;D.push(Y*H-ie*U,Y*U+ie*H)}return me.solveCubic(D,1,0,G,0,1),G}function v(S,B,O,V,k,R,w){for(var N=B[0],U=B[1],H=B[6],D=B[7],G=m(S,N,U,H-N,D-U),K=0,Y=G.length;K<Y;K++){var ie=G[K],W=me.getPoint(S,ie),te=me.getTimeOf(B,W);te!==null&&e(k,R,w?V:O,w?te:ie,w?O:V,w?ie:te)}}function _(S,B,O,V,k,R){var w=ye.intersect(S[0],S[1],S[6],S[7],B[0],B[1],B[6],B[7]);w&&e(k,R,O,me.getTimeOf(S,w),V,me.getTimeOf(B,w))}function y(S,B,O,V,k,R){var w=1e-12,N=Math.min,U=Math.max;if(U(S[0],S[2],S[4],S[6])+w>N(B[0],B[2],B[4],B[6])&&N(S[0],S[2],S[4],S[6])-w<U(B[0],B[2],B[4],B[6])&&U(S[1],S[3],S[5],S[7])+w>N(B[1],B[3],B[5],B[7])&&N(S[1],S[3],S[5],S[7])-w<U(B[1],B[3],B[5],B[7])){var H=z(S,B);if(H)for(var D=0;D<2;D++){var G=H[D];e(k,R,O,G[0],V,G[1],!0)}else{var K=me.isStraight(S),Y=me.isStraight(B),ie=K&&Y,W=K&&!Y,te=k.length;if((ie?_:K||Y?v:i)(W?B:S,W?S:B,W?V:O,W?O:V,k,R,W,0,0,0,1,0,1),!ie||k.length===te)for(var D=0;D<4;D++){var ne=D>>1,ae=D&1,oe=ne*6,ce=ae*6,we=new E(S[oe],S[oe+1]),Ee=new E(B[ce],B[ce+1]);we.isClose(Ee,w)&&e(k,R,O,ne,V,ae)}}}return k}function b(S,B,O,V){var k=me.classify(S);if(k.type==="loop"){var R=k.roots;e(O,V,B,R[0],B,R[1])}return O}function T(S,B,O,V,k,R){var w=1e-7,N=!B;N&&(B=S);for(var U=S.length,H=B.length,D=new Array(U),G=N?D:new Array(H),K=[],Y=0;Y<U;Y++)D[Y]=S[Y].getValues(V);if(!N)for(var Y=0;Y<H;Y++)G[Y]=B[Y].getValues(k);for(var ie=C.findCurveBoundsCollisions(D,G,w),W=0;W<U;W++){var te=S[W],ne=D[W];N&&b(ne,te,K,O);var ae=ie[W];if(ae)for(var oe=0;oe<ae.length;oe++){if(R&&K.length)return K;var ce=ae[oe];if(!N||ce>W){var we=B[ce],Ee=G[ce];y(ne,Ee,te,we,K,O)}}}return K}function z(S,B){function O(ze){var De=ze[6]-ze[0],Re=ze[7]-ze[1];return De*De+Re*Re}var V=Math.abs,k=ye.getDistance,R=1e-8,w=1e-7,N=me.isStraight(S),U=me.isStraight(B),H=N&&U,D=O(S)<O(B),G=D?B:S,K=D?S:B,Y=G[0],ie=G[1],W=G[6]-Y,te=G[7]-ie;if(k(Y,ie,W,te,K[0],K[1],!0)<w&&k(Y,ie,W,te,K[6],K[7],!0)<w)!H&&k(Y,ie,W,te,G[2],G[3],!0)<w&&k(Y,ie,W,te,G[4],G[5],!0)<w&&k(Y,ie,W,te,K[2],K[3],!0)<w&&k(Y,ie,W,te,K[4],K[5],!0)<w&&(N=U=H=!0);else if(H)return null;if(N^U)return null;for(var ne=[S,B],ae=[],oe=0;oe<4&&ae.length<2;oe++){var ce=oe&1,we=ce^1,Ee=oe>>1,Me=me.getTimeOf(ne[ce],new E(ne[we][Ee?6:0],ne[we][Ee?7:1]));if(Me!=null){var Ne=ce?[Ee,Me]:[Me,Ee];(!ae.length||V(Ne[0]-ae[0][0])>R&&V(Ne[1]-ae[0][1])>R)&&ae.push(Ne)}if(oe>2&&!ae.length)break}if(ae.length!==2)ae=null;else if(!H){var ve=me.getPart(S,ae[0][0],ae[1][0]),xe=me.getPart(B,ae[0][1],ae[1][1]);(V(xe[2]-ve[2])>w||V(xe[3]-ve[3])>w||V(xe[4]-ve[4])>w||V(xe[5]-ve[5])>w)&&(ae=null)}return ae}function P(S,B){var O=S[0],V=S[1],k=S[2],R=S[3],w=S[4],N=S[5],U=S[6],H=S[7],D=B.normalize(),G=D.x,K=D.y,Y=3*U-9*w+9*k-3*O,ie=3*H-9*N+9*R-3*V,W=6*w-12*k+6*O,te=6*N-12*R+6*V,ne=3*k-3*O,ae=3*R-3*V,oe=2*Y*K-2*ie*G,ce=[];if(Math.abs(oe)<A.CURVETIME_EPSILON){var we=Y*ae-ie*ne,oe=Y*te-ie*W;if(oe!=0){var Ee=-we/oe;Ee>=0&&Ee<=1&&ce.push(Ee)}}else{var Me=(W*W-4*Y*ne)*K*K+(-2*W*te+4*ie*ne+4*Y*ae)*G*K+(te*te-4*ie*ae)*G*G,Ne=W*K-te*G;if(Me>=0&&oe!=0){var ve=Math.sqrt(Me),xe=-(Ne+ve)/oe,ze=(-Ne+ve)/oe;xe>=0&&xe<=1&&ce.push(xe),ze>=0&&ze<=1&&ce.push(ze)}}return ce}return{getIntersections:function(S){var B=this.getValues(),O=S&&S!==this&&S.getValues();return O?y(B,O,this,S,[]):b(B,this,[])},statics:{getOverlaps:z,getIntersections:T,getCurveLineIntersections:m,getTimesWithTangent:P}}}),Ke=u.extend({_class:"CurveLocation",initialize:function(i,a,h,f,m){if(a>=.99999999){var v=i.getNext();v&&(a=0,i=v)}this._setCurve(i),this._time=a,this._point=h||i.getPointAtTime(a),this._overlap=f,this._distance=m,this._intersection=this._next=this._previous=null},_setPath:function(e){this._path=e,this._version=e?e._version:0},_setCurve:function(e){this._setPath(e._path),this._curve=e,this._segment=null,this._segment1=e._segment1,this._segment2=e._segment2},_setSegment:function(e){var i=e.getCurve();i?this._setCurve(i):(this._setPath(e._path),this._segment1=e,this._segment2=null),this._segment=e,this._time=e===this._segment1?0:1,this._point=e._point.clone()},getSegment:function(){var e=this._segment;if(!e){var i=this.getCurve(),a=this.getTime();a===0?e=i._segment1:a===1?e=i._segment2:a!=null&&(e=i.getPartLength(0,a)<i.getPartLength(a,1)?i._segment1:i._segment2),this._segment=e}return e},getCurve:function(){var e=this._path,i=this;e&&e._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function a(h){var f=h&&h.getCurve();if(f&&(i._time=f.getTimeOf(i._point))!=null)return i._setCurve(f),f}return this._curve||a(this._segment)||a(this._segment1)||a(this._segment2.getPrevious())},getPath:function(){var e=this.getCurve();return e&&e._path},getIndex:function(){var e=this.getCurve();return e&&e.getIndex()},getTime:function(){var e=this.getCurve(),i=this._time;return e&&i==null?this._time=e.getTimeOf(this._point):i},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var e=this._offset;if(e==null){e=0;var i=this.getPath(),a=this.getIndex();if(i&&a!=null)for(var h=i.getCurves(),f=0;f<a;f++)e+=h[f].getLength();this._offset=e+=this.getCurveOffset()}return e},getCurveOffset:function(){var e=this._curveOffset;if(e==null){var i=this.getCurve(),a=this.getTime();this._curveOffset=e=a!=null&&i&&i.getPartLength(0,a)}return e},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var e=this.getCurve(),i=e&&e.divideAtTime(this.getTime());return i&&this._setSegment(i._segment1),i},split:function(){var e=this.getCurve(),i=e._path,a=e&&e.splitAtTime(this.getTime());return a&&this._setSegment(i.getLastSegment()),a},equals:function(e,i){var a=this===e;if(!a&&e instanceof Ke){var h=this.getCurve(),f=e.getCurve(),m=h._path,v=f._path;if(m===v){var _=Math.abs,y=1e-7,b=_(this.getOffset()-e.getOffset()),T=!i&&this._intersection,z=!i&&e._intersection;a=(b<y||m&&_(m.getLength()-b)<y)&&(!T&&!z||T&&z&&T.equals(z,!0))}}return a},toString:function(){var e=[],i=this.getPoint(),a=L.instance;i&&e.push("point: "+i);var h=this.getIndex();h!=null&&e.push("index: "+h);var f=this.getTime();return f!=null&&e.push("time: "+a.number(f)),this._distance!=null&&e.push("distance: "+a.number(this._distance)),"{ "+e.join(", ")+" }"},isTouching:function(){var e=this._intersection;if(e&&this.getTangent().isCollinear(e.getTangent())){var i=this.getCurve(),a=e.getCurve();return!(i.isStraight()&&a.isStraight()&&i.getLine().intersect(a.getLine()))}return!1},isCrossing:function(){var e=this._intersection;if(!e)return!1;var i=this.getTime(),a=e.getTime(),h=1e-8,f=1-h,m=i>=h&&i<=f,v=a>=h&&a<=f;if(m&&v)return!this.isTouching();var _=this.getCurve(),y=_&&i<h?_.getPrevious():_,b=e.getCurve(),T=b&&a<h?b.getPrevious():b;if(i>f&&(_=_.getNext()),a>f&&(b=b.getNext()),!y||!_||!T||!b)return!1;var z=[];function P(G,K){var Y=G.getValues(),ie=me.classify(Y).roots||me.getPeaks(Y),W=ie.length,te=me.getLength(Y,K&&W?ie[W-1]:0,!K&&W?ie[0]:1);z.push(W?te:te/32)}function S(G,K,Y){return K<Y?G>K&&G<Y:G>K||G<Y}m||(P(y,!0),P(_,!1)),v||(P(T,!0),P(b,!1));var B=this.getPoint(),O=Math.min.apply(Math,z),V=m?_.getTangentAtTime(i):_.getPointAt(O).subtract(B),k=m?V.negate():y.getPointAt(-O).subtract(B),R=v?b.getTangentAtTime(a):b.getPointAt(O).subtract(B),w=v?R.negate():T.getPointAt(-O).subtract(B),N=k.getAngle(),U=V.getAngle(),H=w.getAngle(),D=R.getAngle();return!!(m?S(N,H,D)^S(U,H,D)&&S(N,D,H)^S(U,D,H):S(H,N,U)^S(D,N,U)&&S(H,U,N)^S(D,U,N))},hasOverlap:function(){return!!this._overlap}},u.each(me._evaluateMethods,function(e){var i=e+"At";this[e]=function(){var a=this.getCurve(),h=this.getTime();return h!=null&&a&&a[i](h,!0)}},{preserve:!0}),new function(){function e(i,a,h){var f=i.length,m=0,v=f-1;function _(B,O){for(var V=B+O;V>=-1&&V<=f;V+=O){var k=i[(V%f+f)%f];if(!a.getPoint().isClose(k.getPoint(),1e-7))break;if(a.equals(k))return k}return null}for(;m<=v;){var y=m+v>>>1,b=i[y],T;if(h&&(T=a.equals(b)?b:_(y,-1)||_(y,1)))return a._overlap&&(T._overlap=T._intersection._overlap=!0),T;var z=a.getPath(),P=b.getPath(),S=z!==P?z._id-P._id:a.getIndex()+a.getTime()-(b.getIndex()+b.getTime());S<0?v=y-1:m=y+1}return i.splice(m,0,a),a}return{statics:{insert:e,expand:function(i){for(var a=i.slice(),h=i.length-1;h>=0;h--)e(a,i[h]._intersection,!1);return a}}}}),rt=M.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(e){var i,a,h;if(u.isPlainObject(e)?(a=e.segments,i=e.pathData):Array.isArray(e)?a=e:typeof e=="string"&&(i=e),a){var f=a[0];h=f&&Array.isArray(f[0])}else i&&(h=(i.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(i));var m=h?tt:Ve;return new m(e)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(e){this.isClockwise()!=(e=!!e)&&this.reverse()},setPathData:function(e){var i=e&&e.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),a,h=!1,f,m,v=new E,_=new E;function y(w,N){var U=+a[w];return h&&(U+=v[N]),U}function b(w){return new E(y(w,"x"),y(w+1,"y"))}this.clear();for(var T=0,z=i&&i.length;T<z;T++){var P=i[T],S=P[0],B=S.toLowerCase();a=P.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var O=a&&a.length;switch(h=S===B,f==="z"&&!/[mz]/.test(B)&&this.moveTo(v),B){case"m":case"l":for(var V=B==="m",k=0;k<O;k+=2)this[V?"moveTo":"lineTo"](v=b(k)),V&&(_=v,V=!1);m=v;break;case"h":case"v":var R=B==="h"?"x":"y";v=v.clone();for(var k=0;k<O;k++)v[R]=y(k,R),this.lineTo(v);m=v;break;case"c":for(var k=0;k<O;k+=6)this.cubicCurveTo(b(k),m=b(k+2),v=b(k+4));break;case"s":for(var k=0;k<O;k+=4)this.cubicCurveTo(/[cs]/.test(f)?v.multiply(2).subtract(m):v,m=b(k),v=b(k+2)),f=B;break;case"q":for(var k=0;k<O;k+=4)this.quadraticCurveTo(m=b(k),v=b(k+2));break;case"t":for(var k=0;k<O;k+=2)this.quadraticCurveTo(m=/[qt]/.test(f)?v.multiply(2).subtract(m):v,v=b(k)),f=B;break;case"a":for(var k=0;k<O;k+=7)this.arcTo(v=b(k+5),new X(+a[k],+a[k+1]),+a[k+2],+a[k+4],+a[k+3]);break;case"z":this.closePath(1e-12),v=_;break}f=B}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(e){var i=e.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(e):{};return i.onPath||!!(this.getFillRule()==="evenodd"?i.windingL&1||i.windingR&1:i.winding)},getIntersections:function(e,i,a,h){var f=this===e||!e,m=this._matrix._orNullIfIdentity(),v=f?m:(a||e._matrix)._orNullIfIdentity();return f||this.getBounds(m).intersects(e.getBounds(v),1e-12)?me.getIntersections(this.getCurves(),!f&&e.getCurves(),i,m,v,h):[]},getCrossings:function(e){return this.getIntersections(e,function(i){return i.isCrossing()})},getNearestLocation:function(){for(var e=E.read(arguments),i=this.getCurves(),a=1/0,h=null,f=0,m=i.length;f<m;f++){var v=i[f].getNearestLocation(e);v._distance<a&&(a=v._distance,h=v)}return h},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e&&e.getPoint()},interpolate:function(e,i,a){var h=!this._children,f=h?"_segments":"_children",m=e[f],v=i[f],_=this[f];if(!m||!v||m.length!==v.length)throw new Error("Invalid operands in interpolate() call: "+e+", "+i);var y=_.length,b=v.length;if(y<b)for(var T=h?Pe:Ve,z=y;z<b;z++)this.add(new T);else y>b&&this[h?"removeSegments":"removeChildren"](b,y);for(var z=0;z<b;z++)_[z].interpolate(m[z],v[z],a);h&&(this.setClosed(e._closed),this._changed(9))},compare:function(e){var i=!1;if(e){var a=this._children||[this],h=e._children?e._children.slice():[e],f=a.length,m=h.length,v=[],_=0;i=!0;for(var y=C.findItemBoundsCollisions(a,h,A.GEOMETRIC_EPSILON),b=f-1;b>=0&&i;b--){var T=a[b];i=!1;var z=y[b];if(z)for(var P=z.length-1;P>=0&&!i;P--)T.compare(h[z[P]])&&(v[z[P]]||(v[z[P]]=!0,_++),i=!0)}i=i&&_===m}return i}}),Ve=rt.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(i){this._closed=!1,this._segments=[],this._version=0;var a=arguments,h=Array.isArray(i)?typeof i[0]=="object"?i:a:i&&i.size===r&&(i.x!==r||i.point!==r)?a:null;h&&h.length>0?this.setSegments(h):(this._curves=r,this._segmentSelection=0,!h&&typeof i=="string"&&(this.setPathData(i),i=null)),this._initialize(!h&&i)},_equals:function(e){return this._closed===e._closed&&u.equals(this._segments,e._segments)},copyContent:function(e){this.setSegments(e._segments),this._closed=e._closed},_changed:function e(i){if(e.base.call(this,i),i&8){if(this._length=this._area=r,i&32)this._version++;else if(this._curves)for(var a=0,h=this._curves.length;a<h;a++)this._curves[a]._changed()}else i&64&&(this._bounds=r)},getStyle:function(){var e=this._parent;return(e instanceof tt?e:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var i=this.isFullySelected(),a=e&&e.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=r,a){var h=e[a-1];typeof h=="boolean"&&(this.setClosed(h),a--),this._add(Pe.readList(e,0,{},a))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var e=this._curves,i=this._segments;if(!e){var a=this._countCurves();e=this._curves=new Array(a);for(var h=0;h<a;h++)e[h]=new me(this,i[h],i[h+1]||i[0])}return e},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var e=this.getCurves();return e[e.length-1]},isClosed:function(){return this._closed},setClosed:function(e){if(this._closed!=(e=!!e)){if(this._closed=e,this._curves){var i=this._curves.length=this._countCurves();e&&(this._curves[i-1]=new me(this,this._segments[i-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(e,i){var a=this._segments,h=a.length,f=new L(i),m=new Array(6),v=!0,_,y,b,T,z,P,S,B,O=[];function V(R,w){if(R._transformCoordinates(e,m),_=m[0],y=m[1],v)O.push("M"+f.pair(_,y)),v=!1;else if(z=m[2],P=m[3],z===_&&P===y&&S===b&&B===T){if(!w){var N=_-b,U=y-T;O.push(N===0?"v"+f.number(U):U===0?"h"+f.number(N):"l"+f.pair(N,U))}}else O.push("c"+f.pair(S-b,B-T)+" "+f.pair(z-b,P-T)+" "+f.pair(_-b,y-T));b=_,T=y,S=m[4],B=m[5]}if(!h)return"";for(var k=0;k<h;k++)V(a[k]);return this._closed&&h>0&&(V(a[0],!0),O.push("z")),O.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(e){for(var i=this._segments,a=new Array(6),h=0,f=i.length;h<f;h++)i[h]._transformCoordinates(e,a,!0);return!0},_add:function(e,v){for(var a=this._segments,h=this._curves,f=e.length,m=v==null,v=m?a.length:v,_=0;_<f;_++){var y=e[_];y._path&&(y=e[_]=y.clone()),y._path=this,y._index=v+_,y._selection&&this._updateSelection(y,0,y._selection)}if(m)u.push(a,e);else{a.splice.apply(a,[v,0].concat(e));for(var _=v+f,b=a.length;_<b;_++)a[_]._index=_}if(h){var T=this._countCurves(),z=v>0&&v+f-1===T?v-1:v,P=z,S=Math.min(z+f,T);e._curves&&(h.splice.apply(h,[z,0].concat(e._curves)),P+=e._curves.length);for(var _=P;_<S;_++)h.splice(_,0,new me(this,null,null));this._adjustCurves(z,S)}return this._changed(41),e},_adjustCurves:function(e,i){for(var a=this._segments,h=this._curves,f,m=e;m<i;m++)f=h[m],f._path=this,f._segment1=a[m],f._segment2=a[m+1]||a[0],f._changed();(f=h[this._closed&&!e?a.length-1:e-1])&&(f._segment2=a[e]||a[0],f._changed()),(f=h[i])&&(f._segment1=a[i],f._changed())},_countCurves:function(){var e=this._segments.length;return!this._closed&&e>0?e-1:e},add:function(e){var i=arguments;return i.length>1&&typeof e!="number"?this._add(Pe.readList(i)):this._add([Pe.read(i)])[0]},insert:function(e,i){var a=arguments;return a.length>2&&typeof i!="number"?this._add(Pe.readList(a,1),e):this._add([Pe.read(a,1)],e)[0]},addSegment:function(){return this._add([Pe.read(arguments)])[0]},insertSegment:function(e){return this._add([Pe.read(arguments,1)],e)[0]},addSegments:function(e){return this._add(Pe.readList(e))},insertSegments:function(e,i){return this._add(Pe.readList(i),e)},removeSegment:function(e){return this.removeSegments(e,e+1)[0]||null},removeSegments:function(e,i,a){e=e||0,i=u.pick(i,this._segments.length);var h=this._segments,f=this._curves,m=h.length,v=h.splice(e,i-e),_=v.length;if(!_)return v;for(var y=0;y<_;y++){var b=v[y];b._selection&&this._updateSelection(b,b._selection,0),b._index=b._path=null}for(var y=e,T=h.length;y<T;y++)h[y]._index=y;if(f){for(var z=e>0&&i===m+(this._closed?1:0)?e-1:e,f=f.splice(z,_),y=f.length-1;y>=0;y--)f[y]._path=null;a&&(v._curves=f.slice(1)),this._adjustCurves(z,z)}return this._changed(41),v},clear:"#removeSegments",hasHandles:function(){for(var e=this._segments,i=0,a=e.length;i<a;i++)if(e[i].hasHandles())return!0;return!1},clearHandles:function(){for(var e=this._segments,i=0,a=e.length;i<a;i++)e[i].clearHandles()},getLength:function(){if(this._length==null){for(var e=this.getCurves(),i=0,a=0,h=e.length;a<h;a++)i+=e[a].getLength();this._length=i}return this._length},getArea:function(){var e=this._area;if(e==null){var i=this._segments,a=this._closed;e=0;for(var h=0,f=i.length;h<f;h++){var m=h+1===f;e+=me.getArea(me.getValues(i[h],i[m?0:h+1],null,m&&!a))}this._area=e}return e},isFullySelected:function(){var e=this._segments.length;return this.isSelected()&&e>0&&this._segmentSelection===e*7},setFullySelected:function(e){e&&this._selectSegments(!0),this.setSelected(e)},setSelection:function e(i){i&1||this._selectSegments(!1),e.base.call(this,i)},_selectSegments:function(e){var i=this._segments,a=i.length,h=e?7:0;this._segmentSelection=h*a;for(var f=0;f<a;f++)i[f]._selection=h},_updateSelection:function(e,i,a){e._selection=a;var h=this._segmentSelection+=a-i;h>0&&this.setSelected(!0)},divideAt:function(e){var i=this.getLocationAt(e),a;return i&&(a=i.getCurve().divideAt(i.getCurveOffset()))?a._segment1:null},splitAt:function(e){var i=this.getLocationAt(e),a=i&&i.index,h=i&&i.time,f=1e-8,m=1-f;h>m&&(a++,h=0);var v=this.getCurves();if(a>=0&&a<v.length){h>=f&&v[a++].divideAtTime(h);var _=this.removeSegments(a,this._segments.length,!0),y;return this._closed?(this.setClosed(!1),y=this):(y=new Ve(M.NO_INSERT),y.insertAbove(this),y.copyAttributes(this)),y._add(_,0),this.addSegment(_[0]),y}return null},split:function(e,i){var a,h=i===r?e:(a=this.getCurves()[e])&&a.getLocationAtTime(i);return h!=null?this.splitAt(h):null},join:function(e,i){var a=i||0;if(e&&e!==this){var h=e._segments,f=this.getLastSegment(),m=e.getLastSegment();if(!m)return this;f&&f._point.isClose(m._point,a)&&e.reverse();var v=e.getFirstSegment();if(f&&f._point.isClose(v._point,a))f.setHandleOut(v._handleOut),this._add(h.slice(1));else{var _=this.getFirstSegment();_&&_._point.isClose(v._point,a)&&e.reverse(),m=e.getLastSegment(),_&&_._point.isClose(m._point,a)?(_.setHandleIn(m._handleIn),this._add(h.slice(0,h.length-1),0)):this._add(h.slice())}e._closed&&this._add([h[0]]),e.remove()}var y=this.getFirstSegment(),b=this.getLastSegment();return y!==b&&y._point.isClose(b._point,a)&&(y.setHandleIn(b._handleIn),b.remove(),this.setClosed(!0)),this},reduce:function(e){for(var i=this.getCurves(),a=e&&e.simplify,h=a?1e-7:0,f=i.length-1;f>=0;f--){var m=i[f];!m.hasHandles()&&(!m.hasLength(h)||a&&m.isCollinear(m.getNext()))&&m.remove()}return this},reverse:function(){this._segments.reverse();for(var e=0,i=this._segments.length;e<i;e++){var a=this._segments[e],h=a._handleIn;a._handleIn=a._handleOut,a._handleOut=h,a._index=e}this._curves=null,this._changed(9)},flatten:function(e){for(var i=new Kt(this,e||.25,256,!0),a=i.parts,h=a.length,f=[],m=0;m<h;m++)f.push(new Pe(a[m].curve.slice(0,2)));!this._closed&&h>0&&f.push(new Pe(a[h-1].curve.slice(6))),this.setSegments(f)},simplify:function(e){var i=new Bt(this).fit(e||2.5);return i&&this.setSegments(i),!!i},smooth:function(e){var i=this,a=e||{},h=a.type||"asymmetric",f=this._segments,m=f.length,v=this._closed;function _(Re,Be){var Fe=Re&&Re.index;if(Fe!=null){var Ge=Re.path;if(Ge&&Ge!==i)throw new Error(Re._class+" "+Fe+" of "+Ge+" is not part of "+i);Be&&Re instanceof me&&Fe++}else Fe=typeof Re=="number"?Re:Be;return Math.min(Fe<0&&v?Fe%m:Fe<0?Fe+m:Fe,m-1)}var y=v&&a.from===r&&a.to===r,b=_(a.from,0),T=_(a.to,m-1);if(b>T)if(v)b-=m;else{var z=b;b=T,T=z}if(/^(?:asymmetric|continuous)$/.test(h)){var P=h==="asymmetric",S=Math.min,B=T-b+1,O=B-1,V=y?S(B,4):1,k=V,R=V,w=[];if(v||(k=S(1,b),R=S(1,m-T-1)),O+=k+R,O<=1)return;for(var N=0,U=b-k;N<=O;N++,U++)w[N]=f[(U<0?U+m:U)%m]._point;for(var H=w[0]._x+2*w[1]._x,D=w[0]._y+2*w[1]._y,G=2,K=O-1,Y=[H],ie=[D],W=[G],te=[],ne=[],N=1;N<O;N++){var ae=N<K,oe=ae||P?1:2,ce=ae?4:P?2:7,we=ae?4:P?3:8,Ee=ae?2:P?0:1,Me=oe/G;G=W[N]=ce-Me,H=Y[N]=we*w[N]._x+Ee*w[N+1]._x-Me*H,D=ie[N]=we*w[N]._y+Ee*w[N+1]._y-Me*D}te[K]=Y[K]/W[K],ne[K]=ie[K]/W[K];for(var N=O-2;N>=0;N--)te[N]=(Y[N]-te[N+1])/W[N],ne[N]=(ie[N]-ne[N+1])/W[N];te[O]=(3*w[O]._x-te[K])/2,ne[O]=(3*w[O]._y-ne[K])/2;for(var N=k,Ne=O-R,U=b;N<=Ne;N++,U++){var ve=f[U<0?U+m:U],xe=ve._point,ze=te[N]-xe._x,De=ne[N]-xe._y;(y||N<Ne)&&ve.setHandleOut(ze,De),(y||N>k)&&ve.setHandleIn(-ze,-De)}}else for(var N=b;N<=T;N++)f[N<0?N+m:N].smooth(a,!y&&N===b,!y&&N===T)},toShape:function(e){if(!this._closed)return null;var i=this._segments,a,h,f,m;function v(P,S){var B=i[P],O=B.getNext(),V=i[S],k=V.getNext();return B._handleOut.isZero()&&O._handleIn.isZero()&&V._handleOut.isZero()&&k._handleIn.isZero()&&O._point.subtract(B._point).isCollinear(k._point.subtract(V._point))}function _(P){var S=i[P],B=S.getPrevious(),O=S.getNext();return B._handleOut.isZero()&&S._handleIn.isZero()&&S._handleOut.isZero()&&O._handleIn.isZero()&&S._point.subtract(B._point).isOrthogonal(O._point.subtract(S._point))}function y(P){var S=i[P],B=S.getNext(),O=S._handleOut,V=B._handleIn,k=.5522847498307936;if(O.isOrthogonal(V)){var R=S._point,w=B._point,N=new ye(R,O,!0).intersect(new ye(w,V,!0),!0);return N&&A.isZero(O.getLength()/N.subtract(R).getLength()-k)&&A.isZero(V.getLength()/N.subtract(w).getLength()-k)}return!1}function b(P,S){return i[P]._point.getDistance(i[S]._point)}if(!this.hasHandles()&&i.length===4&&v(0,2)&&v(1,3)&&_(1)?(a=pe.Rectangle,h=new X(b(0,3),b(0,1)),m=i[1]._point.add(i[2]._point).divide(2)):i.length===8&&y(0)&&y(2)&&y(4)&&y(6)&&v(1,5)&&v(3,7)?(a=pe.Rectangle,h=new X(b(1,6),b(0,3)),f=h.subtract(new X(b(0,7),b(1,2))).divide(2),m=i[3]._point.add(i[4]._point).divide(2)):i.length===4&&y(0)&&y(1)&&y(2)&&y(3)&&(A.isZero(b(0,2)-b(1,3))?(a=pe.Circle,f=b(0,2)/2):(a=pe.Ellipse,f=new X(b(2,0)/2,b(3,1)/2)),m=i[1]._point),a){var T=this.getPosition(!0),z=new a({center:T,size:h,radius:f,insert:!1});return z.copyAttributes(this,!0),z._matrix.prepend(this._matrix),z.rotate(m.subtract(T).getAngle()+90),(e===r||e)&&z.insertAbove(this),z}return null},toPath:"#clone",compare:function e(i){if(!i||i instanceof tt)return e.base.call(this,i);var a=this.getCurves(),h=i.getCurves(),f=a.length,m=h.length;if(!f||!m)return f==m;for(var v=a[0].getValues(),_=[],y=0,b,T=0,z,P=0;P<m;P++){var V=h[P].getValues();_.push(V);var S=me.getOverlaps(v,V);if(S){b=!P&&S[0][0]>0?m-1:P,z=S[0][1];break}}for(var B=Math.abs,O=1e-8,V=_[b],k;v&&V;){var S=me.getOverlaps(v,V);if(S){var R=S[0][0];if(B(R-T)<O){T=S[1][0],T===1&&(v=++y<f?a[y].getValues():null,T=0);var w=S[0][1];if(B(w-z)<O){if(k||(k=[b,w]),z=S[1][1],z===1&&(++b>=m&&(b=0),V=_[b]||h[b].getValues(),z=0),!v)return k[0]===b&&k[1]===z;continue}}}break}return!1},_hitTestSelf:function(e,i,a,h){var f=this,m=this.getStyle(),v=this._segments,_=v.length,y=this._closed,b=i._tolerancePadding,T=b,z,P,S,B,O,V,k=i.stroke&&m.hasStroke(),R=i.fill&&m.hasFill(),w=i.curves,N=k?m.getStrokeWidth()/2:R&&i.tolerance>0||w?0:null;N!==null&&(N>0?(z=m.getStrokeJoin(),P=m.getStrokeCap(),S=m.getMiterLimit(),T=T.add(Ve._getStrokePadding(N,h))):z=P="round");function U(te,ne){return e.subtract(te).divide(ne).length<=1}function H(te,ne,ae){if(!i.selected||ne.isSelected()){var oe=te._point;if(ne!==oe&&(ne=ne.add(oe)),U(ne,T))return new Oe(ae,f,{segment:te,point:ne})}}function D(te,ne){return(ne||i.segments)&&H(te,te._point,"segment")||!ne&&i.handles&&(H(te,te._handleIn,"handle-in")||H(te,te._handleOut,"handle-out"))}function G(te){B.add(te)}function K(te){var ne=y||te._index>0&&te._index<_-1;if((ne?z:P)==="round")return U(te._point,T);if(B=new Ve({internal:!0,closed:!0}),ne?te.isSmooth()||Ve._addBevelJoin(te,z,N,S,null,h,G,!0):P==="square"&&Ve._addSquareCap(te,P,N,null,h,G,!0),!B.isEmpty()){var ae;return B.contains(e)||(ae=B.getNearestLocation(e))&&U(ae.getPoint(),b)}}if(i.ends&&!i.segments&&!y){if(V=D(v[0],!0)||D(v[_-1],!0))return V}else if(i.segments||i.handles){for(var Y=0;Y<_;Y++)if(V=D(v[Y]))return V}if(N!==null){if(O=this.getNearestLocation(e),O){var ie=O.getTime();ie===0||ie===1&&_>1?K(O.getSegment())||(O=null):U(O.getPoint(),T)||(O=null)}if(!O&&z==="miter"&&_>1)for(var Y=0;Y<_;Y++){var W=v[Y];if(e.getDistance(W._point)<=S*N&&K(W)){O=W.getLocation();break}}}return!O&&R&&this._contains(e)||O&&!k&&!w?new Oe("fill",this):O?new Oe(k?"stroke":"curve",this,{location:O,point:O.getPoint()}):null}},u.each(me._evaluateMethods,function(e){this[e+"At"]=function(i){var a=this.getLocationAt(i);return a&&a[e]()}},{beans:!1,getLocationOf:function(){for(var e=E.read(arguments),i=this.getCurves(),a=0,h=i.length;a<h;a++){var f=i[a].getLocationOf(e);if(f)return f}return null},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getLocationAt:function(e){if(typeof e=="number"){for(var i=this.getCurves(),a=0,h=0,f=i.length;h<f;h++){var m=a,v=i[h];if(a+=v.getLength(),a>e)return v.getLocationAt(e-m)}if(i.length>0&&e<=this.getLength())return new Ke(i[i.length-1],1)}else if(e&&e.getPath&&e.getPath()===this)return e;return null},getOffsetsWithTangent:function(){var e=E.read(arguments);if(e.isZero())return[];for(var i=[],a=0,h=this.getCurves(),f=0,m=h.length;f<m;f++){for(var v=h[f],_=v.getTimesWithTangent(e),y=0,b=_.length;y<b;y++){var T=a+v.getOffsetAtTime(_[y]);i.indexOf(T)<0&&i.push(T)}a+=v.length}return i}}),new function(){function e(a,h,f,m){if(m<=0)return;var v=m/2,_=m-2,y=v-1,b=new Array(6),T,z;function P(R){var w=b[R],N=b[R+1];(T!=w||z!=N)&&(a.beginPath(),a.moveTo(T,z),a.lineTo(w,N),a.stroke(),a.beginPath(),a.arc(w,N,v,0,Math.PI*2,!0),a.fill())}for(var S=0,B=h.length;S<B;S++){var O=h[S],V=O._selection;if(O._transformCoordinates(f,b),T=b[0],z=b[1],V&2&&P(2),V&4&&P(4),a.fillRect(T-v,z-v,m,m),_>0&&!(V&1)){var k=a.fillStyle;a.fillStyle="#ffffff",a.fillRect(T-y,z-y,_,_),a.fillStyle=k}}}function i(a,h,f){var m=h._segments,v=m.length,_=new Array(6),y=!0,b,T,z,P,S,B,O,V;function k(w){if(f)w._transformCoordinates(f,_),b=_[0],T=_[1];else{var N=w._point;b=N._x,T=N._y}if(y)a.moveTo(b,T),y=!1;else{if(f)S=_[2],B=_[3];else{var U=w._handleIn;S=b+U._x,B=T+U._y}S===b&&B===T&&O===z&&V===P?a.lineTo(b,T):a.bezierCurveTo(O,V,S,B,b,T)}if(z=b,P=T,f)O=_[4],V=_[5];else{var U=w._handleOut;O=z+U._x,V=P+U._y}}for(var R=0;R<v;R++)k(m[R]);h._closed&&v>0&&k(m[0])}return{_draw:function(a,h,f,m){var v=h.dontStart,_=h.dontFinish||h.clip,y=this.getStyle(),b=y.hasFill(),T=y.hasStroke(),z=y.getDashArray(),P=!$e.support.nativeDash&&T&&z&&z.length;v||a.beginPath(),(b||T&&!P||_)&&(i(a,this,m),this._closed&&a.closePath());function S(w){return z[(w%P+P)%P]}if(!_&&(b||T)&&(this._setStyles(a,h,f),b&&(a.fill(y.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),T)){if(P){v||a.beginPath();for(var B=new Kt(this,.25,32,!1,m),O=B.length,V=-y.getDashOffset(),k,R=0;V>0;)V-=S(R--)+S(R--);for(;V<O;)k=V+S(R++),(V>0||k>0)&&B.drawPart(a,Math.max(V,0),Math.max(k,0)),V=k+S(R++)}a.stroke()}},_drawSelected:function(a,h){a.beginPath(),i(a,this,h),a.stroke(),e(a,this._segments,h,$e.settings.handleSize)}}},new function(){function e(i){var a=i._segments;if(!a.length)throw new Error("Use a moveTo() command first");return a[a.length-1]}return{moveTo:function(){var i=this._segments;i.length===1&&this.removeSegment(0),i.length||this._add([new Pe(E.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Pe(E.read(arguments))])},cubicCurveTo:function(){var i=arguments,a=E.read(i),h=E.read(i),f=E.read(i),m=e(this);m.setHandleOut(a.subtract(m._point)),this._add([new Pe(f,h.subtract(f))])},quadraticCurveTo:function(){var i=arguments,a=E.read(i),h=E.read(i),f=e(this)._point;this.cubicCurveTo(a.add(f.subtract(a).multiply(1/3)),a.add(h.subtract(a).multiply(1/3)),h)},curveTo:function(){var i=arguments,a=E.read(i),h=E.read(i),f=u.pick(u.read(i),.5),m=1-f,v=e(this)._point,_=a.subtract(v.multiply(m*m)).subtract(h.multiply(f*f)).divide(2*f*m);if(_.isNaN())throw new Error("Cannot put a curve through points with parameter = "+f);this.quadraticCurveTo(_,h)},arcTo:function(){var i=arguments,a=Math.abs,h=Math.sqrt,f=e(this),m=f._point,v=E.read(i),_,y=u.peek(i),b=u.pick(y,!0),T,z,P,S;if(typeof b=="boolean")var B=m.add(v).divide(2),_=B.add(B.subtract(m).rotate(b?-90:90));else if(u.remain(i)<=2)_=v,v=E.read(i);else if(!m.equals(v)){var O=X.read(i),V=A.isZero;if(V(O.width)||V(O.height))return this.lineTo(v);var k=u.read(i),b=!!u.read(i),R=!!u.read(i),B=m.add(v).divide(2),w=m.subtract(B).rotate(-k),N=w.x,U=w.y,H=a(O.width),D=a(O.height),G=H*H,K=D*D,Y=N*N,ie=U*U,W=h(Y/G+ie/K);if(W>1&&(H*=W,D*=W,G=H*H,K=D*D),W=(G*K-G*ie-K*Y)/(G*ie+K*Y),a(W)<1e-12&&(W=0),W<0)throw new Error("Cannot create an arc with the given arguments");T=new E(H*U/D,-D*N/H).multiply((R===b?-1:1)*h(W)).rotate(k).add(B),S=new re().translate(T).rotate(k).scale(H,D),P=S._inverseTransform(m),z=P.getDirectedAngle(S._inverseTransform(v)),!b&&z>0?z-=360:b&&z<0&&(z+=360)}if(_){var te=new ye(m.add(_).divide(2),_.subtract(m).rotate(90),!0),ne=new ye(_.add(v).divide(2),v.subtract(_).rotate(90),!0),ae=new ye(m,v),oe=ae.getSide(_);if(T=te.intersect(ne,!0),!T){if(!oe)return this.lineTo(v);throw new Error("Cannot create an arc with the given arguments")}P=m.subtract(T),z=P.getDirectedAngle(v.subtract(T));var ce=ae.getSide(T,!0);ce===0?z=oe*a(z):oe===ce&&(z+=z<0?360:-360)}if(z){for(var we=1e-5,Ee=a(z),Me=Ee>=360?4:Math.ceil((Ee-we)/90),Ne=z/Me,ve=Ne*Math.PI/360,xe=4/3*Math.sin(ve)/(1+Math.cos(ve)),ze=[],De=0;De<=Me;De++){var w=v,Re=null;if(De<Me&&(Re=P.rotate(90).multiply(xe),S?(w=S._transformPoint(P),Re=S._transformPoint(P.add(Re)).subtract(w)):w=T.add(P)),!De)f.setHandleOut(Re);else{var Be=P.rotate(-90).multiply(xe);S&&(Be=S._transformPoint(P.add(Be)).subtract(w)),ze.push(new Pe(w,Be,Re))}P=P.rotate(Ne)}this._add(ze)}},lineBy:function(){var i=E.read(arguments),a=e(this)._point;this.lineTo(a.add(i))},curveBy:function(){var i=arguments,a=E.read(i),h=E.read(i),f=u.read(i),m=e(this)._point;this.curveTo(m.add(a),m.add(h),f)},cubicCurveBy:function(){var i=arguments,a=E.read(i),h=E.read(i),f=E.read(i),m=e(this)._point;this.cubicCurveTo(m.add(a),m.add(h),m.add(f))},quadraticCurveBy:function(){var i=arguments,a=E.read(i),h=E.read(i),f=e(this)._point;this.quadraticCurveTo(f.add(a),f.add(h))},arcBy:function(){var i=arguments,a=e(this)._point,h=a.add(E.read(i)),f=u.pick(u.peek(i),!0);typeof f=="boolean"?this.arcTo(h,f):this.arcTo(h,a.add(E.read(i)))},closePath:function(i){this.setClosed(!0),this.join(this,i)}}},{_getBounds:function(e,i){var a=i.handle?"getHandleBounds":i.stroke?"getStrokeBounds":"getBounds";return Ve[a](this._segments,this._closed,this,e,i)},statics:{getBounds:function(e,i,a,h,f,m){var v=e[0];if(!v)return new $;var _=new Array(6),y=v._transformCoordinates(h,new Array(6)),b=y.slice(0,2),T=b.slice(),z=new Array(2);function P(O){O._transformCoordinates(h,_);for(var V=0;V<2;V++)me._addBounds(y[V],y[V+4],_[V+2],_[V],V,m?m[V]:0,b,T,z);var k=y;y=_,_=k}for(var S=1,B=e.length;S<B;S++)P(e[S]);return i&&P(v),new $(b[0],b[1],T[0]-b[0],T[1]-b[1])},getStrokeBounds:function(e,i,a,h,f){var m=a.getStyle(),v=m.hasStroke(),_=m.getStrokeWidth(),y=v&&a._getStrokeMatrix(h,f),b=v&&Ve._getStrokePadding(_,y),T=Ve.getBounds(e,i,a,h,f,b);if(!v)return T;var z=_/2,P=m.getStrokeJoin(),S=m.getStrokeCap(),B=m.getMiterLimit(),O=new $(new X(b));function V(H){T=T.include(H)}function k(H){T=T.unite(O.setCenter(H._point.transform(h)))}function R(H,D){D==="round"||H.isSmooth()?k(H):Ve._addBevelJoin(H,D,z,B,h,y,V)}function w(H,D){D==="round"?k(H):Ve._addSquareCap(H,D,z,h,y,V)}var N=e.length-(i?0:1);if(N>0){for(var U=1;U<N;U++)R(e[U],P);i?R(e[0],P):(w(e[0],S),w(e[e.length-1],S))}return T},_getStrokePadding:function(e,i){if(!i)return[e,e];var a=new E(e,0).transform(i),h=new E(0,e).transform(i),f=a.getAngleInRadians(),m=a.getLength(),v=h.getLength(),_=Math.sin(f),y=Math.cos(f),b=Math.tan(f),T=Math.atan2(v*b,m),z=Math.atan2(v,b*m);return[Math.abs(m*Math.cos(T)*y+v*Math.sin(T)*_),Math.abs(v*Math.sin(z)*y+m*Math.cos(z)*_)]},_addBevelJoin:function(e,i,a,h,f,m,v,_){var y=e.getCurve(),b=y.getPrevious(),T=y.getPoint1().transform(f),z=b.getNormalAtTime(1).multiply(a).transform(m),P=y.getNormalAtTime(0).multiply(a).transform(m),S=z.getDirectedAngle(P);if((S<0||S>=180)&&(z=z.negate(),P=P.negate()),_&&v(T),v(T.add(z)),i==="miter"){var B=new ye(T.add(z),new E(-z.y,z.x),!0).intersect(new ye(T.add(P),new E(-P.y,P.x),!0),!0);B&&T.getDistance(B)<=h*a&&v(B)}v(T.add(P))},_addSquareCap:function(e,i,a,h,f,m,v){var _=e._point.transform(h),y=e.getLocation(),b=y.getNormal().multiply(y.getTime()===0?a:-a).transform(f);i==="square"&&(v&&(m(_.subtract(b)),m(_.add(b))),_=_.add(b.rotate(-90))),m(_.add(b)),m(_.subtract(b))},getHandleBounds:function(e,i,a,h,f){var m=a.getStyle(),v=f.stroke&&m.hasStroke(),_,y;if(v){var b=a._getStrokeMatrix(h,f),T=m.getStrokeWidth()/2,z=T;m.getStrokeJoin()==="miter"&&(z=T*m.getMiterLimit()),m.getStrokeCap()==="square"&&(z=Math.max(z,T*Math.SQRT2)),_=Ve._getStrokePadding(T,b),y=Ve._getStrokePadding(z,b)}for(var P=new Array(6),S=1/0,B=-S,O=S,V=B,k=0,R=e.length;k<R;k++){var w=e[k];w._transformCoordinates(h,P);for(var N=0;N<6;N+=2){var U=N?_:y,H=U?U[0]:0,D=U?U[1]:0,G=P[N],K=P[N+1],Y=G-H,ie=G+H,W=K-D,te=K+D;Y<S&&(S=Y),ie>B&&(B=ie),W<O&&(O=W),te>V&&(V=te)}}return new $(S,O,B-S,V-O)}}});Ve.inject({statics:new function(){var e=.5522847498307936,i=[new Pe([-1,0],[0,e],[0,-e]),new Pe([0,-1],[-e,0],[e,0]),new Pe([1,0],[0,-e],[0,e]),new Pe([0,1],[e,0],[-e,0])];function a(f,m,v){var _=u.getNamed(v),y=new Ve(_&&(_.insert==!0?M.INSERT:_.insert==!1?M.NO_INSERT:null));return y._add(f),y._closed=m,y.set(_,M.INSERT)}function h(f,m,v){for(var _=new Array(4),y=0;y<4;y++){var b=i[y];_[y]=new Pe(b._point.multiply(m).add(f),b._handleIn.multiply(m),b._handleOut.multiply(m))}return a(_,!0,v)}return{Line:function(){var f=arguments;return a([new Pe(E.readNamed(f,"from")),new Pe(E.readNamed(f,"to"))],!1,f)},Circle:function(){var f=arguments,m=E.readNamed(f,"center"),v=u.readNamed(f,"radius");return h(m,new X(v),f)},Rectangle:function(){var f=arguments,m=$.readNamed(f,"rectangle"),v=X.readNamed(f,"radius",0,{readNull:!0}),_=m.getBottomLeft(!0),y=m.getTopLeft(!0),b=m.getTopRight(!0),T=m.getBottomRight(!0),z;if(!v||v.isZero())z=[new Pe(_),new Pe(y),new Pe(b),new Pe(T)];else{v=X.min(v,m.getSize(!0).divide(2));var P=v.width,S=v.height,B=P*e,O=S*e;z=[new Pe(_.add(P,0),null,[-B,0]),new Pe(_.subtract(0,S),[0,O]),new Pe(y.add(0,S),null,[0,-O]),new Pe(y.add(P,0),[-B,0],null),new Pe(b.subtract(P,0),null,[B,0]),new Pe(b.add(0,S),[0,-O],null),new Pe(T.subtract(0,S),null,[0,O]),new Pe(T.subtract(P,0),[B,0])]}return a(z,!0,f)},RoundRectangle:"#Rectangle",Ellipse:function(){var f=arguments,m=pe._readEllipse(f);return h(m.center,m.radius,f)},Oval:"#Ellipse",Arc:function(){var f=arguments,m=E.readNamed(f,"from"),v=E.readNamed(f,"through"),_=E.readNamed(f,"to"),y=u.getNamed(f),b=new Ve(y&&y.insert==!1&&M.NO_INSERT);return b.moveTo(m),b.arcTo(v,_),b.set(y)},RegularPolygon:function(){for(var f=arguments,m=E.readNamed(f,"center"),v=u.readNamed(f,"sides"),_=u.readNamed(f,"radius"),y=360/v,b=v%3===0,T=new E(0,b?-_:_),z=b?-1:.5,P=new Array(v),S=0;S<v;S++)P[S]=new Pe(m.add(T.rotate((S+z)*y)));return a(P,!0,f)},Star:function(){for(var f=arguments,m=E.readNamed(f,"center"),v=u.readNamed(f,"points")*2,_=u.readNamed(f,"radius1"),y=u.readNamed(f,"radius2"),b=360/v,T=new E(0,-1),z=new Array(v),P=0;P<v;P++)z[P]=new Pe(m.add(T.rotate(b*P).multiply(P%2?y:_)));return a(z,!0,f)}}}});var tt=rt.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(i){this._children=[],this._namedChildren={},this._initialize(i)||(typeof i=="string"?this.setPathData(i):this.addChildren(Array.isArray(i)?i:arguments))},insertChildren:function e(i,a){var h=a,f=h[0];f&&typeof f[0]=="number"&&(h=[h]);for(var m=a.length-1;m>=0;m--){var v=h[m];h===a&&!(v instanceof Ve)&&(h=u.slice(h)),Array.isArray(v)?h[m]=new Ve({segments:v,insert:!1}):v instanceof tt&&(h.splice.apply(h,[m,1].concat(v.removeChildren())),v.remove())}return e.base.call(this,i,h)},reduce:function e(i){for(var a=this._children,h=a.length-1;h>=0;h--){var f=a[h].reduce(i);f.isEmpty()&&f.remove()}if(!a.length){var f=new Ve(M.NO_INSERT);return f.copyAttributes(this),f.insertAbove(this),this.remove(),f}return e.base.call(this)},isClosed:function(){for(var e=this._children,i=0,a=e.length;i<a;i++)if(!e[i]._closed)return!1;return!0},setClosed:function(e){for(var i=this._children,a=0,h=i.length;a<h;a++)i[a].setClosed(e)},getFirstSegment:function(){var e=this.getFirstChild();return e&&e.getFirstSegment()},getLastSegment:function(){var e=this.getLastChild();return e&&e.getLastSegment()},getCurves:function(){for(var e=this._children,i=[],a=0,h=e.length;a<h;a++)u.push(i,e[a].getCurves());return i},getFirstCurve:function(){var e=this.getFirstChild();return e&&e.getFirstCurve()},getLastCurve:function(){var e=this.getLastChild();return e&&e.getLastCurve()},getArea:function(){for(var e=this._children,i=0,a=0,h=e.length;a<h;a++)i+=e[a].getArea();return i},getLength:function(){for(var e=this._children,i=0,a=0,h=e.length;a<h;a++)i+=e[a].getLength();return i},getPathData:function(e,i){for(var a=this._children,h=[],f=0,m=a.length;f<m;f++){var v=a[f],_=v._matrix;h.push(v.getPathData(e&&!_.isIdentity()?e.appended(_):e,i))}return h.join("")},_hitTestChildren:function e(i,a,h){return e.base.call(this,i,a.class===Ve||a.type==="path"?a:u.set({},a,{fill:!1}),h)},_draw:function(e,i,a,h){var f=this._children;if(f.length){i=i.extend({dontStart:!0,dontFinish:!0}),e.beginPath();for(var m=0,v=f.length;m<v;m++)f[m].draw(e,i,h);if(!i.clip){this._setStyles(e,i,a);var _=this._style;_.hasFill()&&(e.fill(_.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),_.hasStroke()&&e.stroke()}}},_drawSelected:function(e,i,a){for(var h=this._children,f=0,m=h.length;f<m;f++){var v=h[f],_=v._matrix;a[v._id]||v._drawSelected(e,_.isIdentity()?i:i.appended(_))}}},new function(){function e(i,a){var h=i._children;if(a&&!h.length)throw new Error("Use a moveTo() command first");return h[h.length-1]}return u.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(i){this[i]=function(){var a=e(this,!0);a[i].apply(a,arguments)}},{moveTo:function(){var i=e(this),a=i&&i.isEmpty()?i:new Ve(M.NO_INSERT);a!==i&&this.addChild(a),a.moveTo.apply(a,arguments)},moveBy:function(){var i=e(this,!0),a=i&&i.getLastSegment(),h=E.read(arguments);this.moveTo(a?h.add(a._point):h)},closePath:function(i){e(this,!0).closePath(i)}})},u.each(["reverse","flatten","simplify","smooth"],function(e){this[e]=function(i){for(var a=this._children,h,f=0,m=a.length;f<m;f++)h=a[f][e](i)||h;return h}},{}));rt.inject(new function(){var e=Math.min,i=Math.max,a=Math.abs,h={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function f(k){return k._children||[k]}function m(k,R){var w=k.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(R){for(var N=f(w),U=0,H=N.length;U<H;U++){var k=N[U];!k._closed&&!k.isEmpty()&&(k.closePath(1e-12),k.getFirstSegment().setHandleIn(0,0),k.getLastSegment().setHandleOut(0,0))}w=w.resolveCrossings().reorient(w.getFillRule()==="nonzero",!0)}return w}function v(k,R,w,N,U){var H=new tt(M.NO_INSERT);return H.addChildren(k,!0),H=H.reduce({simplify:R}),U&&U.insert==!1||H.insertAbove(N&&w.isSibling(N)&&w.getIndex()<N.getIndex()?N:w),H.copyAttributes(w,!0),H}function _(k){return k.hasOverlap()||k.isCrossing()}function y(k,R,w,N){if(N&&(N.trace==!1||N.stroke)&&/^(subtract|intersect)$/.test(w))return b(k,R,w);var U=m(k,!0),H=R&&k!==R&&m(R,!0),D=h[w];D[w]=!0,H&&(D.subtract||D.exclude)^(H.isClockwise()^U.isClockwise())&&H.reverse();var G=S(Ke.expand(U.getIntersections(H,_))),K=f(U),Y=H&&f(H),ie=[],W=[],te;function ne(Re){for(var Be=0,Fe=Re.length;Be<Fe;Be++){var Ge=Re[Be];u.push(ie,Ge._segments),u.push(W,Ge.getCurves()),Ge._overlapsOnly=!0}}function ae(Re){for(var Be=[],Fe=0,Ge=Re&&Re.length;Fe<Ge;Fe++)Be.push(W[Re[Fe]]);return Be}if(G.length){ne(K),Y&&ne(Y);for(var oe=new Array(W.length),ce=0,we=W.length;ce<we;ce++)oe[ce]=W[ce].getValues();for(var Ee=C.findCurveBoundsCollisions(oe,oe,0,!0),Me={},ce=0;ce<W.length;ce++){var Ne=W[ce],ve=Ne._path._id,xe=Me[ve]=Me[ve]||{};xe[Ne.getIndex()]={hor:ae(Ee[ce].hor),ver:ae(Ee[ce].ver)}}for(var ce=0,we=G.length;ce<we;ce++)O(G[ce]._segment,U,H,Me,D);for(var ce=0,we=ie.length;ce<we;ce++){var ze=ie[ce],De=ze._intersection;ze._winding||O(ze,U,H,Me,D),De&&De._overlap||(ze._path._overlapsOnly=!1)}te=V(ie,D)}else te=P(Y?K.concat(Y):K.slice(),function(Re){return!!D[Re]});return v(te,!0,k,R,N)}function b(k,R,w){var N=m(k),U=m(R),H=N.getIntersections(U,_),D=w==="subtract",G=w==="divide",K={},Y=[];function ie(ne){if(!K[ne._id]&&(G||U.contains(ne.getPointAt(ne.getLength()/2))^D))return Y.unshift(ne),K[ne._id]=!0}for(var W=H.length-1;W>=0;W--){var te=H[W].split();te&&(ie(te)&&te.getFirstSegment().setHandleIn(0,0),N.getLastSegment().setHandleOut(0,0))}return ie(N),v(Y,!1,k,R)}function T(k,R){for(var w=k;w;){if(w===R)return;w=w._previous}for(;k._next&&k._next!==R;)k=k._next;if(!k._next){for(;R._previous;)R=R._previous;k._next=R,R._previous=k}}function z(k){for(var R=k.length-1;R>=0;R--)k[R].clearHandles()}function P(k,R,w){var N=k&&k.length;if(N){var U=u.each(k,function(Ee,Me){this[Ee._id]={container:null,winding:Ee.isClockwise()?1:-1,index:Me}},{}),H=k.slice().sort(function(Ee,Me){return a(Me.getArea())-a(Ee.getArea())}),D=H[0],G=C.findItemBoundsCollisions(H,null,A.GEOMETRIC_EPSILON);w==null&&(w=D.isClockwise());for(var K=0;K<N;K++){var Y=H[K],ie=U[Y._id],W=0,te=G[K];if(te){for(var ne=null,ae=te.length-1;ae>=0;ae--)if(te[ae]<K){ne=ne||Y.getInteriorPoint();var oe=H[te[ae]];if(oe.contains(ne)){var ce=U[oe._id];W=ce.winding,ie.winding+=W,ie.container=ce.exclude?ce.container:oe;break}}}if(R(ie.winding)===R(W))ie.exclude=!0,k[ie.index]=null;else{var we=ie.container;Y.setClockwise(we?!we.isClockwise():w)}}}return k}function S(k,R,w){var N=R&&[],U=1e-8,H=1-U,D=!1,G=w||[],K=w&&{},Y,ie,W;function te(Be){return Be._path._id+"."+Be._segment1._index}for(var ne=(w&&w.length)-1;ne>=0;ne--){var ae=w[ne];ae._path&&(K[te(ae)]=!0)}for(var ne=k.length-1;ne>=0;ne--){var oe=k[ne],ce=oe._time,we=ce,Ee=R&&!R(oe),ae=oe._curve,Me;if(ae&&(ae!==ie?(D=!ae.hasHandles()||K&&K[te(ae)],Y=[],W=null,ie=ae):W>=U&&(ce/=W)),Ee){Y&&Y.push(oe);continue}else R&&N.unshift(oe);if(W=we,ce<U)Me=ae._segment1;else if(ce>H)Me=ae._segment2;else{var Ne=ae.divideAtTime(ce,!0);D&&G.push(ae,Ne),Me=Ne._segment1;for(var ve=Y.length-1;ve>=0;ve--){var xe=Y[ve];xe._time=(xe._time-ce)/(1-ce)}}oe._setSegment(Me);var ze=Me._intersection,De=oe._intersection;if(ze){T(ze,De);for(var Re=ze;Re;)T(Re._intersection,ze),Re=Re._next}else Me._intersection=De}return w||z(G),N||k}function B(k,R,w,N,U){var H=Array.isArray(R)?R:R[w?"hor":"ver"],D=w?1:0,G=D^1,K=[k.x,k.y],Y=K[D],ie=K[G],W=1e-9,te=1e-6,ne=Y-W,ae=Y+W,oe=0,ce=0,we=0,Ee=0,Me=!1,Ne=!1,ve=1,xe=[],ze,De;function Re(Ae){var lt=Ae[G+0],ht=Ae[G+6];if(!(ie<e(lt,ht)||ie>i(lt,ht))){var _t=Ae[D+0],Ot=Ae[D+2],Gt=Ae[D+4],Rt=Ae[D+6];if(lt===ht){(_t<ae&&Rt>ne||Rt<ae&&_t>ne)&&(Me=!0);return}var Dt=ie===lt?0:ie===ht||ne>i(_t,Ot,Gt,Rt)||ae<e(_t,Ot,Gt,Rt)?1:me.solveCubic(Ae,G,ie,xe,0,1)>0?xe[0]:1,Pt=Dt===0?_t:Dt===1?Rt:me.getPoint(Ae,Dt)[w?"y":"x"],Mt=lt>ht?1:-1,jt=ze[G]>ze[G+6]?1:-1,yt=ze[D+6];return ie!==lt?(Pt<ne?we+=Mt:Pt>ae?Ee+=Mt:Me=!0,Pt>Y-te&&Pt<Y+te&&(ve/=2)):(Mt!==jt?_t<ne?we+=Mt:_t>ae&&(Ee+=Mt):_t!=yt&&(yt<ae&&Pt>ae?(Ee+=Mt,Me=!0):yt>ne&&Pt<ne&&(we+=Mt,Me=!0)),ve/=4),ze=Ae,!U&&Pt>ne&&Pt<ae&&me.getTangent(Ae,Dt)[w?"x":"y"]===0&&B(k,R,!w,N,!0)}}function Be(Ae){var lt=Ae[G+0],ht=Ae[G+2],_t=Ae[G+4],Ot=Ae[G+6];if(ie<=i(lt,ht,_t,Ot)&&ie>=e(lt,ht,_t,Ot)){for(var Gt=Ae[D+0],Rt=Ae[D+2],Dt=Ae[D+4],Pt=Ae[D+6],Mt=ne>i(Gt,Rt,Dt,Pt)||ae<e(Gt,Rt,Dt,Pt)?[Ae]:me.getMonoCurves(Ae,w),jt,yt=0,kt=Mt.length;yt<kt;yt++)if(jt=Re(Mt[yt]))return jt}}for(var Fe=0,Ge=H.length;Fe<Ge;Fe++){var Xe=H[Fe],Ue=Xe._path,vt=Xe.getValues(),pt;if((!Fe||H[Fe-1]._path!==Ue)&&(ze=null,Ue._closed||(De=me.getValues(Ue.getLastCurve().getSegment2(),Xe.getSegment1(),null,!N),De[G]!==De[G+6]&&(ze=De)),!ze)){ze=vt;for(var xt=Ue.getLastCurve();xt&&xt!==Xe;){var gt=xt.getValues();if(gt[G]!==gt[G+6]){ze=gt;break}xt=xt.getPrevious()}}if(pt=Be(vt))return pt;if(Fe+1===Ge||H[Fe+1]._path!==Ue){if(De&&(pt=Be(De)))return pt;Me&&!we&&!Ee&&(we=Ee=Ue.isClockwise(N)^w?1:-1),oe+=we,ce+=Ee,we=Ee=0,Me&&(Ne=!0,Me=!1),De=null}}return oe=a(oe),ce=a(ce),{winding:i(oe,ce),windingL:oe,windingR:ce,quality:ve,onPath:Ne}}function O(k,R,w,N,U){var H=[],D=k,G=0,W;do{var K=k.getCurve();if(K){var Y=K.getLength();H.push({segment:k,curve:K,length:Y}),G+=Y}k=k.getNext()}while(k&&!k._intersection&&k!==D);for(var ie=[.5,.25,.75],W={winding:0,quality:-1},te=.001,ne=1-te,ae=0;ae<ie.length&&W.quality<.5;ae++)for(var Y=G*ie[ae],oe=0,ce=H.length;oe<ce;oe++){var we=H[oe],Ee=we.length;if(Y<=Ee){var K=we.curve,Me=K._path,Ne=Me._parent,ve=Ne instanceof tt?Ne:Me,xe=A.clamp(K.getTimeAt(Y),te,ne),ze=K.getPointAtTime(xe),De=a(K.getTangentAtTime(xe).y)<Math.SQRT1_2,Re=null;if(U.subtract&&w){var Be=ve===R?w:R,Fe=Be._getWinding(ze,De,!0);if(ve===R&&Fe.winding||ve===w&&!Fe.winding){if(Fe.quality<1)continue;Re={winding:0,quality:1}}}Re=Re||B(ze,N[Me._id][K.getIndex()],De,!0),Re.quality>W.quality&&(W=Re);break}Y-=Ee}for(var oe=H.length-1;oe>=0;oe--)H[oe].segment._winding=W}function V(k,R){var w=[],N;function U(Ge){var Xe;return!!(Ge&&!Ge._visited&&(!R||R[(Xe=Ge._winding||{}).winding]&&!(R.unite&&Xe.winding===2&&Xe.windingL&&Xe.windingR)))}function H(Ge){if(Ge){for(var Xe=0,Ue=N.length;Xe<Ue;Xe++)if(Ge===N[Xe])return!0}return!1}function D(Ge){for(var Xe=Ge._segments,Ue=0,vt=Xe.length;Ue<vt;Ue++)Xe[Ue]._visited=!0}function G(Ge,Xe){var Ue=Ge._intersection,vt=Ue,pt=[];Xe&&(N=[Ge]);function xt(gt,Ae){for(;gt&&gt!==Ae;){var lt=gt._segment,ht=lt&&lt._path;if(ht){var _t=lt.getNext()||ht.getFirstSegment(),Ot=_t._intersection;lt!==Ge&&(H(lt)||H(_t)||_t&&U(lt)&&(U(_t)||Ot&&U(Ot._segment)))&&pt.push(lt),Xe&&N.push(lt)}gt=gt._next}}if(Ue){for(xt(Ue);Ue&&Ue._previous;)Ue=Ue._previous;xt(Ue,vt)}return pt}k.sort(function(Ge,Xe){var Ue=Ge._intersection,vt=Xe._intersection,pt=!!(Ue&&Ue._overlap),xt=!!(vt&&vt._overlap),gt=Ge._path,Ae=Xe._path;return pt^xt?pt?1:-1:!Ue^!vt?Ue?1:-1:gt!==Ae?gt._id-Ae._id:Ge._index-Xe._index});for(var K=0,Y=k.length;K<Y;K++){var ie=k[K],W=U(ie),te=null,ne=!1,ae=!0,oe=[],ce,we,Ee;if(W&&ie._path._overlapsOnly){var Me=ie._path,Ne=ie._intersection._segment._path;Me.compare(Ne)&&(Me.getArea()&&w.push(Me.clone(!1)),D(Me),D(Ne),W=!1)}for(;W;){var ve=!te,xe=G(ie,ve),ze=xe.shift(),ne=!ve&&(H(ie)||H(ze)),De=!ne&&ze;if(ve&&(te=new Ve(M.NO_INSERT),ce=null),ne){(ie.isFirst()||ie.isLast())&&(ae=ie._path._closed),ie._visited=!0;break}if(De&&ce&&(oe.push(ce),ce=null),ce||(De&&xe.push(ie),ce={start:te._segments.length,crossings:xe,visited:we=[],handleIn:Ee}),De&&(ie=ze),!U(ie)){te.removeSegments(ce.start);for(var Re=0,Be=we.length;Re<Be;Re++)we[Re]._visited=!1;we.length=0;do ie=ce&&ce.crossings.shift(),(!ie||!ie._path)&&(ie=null,ce=oe.pop(),ce&&(we=ce.visited,Ee=ce.handleIn));while(ce&&!U(ie));if(!ie)break}var Fe=ie.getNext();te.add(new Pe(ie._point,Ee,Fe&&ie._handleOut)),ie._visited=!0,we.push(ie),ie=Fe||ie._path.getFirstSegment(),Ee=Fe&&Fe._handleIn}ne&&(ae&&(te.getFirstSegment().setHandleIn(Ee),te.setClosed(ae)),te.getArea()!==0&&w.push(te))}return w}return{_getWinding:function(k,R,w){return B(k,this.getCurves(),R,w)},unite:function(k,R){return y(this,k,"unite",R)},intersect:function(k,R){return y(this,k,"intersect",R)},subtract:function(k,R){return y(this,k,"subtract",R)},exclude:function(k,R){return y(this,k,"exclude",R)},divide:function(k,R){return R&&(R.trace==!1||R.stroke)?b(this,k,"divide"):v([this.subtract(k,R),this.intersect(k,R)],!0,this,k,R)},resolveCrossings:function(){var k=this._children,R=k||[this];function w(ce,we){var Ee=ce&&ce._intersection;return Ee&&Ee._overlap&&Ee._path===we}var N=!1,U=!1,H=this.getIntersections(null,function(ce){return ce.hasOverlap()&&(N=!0)||ce.isCrossing()&&(U=!0)}),D=N&&U&&[];if(H=Ke.expand(H),N)for(var G=S(H,function(ce){return ce.hasOverlap()},D),K=G.length-1;K>=0;K--){var Y=G[K],ie=Y._path,W=Y._segment,te=W.getPrevious(),ne=W.getNext();w(te,ie)&&w(ne,ie)&&(W.remove(),te._handleOut._set(0,0),ne._handleIn._set(0,0),te!==W&&!te.getCurve().hasLength()&&(ne._handleIn.set(te._handleIn),te.remove()))}U&&(S(H,N&&function(ce){var we=ce.getCurve(),Ee=ce.getSegment(),Me=ce._intersection,Ne=Me._curve,ve=Me._segment;if(we&&Ne&&we._path&&Ne._path)return!0;Ee&&(Ee._intersection=null),ve&&(ve._intersection=null)},D),D&&z(D),R=V(u.each(R,function(ce){u.push(this,ce._segments)},[])));var ae=R.length,oe;return ae>1&&k?(R!==k&&this.setChildren(R),oe=this):ae===1&&!k&&(R[0]!==this&&this.setSegments(R[0].removeSegments()),oe=this),oe||(oe=new tt(M.NO_INSERT),oe.addChildren(R),oe=oe.reduce(),oe.copyAttributes(this),this.replaceWith(oe)),oe},reorient:function(k,R){var w=this._children;return w&&w.length?this.setChildren(P(this.removeChildren(),function(N){return!!(k?N:N&1)},R)):R!==r&&this.setClockwise(R),this},getInteriorPoint:function(){var k=this.getBounds(),R=k.getCenter(!0);if(!this.contains(R)){for(var w=this.getCurves(),N=R.y,U=[],H=[],D=0,G=w.length;D<G;D++){var K=w[D].getValues(),Y=K[1],ie=K[3],W=K[5],te=K[7];if(N>=e(Y,ie,W,te)&&N<=i(Y,ie,W,te))for(var ne=me.getMonoCurves(K),ae=0,oe=ne.length;ae<oe;ae++){var ce=ne[ae],we=ce[1],Ee=ce[7];if(we!==Ee&&(N>=we&&N<=Ee||N>=Ee&&N<=we)){var Me=N===we?ce[0]:N===Ee?ce[6]:me.solveCubic(ce,1,N,H,0,1)===1?me.getPoint(ce,H[0]).x:(ce[0]+ce[6])/2;U.push(Me)}}}U.length>1&&(U.sort(function(Ne,ve){return Ne-ve}),R.x=(U[0]+U[1])/2)}return R}}});var Kt=u.extend({_class:"PathFlattener",initialize:function(e,i,a,h,f){var m=[],v=[],_=0,y=1/(a||32),b=e._segments,T=b[0],z;function P(V,k){var R=me.getValues(V,k,f);m.push(R),S(R,V._index,0,1)}function S(V,k,R,w){if(w-R>y&&!(h&&me.isStraight(V))&&!me.isFlatEnough(V,i||.25)){var N=me.subdivide(V,.5),U=(R+w)/2;S(N[0],k,R,U),S(N[1],k,U,w)}else{var H=V[6]-V[0],D=V[7]-V[1],G=Math.sqrt(H*H+D*D);G>0&&(_+=G,v.push({offset:_,curve:V,index:k,time:w}))}}for(var B=1,O=b.length;B<O;B++)z=b[B],P(T,z),T=z;e._closed&&P(z||T,b[0]),this.curves=m,this.parts=v,this.length=_,this.index=0},_get:function(e){for(var i=this.parts,a=i.length,h,f=this.index;h=f,!(!f||i[--f].offset<e););for(;h<a;h++){var m=i[h];if(m.offset>=e){this.index=h;var v=i[h-1],_=v&&v.index===m.index?v.time:0,y=v?v.offset:0;return{index:m.index,time:_+(m.time-_)*(e-y)/(m.offset-y)}}}return{index:i[a-1].index,time:1}},drawPart:function(e,i,a){for(var h=this._get(i),f=this._get(a),m=h.index,v=f.index;m<=v;m++){var _=me.getPart(this.curves[m],m===h.index?h.time:0,m===f.index?f.time:1);m===h.index&&e.moveTo(_[0],_[1]),e.bezierCurveTo.apply(e,_.slice(2))}}},u.each(me._evaluateMethods,function(e){this[e+"At"]=function(i){var a=this._get(i);return me[e](this.curves[a.index],a.time)}},{})),Bt=u.extend({initialize:function(e){for(var i=this.points=[],a=e._segments,h=e._closed,f=0,m,v=a.length;f<v;f++){var _=a[f].point;(!m||!m.equals(_))&&i.push(m=_.clone())}h&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=h},fit:function(e){var i=this.points,a=i.length,h=null;return a>0&&(h=[new Pe(i[0])],a>1&&(this.fitCubic(h,e,0,a-1,i[1].subtract(i[0]),i[a-2].subtract(i[a-1])),this.closed&&(h.shift(),h.pop()))),h},fitCubic:function(e,i,a,h,f,m){var v=this.points;if(h-a===1){var _=v[a],y=v[h],b=_.getDistance(y)/3;this.addCurve(e,[_,_.add(f.normalize(b)),y.add(m.normalize(b)),y]);return}for(var T=this.chordLengthParameterize(a,h),z=Math.max(i,i*i),P,S=!0,B=0;B<=4;B++){var O=this.generateBezier(a,h,T,f,m),V=this.findMaxError(a,h,O,T);if(V.error<i&&S){this.addCurve(e,O);return}if(P=V.index,V.error>=z)break;S=this.reparameterize(a,h,T,O),z=V.error}var k=v[P-1].subtract(v[P+1]);this.fitCubic(e,i,a,P,f,k),this.fitCubic(e,i,P,h,k.negate(),m)},addCurve:function(e,i){var a=e[e.length-1];a.setHandleOut(i[1].subtract(i[0])),e.push(new Pe(i[3],i[2].subtract(i[3])))},generateBezier:function(e,i,a,h,f){for(var m=1e-12,v=Math.abs,_=this.points,y=_[e],b=_[i],T=[[0,0],[0,0]],z=[0,0],P=0,S=i-e+1;P<S;P++){var B=a[P],O=1-B,V=3*B*O,k=O*O*O,R=V*O,w=V*B,N=B*B*B,U=h.normalize(R),H=f.normalize(w),D=_[e+P].subtract(y.multiply(k+R)).subtract(b.multiply(w+N));T[0][0]+=U.dot(U),T[0][1]+=U.dot(H),T[1][0]=T[0][1],T[1][1]+=H.dot(H),z[0]+=U.dot(D),z[1]+=H.dot(D)}var G=T[0][0]*T[1][1]-T[1][0]*T[0][1],K,Y;if(v(G)>m){var ie=T[0][0]*z[1]-T[1][0]*z[0],W=z[0]*T[1][1]-z[1]*T[0][1];K=W/G,Y=ie/G}else{var te=T[0][0]+T[0][1],ne=T[1][0]+T[1][1];K=Y=v(te)>m?z[0]/te:v(ne)>m?z[1]/ne:0}var ae=b.getDistance(y),oe=m*ae,ce,we;if(K<oe||Y<oe)K=Y=ae/3;else{var Ee=b.subtract(y);ce=h.normalize(K),we=f.normalize(Y),ce.dot(Ee)-we.dot(Ee)>ae*ae&&(K=Y=ae/3,ce=we=null)}return[y,y.add(ce||h.normalize(K)),b.add(we||f.normalize(Y)),b]},reparameterize:function(e,i,a,h){for(var f=e;f<=i;f++)a[f-e]=this.findRoot(h,this.points[f],a[f-e]);for(var f=1,m=a.length;f<m;f++)if(a[f]<=a[f-1])return!1;return!0},findRoot:function(e,i,a){for(var h=[],f=[],m=0;m<=2;m++)h[m]=e[m+1].subtract(e[m]).multiply(3);for(var m=0;m<=1;m++)f[m]=h[m+1].subtract(h[m]).multiply(2);var v=this.evaluate(3,e,a),_=this.evaluate(2,h,a),y=this.evaluate(1,f,a),b=v.subtract(i),T=_.dot(_)+b.dot(y);return A.isMachineZero(T)?a:a-b.dot(_)/T},evaluate:function(e,i,a){for(var h=i.slice(),f=1;f<=e;f++)for(var m=0;m<=e-f;m++)h[m]=h[m].multiply(1-a).add(h[m+1].multiply(a));return h[0]},chordLengthParameterize:function(e,i){for(var a=[0],h=e+1;h<=i;h++)a[h-e]=a[h-e-1]+this.points[h].getDistance(this.points[h-1]);for(var h=1,f=i-e;h<=f;h++)a[h]/=a[f];return a},findMaxError:function(e,i,a,h){for(var f=Math.floor((i-e+1)/2),m=0,v=e+1;v<i;v++){var _=this.evaluate(3,a,h[v-e]),y=_.subtract(this.points[v]),b=y.x*y.x+y.y*y.y;b>=m&&(m=b,f=v)}return{error:m,index:f}}}),$t=M.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(i){this._content="",this._lines=[];var a=i&&u.isPlainObject(i)&&i.x===r&&i.y===r;this._initialize(a&&i,!a&&E.read(arguments))},_equals:function(e){return this._content===e._content},copyContent:function(e){this.setContent(e._content)},getContent:function(){return this._content},setContent:function(e){this._content=""+e,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Ki=$t.extend({_class:"PointText",initialize:function(){$t.apply(this,arguments)},getPoint:function(){var e=this._matrix.getTranslation();return new Q(e.x,e.y,this,"setPoint")},setPoint:function(){var e=E.read(arguments);this.translate(e.subtract(this._matrix.getTranslation()))},_draw:function(e,i,a){if(this._content){this._setStyles(e,i,a);var h=this._lines,f=this._style,m=f.hasFill(),v=f.hasStroke(),_=f.getLeading(),y=e.shadowColor;e.font=f.getFontStyle(),e.textAlign=f.getJustification();for(var b=0,T=h.length;b<T;b++){e.shadowColor=y;var z=h[b];m&&(e.fillText(z,0,0),e.shadowColor="rgba(0,0,0,0)"),v&&e.strokeText(z,0,0),e.translate(0,_)}}},_getBounds:function(e,i){var a=this._style,h=this._lines,f=h.length,m=a.getJustification(),v=a.getLeading(),_=this.getView().getTextWidth(a.getFontStyle(),h),y=0;m!=="left"&&(y-=_/(m==="center"?2:1));var b=new $(y,f?-.75*v:0,_,f*v);return e?e._transformBounds(b,b):b}}),ft=u.extend(new function(){var e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},i={},a={transparent:[0,0,0,0]},h;function f(_){var y=_.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||_.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),b="rgb",T;if(y){var z=y[4]?4:3;T=new Array(z);for(var P=0;P<z;P++){var S=y[P+1];T[P]=parseInt(S.length==1?S+S:S,16)/255}}else if(y=_.match(/^(rgb|hsl)a?\((.*)\)$/)){b=y[1],T=y[2].trim().split(/[,\s]+/g);for(var B=b==="hsl",P=0,O=Math.min(T.length,4);P<O;P++){var V=T[P],S=parseFloat(V);if(B)if(P===0){var k=V.match(/([a-z]*)$/)[1];S*={turn:360,rad:180/Math.PI,grad:.9}[k]||1}else P<3&&(S/=100);else P<3&&(S/=/%$/.test(V)?100:255);T[P]=S}}else{var R=a[_];if(!R)if(l){h||(h=dt.getContext(1,1,{willReadFrequently:!0}),h.globalCompositeOperation="copy"),h.fillStyle="rgba(0,0,0,0)",h.fillStyle=_,h.fillRect(0,0,1,1);var w=h.getImageData(0,0,1,1).data;R=a[_]=[w[0]/255,w[1]/255,w[2]/255]}else R=[0,0,0];T=R.slice()}return[b,T]}var m=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],v={"rgb-hsb":function(_,y,b){var T=Math.max(_,y,b),z=Math.min(_,y,b),P=T-z,S=P===0?0:(T==_?(y-b)/P+(y<b?6:0):T==y?(b-_)/P+2:(_-y)/P+4)*60;return[S,T===0?0:P/T,T]},"hsb-rgb":function(_,y,b){_=(_/60%6+6)%6;var z=Math.floor(_),T=_-z,z=m[z],P=[b,b*(1-y),b*(1-y*T),b*(1-y*(1-T))];return[P[z[0]],P[z[1]],P[z[2]]]},"rgb-hsl":function(_,y,b){var T=Math.max(_,y,b),z=Math.min(_,y,b),P=T-z,S=P===0,B=S?0:(T==_?(y-b)/P+(y<b?6:0):T==y?(b-_)/P+2:(_-y)/P+4)*60,O=(T+z)/2,V=S?0:O<.5?P/(T+z):P/(2-T-z);return[B,V,O]},"hsl-rgb":function(_,y,b){if(_=(_/360%1+1)%1,y===0)return[b,b,b];for(var T=[_+1/3,_,_-1/3],z=b<.5?b*(1+y):b+y-b*y,P=2*b-z,S=[],B=0;B<3;B++){var O=T[B];O<0&&(O+=1),O>1&&(O-=1),S[B]=6*O<1?P+(z-P)*6*O:2*O<1?z:3*O<2?P+(z-P)*(2/3-O)*6:P}return S},"rgb-gray":function(_,y,b){return[_*.2989+y*.587+b*.114]},"gray-rgb":function(_){return[_,_,_]},"gray-hsb":function(_){return[0,0,_]},"gray-hsl":function(_){return[0,0,_]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return u.each(e,function(_,y){i[y]=[],u.each(_,function(b,T){var z=u.capitalize(b),P=/^(hue|saturation)$/.test(b),S=i[y][T]=y==="gradient"?b==="gradient"?function(B){var O=this._components[0];return B=vi.read(Array.isArray(B)?B:arguments,0,{readNull:!0}),O!==B&&(O&&O._removeOwner(this),B&&B._addOwner(this)),B}:function(){return E.read(arguments,0,{readNull:b==="highlight",clone:!0})}:function(B){return B==null||isNaN(B)?0:+B};this["get"+z]=function(){return this._type===y||P&&/^hs[bl]$/.test(this._type)?this._components[T]:this._convert(y)[T]},this["set"+z]=function(B){this._type!==y&&!(P&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(y),this._properties=e[y],this._type=y),this._components[T]=S.call(this,B),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function _(y){var b=arguments,T=this.__read,z=0,P,S,B,O;Array.isArray(y)&&(b=y,y=b[0]);var V=y!=null&&typeof y;if(V==="string"&&y in e&&(P=y,y=b[1],Array.isArray(y)?(S=y,B=b[2]):(T&&(z=1),b=u.slice(b,1),V=typeof y)),!S){if(O=V==="number"?b:V==="object"&&y.length!=null?y:null,O){P||(P=O.length>=3?"rgb":"gray");var k=e[P].length;B=O[k],T&&(z+=O===arguments?k+(B!=null?1:0):1),O.length>k&&(O=u.slice(O,0,k))}else if(V==="string"){var R=f(y);P=R[0],S=R[1],S.length===4&&(B=S[3],S.length--)}else if(V==="object")if(y.constructor===_){if(P=y._type,S=y._components.slice(),B=y._alpha,P==="gradient")for(var w=1,N=S.length;w<N;w++){var U=S[w];U&&(S[w]=U.clone())}}else if(y.constructor===vi)P="gradient",O=b;else{P="hue"in y?"lightness"in y?"hsl":"hsb":"gradient"in y||"stops"in y||"radial"in y?"gradient":"gray"in y?"gray":"rgb";var H=e[P],D=i[P];this._components=S=[];for(var w=0,N=H.length;w<N;w++){var G=y[H[w]];G==null&&!w&&P==="gradient"&&"stops"in y&&(G={stops:y.stops,radial:y.radial}),G=D[w].call(this,G),G!=null&&(S[w]=G)}B=y.alpha}T&&P&&(z=1)}if(this._type=P||"rgb",!S){this._components=S=[];for(var D=i[this._type],w=0,N=D.length;w<N;w++){var G=D[w].call(this,O&&O[w]);G!=null&&(S[w]=G)}}return this._components=S,this._properties=e[this._type],this._alpha=B,T&&(this.__read=z),this},set:"#initialize",_serialize:function(_,y){var b=this.getComponents();return u.serialize(/^(gray|rgb)$/.test(this._type)?b:[this._type].concat(b),_,!0,y)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(_){var y;return this._type===_?this._components.slice():(y=v[this._type+"-"+_])?y.apply(this,this._components):v["rgb-"+_].apply(this,v[this._type+"-rgb"].apply(this,this._components))},convert:function(_){return new ft(_,this._convert(_),this._alpha)},getType:function(){return this._type},setType:function(_){this._components=this._convert(_),this._properties=e[_],this._type=_},getComponents:function(){var _=this._components.slice();return this._alpha!=null&&_.push(this._alpha),_},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(_){this._alpha=_==null?null:Math.min(Math.max(_,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(_){var y=u.isPlainValue(_,!0)?ft.read(arguments):_;return y===this||y&&this._class===y._class&&this._type===y._type&&this.getAlpha()===y.getAlpha()&&u.equals(this._components,y._components)||!1},toString:function(){for(var _=this._properties,y=[],b=this._type==="gradient",T=L.instance,z=0,P=_.length;z<P;z++){var S=this._components[z];S!=null&&y.push(_[z]+": "+(b?S:T.number(S)))}return this._alpha!=null&&y.push("alpha: "+T.number(this._alpha)),"{ "+y.join(", ")+" }"},toCSS:function(_){var y=this._convert("rgb"),b=_||this._alpha==null?1:this._alpha;function T(z){return Math.round((z<0?0:z>1?1:z)*255)}return y=[T(y[0]),T(y[1]),T(y[2])],b<1&&y.push(b<0?0:b),_?"#"+((1<<24)+(y[0]<<16)+(y[1]<<8)+y[2]).toString(16).slice(1):(y.length==4?"rgba(":"rgb(")+y.join(",")+")"},toCanvasStyle:function(_,y){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var b=this._components,T=b[0],z=T._stops,P=b[1],S=b[2],B=b[3],O=y&&y.inverted(),V;if(O&&(P=O._transformPoint(P),S=O._transformPoint(S),B&&(B=O._transformPoint(B))),T._radial){var k=S.getDistance(P);if(B){var R=B.subtract(P);R.getLength()>k&&(B=P.add(R.normalize(k-.1)))}var w=B||P;V=_.createRadialGradient(w.x,w.y,0,P.x,P.y,k)}else V=_.createLinearGradient(P.x,P.y,S.x,S.y);for(var N=0,U=z.length;N<U;N++){var H=z[N],D=H._offset;V.addColorStop(D??N/(U-1),H._color.toCanvasStyle())}return this._canvasStyle=V},transform:function(_){if(this._type==="gradient"){for(var y=this._components,b=1,T=y.length;b<T;b++){var z=y[b];_._transformPoint(z,z,!0)}this._changed()}},statics:{_types:e,random:function(){var _=Math.random;return new ft(_(),_(),_())},_setOwner:function(_,y,b){return _&&(_._owner&&y&&_._owner!==y&&(_=_.clone()),!_._owner^!y&&(_._owner=y||null,_._setter=b||null)),_}}})},new function(){var e={add:function(i,a){return i+a},subtract:function(i,a){return i-a},multiply:function(i,a){return i*a},divide:function(i,a){return i/a}};return u.each(e,function(i,a){this[a]=function(h){h=ft.read(arguments);for(var f=this._type,m=this._components,v=h._convert(f),_=0,y=m.length;_<y;_++)v[_]=i(m[_],v[_]);return new ft(f,v,this._alpha!=null?i(this._alpha,h.getAlpha()):null)}},{})}),vi=u.extend({_class:"Gradient",initialize:function(i,a){this._id=q.get(),i&&u.isPlainObject(i)&&(this.set(i),i=a=null),this._stops==null&&this.setStops(i||["white","black"]),this._radial==null&&this.setRadial(typeof a=="string"&&a==="radial"||a||!1)},_serialize:function(e,i){return i.add(this,function(){return u.serialize([this._stops,this._radial],e,!0,i)})},_changed:function(){for(var e=0,i=this._owners&&this._owners.length;e<i;e++)this._owners[e]._changed()},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var i=this._owners?this._owners.indexOf(e):-1;i!=-1&&(this._owners.splice(i,1),this._owners.length||(this._owners=r))},clone:function(){for(var e=[],i=0,a=this._stops.length;i<a;i++)e[i]=this._stops[i].clone();return new vi(e,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var a=0,h=i.length;a<h;a++)i[a]._owner=r;i=this._stops=$i.readList(e,0,{clone:!0});for(var a=0,h=i.length;a<h;a++)i[a]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(e){this._radial=e,this._changed()},equals:function(e){if(e===this)return!0;if(e&&this._class===e._class){var i=this._stops,a=e._stops,h=i.length;if(h===a.length){for(var f=0;f<h;f++)if(!i[f].equals(a[f]))return!1;return!0}}return!1}}),$i=u.extend({_class:"GradientStop",initialize:function(i,a){var h=i,f=a;typeof i=="object"&&a===r&&(Array.isArray(i)&&typeof i[0]!="number"?(h=i[0],f=i[1]):("color"in i||"offset"in i||"rampPoint"in i)&&(h=i.color,f=i.offset||i.rampPoint||0)),this.setColor(h),this.setOffset(f)},clone:function(){return new $i(this._color.clone(),this._offset)},_serialize:function(e,i){var a=this._color,h=this._offset;return u.serialize(h==null?[a]:[a,h],e,!0,i)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){ft._setOwner(this._color,null),this._color=ft._setOwner(ft.read(arguments,0),this,"setColor"),this._changed()},equals:function(e){return e===this||e&&this._class===e._class&&this._color.equals(e._color)&&this._offset==e._offset||!1}}),Yi=u.extend(new function(){var e={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new E,selectedColor:null},i=u.set({},e,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),a=u.set({},i,{fillColor:new ft}),h={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},f={beans:!0},m={_class:"Style",beans:!0,initialize:function(_,y,b){this._values={},this._owner=y,this._project=y&&y._project||b||$e.project,this._defaults=!y||y instanceof de?i:y instanceof $t?a:e,_&&this.set(_)}};return u.each(i,function(v,_){var y=/Color$/.test(_),b=_==="shadowOffset",T=u.capitalize(_),z=h[_],P="set"+T,S="get"+T;m[P]=function(B){var O=this._owner,V=O&&O._children,k=V&&V.length>0&&!(O instanceof tt);if(k)for(var R=0,w=V.length;R<w;R++)V[R]._style[P](B);if((_==="selectedColor"||!k)&&_ in this._defaults){var N=this._values[_];N!==B&&(y&&(N&&(ft._setOwner(N,null),N._canvasStyle=null),B&&B.constructor===ft&&(B=ft._setOwner(B,O,k&&P))),this._values[_]=B,O&&O._changed(z||129))}},m[S]=function(B){var O=this._owner,V=O&&O._children,k=V&&V.length>0&&!(O instanceof tt),R;if(k&&!B)for(var w=0,N=V.length;w<N;w++){var U=V[w]._style[S]();if(!w)R=U;else if(!u.equals(R,U))return r}else if(_ in this._defaults){var R=this._values[_];if(R===r)R=this._defaults[_],R&&R.clone&&(R=R.clone());else{var H=y?ft:b?E:null;H&&!(R&&R.constructor===H)&&(this._values[_]=R=H.read([R],0,{readNull:!0,clone:!0}))}}return R&&y&&(R=ft._setOwner(R,O,k&&P)),R},f[S]=function(B){return this._style[S](B)},f[P]=function(B){this._style[P](B)}}),u.each({Font:"FontFamily",WindingRule:"FillRule"},function(v,_){var y="get"+_,b="set"+_;m[y]=f[y]="#get"+v,m[b]=f[b]="#set"+v}),M.inject(f),m},{set:function(e){var i=e instanceof Yi,a=i?e._values:e;if(a){for(var h in a)if(h in this._defaults){var f=a[h];this[h]=f&&i&&f.clone?f.clone():f}}},equals:function(e){function i(a,h,f){var m=a._values,v=h._values,_=h._defaults;for(var y in m){var b=m[y],T=v[y];if(!(f&&y in v)&&!u.equals(b,T===r?_[y]:T))return!1}return!0}return e===this||e&&this._class===e._class&&i(this,e)&&i(e,this,!0)||!1},_dispose:function(){var e;e=this.getFillColor(),e&&(e._canvasStyle=null),e=this.getStrokeColor(),e&&(e._canvasStyle=null),e=this.getShadowColor(),e&&(e._canvasStyle=null)},hasFill:function(){var e=this.getFillColor();return!!e&&e.alpha>0},hasStroke:function(){var e=this.getStrokeColor();return!!e&&e.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var e=this.getShadowColor();return!!e&&e.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var e=this.getFontSize();return this.getFontWeight()+" "+e+(/[a-z]/i.test(e+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function e(){var i=e.base.call(this),a=this.getFontSize();return/pt|em|%|px/.test(a)&&(a=this.getView().getPixelSize(a)),i??a*1.2}}),st=new function(){function e(i,a,h,f){for(var m=["","webkit","moz","Moz","ms","o"],v=a[0].toUpperCase()+a.substring(1),_=0;_<6;_++){var y=m[_],b=y?y+v:a;if(b in i){if(h)i[b]=f;else return i[b];break}}}return{getStyles:function(i){var a=i&&i.nodeType!==9?i.ownerDocument:i,h=a&&a.defaultView;return h&&h.getComputedStyle(i,"")},getBounds:function(i,a){var h=i.ownerDocument,f=h.body,m=h.documentElement,v;try{v=i.getBoundingClientRect()}catch{v={left:0,top:0,width:0,height:0}}var _=v.left-(m.clientLeft||f.clientLeft||0),y=v.top-(m.clientTop||f.clientTop||0);if(!a){var b=h.defaultView;_+=b.pageXOffset||m.scrollLeft||f.scrollLeft,y+=b.pageYOffset||m.scrollTop||f.scrollTop}return new $(_,y,v.width,v.height)},getViewportBounds:function(i){var a=i.ownerDocument,h=a.defaultView,f=a.documentElement;return new $(0,0,h.innerWidth||f.clientWidth,h.innerHeight||f.clientHeight)},getOffset:function(i,a){return st.getBounds(i,a).getPoint()},getSize:function(i){return st.getBounds(i,!0).getSize()},isInvisible:function(i){return st.getSize(i).equals(new X(0,0))},isInView:function(i){return!st.isInvisible(i)&&st.getViewportBounds(i).intersects(st.getBounds(i,!0))},isInserted:function(i){return c.body.contains(i)},getPrefixed:function(i,a){return i&&e(i,a)},setPrefixed:function(i,a,h){if(typeof a=="object")for(var f in a)e(i,f,!0,a[f]);else e(i,a,!0,h)}}},ot={add:function(e,i){if(e)for(var a in i)for(var h=i[a],f=a.split(/[\s,]+/g),m=0,v=f.length;m<v;m++){var _=f[m],y=e===c&&(_==="touchstart"||_==="touchmove")?{passive:!1}:!1;e.addEventListener(_,h,y)}},remove:function(e,i){if(e)for(var a in i)for(var h=i[a],f=a.split(/[\s,]+/g),m=0,v=f.length;m<v;m++)e.removeEventListener(f[m],h,!1)},getPoint:function(e){var i=e.targetTouches?e.targetTouches.length?e.targetTouches[0]:e.changedTouches[0]:e;return new E(i.pageX||i.clientX+c.documentElement.scrollLeft,i.pageY||i.clientY+c.documentElement.scrollTop)},getTarget:function(e){return e.target||e.srcElement},getRelatedTarget:function(e){return e.relatedTarget||e.toElement},getOffset:function(e,i){return ot.getPoint(e).subtract(st.getOffset(i||ot.getTarget(e)))}};ot.requestAnimationFrame=new function(){var e=st.getPrefixed(l,"requestAnimationFrame"),i=!1,a=[],h;function f(){var m=a;a=[];for(var v=0,_=m.length;v<_;v++)m[v]();i=e&&a.length,i&&e(f)}return function(m){a.push(m),e?i||(e(f),i=!0):h||(h=setInterval(f,1e3/60))}};var ut=u.extend(d,{_class:"View",initialize:function e(i,a){function h(z){return a[z]||parseInt(a.getAttribute(z),10)}function f(){var z=st.getSize(a);return z.isNaN()||z.isZero()?new X(h("width"),h("height")):z}var m;if(l&&a){this._id=a.getAttribute("id"),this._id==null&&a.setAttribute("id",this._id="paper-view-"+e._id++),ot.add(a,this._viewEvents);var v="none";if(st.setPrefixed(a.style,{userDrag:v,userSelect:v,touchCallout:v,contentZooming:v,tapHighlightColor:"rgba(0,0,0,0)"}),g.hasAttribute(a,"resize")){var _=this;ot.add(l,this._windowEvents={resize:function(){_.setViewSize(f())}})}if(m=f(),g.hasAttribute(a,"stats")&&typeof Stats<"u"){this._stats=new Stats;var y=this._stats.domElement,b=y.style,T=st.getOffset(a);b.position="absolute",b.left=T.x+"px",b.top=T.y+"px",c.body.appendChild(y)}}else m=new X(a),a=null;this._project=i,this._scope=i._scope,this._element=a,this._pixelRatio||(this._pixelRatio=l&&l.devicePixelRatio||1),this._setElementSize(m.width,m.height),this._viewSize=m,e._views.push(this),e._viewsById[this._id]=this,(this._matrix=new re)._owner=this,e._focused||(e._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!$e.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;ut._focused===this&&(ut._focused=null),ut._views.splice(ut._views.indexOf(this),1),delete ut._viewsById[this._id];var e=this._project;return e._view===this&&(e._view=null),ot.remove(this._element,this._viewEvents),ot.remove(l,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:u.each(M._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(e){this[e]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(e){this._autoUpdate=e,e&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var e=this;ot.requestAnimationFrame(function(){if(e._requested=!1,e._animate){e.requestUpdate();var i=e._element;(!st.getPrefixed(c,"hidden")||g.getAttribute(i,"keepalive")==="true")&&st.isInView(i)&&e._handleFrame()}e._autoUpdate&&e.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){$e=this._scope;var e=Date.now()/1e3,i=this._last?e-this._last:0;this._last=e,this.emit("frame",new u({delta:i,time:this._time+=i,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(e,i){var a=this._frameItems;i?(a[e._id]={item:e,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete a[e._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(e){for(var i in this._frameItems){var a=this._frameItems[i];a.item.emit("frame",new u(e,{time:a.time+=e.delta,count:a.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=r},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var e=this._viewSize;return new j(e.width,e.height,this,"setViewSize")},setViewSize:function(){var e=X.read(arguments),i=e.subtract(this._viewSize);i.isZero()||(this._setElementSize(e.width,e.height),this._viewSize.set(e),this._changed(),this.emit("resize",{size:e,delta:i}),this._autoUpdate&&this.update())},_setElementSize:function(e,i){var a=this._element;a&&(a.width!==e&&(a.width=e),a.height!==i&&(a.height=i))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new $(new E,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return st.isInView(this._element)},isInserted:function(){return st.isInserted(this._element)},getPixelSize:function(e){var i=this._element,a;if(i){var h=i.parentNode,f=c.createElement("div");f.style.fontSize=e,h.appendChild(f),a=parseFloat(st.getStyles(f).fontSize),h.removeChild(f)}else a=parseFloat(a);return a},getTextWidth:function(e,i){return 0}},u.each(["rotate","scale","shear","skew"],function(e){var i=e==="rotate";this[e]=function(){var a=arguments,h=(i?u:E).read(a),f=E.read(a,0,{readNull:!0});return this.transform(new re()[e](h,f||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var e=new re;return this.transform(e.translate.apply(e,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var e=E.read(arguments);this.translate(this.getCenter().subtract(e))},getZoom:function(){var e=this._decompose().scaling;return(e.x+e.y)/2},setZoom:function(e){this.transform(new re().scale(e/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(e){var i=this.getRotation();i!=null&&e!=null&&this.rotate(e-i)},getScaling:function(){var e=this._decompose().scaling;return new Q(e.x,e.y,this,"setScaling")},setScaling:function(){var e=this.getScaling(),i=E.read(arguments,0,{clone:!0,readNull:!0});e&&i&&this.scale(i.x/e.x,i.y/e.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},transform:function(e){this._matrix.append(e)},scrollBy:function(){this.translate(E.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(E.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(E.read(arguments))},getEventPoint:function(e){return this.viewToProject(ot.getOffset(e,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(e,i){c&&typeof i=="string"&&(i=c.getElementById(i));var a=l?On:ut;return new a(e,i)}}},new function(){if(!l)return;var e,i,a=!1,h=!1;function f(W){var te=ot.getTarget(W);return te.getAttribute&&ut._viewsById[te.getAttribute("id")]}function m(){var W=ut._focused;if(!W||!W.isVisible()){for(var te=0,ne=ut._views.length;te<ne;te++)if((W=ut._views[te]).isVisible()){ut._focused=i=W;break}}}function v(W,te,ne){W._handleMouseEvent("mousemove",te,ne)}var _=l.navigator,y,b,T;_.pointerEnabled||_.msPointerEnabled?(y="pointerdown MSPointerDown",b="pointermove MSPointerMove",T="pointerup pointercancel MSPointerUp MSPointerCancel"):(y="touchstart",b="touchmove",T="touchend touchcancel","ontouchstart"in l&&_.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(y+=" mousedown",b+=" mousemove",T+=" mouseup"));var z={},P={mouseout:function(W){var te=ut._focused,ne=ot.getRelatedTarget(W);if(te&&(!ne||ne.nodeName==="HTML")){var ae=ot.getOffset(W,te._element),oe=ae.x,ce=Math.abs,we=ce(oe),Ee=1<<25,Me=we-Ee;ae.x=ce(Me)<we?Me*(oe<0?-1:1):oe,v(te,W,te.viewToProject(ae))}},scroll:m};z[y]=function(W){var te=ut._focused=f(W);a||(a=!0,te._handleMouseEvent("mousedown",W))},P[b]=function(W){var te=ut._focused;if(!h){var ne=f(W);ne?te!==ne&&(te&&v(te,W),e||(e=te),te=ut._focused=i=ne):i&&i===te&&(e&&!e.isInserted()&&(e=null),te=ut._focused=e,e=null,m())}te&&v(te,W)},P[y]=function(){h=!0},P[T]=function(W){var te=ut._focused;te&&a&&te._handleMouseEvent("mouseup",W),h=a=!1},ot.add(c,P),ot.add(l,{load:m});var S=!1,B=!1,O={doubleclick:"click",mousedrag:"mousemove"},V=!1,k,R,w,N,U,H,D,G;function K(W,te,ne,ae,oe,ce,we){var Ee=!1,Me;function Ne(ve,xe){if(ve.responds(xe)){if(Me||(Me=new Rn(xe,ae,oe,te||ve,ce?oe.subtract(ce):null)),ve.emit(xe,Me)&&(S=!0,Me.prevented&&(B=!0),Me.stopped))return Ee=!0}else{var ze=O[xe];if(ze)return Ne(ve,ze)}}for(;W&&W!==we&&!Ne(W,ne);)W=W._parent;return Ee}function Y(W,te,ne,ae,oe,ce){return W._project.removeOn(ne),B=S=!1,U&&K(U,null,ne,ae,oe,ce)||te&&te!==U&&!te.isDescendant(U)&&K(te,null,ne==="mousedrag"?"mousemove":ne,ae,oe,ce,U)||K(W,U||te||W,ne,ae,oe,ce)}var ie={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:z,_handleMouseEvent:function(W,te,ne){var ae=this._itemEvents,oe=ae.native[W],ce=W==="mousemove",we=this._scope.tool,Ee=this;function Me(Be){return ae.virtual[Be]||Ee.responds(Be)||we&&we.responds(Be)}ce&&a&&Me("mousedrag")&&(W="mousedrag"),ne||(ne=this.getEventPoint(te));var Ne=this.getBounds().contains(ne),ve=oe&&Ne&&Ee._project.hitTest(ne,{tolerance:0,fill:!0,stroke:!0}),xe=ve&&ve.item||null,ze=!1,De={};if(De[W.substr(5)]=!0,oe&&xe!==N&&(N&&K(N,null,"mouseleave",te,ne),xe&&K(xe,null,"mouseenter",te,ne),N=xe),V^Ne&&(K(this,null,Ne?"mouseenter":"mouseleave",te,ne),ze=!0),(Ne||De.drag)&&!ne.equals(R)&&(Y(this,xe,ce?W:"mousemove",te,ne,R),ze=!0),V=Ne,De.down&&Ne||De.up&&k){if(Y(this,xe,W,te,ne,k),De.down){if(G=xe===H&&Date.now()-D<300,w=H=xe,!B&&xe){for(var Re=xe;Re&&!Re.responds("mousedrag");)Re=Re._parent;Re&&(U=xe)}k=ne}else De.up&&(!B&&xe===w&&(D=Date.now(),Y(this,xe,G?"doubleclick":"click",te,ne,k),G=!1),w=U=null);V=!1,ze=!0}R=ne,ze&&we&&(S=we._handleMouseEvent(W,te,ne,De)||S),te.cancelable!==!1&&(S&&!De.move||De.down&&Me("mouseup"))&&te.preventDefault()},_handleKeyEvent:function(W,te,ne,ae){var oe=this._scope,ce=oe.tool,we;function Ee(Me){Me.responds(W)&&($e=oe,Me.emit(W,we=we||new Nn(W,te,ne,ae)))}this.isVisible()&&(Ee(this),ce&&ce.responds(W)&&Ee(ce))},_countItemEvent:function(W,te){var ne=this._itemEvents,ae=ne.native,oe=ne.virtual;for(var ce in ie)ae[ce]=(ae[ce]||0)+(ie[ce][W]||0)*te;oe[W]=(oe[W]||0)+te},statics:{updateFocus:m,_resetState:function(){a=h=S=V=!1,e=i=k=R=w=N=U=H=D=G=null}}}}),On=ut.extend({_class:"CanvasView",initialize:function(i,a){if(!(a instanceof l.HTMLCanvasElement)){var h=X.read(arguments,1);if(h.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+u.slice(arguments,1));a=dt.getCanvas(h)}var f=this._context=a.getContext("2d");if(f.save(),this._pixelRatio=1,!/^off|false$/.test(g.getAttribute(a,"hidpi"))){var m=l.devicePixelRatio||1,v=st.getPrefixed(f,"backingStorePixelRatio")||1;this._pixelRatio=m/v}ut.call(this,i,a),this._needsUpdate=!0},remove:function e(){return this._context.restore(),e.base.call(this)},_setElementSize:function e(i,a){var h=this._pixelRatio;if(e.base.call(this,i*h,a*h),h!==1){var f=this._element,m=this._context;if(!g.hasAttribute(f,"resize")){var v=f.style;v.width=i+"px",v.height=a+"px"}m.restore(),m.save(),m.scale(h,h)}},getContext:function(){return this._context},getPixelSize:function e(i){var a=$e.agent,h;if(a&&a.firefox)h=e.base.call(this,i);else{var f=this._context,m=f.font;f.font=i+" serif",h=parseFloat(f.font),f.font=m}return h},getTextWidth:function(e,i){var a=this._context,h=a.font,f=0;a.font=e;for(var m=0,v=i.length;m<v;m++)f=Math.max(f,a.measureText(i[m]).width);return a.font=h,f},update:function(){if(!this._needsUpdate)return!1;var e=this._project,i=this._context,a=this._viewSize;return i.clearRect(0,0,a.width+1,a.height+1),e&&e.draw(i,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),oi=u.extend({_class:"Event",initialize:function(i){this.event=i,this.type=i&&i.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return _i.modifiers}}),Nn=oi.extend({_class:"KeyEvent",initialize:function(i,a,h,f){this.type=i,this.event=a,this.key=h,this.character=f},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),_i=new function(){var e={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},i={tab:"	",space:" ",enter:"\r"},a={},h={},f,m,v=new u({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var b=$e&&$e.agent;return b&&b.mac?this.meta:this.control}}});function _(b){var T=b.key||b.keyIdentifier;return T=/^U\+/.test(T)?String.fromCharCode(parseInt(T.substr(2),16)):/^Arrow[A-Z]/.test(T)?T.substr(5):T==="Unidentified"||T===r?String.fromCharCode(b.keyCode):T,e[T]||(T.length>1?u.hyphenate(T):T.toLowerCase())}function y(b,T,z,P){var S=ut._focused,B;if(a[T]=b,b?h[T]=z:delete h[T],T.length>1&&(B=u.camelize(T))in v){v[B]=b;var O=$e&&$e.agent;if(B==="meta"&&O&&O.mac)if(b)f={};else{for(var V in f)V in h&&y(!1,V,f[V],P);f=null}}else b&&f&&(f[T]=z);S&&S._handleKeyEvent(b?"keydown":"keyup",P,T,z)}return ot.add(c,{keydown:function(b){var T=_(b),z=$e&&$e.agent;T.length>1||z&&z.chrome&&(b.altKey||z.mac&&b.metaKey||!z.mac&&b.ctrlKey)?y(!0,T,i[T]||(T.length>1?"":T),b):m=T},keypress:function(b){if(m){var T=_(b),z=b.charCode,P=z>=32?String.fromCharCode(z):T.length>1?"":T;T!==m&&(T=P.toLowerCase()),y(!0,T,P,b),m=null}},keyup:function(b){var T=_(b);T in h&&y(!1,T,h[T],b)}}),ot.add(l,{blur:function(b){for(var T in h)y(!1,T,h[T],b)}}),{modifiers:v,isDown:function(b){return!!a[b]}}},Rn=oi.extend({_class:"MouseEvent",initialize:function(i,a,h,f,m){this.type=i,this.event=a,this.point=h,this.target=f,this.delta=m},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Jt=oi.extend({_class:"ToolEvent",_item:null,initialize:function(i,a,h){this.tool=i,this.type=a,this.event=h},_choosePoint:function(e,i){return e||(i?i.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(e){this._point=e},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(e){this._lastPoint=e},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(e){this._downPoint=e},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(e){this._middlePoint=e},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(e){this._delta=e},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(e){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=e},getItem:function(){if(!this._item){var e=this.tool._scope.project.hitTest(this.getPoint());if(e){for(var i=e.item,a=i._parent;/^(Group|CompoundPath)$/.test(a._class);)i=a,a=a._parent;this._item=i}}return this._item},setItem:function(e){this._item=e},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),yi=x.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(i){x.call(this),this._moveCount=-1,this._downCount=-1,this.set(i)},getMinDistance:function(){return this._minDistance},setMinDistance:function(e){this._minDistance=e,e!=null&&this._maxDistance!=null&&e>this._maxDistance&&(this._maxDistance=e)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(e){this._maxDistance=e,this._minDistance!=null&&e!=null&&e<this._minDistance&&(this._minDistance=e)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(e){this._minDistance=this._maxDistance=e},_handleMouseEvent:function(e,i,a,h){$e=this._scope,h.drag&&!this.responds(e)&&(e="mousemove");var f=h.move||h.drag,m=this.responds(e),v=!1,_=this;function y(T,z){var P=a,S=f?_._point:_._downPoint||P;if(f){if(_._moveCount>=0&&P.equals(S))return!1;if(S&&(T!=null||z!=null)){var B=P.subtract(S),O=B.getLength();if(O<(T||0))return!1;z&&(P=S.add(B.normalize(Math.min(O,z))))}_._moveCount++}return _._point=P,_._lastPoint=S||P,h.down&&(_._moveCount=-1,_._downPoint=P,_._downCount++),!0}function b(){m&&(v=_.emit(e,new Jt(_,e,i))||v)}if(h.down)y(),b();else if(h.up)y(null,this._maxDistance),b();else if(m)for(;y(this._minDistance,this._maxDistance);)b();return v}}),Ni=u.extend(d,{_class:"Tween",statics:{easings:new u({linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:-1+2*(2-e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}})},initialize:function e(i,a,h,f,m,v){this.object=i;var _=typeof m,y=_==="function";this.type=y?_:_==="string"?m:"linear",this.easing=y?m:e.easings[this.type],this.duration=f,this.running=!1,this._then=null,this._startTime=null;var b=a||h;this._keys=b?Object.keys(b):[],this._parsedKeys=this._parseKeys(this._keys),this._from=b&&this._getState(a),this._to=b&&this._getState(h),v!==!1&&this.start()},then:function(e){return this._then=e,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(e){if(this.running){e>=1&&(e=1,this.running=!1);for(var i=this.easing(e),a=this._keys,h=function(T){return typeof T=="function"?T(i,e):T},f=0,m=a&&a.length;f<m;f++){var v=a[f],_=h(this._from[v]),y=h(this._to[v]),b=_&&y&&_.__add&&y.__add?y.__subtract(_).__multiply(i).__add(_):(y-_)*i+_;this._setProperty(this._parsedKeys[v],b)}this.responds("update")&&this.emit("update",new u({progress:e,factor:i})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(e){var i=this._startTime,a=i?(e-i)/this.duration:0;i||(this._startTime=e),this.update(a)},_getState:function(e){for(var i=this._keys,a={},h=0,f=i.length;h<f;h++){var m=i[h],v=this._parsedKeys[m],_=this._getProperty(v),y;if(e){var b=this._resolveValue(_,e[m]);this._setProperty(v,b),y=this._getProperty(v),y=y&&y.clone?y.clone():y,this._setProperty(v,_)}else y=_&&_.clone?_.clone():_;a[m]=y}return a},_resolveValue:function(e,i){if(i){if(Array.isArray(i)&&i.length===2){var a=i[0];return a&&a.match&&a.match(/^[+\-\*\/]=/)?this._calculate(e,a[0],i[1]):i}else if(typeof i=="string"){var h=i.match(/^[+\-*/]=(.*)/);if(h){var f=JSON.parse(h[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(e,i[0],f)}}}return i},_calculate:function(e,i,a){return $e.PaperScript.calculateBinary(e,i,a)},_parseKeys:function(e){for(var i={},a=0,h=e.length;a<h;a++){var f=e[a],m=f.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");i[f]=m.split("/")}return i},_getProperty:function(e,i){for(var a=this.object,h=0,f=e.length-(i||0);h<f&&a;h++)a=a[e[h]];return a},_setProperty:function(e,i){var a=this._getProperty(e,1);a&&(a[e[e.length-1]]=i)}}),Ri={request:function(e){var i=new s.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,u.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var a=i.status;a===0||a===200?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var a=i.status,h='Could not load "'+e.url+'" (Status: '+a+")";if(e.onError)e.onError(h,a);else throw new Error(h)},i.send(null)}},dt=u.exports.CanvasProvider={canvases:[],getCanvas:function(e,i,a){if(!l)return null;var h,f=!0;typeof e=="object"&&(i=e.height,e=e.width),this.canvases.length?h=this.canvases.pop():(h=c.createElement("canvas"),f=!1);var m=h.getContext("2d",a||{});if(!m)throw new Error("Canvas "+h+" is unable to provide a 2D context.");return h.width===e&&h.height===i?f&&m.clearRect(0,0,e+1,i+1):(h.width=e,h.height=i),m.save(),h},getContext:function(e,i,a){var h=this.getCanvas(e,i,a);return h?h.getContext("2d",a||{}):null},release:function(e){var i=e&&e.canvas?e.canvas:e;i&&i.getContext&&(i.getContext("2d").restore(),this.canvases.push(i))}},xi=new function(){var e=Math.min,i=Math.max,a=Math.abs,h,f,m,v,_,y,b,T,z,P,S;function B(U,H,D){return .2989*U+.587*H+.114*D}function O(U,H,D,Y){var K=Y-B(U,H,D);z=U+K,P=H+K,S=D+K;var Y=B(z,P,S),ie=e(z,P,S),W=i(z,P,S);if(ie<0){var te=Y-ie;z=Y+(z-Y)*Y/te,P=Y+(P-Y)*Y/te,S=Y+(S-Y)*Y/te}if(W>255){var ne=255-Y,ae=W-Y;z=Y+(z-Y)*ne/ae,P=Y+(P-Y)*ne/ae,S=Y+(S-Y)*ne/ae}}function V(U,H,D){return i(U,H,D)-e(U,H,D)}function k(U,H,D,G){var K=[U,H,D],Y=i(U,H,D),ie=e(U,H,D),W;ie=ie===U?0:ie===H?1:2,Y=Y===U?0:Y===H?1:2,W=e(ie,Y)===0?i(ie,Y)===1?2:1:0,K[Y]>K[ie]?(K[W]=(K[W]-K[ie])*G/(K[Y]-K[ie]),K[Y]=G):K[W]=K[Y]=0,K[ie]=0,z=K[0],P=K[1],S=K[2]}var R={multiply:function(){z=_*h/255,P=y*f/255,S=b*m/255},screen:function(){z=_+h-_*h/255,P=y+f-y*f/255,S=b+m-b*m/255},overlay:function(){z=_<128?2*_*h/255:255-2*(255-_)*(255-h)/255,P=y<128?2*y*f/255:255-2*(255-y)*(255-f)/255,S=b<128?2*b*m/255:255-2*(255-b)*(255-m)/255},"soft-light":function(){var U=h*_/255;z=U+_*(255-(255-_)*(255-h)/255-U)/255,U=f*y/255,P=U+y*(255-(255-y)*(255-f)/255-U)/255,U=m*b/255,S=U+b*(255-(255-b)*(255-m)/255-U)/255},"hard-light":function(){z=h<128?2*h*_/255:255-2*(255-h)*(255-_)/255,P=f<128?2*f*y/255:255-2*(255-f)*(255-y)/255,S=m<128?2*m*b/255:255-2*(255-m)*(255-b)/255},"color-dodge":function(){z=_===0?0:h===255?255:e(255,255*_/(255-h)),P=y===0?0:f===255?255:e(255,255*y/(255-f)),S=b===0?0:m===255?255:e(255,255*b/(255-m))},"color-burn":function(){z=_===255?255:h===0?0:i(0,255-(255-_)*255/h),P=y===255?255:f===0?0:i(0,255-(255-y)*255/f),S=b===255?255:m===0?0:i(0,255-(255-b)*255/m)},darken:function(){z=_<h?_:h,P=y<f?y:f,S=b<m?b:m},lighten:function(){z=_>h?_:h,P=y>f?y:f,S=b>m?b:m},difference:function(){z=_-h,z<0&&(z=-z),P=y-f,P<0&&(P=-P),S=b-m,S<0&&(S=-S)},exclusion:function(){z=_+h*(255-_-_)/255,P=y+f*(255-y-y)/255,S=b+m*(255-b-b)/255},hue:function(){k(h,f,m,V(_,y,b)),O(z,P,S,B(_,y,b))},saturation:function(){k(_,y,b,V(h,f,m)),O(z,P,S,B(_,y,b))},luminosity:function(){O(_,y,b,B(h,f,m))},color:function(){O(h,f,m,B(_,y,b))},add:function(){z=e(_+h,255),P=e(y+f,255),S=e(b+m,255)},subtract:function(){z=i(_-h,0),P=i(y-f,0),S=i(b-m,0)},average:function(){z=(_+h)/2,P=(y+f)/2,S=(b+m)/2},negation:function(){z=255-a(255-h-_),P=255-a(255-f-y),S=255-a(255-m-b)}},w=this.nativeModes=u.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(U){this[U]=!0},{}),N=dt.getContext(1,1,{willReadFrequently:!0});N&&(u.each(R,function(U,H){var D=H==="darken",G=!1;N.save();try{N.fillStyle=D?"#300":"#a00",N.fillRect(0,0,1,1),N.globalCompositeOperation=H,N.globalCompositeOperation===H&&(N.fillStyle=D?"#a00":"#300",N.fillRect(0,0,1,1),G=N.getImageData(0,0,1,1).data[0]!==D?170:51)}catch{}N.restore(),w[H]=G}),dt.release(N)),this.process=function(U,H,D,G,K){var Y=H.canvas,ie=U==="normal";if(ie||w[U])D.save(),D.setTransform(1,0,0,1,0,0),D.globalAlpha=G,ie||(D.globalCompositeOperation=U),D.drawImage(Y,K.x,K.y),D.restore();else{var W=R[U];if(!W)return;for(var te=D.getImageData(K.x,K.y,Y.width,Y.height),ne=te.data,ae=H.getImageData(0,0,Y.width,Y.height).data,oe=0,ce=ne.length;oe<ce;oe+=4){h=ae[oe],_=ne[oe],f=ae[oe+1],y=ne[oe+1],m=ae[oe+2],b=ne[oe+2],v=ae[oe+3],T=ne[oe+3],W();var we=v*G/255,Ee=1-we;ne[oe]=we*z+Ee*_,ne[oe+1]=we*P+Ee*y,ne[oe+2]=we*S+Ee*b,ne[oe+3]=v*G+Ee*T}D.putImageData(te,K.x,K.y)}}},it=new function(){var e="http://www.w3.org/2000/svg",i="http://www.w3.org/2000/xmlns",a="http://www.w3.org/1999/xlink",h={href:a,xlink:i,xmlns:i+"/","xmlns:xlink":i+"/"};function f(_,y,b){return v(c.createElementNS(e,_),y,b)}function m(_,y){var b=h[y],T=b?_.getAttributeNS(b,y):_.getAttribute(y);return T==="null"?null:T}function v(_,y,b){for(var T in y){var z=y[T],P=h[T];typeof z=="number"&&b&&(z=b.number(z)),P?_.setAttributeNS(P,T,z):_.setAttribute(T,z)}return _}return{svg:e,xmlns:i,xlink:a,create:f,get:m,set:v}},Qi=u.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(e,i){return!i&&(e instanceof rt||e instanceof pe||e instanceof $t)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(e,i){var a=u.capitalize(i),h=e[2];this[i]={type:e[1],property:i,attribute:e[0],toSVG:h,fromSVG:h&&u.each(h,function(f,m){this[f]=m},{}),exportFilter:e[3],get:"get"+a,set:"set"+a}},{});new function(){var e;function i(R,w,N){var U=new u,H=R.getTranslation();if(w){var D;R.isInvertible()?(R=R._shiftless(),D=R._inverseTransform(H),H=null):D=new E,U[N?"cx":"x"]=D.x,U[N?"cy":"y"]=D.y}if(!R.isIdentity()){var G=R.decompose();if(G){var K=[],Y=G.rotation,ie=G.scaling,W=G.skewing;H&&!H.isZero()&&K.push("translate("+e.point(H)+")"),Y&&K.push("rotate("+e.number(Y)+")"),(!A.isZero(ie.x-1)||!A.isZero(ie.y-1))&&K.push("scale("+e.point(ie)+")"),W.x&&K.push("skewX("+e.number(W.x)+")"),W.y&&K.push("skewY("+e.number(W.y)+")"),U.transform=K.join(" ")}else U.transform="matrix("+R.getValues().join(",")+")"}return U}function a(R,w){for(var N=i(R._matrix),U=R._children,H=it.create("g",N,e),D=0,G=U.length;D<G;D++){var K=U[D],Y=V(K,w);if(Y)if(K.isClipMask()){var ie=it.create("clipPath");ie.appendChild(Y),B(K,ie,"clip"),it.set(H,{"clip-path":"url(#"+ie.id+")"})}else H.appendChild(Y)}return H}function h(R,w){var N=i(R._matrix,!0),U=R.getSize(),H=R.getImage();return N.x-=U.width/2,N.y-=U.height/2,N.width=U.width,N.height=U.height,N.href=w.embedImages==!1&&H&&H.src||R.toDataURL(),it.create("image",N,e)}function f(R,w){var N=w.matchShapes;if(N){var U=R.toShape(!1);if(U)return m(U)}var H=R._segments,D=H.length,G,K=i(R._matrix);if(N&&D>=2&&!R.hasHandles())if(D>2){G=R._closed?"polygon":"polyline";for(var Y=[],ie=0;ie<D;ie++)Y.push(e.point(H[ie]._point));K.points=Y.join(" ")}else{G="line";var W=H[0]._point,te=H[1]._point;K.set({x1:W.x,y1:W.y,x2:te.x,y2:te.y})}else G="path",K.d=R.getPathData(null,w.precision);return it.create(G,K,e)}function m(R){var w=R._type,N=R._radius,U=i(R._matrix,!0,w!=="rectangle");if(w==="rectangle"){w="rect";var H=R._size,D=H.width,G=H.height;U.x-=D/2,U.y-=G/2,U.width=D,U.height=G,N.isZero()&&(N=null)}return N&&(w==="circle"?U.r=N:(U.rx=N.width,U.ry=N.height)),it.create(w,U,e)}function v(R,w){var N=i(R._matrix),U=R.getPathData(null,w.precision);return U&&(N.d=U),it.create("path",N,e)}function _(R,w){var N=i(R._matrix,!0),U=R._definition,H=S(U,"symbol"),D=U._item,G=D.getStrokeBounds();return H||(H=it.create("symbol",{viewBox:e.rectangle(G)}),H.appendChild(V(D,w)),B(U,H,"symbol")),N.href="#"+H.id,N.x+=G.x,N.y+=G.y,N.width=G.width,N.height=G.height,N.overflow="visible",it.create("use",N,e)}function y(R){var w=S(R,"color");if(!w){var N=R.getGradient(),U=N._radial,H=R.getOrigin(),D=R.getDestination(),G;if(U){G={cx:H.x,cy:H.y,r:H.getDistance(D)};var K=R.getHighlight();K&&(G.fx=K.x,G.fy=K.y)}else G={x1:H.x,y1:H.y,x2:D.x,y2:D.y};G.gradientUnits="userSpaceOnUse",w=it.create((U?"radial":"linear")+"Gradient",G,e);for(var Y=N._stops,ie=0,W=Y.length;ie<W;ie++){var te=Y[ie],ne=te._color,ae=ne.getAlpha(),oe=te._offset;G={offset:oe??ie/(W-1)},ne&&(G["stop-color"]=ne.toCSS(!0)),ae<1&&(G["stop-opacity"]=ae),w.appendChild(it.create("stop",G,e))}B(R,w,"color")}return"url(#"+w.id+")"}function b(R){var w=it.create("text",i(R._matrix,!0),e);return w.textContent=R._content,w}var T={Group:a,Layer:a,Raster:h,Path:f,Shape:m,CompoundPath:v,SymbolItem:_,PointText:b};function z(R,w,N,U){var H={},D=!U&&R.getParent(),G=[];return R._name!=null&&(H.id=R._name),u.each(Qi,function(K){var Y=K.get,ie=K.type,W=R[Y]();if(K.exportFilter?K.exportFilter(R,W):N.reduceAttributes==!1||!D||!u.equals(D[Y](),W)){if(ie==="color"&&W!=null){var te=W.getAlpha();te<1&&(H[K.attribute+"-opacity"]=te)}ie==="style"?G.push(K.attribute+": "+W):H[K.attribute]=W==null?"none":ie==="color"?W.gradient?y(W):W.toCSS(!0):ie==="array"?W.join(","):ie==="lookup"?K.toSVG[W]:W}}),G.length&&(H.style=G.join(";")),H.opacity===1&&delete H.opacity,R._visible||(H.visibility="hidden"),it.set(w,H,e)}var P;function S(R,w){return P||(P={ids:{},svgs:{}}),R&&P.svgs[w+"-"+(R._id||R.__id||(R.__id=q.get("svg")))]}function B(R,w,N){P||S();var U=P.ids[N]=(P.ids[N]||0)+1;w.id=N+"-"+U,P.svgs[N+"-"+(R._id||R.__id)]=w}function O(R,w){var N=R,U=null;if(P){N=R.nodeName.toLowerCase()==="svg"&&R;for(var H in P.svgs)U||(N||(N=it.create("svg"),N.appendChild(R)),U=N.insertBefore(it.create("defs"),N.firstChild)),U.appendChild(P.svgs[H]);P=null}return w.asString?new s.XMLSerializer().serializeToString(N):N}function V(R,w,N){var U=T[R._class],H=U&&U(R,w);if(H){var D=w.onExport;D&&(H=D(R,H,w)||H);var G=JSON.stringify(R._data);G&&G!=="{}"&&G!=="null"&&H.setAttribute("data-paper-data",G)}return H&&z(R,H,w,N)}function k(R){return R||(R={}),e=new L(R.precision),R}M.inject({exportSVG:function(R){return R=k(R),O(V(this,R,!0),R)}}),ue.inject({exportSVG:function(R){R=k(R);var w=this._children,N=this.getView(),U=u.pick(R.bounds,"view"),H=R.matrix||U==="view"&&N._matrix,D=H&&re.read([H]),G=U==="view"?new $([0,0],N.getViewSize()):U==="content"?M._getBounds(w,D,{stroke:!0}).rect:$.read([U],0,{readNull:!0}),K={version:"1.1",xmlns:it.svg,"xmlns:xlink":it.xlink};G&&(K.width=G.width,K.height=G.height,(G.x||G.x===0||G.y||G.y===0)&&(K.viewBox=e.rectangle(G)));var Y=it.create("svg",K,e),ie=Y;D&&!D.isIdentity()&&(ie=Y.appendChild(it.create("g",i(D),e)));for(var W=0,te=w.length;W<te;W++)ie.appendChild(V(w[W],R,!0));return O(Y,R)}})},new function(){var e={},i;function a(w,N,U,H,D,G){var K=it.get(w,N)||G,Y=K==null?H?null:U?"":0:U?K:parseFloat(K);return/%\s*$/.test(K)?Y/100*(D?1:i[/x|^width/.test(N)?"width":"height"]):Y}function h(w,N,U,H,D,G,K){return N=a(w,N||"x",!1,H,D,G),U=a(w,U||"y",!1,H,D,K),H&&(N==null||U==null)?null:new E(N,U)}function f(w,N,U,H,D){return N=a(w,N||"width",!1,H,D),U=a(w,U||"height",!1,H,D),H&&(N==null||U==null)?null:new X(N,U)}function m(w,N,U){return w==="none"?null:N==="number"?parseFloat(w):N==="array"?w?w.split(/[\s,]+/g).map(parseFloat):[]:N==="color"?V(w)||w:N==="lookup"?U[w]:w}function v(w,N,U,H){var D=w.childNodes,G=N==="clippath",K=N==="defs",Y=new de,ie=Y._project,W=ie._currentStyle,te=[];if(!G&&!K&&(Y=O(Y,w,H),ie._currentStyle=Y._style.clone()),H)for(var ne=w.querySelectorAll("defs"),ae=0,oe=ne.length;ae<oe;ae++)k(ne[ae],U,!1);for(var ae=0,oe=D.length;ae<oe;ae++){var ce=D[ae],we;ce.nodeType===1&&!/^defs$/i.test(ce.nodeName)&&(we=k(ce,U,!1))&&!(we instanceof Se)&&te.push(we)}return Y.addChildren(te),G&&(Y=O(Y.reduce(),w,H)),ie._currentStyle=W,(G||K)&&(Y.remove(),Y=null),Y}function _(w,N){for(var U=w.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),H=[],D=0,G=U.length;D<G;D+=2)H.push(new E(parseFloat(U[D]),parseFloat(U[D+1])));var K=new Ve(H);return N==="polygon"&&K.closePath(),K}function y(w){return rt.create(w.getAttribute("d"))}function b(w,N){var U=(a(w,"href",!0)||"").substring(1),H=N==="radialgradient",D;if(U)D=e[U].getGradient(),D._radial^H&&(D=D.clone(),D._radial=H);else{for(var G=w.childNodes,K=[],Y=0,ie=G.length;Y<ie;Y++){var W=G[Y];W.nodeType===1&&K.push(O(new $i,W))}D=new vi(K,H)}var te,ne,ae,oe=a(w,"gradientUnits",!0)!=="userSpaceOnUse";H?(te=h(w,"cx","cy",!1,oe,"50%","50%"),ne=te.add(a(w,"r",!1,!1,oe,"50%"),0),ae=h(w,"fx","fy",!0,oe)):(te=h(w,"x1","y1",!1,oe,"0%","0%"),ne=h(w,"x2","y2",!1,oe,"100%","0%"));var ce=O(new ft(D,te,ne,ae),w);return ce._scaleToBounds=oe,null}var T={"#document":function(w,N,U,H){for(var D=w.childNodes,G=0,K=D.length;G<K;G++){var Y=D[G];if(Y.nodeType===1)return k(Y,U,H)}},g:v,svg:v,clippath:v,polygon:_,polyline:_,path:y,lineargradient:b,radialgradient:b,image:function(w){var N=new Ce(a(w,"href",!0));return N.on("load",function(){var U=f(w);this.setSize(U);var H=h(w).add(U.divide(2));this._matrix.append(new re().translate(H))}),N},symbol:function(w,N,U,H){return new Se(v(w,N,U,H),!0)},defs:v,use:function(w){var N=(a(w,"href",!0)||"").substring(1),U=e[N],H=h(w);return U?U instanceof Se?U.place(H):U.clone().translate(H):null},circle:function(w){return new pe.Circle(h(w,"cx","cy"),a(w,"r"))},ellipse:function(w){return new pe.Ellipse({center:h(w,"cx","cy"),radius:f(w,"rx","ry")})},rect:function(w){return new pe.Rectangle(new $(h(w),f(w)),f(w,"rx","ry"))},line:function(w){return new Ve.Line(h(w,"x1","y1"),h(w,"x2","y2"))},text:function(w){var N=new Ki(h(w).add(h(w,"dx","dy")));return N.setContent(w.textContent.trim()||""),N},switch:v};function z(w,N,U,H){if(w.transform){for(var D=(H.getAttribute(U)||"").split(/\)\s*/g),G=new re,K=0,Y=D.length;K<Y;K++){var ie=D[K];if(!ie)break;for(var W=ie.split(/\(\s*/),te=W[0].trim(),ne=W[1].split(/[\s,]+/g),ae=0,oe=ne.length;ae<oe;ae++)ne[ae]=parseFloat(ne[ae]);switch(te){case"matrix":G.append(new re(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5]));break;case"rotate":G.rotate(ne[0],ne[1]||0,ne[2]||0);break;case"translate":G.translate(ne[0],ne[1]||0);break;case"scale":G.scale(ne);break;case"skewX":G.skew(ne[0],0);break;case"skewY":G.skew(0,ne[0]);break}}w.transform(G)}}function P(w,N,U){var H=U==="fill-opacity"?"getFillColor":"getStrokeColor",D=w[H]&&w[H]();D&&D.setAlpha(parseFloat(N))}var S=u.set(u.each(Qi,function(w){this[w.attribute]=function(N,U){if(N[w.set]&&(N[w.set](m(U,w.type,w.fromSVG)),w.type==="color")){var H=N[w.get]();if(H&&H._scaleToBounds){var D=N.getBounds();H.transform(new re().translate(D.getPoint()).scale(D.getSize()))}}}},{}),{id:function(w,N){e[N]=w,w.setName&&w.setName(N)},"clip-path":function(w,N){var U=V(N);if(U)if(U=U.clone(),U.setClipMask(!0),w instanceof de)w.insertChild(0,U);else return new de(U,w)},gradientTransform:z,transform:z,"fill-opacity":P,"stroke-opacity":P,visibility:function(w,N){w.setVisible&&w.setVisible(N==="visible")},display:function(w,N){w.setVisible&&w.setVisible(N!==null)},"stop-color":function(w,N){w.setColor&&w.setColor(N)},"stop-opacity":function(w,N){w._color&&w._color.setAlpha(parseFloat(N))},offset:function(w,N){if(w.setOffset){var U=N.match(/(.*)%$/);w.setOffset(U?U[1]/100:parseFloat(N))}},viewBox:function(w,N,U,H,D){var G=new $(m(N,"array")),K=f(H,null,null,!0),Y,ie;if(w instanceof de){var W=K?K.divide(G.getSize()):1,ie=new re().scale(W).translate(G.getPoint().negate());Y=w}else w instanceof Se&&(K&&G.setSize(K),Y=w._item);if(Y){if(B(H,"overflow",D)!=="visible"){var te=new pe.Rectangle(G);te.setClipMask(!0),Y.addChild(te)}ie&&Y.transform(ie)}}});function B(w,N,U){var H=w.attributes[N],D=H&&H.value;if(!D&&w.style){var G=u.camelize(N);D=w.style[G],!D&&U.node[G]!==U.parent[G]&&(D=U.node[G])}return D?D==="none"?null:D:r}function O(w,N,U){var H=N.parentNode,D={node:st.getStyles(N)||{},parent:!U&&!/^defs$/i.test(H.tagName)&&st.getStyles(H)||{}};return u.each(S,function(G,K){var Y=B(N,K,D);w=Y!==r&&G(w,Y,K,N,D)||w}),w}function V(w){var N=w&&w.match(/\((?:["'#]*)([^"')]+)/),U=N&&N[1],H=U&&e[l?U.replace(l.location.href.split("#")[0]+"#",""):U];return H&&H._scaleToBounds&&(H=H.clone(),H._scaleToBounds=!0),H}function k(w,N,U){var H=w.nodeName.toLowerCase(),D=H!=="#document",G=c.body,K,Y,ie;U&&D&&(i=$e.getView().getSize(),i=f(w,null,null,!0)||i,K=it.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),Y=w.parentNode,ie=w.nextSibling,K.appendChild(w),G.appendChild(K));var W=$e.settings,te=W.applyMatrix,ne=W.insertItems;W.applyMatrix=!1,W.insertItems=!1;var ae=T[H],oe=ae&&ae(w,H,N,U)||null;if(W.insertItems=ne,W.applyMatrix=te,oe){D&&!(oe instanceof de)&&(oe=O(oe,w,U));var ce=N.onImport,we=D&&w.getAttribute("data-paper-data");ce&&(oe=ce(w,oe,N)||oe),N.expandShapes&&oe instanceof pe&&(oe.remove(),oe=oe.toPath()),we&&(oe._data=JSON.parse(we))}return K&&(G.removeChild(K),Y&&(ie?Y.insertBefore(w,ie):Y.appendChild(w))),U&&(e={},oe&&u.pick(N.applyMatrix,te)&&oe.matrix.apply(!0,!0)),oe}function R(w,N,U){if(!w)return null;N=typeof N=="function"?{onLoad:N}:N||{};var H=$e,D=null;function G(W){try{var te=typeof W=="object"?W:new s.DOMParser().parseFromString(W.trim(),"image/svg+xml");if(!te.nodeName)throw te=null,new Error("Unsupported SVG source: "+w);$e=H,D=k(te,N,!0),(!N||N.insert!==!1)&&U._insertItem(r,D);var ne=N.onLoad;ne&&ne(D,W)}catch(ae){K(ae)}}function K(W,te){var ne=N.onError;if(ne)ne(W,te);else throw new Error(W)}if(typeof w=="string"&&!/^[\s\S]*</.test(w)){var Y=c.getElementById(w);Y?G(Y):Ri.request({url:w,async:!0,onLoad:G,onError:K})}else if(typeof File<"u"&&w instanceof File){var ie=new FileReader;return ie.onload=function(){G(ie.result)},ie.onerror=function(){K(ie.error)},ie.readAsText(w)}else G(w);return D}M.inject({importSVG:function(w,N){return R(w,N,this)}}),ue.inject({importSVG:function(w,N){return this.activate(),R(w,N,this)}})},u.exports.PaperScript=(function(){var e=this,i=e.acorn;if(!i&&typeof wo<"u")try{i=ko()}catch{}if(!i){var a,h;i=a=h={},(function(O,V){if(typeof a=="object"&&typeof h=="object")return V(a);if(typeof r=="function"&&r.amd)return r(["exports"],V);V(O.acorn||(O.acorn={}))})(this,function(O){O.version="0.5.0";var V,k,R,w;O.parse=function(ee,se){return k=String(ee),R=k.length,U(se),ds(),no(V.program)};var N=O.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function U(ee){V=ee||{};for(var se in N)Object.prototype.hasOwnProperty.call(V,se)||(V[se]=N[se]);w=V.sourceFile||null}var H=O.getLineInfo=function(ee,se){for(var ge=1,be=0;;){Vi.lastIndex=be;var qe=Vi.exec(ee);if(qe&&qe.index<se)++ge,be=qe.index+qe[0].length;else break}return{line:ge,column:se-be}};O.tokenize=function(ee,se){k=String(ee),R=k.length,U(se),ds();var ge={};function be(qe){return we=K,Pi(qe),ge.start=G,ge.end=K,ge.startLoc=Y,ge.endLoc=ie,ge.type=W,ge.value=te,ge}return be.jumpTo=function(qe,je){if(D=qe,V.locations){ae=1,oe=Vi.lastIndex=0;for(var Ze;(Ze=Vi.exec(k))&&Ze.index<qe;)++ae,oe=Ze.index+Ze[0].length}ne=je,Fi()},be};var D,G,K,Y,ie,W,te,ne,ae,oe,ce,we,Ee,Me,Ne,ve;function xe(ee,se){var ge=H(k,ee);se+=" ("+ge.line+":"+ge.column+")";var be=new SyntaxError(se);throw be.pos=ee,be.loc=ge,be.raisedAt=D,be}var ze=[],De={type:"num"},Re={type:"regexp"},Be={type:"string"},Fe={type:"name"},Ge={type:"eof"},Xe={keyword:"break"},Ue={keyword:"case",beforeExpr:!0},vt={keyword:"catch"},pt={keyword:"continue"},xt={keyword:"debugger"},gt={keyword:"default"},Ae={keyword:"do",isLoop:!0},lt={keyword:"else",beforeExpr:!0},ht={keyword:"finally"},_t={keyword:"for",isLoop:!0},Ot={keyword:"function"},Gt={keyword:"if"},Rt={keyword:"return",beforeExpr:!0},Dt={keyword:"switch"},Pt={keyword:"throw",beforeExpr:!0},Mt={keyword:"try"},jt={keyword:"var"},yt={keyword:"while",isLoop:!0},kt={keyword:"with"},Dn={keyword:"new",beforeExpr:!0},Ji={keyword:"this"},Vn={keyword:"null",atomValue:null},Fn={keyword:"true",atomValue:!0},Bn={keyword:"false",atomValue:!1},Di={keyword:"in",binop:7,beforeExpr:!0},ui={break:Xe,case:Ue,catch:vt,continue:pt,debugger:xt,default:gt,do:Ae,else:lt,finally:ht,for:_t,function:Ot,if:Gt,return:Rt,switch:Dt,throw:Pt,try:Mt,var:jt,while:yt,with:kt,null:Vn,true:Fn,false:Bn,new:Dn,in:Di,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:Ji,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},bi={type:"[",beforeExpr:!0},wi={type:"]"},ei={type:"{",beforeExpr:!0},Ut={type:"}"},We={type:"(",beforeExpr:!0},Vt={type:")"},qt={type:",",beforeExpr:!0},Ft={type:";",beforeExpr:!0},ti={type:":",beforeExpr:!0},en={type:"."},tn={type:"?",beforeExpr:!0},nn={binop:10,beforeExpr:!0},n={isAssign:!0,beforeExpr:!0},p={isAssign:!0,beforeExpr:!0},I={postfix:!0,prefix:!0,isUpdate:!0},F={prefix:!0,beforeExpr:!0},Z={binop:1,beforeExpr:!0},le={binop:2,beforeExpr:!0},fe={binop:3,beforeExpr:!0},Ie={binop:4,beforeExpr:!0},Le={binop:5,beforeExpr:!0},He={binop:6,beforeExpr:!0},Ye={binop:7,beforeExpr:!0},at={binop:8,beforeExpr:!0},wt={binop:9,prefix:!0,beforeExpr:!0},Ci={binop:10,beforeExpr:!0};O.tokTypes={bracketL:bi,bracketR:wi,braceL:ei,braceR:Ut,parenL:We,parenR:Vt,comma:qt,semi:Ft,colon:ti,dot:en,question:tn,slash:nn,eq:n,name:Fe,eof:Ge,num:De,regexp:Re,string:Be};for(var ii in ui)O.tokTypes["_"+ii]=ui[ii];function Yt(ee){ee=ee.split(" ");var se="",ge=[];e:for(var be=0;be<ee.length;++be){for(var qe=0;qe<ge.length;++qe)if(ge[qe][0].length==ee[be].length){ge[qe].push(ee[be]);continue e}ge.push([ee[be]])}function je(nt){if(nt.length==1)return se+="return str === "+JSON.stringify(nt[0])+";";se+="switch(str){";for(var Zt=0;Zt<nt.length;++Zt)se+="case "+JSON.stringify(nt[Zt])+":";se+="return true}return false;"}if(ge.length>3){ge.sort(function(nt,Zt){return Zt.length-nt.length}),se+="switch(str.length){";for(var be=0;be<ge.length;++be){var Ze=ge[be];se+="case "+Ze[0].length+":",je(Ze)}se+="}"}else je(ee);return new Function("str",se)}var li=Yt("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),hi=Yt("class enum extends super const export import"),ls=Yt("implements interface let package private protected public static yield"),Un=Yt("eval arguments"),Ua=Yt("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),qa=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,hs="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Ha="̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿",cs=new RegExp("["+hs+"]"),Ga=new RegExp("["+hs+Ha+"]"),qn=/[\n\r\u2028\u2029]/,Vi=/\r\n|[\n\r\u2028\u2029]/g,Hn=O.isIdentifierStart=function(ee){return ee<65?ee===36:ee<91?!0:ee<97?ee===95:ee<123?!0:ee>=170&&cs.test(String.fromCharCode(ee))},fs=O.isIdentifierChar=function(ee){return ee<48?ee===36:ee<58?!0:ee<65?!1:ee<91?!0:ee<97?ee===95:ee<123?!0:ee>=170&&Ga.test(String.fromCharCode(ee))};function Si(){this.line=ae,this.column=D-oe}function ds(){ae=1,D=oe=0,ne=!0,Fi()}function Ct(ee,se){K=D,V.locations&&(ie=new Si),W=ee,Fi(),te=se,ne=ee.beforeExpr}function ja(){var ee=V.onComment&&V.locations&&new Si,se=D,ge=k.indexOf("*/",D+=2);if(ge===-1&&xe(D-2,"Unterminated comment"),D=ge+2,V.locations){Vi.lastIndex=se;for(var be;(be=Vi.exec(k))&&be.index<D;)++ae,oe=be.index+be[0].length}V.onComment&&V.onComment(!0,k.slice(se+2,ge),se,D,ee,V.locations&&new Si)}function vr(){for(var ee=D,se=V.onComment&&V.locations&&new Si,ge=k.charCodeAt(D+=2);D<R&&ge!==10&&ge!==13&&ge!==8232&&ge!==8233;)++D,ge=k.charCodeAt(D);V.onComment&&V.onComment(!1,k.slice(ee+2,D),ee,D,se,V.locations&&new Si)}function Fi(){for(;D<R;){var ee=k.charCodeAt(D);if(ee===32)++D;else if(ee===13){++D;var se=k.charCodeAt(D);se===10&&++D,V.locations&&(++ae,oe=D)}else if(ee===10||ee===8232||ee===8233)++D,V.locations&&(++ae,oe=D);else if(ee>8&&ee<14)++D;else if(ee===47){var se=k.charCodeAt(D+1);if(se===42)ja();else if(se===47)vr();else break}else if(ee===160)++D;else if(ee>=5760&&qa.test(String.fromCharCode(ee)))++D;else break}}function Wa(){var ee=k.charCodeAt(D+1);return ee>=48&&ee<=57?gs(!0):(++D,Ct(en))}function Za(){var ee=k.charCodeAt(D+1);return ne?(++D,ps()):ee===61?St(p,2):St(nn,1)}function Xa(){var ee=k.charCodeAt(D+1);return ee===61?St(p,2):St(Ci,1)}function Ka(ee){var se=k.charCodeAt(D+1);return se===ee?St(ee===124?Z:le,2):se===61?St(p,2):St(ee===124?fe:Le,1)}function $a(){var ee=k.charCodeAt(D+1);return ee===61?St(p,2):St(Ie,1)}function Ya(ee){var se=k.charCodeAt(D+1);return se===ee?se==45&&k.charCodeAt(D+2)==62&&qn.test(k.slice(we,D))?(D+=3,vr(),Fi(),Pi()):St(I,2):se===61?St(p,2):St(wt,1)}function Qa(ee){var se=k.charCodeAt(D+1),ge=1;return se===ee?(ge=ee===62&&k.charCodeAt(D+2)===62?3:2,k.charCodeAt(D+ge)===61?St(p,ge+1):St(at,ge)):se==33&&ee==60&&k.charCodeAt(D+2)==45&&k.charCodeAt(D+3)==45?(D+=4,vr(),Fi(),Pi()):(se===61&&(ge=k.charCodeAt(D+2)===61?3:2),St(Ye,ge))}function Ja(ee){var se=k.charCodeAt(D+1);return se===61?St(He,k.charCodeAt(D+2)===61?3:2):St(ee===61?n:F,1)}function eo(ee){switch(ee){case 46:return Wa();case 40:return++D,Ct(We);case 41:return++D,Ct(Vt);case 59:return++D,Ct(Ft);case 44:return++D,Ct(qt);case 91:return++D,Ct(bi);case 93:return++D,Ct(wi);case 123:return++D,Ct(ei);case 125:return++D,Ct(Ut);case 58:return++D,Ct(ti);case 63:return++D,Ct(tn);case 48:var se=k.charCodeAt(D+1);if(se===120||se===88)return to();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return gs(!1);case 34:case 39:return io(ee);case 47:return Za();case 37:case 42:return Xa();case 124:case 38:return Ka(ee);case 94:return $a();case 43:case 45:return Ya(ee);case 60:case 62:return Qa(ee);case 61:case 33:return Ja(ee);case 126:return St(F,1)}return!1}function Pi(ee){if(ee?D=G+1:G=D,V.locations&&(Y=new Si),ee)return ps();if(D>=R)return Ct(Ge);var se=k.charCodeAt(D);if(Hn(se)||se===92)return vs();var ge=eo(se);if(ge===!1){var be=String.fromCharCode(se);if(be==="\\"||cs.test(be))return vs();xe(D,"Unexpected character '"+be+"'")}return ge}function St(ee,se){var ge=k.slice(D,D+se);D+=se,Ct(ee,ge)}function ps(){for(var qe="",ee,se,ge=D;;){D>=R&&xe(ge,"Unterminated regular expression");var be=k.charAt(D);if(qn.test(be)&&xe(ge,"Unterminated regular expression"),ee)ee=!1;else{if(be==="[")se=!0;else if(be==="]"&&se)se=!1;else if(be==="/"&&!se)break;ee=be==="\\"}++D}var qe=k.slice(ge,D);++D;var je=ms();je&&!/^[gmsiy]*$/.test(je)&&xe(ge,"Invalid regexp flag");try{var Ze=new RegExp(qe,je)}catch(nt){nt instanceof SyntaxError&&xe(ge,nt.message),xe(nt)}return Ct(Re,Ze)}function rn(ee,se){for(var ge=D,be=0,qe=0,je=se??1/0;qe<je;++qe){var Ze=k.charCodeAt(D),nt;if(Ze>=97?nt=Ze-97+10:Ze>=65?nt=Ze-65+10:Ze>=48&&Ze<=57?nt=Ze-48:nt=1/0,nt>=ee)break;++D,be=be*ee+nt}return D===ge||se!=null&&D-ge!==se?null:be}function to(){D+=2;var ee=rn(16);return ee==null&&xe(G+2,"Expected hexadecimal number"),Hn(k.charCodeAt(D))&&xe(D,"Identifier directly after number"),Ct(De,ee)}function gs(ee){var se=D,ge=!1,be=k.charCodeAt(D)===48;!ee&&rn(10)===null&&xe(se,"Invalid number"),k.charCodeAt(D)===46&&(++D,rn(10),ge=!0);var qe=k.charCodeAt(D);(qe===69||qe===101)&&(qe=k.charCodeAt(++D),(qe===43||qe===45)&&++D,rn(10)===null&&xe(se,"Invalid number"),ge=!0),Hn(k.charCodeAt(D))&&xe(D,"Identifier directly after number");var je=k.slice(se,D),Ze;return ge?Ze=parseFloat(je):!be||je.length===1?Ze=parseInt(je,10):/[89]/.test(je)||ve?xe(se,"Invalid number"):Ze=parseInt(je,8),Ct(De,Ze)}function io(ee){D++;for(var se="";;){D>=R&&xe(G,"Unterminated string constant");var ge=k.charCodeAt(D);if(ge===ee)return++D,Ct(Be,se);if(ge===92){ge=k.charCodeAt(++D);var be=/^[0-7]+/.exec(k.slice(D,D+3));for(be&&(be=be[0]);be&&parseInt(be,8)>255;)be=be.slice(0,-1);if(be==="0"&&(be=null),++D,be)ve&&xe(D-2,"Octal literal in strict mode"),se+=String.fromCharCode(parseInt(be,8)),D+=be.length-1;else switch(ge){case 110:se+=`
`;break;case 114:se+="\r";break;case 120:se+=String.fromCharCode(Gn(2));break;case 117:se+=String.fromCharCode(Gn(4));break;case 85:se+=String.fromCharCode(Gn(8));break;case 116:se+="	";break;case 98:se+="\b";break;case 118:se+="\v";break;case 102:se+="\f";break;case 48:se+="\0";break;case 13:k.charCodeAt(D)===10&&++D;case 10:V.locations&&(oe=D,++ae);break;default:se+=String.fromCharCode(ge);break}}else(ge===13||ge===10||ge===8232||ge===8233)&&xe(G,"Unterminated string constant"),se+=String.fromCharCode(ge),++D}}function Gn(ee){var se=rn(16,ee);return se===null&&xe(G,"Bad character escape sequence"),se}var Bi;function ms(){Bi=!1;for(var ee,se=!0,ge=D;;){var be=k.charCodeAt(D);if(fs(be))Bi&&(ee+=k.charAt(D)),++D;else if(be===92){Bi||(ee=k.slice(ge,D)),Bi=!0,k.charCodeAt(++D)!=117&&xe(D,"Expecting Unicode escape sequence \\uXXXX"),++D;var qe=Gn(4),je=String.fromCharCode(qe);je||xe(D-1,"Invalid Unicode escape"),(se?Hn(qe):fs(qe))||xe(D-4,"Invalid Unicode escape"),ee+=je}else break;se=!1}return Bi?ee:k.slice(ge,D)}function vs(){var ee=ms(),se=Fe;return!Bi&&Ua(ee)&&(se=ui[ee]),Ct(se,ee)}function et(){ce=G,we=K,Ee=ie,Pi()}function _r(ee){if(ve=ee,D=G,V.locations)for(;D<oe;)oe=k.lastIndexOf(`
`,oe-2)+1,--ae;Fi(),Pi()}function _s(){this.type=null,this.start=G,this.end=null}function ys(){this.start=Y,this.end=null,w!==null&&(this.source=w)}function It(){var ee=new _s;return V.locations&&(ee.loc=new ys),V.directSourceFile&&(ee.sourceFile=V.directSourceFile),V.ranges&&(ee.range=[G,0]),ee}function ci(ee){var se=new _s;return se.start=ee.start,V.locations&&(se.loc=new ys,se.loc.start=ee.loc.start),V.ranges&&(se.range=[ee.range[0],0]),se}function Qe(ee,se){return ee.type=se,ee.end=we,V.locations&&(ee.loc.end=Ee),V.ranges&&(ee.range[1]=we),ee}function yr(ee){return V.ecmaVersion>=5&&ee.type==="ExpressionStatement"&&ee.expression.type==="Literal"&&ee.expression.value==="use strict"}function mt(ee){if(W===ee)return et(),!0}function jn(){return!V.strictSemicolons&&(W===Ge||W===Ut||qn.test(k.slice(we,G)))}function ki(){!mt(Ft)&&!jn()&&ni()}function bt(ee){W===ee?et():ni()}function ni(){xe(G,"Unexpected token")}function Wn(ee){ee.type!=="Identifier"&&ee.type!=="MemberExpression"&&xe(ee.start,"Assigning to rvalue"),ve&&ee.type==="Identifier"&&Un(ee.name)&&xe(ee.start,"Assigning to "+ee.name+" in strict mode")}function no(ee){ce=we=D,V.locations&&(Ee=new Si),Me=ve=null,Ne=[],Pi();var se=ee||It(),ge=!0;for(ee||(se.body=[]);W!==Ge;){var be=Wt();se.body.push(be),ge&&yr(be)&&_r(!0),ge=!1}return Qe(se,"Program")}var xr={kind:"loop"},ro={kind:"switch"};function Wt(){(W===nn||W===p&&te=="/=")&&Pi(!0);var ee=W,se=It();switch(ee){case Xe:case pt:et();var ge=ee===Xe;mt(Ft)||jn()?se.label=null:W!==Fe?ni():(se.label=fi(),ki());for(var be=0;be<Ne.length;++be){var qe=Ne[be];if((se.label==null||qe.name===se.label.name)&&(qe.kind!=null&&(ge||qe.kind==="loop")||se.label&&ge))break}return be===Ne.length&&xe(se.start,"Unsyntactic "+ee.keyword),Qe(se,ge?"BreakStatement":"ContinueStatement");case xt:return et(),ki(),Qe(se,"DebuggerStatement");case Ae:return et(),Ne.push(xr),se.body=Wt(),Ne.pop(),bt(yt),se.test=sn(),ki(),Qe(se,"DoWhileStatement");case _t:if(et(),Ne.push(xr),bt(We),W===Ft)return br(se,null);if(W===jt){var je=It();return et(),bs(je,!0),Qe(je,"VariableDeclaration"),je.declarations.length===1&&mt(Di)?xs(se,je):br(se,je)}var je=Et(!1,!0);return mt(Di)?(Wn(je),xs(se,je)):br(se,je);case Ot:return et(),kr(se,!0);case Gt:return et(),se.test=sn(),se.consequent=Wt(),se.alternate=mt(lt)?Wt():null,Qe(se,"IfStatement");case Rt:return!Me&&!V.allowReturnOutsideFunction&&xe(G,"'return' outside of function"),et(),mt(Ft)||jn()?se.argument=null:(se.argument=Et(),ki()),Qe(se,"ReturnStatement");case Dt:et(),se.discriminant=sn(),se.cases=[],bt(ei),Ne.push(ro);for(var Ze,nt;W!=Ut;)if(W===Ue||W===gt){var Zt=W===Ue;Ze&&Qe(Ze,"SwitchCase"),se.cases.push(Ze=It()),Ze.consequent=[],et(),Zt?Ze.test=Et():(nt&&xe(ce,"Multiple default clauses"),nt=!0,Ze.test=null),bt(ti)}else Ze||ni(),Ze.consequent.push(Wt());return Ze&&Qe(Ze,"SwitchCase"),et(),Ne.pop(),Qe(se,"SwitchStatement");case Pt:return et(),qn.test(k.slice(we,G))&&xe(we,"Illegal newline after throw"),se.argument=Et(),ki(),Qe(se,"ThrowStatement");case Mt:if(et(),se.block=an(),se.handler=null,W===vt){var Ii=It();et(),bt(We),Ii.param=fi(),ve&&Un(Ii.param.name)&&xe(Ii.param.start,"Binding "+Ii.param.name+" in strict mode"),bt(Vt),Ii.guard=null,Ii.body=an(),se.handler=Qe(Ii,"CatchClause")}return se.guardedHandlers=ze,se.finalizer=mt(ht)?an():null,!se.handler&&!se.finalizer&&xe(se.start,"Missing catch or finally clause"),Qe(se,"TryStatement");case jt:return et(),bs(se),ki(),Qe(se,"VariableDeclaration");case yt:return et(),se.test=sn(),Ne.push(xr),se.body=Wt(),Ne.pop(),Qe(se,"WhileStatement");case kt:return ve&&xe(G,"'with' in strict mode"),et(),se.object=sn(),se.body=Wt(),Qe(se,"WithStatement");case ei:return an();case Ft:return et(),Qe(se,"EmptyStatement");default:var Er=te,Zn=Et();if(ee===Fe&&Zn.type==="Identifier"&&mt(ti)){for(var be=0;be<Ne.length;++be)Ne[be].name===Er&&xe(Zn.start,"Label '"+Er+"' is already declared");var ho=W.isLoop?"loop":W===Dt?"switch":null;return Ne.push({name:Er,kind:ho}),se.body=Wt(),Ne.pop(),se.label=Zn,Qe(se,"LabeledStatement")}else return se.expression=Zn,ki(),Qe(se,"ExpressionStatement")}}function sn(){bt(We);var ee=Et();return bt(Vt),ee}function an(ee){var se=It(),ge=!0,be=!1,qe;for(se.body=[],bt(ei);!mt(Ut);){var je=Wt();se.body.push(je),ge&&ee&&yr(je)&&(qe=be,_r(be=!0)),ge=!1}return be&&!qe&&_r(!1),Qe(se,"BlockStatement")}function br(ee,se){return ee.init=se,bt(Ft),ee.test=W===Ft?null:Et(),bt(Ft),ee.update=W===Vt?null:Et(),bt(Vt),ee.body=Wt(),Ne.pop(),Qe(ee,"ForStatement")}function xs(ee,se){return ee.left=se,ee.right=Et(),bt(Vt),ee.body=Wt(),Ne.pop(),Qe(ee,"ForInStatement")}function bs(ee,se){for(ee.declarations=[],ee.kind="var";;){var ge=It();if(ge.id=fi(),ve&&Un(ge.id.name)&&xe(ge.id.start,"Binding "+ge.id.name+" in strict mode"),ge.init=mt(n)?Et(!0,se):null,ee.declarations.push(Qe(ge,"VariableDeclarator")),!mt(qt))break}return ee}function Et(ee,se){var ge=wr(se);if(!ee&&W===qt){var be=ci(ge);for(be.expressions=[ge];mt(qt);)be.expressions.push(wr(se));return Qe(be,"SequenceExpression")}return ge}function wr(ee){var se=so(ee);if(W.isAssign){var ge=ci(se);return ge.operator=te,ge.left=se,et(),ge.right=wr(ee),Wn(se),Qe(ge,"AssignmentExpression")}return se}function so(ee){var se=ao(ee);if(mt(tn)){var ge=ci(se);return ge.test=se,ge.consequent=Et(!0),bt(ti),ge.alternate=Et(!0,ee),Qe(ge,"ConditionalExpression")}return se}function ao(ee){return Cr(Sr(),-1,ee)}function Cr(ee,se,ge){var be=W.binop;if(be!=null&&(!ge||W!==Di)&&be>se){var qe=ci(ee);qe.left=ee,qe.operator=te;var je=W;et(),qe.right=Cr(Sr(),be,ge);var Ze=Qe(qe,je===Z||je===le?"LogicalExpression":"BinaryExpression");return Cr(Ze,se,ge)}return ee}function Sr(){if(W.prefix){var ee=It(),se=W.isUpdate;return ee.operator=te,ee.prefix=!0,ne=!0,et(),ee.argument=Sr(),se?Wn(ee.argument):ve&&ee.operator==="delete"&&ee.argument.type==="Identifier"&&xe(ee.start,"Deleting local variable in strict mode"),Qe(ee,se?"UpdateExpression":"UnaryExpression")}for(var ge=oo();W.postfix&&!jn();){var ee=ci(ge);ee.operator=te,ee.prefix=!1,ee.argument=ge,Wn(ge),et(),ge=Qe(ee,"UpdateExpression")}return ge}function oo(){return on(Pr())}function on(ee,se){if(mt(en)){var ge=ci(ee);return ge.object=ee,ge.property=fi(!0),ge.computed=!1,on(Qe(ge,"MemberExpression"),se)}else if(mt(bi)){var ge=ci(ee);return ge.object=ee,ge.property=Et(),ge.computed=!0,bt(wi),on(Qe(ge,"MemberExpression"),se)}else if(!se&&mt(We)){var ge=ci(ee);return ge.callee=ee,ge.arguments=Ir(Vt,!1),on(Qe(ge,"CallExpression"),se)}else return ee}function Pr(){switch(W){case Ji:var be=It();return et(),Qe(be,"ThisExpression");case Fe:return fi();case De:case Be:case Re:var be=It();return be.value=te,be.raw=k.slice(G,K),et(),Qe(be,"Literal");case Vn:case Fn:case Bn:var be=It();return be.value=W.atomValue,be.raw=W.keyword,et(),Qe(be,"Literal");case We:var ee=Y,se=G;et();var ge=Et();return ge.start=se,ge.end=K,V.locations&&(ge.loc.start=ee,ge.loc.end=ie),V.ranges&&(ge.range=[se,K]),bt(Vt),ge;case bi:var be=It();return et(),be.elements=Ir(wi,!0,!0),Qe(be,"ArrayExpression");case ei:return lo();case Ot:var be=It();return et(),kr(be,!1);case Dn:return uo();default:ni()}}function uo(){var ee=It();return et(),ee.callee=on(Pr(),!0),mt(We)?ee.arguments=Ir(Vt,!1):ee.arguments=ze,Qe(ee,"NewExpression")}function lo(){var ee=It(),se=!0,ge=!1;for(ee.properties=[],et();!mt(Ut);){if(se)se=!1;else if(bt(qt),V.allowTrailingCommas&&mt(Ut))break;var be={key:ws()},qe=!1,je;if(mt(ti)?(be.value=Et(!0),je=be.kind="init"):V.ecmaVersion>=5&&be.key.type==="Identifier"&&(be.key.name==="get"||be.key.name==="set")?(qe=ge=!0,je=be.kind=be.key.name,be.key=ws(),W!==We&&ni(),be.value=kr(It(),!1)):ni(),be.key.type==="Identifier"&&(ve||ge))for(var Ze=0;Ze<ee.properties.length;++Ze){var nt=ee.properties[Ze];if(nt.key.name===be.key.name){var Zt=je==nt.kind||qe&&nt.kind==="init"||je==="init"&&(nt.kind==="get"||nt.kind==="set");Zt&&!ve&&je==="init"&&nt.kind==="init"&&(Zt=!1),Zt&&xe(be.key.start,"Redefinition of property")}}ee.properties.push(be)}return Qe(ee,"ObjectExpression")}function ws(){return W===De||W===Be?Pr():fi(!0)}function kr(ee,se){W===Fe?ee.id=fi():se?ni():ee.id=null,ee.params=[];var ge=!0;for(bt(We);!mt(Vt);)ge?ge=!1:bt(qt),ee.params.push(fi());var be=Me,qe=Ne;if(Me=!0,Ne=[],ee.body=an(!0),Me=be,Ne=qe,ve||ee.body.body.length&&yr(ee.body.body[0]))for(var je=ee.id?-1:0;je<ee.params.length;++je){var Ze=je<0?ee.id:ee.params[je];if((ls(Ze.name)||Un(Ze.name))&&xe(Ze.start,"Defining '"+Ze.name+"' in strict mode"),je>=0)for(var nt=0;nt<je;++nt)Ze.name===ee.params[nt].name&&xe(Ze.start,"Argument name clash in strict mode")}return Qe(ee,se?"FunctionDeclaration":"FunctionExpression")}function Ir(ee,se,ge){for(var be=[],qe=!0;!mt(ee);){if(qe)qe=!1;else if(bt(qt),se&&V.allowTrailingCommas&&mt(ee))break;ge&&W===qt?be.push(null):be.push(Et(!0))}return be}function fi(ee){var se=It();return ee&&V.forbidReserved=="everywhere"&&(ee=!1),W===Fe?(!ee&&(V.forbidReserved&&(V.ecmaVersion===3?li:hi)(te)||ve&&ls(te))&&k.slice(G,K).indexOf("\\")==-1&&xe(G,"The keyword '"+te+"' is reserved"),se.name=te):ee&&W.keyword?se.name=W.keyword:ni(),ne=!1,et(),Qe(se,"Identifier")}}),i.version||(i=null)}function f(O,V){return(e.acorn||i).parse(O,V)}var m={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},v={"-":"__negate","+":"__self"},_=u.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(O){this["__"+O]="#"+O},{__self:function(){return this}});E.inject(_),X.inject(_),ft.inject(_);function y(O,V,k){var R=m[V];if(O&&O[R]){var w=O[R](k);return V==="!="?!w:w}switch(V){case"+":return O+k;case"-":return O-k;case"*":return O*k;case"/":return O/k;case"%":return O%k;case"==":return O==k;case"!=":return O!=k}}function b(O,V){var k=v[O];if(V&&V[k])return V[k]();switch(O){case"+":return+V;case"-":return-V}}function T(O,V){if(!O)return"";V=V||{};var k=[];function R(ve){for(var xe=0,ze=k.length;xe<ze;xe++){var De=k[xe];if(De[0]>=ve)break;ve+=De[1]}return ve}function w(ve){return O.substring(R(ve.range[0]),R(ve.range[1]))}function N(ve,xe){return O.substring(R(ve.range[1]),R(xe.range[0]))}function U(ve,xe){for(var ze=R(ve.range[0]),De=R(ve.range[1]),Re=0,Be=k.length-1;Be>=0;Be--)if(ze>k[Be][0]){Re=Be+1;break}k.splice(Re,0,[ze,xe.length-De+ze]),O=O.substring(0,ze)+xe+O.substring(De)}function H(ve,xe){switch(ve.type){case"UnaryExpression":if(ve.operator in v&&ve.argument.type!=="Literal"){var ze=w(ve.argument);U(ve,'$__("'+ve.operator+'", '+ze+")")}break;case"BinaryExpression":if(ve.operator in m&&ve.left.type!=="Literal"){var De=w(ve.left),Re=w(ve.right),Be=N(ve.left,ve.right),Fe=ve.operator;U(ve,"__$__("+De+","+Be.replace(new RegExp("\\"+Fe),'"'+Fe+'"')+", "+Re+")")}break;case"UpdateExpression":case"AssignmentExpression":var Ge=xe&&xe.type;if(!(Ge==="ForStatement"||Ge==="BinaryExpression"&&/^[=!<>]/.test(xe.operator)||Ge==="MemberExpression"&&xe.computed)){if(ve.type==="UpdateExpression"){var ze=w(ve.argument),Xe="__$__("+ze+', "'+ve.operator[0]+'", 1)',Ue=ze+" = "+Xe;ve.prefix?Ue="("+Ue+")":(Ge==="AssignmentExpression"||Ge==="VariableDeclarator"||Ge==="BinaryExpression")&&(w(xe.left||xe.id)===ze&&(Ue=Xe),Ue=ze+"; "+Ue),U(ve,Ue)}else if(/^.=$/.test(ve.operator)&&ve.left.type!=="Literal"){var De=w(ve.left),Re=w(ve.right),Xe=De+" = __$__("+De+', "'+ve.operator[0]+'", '+Re+")";U(ve,/^\(.*\)$/.test(w(ve))?"("+Xe+")":Xe)}}break}}function D(ve){switch(ve.type){case"ExportDefaultDeclaration":U({range:[ve.start,ve.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var xe=ve.declaration,ze=ve.specifiers;if(xe){var De=xe.declarations;De&&(De.forEach(function(Be){U(Be,"module.exports."+w(Be))}),U({range:[ve.start,xe.start+xe.kind.length]},""))}else if(ze){var Re=ze.map(function(Be){var Fe=w(Be);return"module.exports."+Fe+" = "+Fe+"; "}).join("");Re&&U(ve,Re)}break}}function G(ve,xe,ze){if(ve){for(var De in ve)if(De!=="range"&&De!=="loc"){var Re=ve[De];if(Array.isArray(Re))for(var Be=0,Fe=Re.length;Be<Fe;Be++)G(Re[Be],ve,ze);else Re&&typeof Re=="object"&&G(Re,ve,ze)}ze.operatorOverloading!==!1&&H(ve,xe),ze.moduleExports!==!1&&D(ve)}}function K(ve){var xe="",ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ve=(Math.abs(ve)<<1)+(ve<0?1:0);ve||!xe;){var De=ve&31;ve>>=5,ve&&(De|=32),xe+=ze[De]}return xe}var Y=V.url||"",ie=V.sourceMaps,W=V.paperFeatures||{},te=V.source||O,ne=V.offset||0,ae=$e.agent,oe=ae.versionNumber,ce=!1,we=/\r\n|\n|\r/mg,Ee;if(ie&&(ae.chrome&&oe>=30||ae.webkit&&oe>=537.76||ae.firefox&&oe>=23||ae.node)){if(ae.node)ne-=2;else if(l&&Y&&!l.location.href.indexOf(Y)){var Me=c.getElementsByTagName("html")[0].innerHTML;ne=Me.substr(0,Me.indexOf(O)+1).match(we).length+1}ce=ne>0&&!(ae.chrome&&oe>=36||ae.safari&&oe>=600||ae.firefox&&oe>=40||ae.node);var Ne=["AA"+K(ce?0:ne)+"A"];Ne.length=(O.match(we)||[]).length+1+(ce?ne:0),Ee={version:3,file:Y,names:[],mappings:Ne.join(";AACA"),sourceRoot:"",sources:[Y],sourcesContent:[te]}}return(W.operatorOverloading!==!1||W.moduleExports!==!1)&&G(f(O,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,W),Ee&&(ce&&(O=new Array(ne+1).join(`
`)+O),/^(inline|both)$/.test(ie)&&(O+=`
//# sourceMappingURL=data:application/json;base64,`+s.btoa(unescape(encodeURIComponent(JSON.stringify(Ee))))),O+=`
//# sourceURL=`+(Y||"paperscript")),{url:Y,source:te,code:O,map:Ee}}function z(O,V,k){$e=V;var R=V.getView(),w=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(O)&&!/\bnew\s+Tool\b/.test(O)?new yi:null,N=w?w._events:[],U=["onFrame","onResize"].concat(N),H=[],D=[],G,K=typeof O=="object"?O:T(O,k);O=K.code;function Y(oe,ce){for(var we in oe)(ce||!/^_/.test(we))&&new RegExp("([\\b\\s\\W]|^)"+we.replace(/\$/g,"\\$")+"\\b").test(O)&&(H.push(we),D.push(oe[we]))}Y({__$__:y,$__:b,paper:V,tool:w},!0),Y(V),O="var module = { exports: {} }; "+O;var ne=u.each(U,function(oe){new RegExp("\\s+"+oe+"\\b").test(O)&&(H.push(oe),this.push("module.exports."+oe+" = "+oe+";"))},[]).join(`
`);ne&&(O+=`
`+ne),O+=`
return module.exports;`;var ie=$e.agent;if(c&&(ie.chrome||ie.firefox&&ie.versionNumber<40)){var W=c.createElement("script"),te=c.head||c.getElementsByTagName("head")[0];ie.firefox&&(O=`
`+O),W.appendChild(c.createTextNode("document.__paperscript__ = function("+H+") {"+O+`
}`)),te.appendChild(W),G=c.__paperscript__,delete c.__paperscript__,te.removeChild(W)}else G=Function(H,O);var ne=G&&G.apply(V,D),ae=ne||{};return u.each(N,function(oe){var ce=ae[oe];ce&&(w[oe]=ce)}),R&&(ae.onResize&&R.setOnResize(ae.onResize),R.emit("resize",{size:R.size,delta:new E}),ae.onFrame&&R.setOnFrame(ae.onFrame),R.requestUpdate()),ne}function P(O){if(/^text\/(?:x-|)paperscript$/.test(O.type)&&g.getAttribute(O,"ignore")!=="true"){var V=g.getAttribute(O,"canvas"),k=c.getElementById(V),R=O.src||O.getAttribute("data-src"),w=g.hasAttribute(O,"async"),N="data-paper-scope";if(!k)throw new Error('Unable to find canvas with id "'+V+'"');var U=g.get(k.getAttribute(N))||new g().setup(k);return k.setAttribute(N,U._id),R?Ri.request({url:R,async:w,mimeType:"text/plain",onLoad:function(H){z(H,U,R)}}):z(O.innerHTML,U,O.baseURI),O.setAttribute("data-paper-ignore","true"),U}}function S(){u.each(c&&c.getElementsByTagName("script"),P)}function B(O){return O?P(O):S()}return l&&(c.readyState==="complete"?setTimeout(S):ot.add(l,{load:S})),{compile:T,execute:z,load:B,parse:f,calculateBinary:y,calculateUnary:b}}).call(this);var $e=new(g.inject(u.exports,{Base:u,Numerical:A,Key:_i,DomEvent:ot,DomElement:st,document:c,window:l,Symbol:Se,PlacedSymbol:ke}));return $e.agent.node&&Ps($e),typeof r=="function"&&r.amd?r("paper",$e):o&&(o.exports=$e),$e}).call(Io,typeof self=="object"?self:null)})(ir)),ir.exports}var Ao=Eo();const To=is(Ao);function sr(o,s){const r=!!o&&!!o.project&&!!o.project.activeLayer&&!!o.view&&!!o.view._context&&o.view._visible!==!1;return r||console.warn(`[${s}] Paper not ready`,{hasScope:!!o,hasProject:!!o?.project,hasLayer:!!o?.project?.activeLayer,hasView:!!o?.view,ctx:!!o?.view?._context,visible:o?.view?._visible}),r}function Nt(o,s,r){try{return o.scope.activate(),r()}catch(l){console.error(`[${s}] block in paper scope failed`,l)}}function ua(o,s,r){const l=new To.PaperScope;return l.setup(o),l.view.viewSize=new l.Size(s,r),{scope:l}}function Mo(o){const s=[];if(o.segments.length===0)return s;const r=o.segments[0],l={type:"move",p:[r.point.x,r.point.y]};s.push(l);for(let c=1;c<o.segments.length;c++){const u=o.segments[c-1],d=o.segments[c];if(u.handleOut&&u.handleOut.length>0||d.handleIn&&d.handleIn.length>0){const x=u.handleOut?[u.point.x+u.handleOut.x,u.point.y+u.handleOut.y]:[u.point.x,u.point.y],C=d.handleIn?[d.point.x+d.handleIn.x,d.point.y+d.handleIn.y]:[d.point.x,d.point.y],L={type:"bezier",p1:x,p2:C,p3:[d.point.x,d.point.y]};s.push(L)}else{const x={type:"line",p:[d.point.x,d.point.y]};s.push(x)}}if(o.closed&&o.segments.length>=2){const c=o.segments[o.segments.length-1],u=o.segments[0];if(c.handleOut&&c.handleOut.length>0||u.handleIn&&u.handleIn.length>0){const g=c.handleOut?[c.point.x+c.handleOut.x,c.point.y+c.handleOut.y]:[c.point.x,c.point.y],x=u.handleIn?[u.point.x+u.handleIn.x,u.point.y+u.handleIn.y]:[u.point.x,u.point.y],C={type:"bezier",p1:g,p2:x,p3:[u.point.x,u.point.y]};s.push(C)}else{const g={type:"line",p:[u.point.x,u.point.y]};s.push(g)}}return s}function Zr(o,s){const r=s.scope,l=new r.Path;if(o.length===0)return l;let c=null;for(const u of o)switch(u.type){case"move":{const[d,g]=u.p;c=new r.Point(d,g),l.moveTo(c);break}case"line":{const[d,g]=u.p;c=new r.Point(d,g),l.lineTo(c);break}case"bezier":{if(!c){console.warn("paperUtils: CurveTo command without a current point, skipping");break}const[d,g]=u.p1,[x,C]=u.p2,[L,A]=u.p3,q=new r.Point(L,A),E=new r.Point(d,g),Q=new r.Point(x,C);l.add(q);const X=l.lastSegment,j=Q.subtract(q);if(X.handleIn=j,l.segments.length>=2){const $=E.subtract(c);l.segments[l.segments.length-2].handleOut=$}c=q;break}case"arc":console.warn("paperUtils: Arc commands not yet supported, skipping arc command");break}return l}function zo(o,s,r){const l=r.scope,c=new l.Group,u=Zr(o.borderPath,r);u.strokeColor=new l.Color(s),u.strokeWidth=1,u.data.isBorder=!0,c.addChild(u);for(const d of o.pieces.values()){const g=Lo(d,o,r);g.strokeColor=new l.Color(s),g.strokeWidth=1,g.data.pieceId=d.id,c.addChild(g)}return c}function Lo(o,s,r){const l=r.scope,c=new l.Path;let u=s.halfEdges.get(o.halfEdge);if(!u)return c;const d=u.id;c.moveTo(new l.Point(u.origin[0],u.origin[1]));do{if(u.segments)for(const g of u.segments)Oo(c,g,r);else{const g=s.halfEdges.get(u.next);c.lineTo(new l.Point(g.origin[0],g.origin[1]))}u=s.halfEdges.get(u.next)}while(u.id!==d);return c}function Oo(o,s,r){const l=r.scope;switch(s.type){case"line":{o.lineTo(new l.Point(s.p[0],s.p[1]));break}case"bezier":{o.cubicCurveTo(new l.Point(s.p1[0],s.p1[1]),new l.Point(s.p2[0],s.p2[1]),new l.Point(s.p3[0],s.p3[1]));break}}}function No(o,s,r,l){if(s.removeChildren(),!r)return;const c=l.scope;for(const u of o.pieces.values()){const[d,g]=u.site,x=new c.Path.Circle(new c.Point(d,g),3);x.fillColor=new c.Color(r),x.data.pieceId=u.id,s.addChild(x)}}function Ro(o,s,r){if(s.removeChildren(),!o.problems||o.problems.length===0)return;const l=r.scope;for(const c of o.problems){const[u,d]=c,g=new l.Path.Circle(new l.Point(u,d),8);g.strokeColor=new l.Color("red"),g.strokeWidth=2,s.addChild(g)}}function Do(o,s){return s()}async function Vo(o,s){return s()}function Fo(o,s,r,l){l.paperCtx=ua(o,s,r),l.paperCtx||console.error("PuzzleRenderer: Failed to create Paper.js context")}function ar(o,s,r,l){if(!o.paperCtx){console.error("PuzzleRenderer: Cannot render - Paper.js context not initialized");return}Do("Paper.js Rendering",()=>{Nt(o.paperCtx,"PuzzleRenderer:renderPuzzle",()=>{const c=o.paperCtx.scope;if(!sr(c,"PuzzleRenderer:renderPuzzle")){console.error("PuzzleRenderer: Paper.js not ready - canvas may have been replaced");return}o.paperPath&&(o.paperPath.remove(),o.paperPath=null),o.paperPath=zo(s,r,o.paperCtx),Uo(s,o),o.seedPointItems&&o.paperCtx&&No(s,o.seedPointItems,l,o.paperCtx),o.problemItems&&o.paperCtx&&Ro(s,o.problemItems,o.paperCtx),c.view.update()})})}function Bo(o){if(!o.paperCtx){console.error("PuzzleRenderer: Cannot create groups - Paper.js context not initialized");return}Nt(o.paperCtx,"PuzzleRenderer:createPaperGroups",()=>{const s=o.paperCtx.scope;if(!sr(s,"PuzzleRenderer:createPaperGroups")){console.error("PuzzleRenderer: Paper.js not ready - canvas may have been replaced");return}o.backgroundRaster=null,o.seedPointItems=new s.Group,o.problemItems=new s.Group,o.vertexItems=new s.Group})}function Es(o,s,r,l){if(!o.paperCtx){console.error("PuzzleRenderer: Cannot update background - Paper.js context not initialized");return}Nt(o.paperCtx,"PuzzleRenderer:updateBackgroundImage",()=>{const c=o.paperCtx.scope;if(o.backgroundRaster&&(o.backgroundRaster.remove(),o.backgroundRaster=null),s){const u=new c.Raster(s);u.position=new c.Point(r/2,l/2),u.onLoad=()=>{if(u.width&&u.height){const d=r/u.width,g=l/u.height;u.scale(d,g)}},u.sendToBack(),o.backgroundRaster=u}})}function la(o){const s=new Set;for(const r of o.halfEdges.values())if(r.twin===-1){const l=o.vertices.findIndex(c=>c[0]===r.origin[0]&&c[1]===r.origin[1]);l>=0&&s.add(l)}return s}function Uo(o,s){if(!s.vertexItems||!s.paperCtx)return;const r=s.paperCtx.scope;s.vertexItems.removeChildren();const l=la(o);for(let c=0;c<o.vertices.length;c++){if(l.has(c))continue;const[u,d]=o.vertices[c],g=new r.Path.Circle(new r.Point(u,d),4);g.fillColor=new r.Color("#4363d8"),g.strokeColor=new r.Color("#ffffff"),g.strokeWidth=1,g.visible=!1,g.data.vertexId=c,s.vertexItems.addChild(g)}}function qo(o){o.backgroundRaster&&(o.backgroundRaster.remove(),o.backgroundRaster=null),o.paperPath&&(o.paperPath.remove(),o.paperPath=null),o.seedPointItems&&(o.seedPointItems.remove(),o.seedPointItems=null),o.problemItems&&(o.problemItems.remove(),o.problemItems=null),o.vertexItems&&(o.vertexItems.remove(),o.vertexItems=null),o.paperCtx&&o.paperCtx.scope.project.remove()}class gr{generators=new Map;register(s,r,l){this.generators.has(s)&&console.warn(`Generator "${s}" is already registered, overwriting`),this.generators.set(s,{factory:r,uiMetadata:l})}create(s,r,l){const c=this.generators.get(l.name);if(!c)throw new Error(`Unknown generator "${l.name}". Is it registered?`);return c.factory(s,r,l)}getAvailableGenerators(){return Array.from(this.generators.values()).sort((s,r)=>s.uiMetadata.sortHint-r.uiMetadata.sortHint).map(s=>({name:s.uiMetadata.name,displayName:s.uiMetadata.displayName}))}getUIMetadata(s){return this.generators.get(s)?.uiMetadata}getDefaultConfig(s,r,l){const c={name:s,width:r,height:l},u=this.getUIMetadata(s);if(u)for(const d of u.controls)c[d.name]=d.defaultValue;return c}}const An=new gr,Tn=new gr,Mn=new gr,Oi=new gr;let Ho=0;function ha(){return Ho++}const{abs:un,cos:ri,sin:Ui,acos:Go,atan2:ln,sqrt:di,pow:Ht}=Math;function hn(o){return o<0?-Ht(-o,1/3):Ht(o,1/3)}const ca=Math.PI,Xn=2*ca,pi=ca/2,jo=1e-6,Tr=Number.MAX_SAFE_INTEGER||9007199254740991,Mr=Number.MIN_SAFE_INTEGER||-9007199254740991,Wo={x:0,y:0,z:0},Te={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(o,s){const r=s(o);let l=r.x*r.x+r.y*r.y;return typeof r.z<"u"&&(l+=r.z*r.z),di(l)},compute:function(o,s,r){if(o===0)return s[0].t=0,s[0];const l=s.length-1;if(o===1)return s[l].t=1,s[l];const c=1-o;let u=s;if(l===0)return s[0].t=o,s[0];if(l===1){const g={x:c*u[0].x+o*u[1].x,y:c*u[0].y+o*u[1].y,t:o};return r&&(g.z=c*u[0].z+o*u[1].z),g}if(l<4){let g=c*c,x=o*o,C,L,A,q=0;l===2?(u=[u[0],u[1],u[2],Wo],C=g,L=c*o*2,A=x):l===3&&(C=g*c,L=g*o*3,A=c*x*3,q=o*x);const E={x:C*u[0].x+L*u[1].x+A*u[2].x+q*u[3].x,y:C*u[0].y+L*u[1].y+A*u[2].y+q*u[3].y,t:o};return r&&(E.z=C*u[0].z+L*u[1].z+A*u[2].z+q*u[3].z),E}const d=JSON.parse(JSON.stringify(s));for(;d.length>1;){for(let g=0;g<d.length-1;g++)d[g]={x:d[g].x+(d[g+1].x-d[g].x)*o,y:d[g].y+(d[g+1].y-d[g].y)*o},typeof d[g].z<"u"&&(d[g].z=d[g].z+(d[g+1].z-d[g].z)*o);d.splice(d.length-1,1)}return d[0].t=o,d[0]},computeWithRatios:function(o,s,r,l){const c=1-o,u=r,d=s;let g=u[0],x=u[1],C=u[2],L=u[3],A;if(g*=c,x*=o,d.length===2)return A=g+x,{x:(g*d[0].x+x*d[1].x)/A,y:(g*d[0].y+x*d[1].y)/A,z:l?(g*d[0].z+x*d[1].z)/A:!1,t:o};if(g*=c,x*=2*c,C*=o*o,d.length===3)return A=g+x+C,{x:(g*d[0].x+x*d[1].x+C*d[2].x)/A,y:(g*d[0].y+x*d[1].y+C*d[2].y)/A,z:l?(g*d[0].z+x*d[1].z+C*d[2].z)/A:!1,t:o};if(g*=c,x*=1.5*c,C*=3*c,L*=o*o*o,d.length===4)return A=g+x+C+L,{x:(g*d[0].x+x*d[1].x+C*d[2].x+L*d[3].x)/A,y:(g*d[0].y+x*d[1].y+C*d[2].y+L*d[3].y)/A,z:l?(g*d[0].z+x*d[1].z+C*d[2].z+L*d[3].z)/A:!1,t:o}},derive:function(o,s){const r=[];for(let l=o,c=l.length,u=c-1;c>1;c--,u--){const d=[];for(let g=0,x;g<u;g++)x={x:u*(l[g+1].x-l[g].x),y:u*(l[g+1].y-l[g].y)},s&&(x.z=u*(l[g+1].z-l[g].z)),d.push(x);r.push(d),l=d}return r},between:function(o,s,r){return s<=o&&o<=r||Te.approximately(o,s)||Te.approximately(o,r)},approximately:function(o,s,r){return un(o-s)<=(r||jo)},length:function(o){const r=Te.Tvalues.length;let l=0;for(let c=0,u;c<r;c++)u=.5*Te.Tvalues[c]+.5,l+=Te.Cvalues[c]*Te.arcfn(u,o);return .5*l},map:function(o,s,r,l,c){const u=r-s,d=c-l,g=o-s,x=g/u;return l+d*x},lerp:function(o,s,r){const l={x:s.x+o*(r.x-s.x),y:s.y+o*(r.y-s.y)};return s.z!==void 0&&r.z!==void 0&&(l.z=s.z+o*(r.z-s.z)),l},pointToString:function(o){let s=o.x+"/"+o.y;return typeof o.z<"u"&&(s+="/"+o.z),s},pointsToString:function(o){return"["+o.map(Te.pointToString).join(", ")+"]"},copy:function(o){return JSON.parse(JSON.stringify(o))},angle:function(o,s,r){const l=s.x-o.x,c=s.y-o.y,u=r.x-o.x,d=r.y-o.y,g=l*d-c*u,x=l*u+c*d;return ln(g,x)},round:function(o,s){const r=""+o,l=r.indexOf(".");return parseFloat(r.substring(0,l+1+s))},dist:function(o,s){const r=o.x-s.x,l=o.y-s.y;return di(r*r+l*l)},closest:function(o,s){let r=Ht(2,63),l,c;return o.forEach(function(u,d){c=Te.dist(s,u),c<r&&(r=c,l=d)}),{mdist:r,mpos:l}},abcratio:function(o,s){if(s!==2&&s!==3)return!1;if(typeof o>"u")o=.5;else if(o===0||o===1)return o;const r=Ht(o,s)+Ht(1-o,s),l=r-1;return un(l/r)},projectionratio:function(o,s){if(s!==2&&s!==3)return!1;if(typeof o>"u")o=.5;else if(o===0||o===1)return o;const r=Ht(1-o,s),l=Ht(o,s)+r;return r/l},lli8:function(o,s,r,l,c,u,d,g){const x=(o*l-s*r)*(c-d)-(o-r)*(c*g-u*d),C=(o*l-s*r)*(u-g)-(s-l)*(c*g-u*d),L=(o-r)*(u-g)-(s-l)*(c-d);return L==0?!1:{x:x/L,y:C/L}},lli4:function(o,s,r,l){const c=o.x,u=o.y,d=s.x,g=s.y,x=r.x,C=r.y,L=l.x,A=l.y;return Te.lli8(c,u,d,g,x,C,L,A)},lli:function(o,s){return Te.lli4(o,o.c,s,s.c)},makeline:function(o,s){return new ct(o.x,o.y,(o.x+s.x)/2,(o.y+s.y)/2,s.x,s.y)},findbbox:function(o){let s=Tr,r=Tr,l=Mr,c=Mr;return o.forEach(function(u){const d=u.bbox();s>d.x.min&&(s=d.x.min),r>d.y.min&&(r=d.y.min),l<d.x.max&&(l=d.x.max),c<d.y.max&&(c=d.y.max)}),{x:{min:s,mid:(s+l)/2,max:l,size:l-s},y:{min:r,mid:(r+c)/2,max:c,size:c-r}}},shapeintersections:function(o,s,r,l,c){if(!Te.bboxoverlap(s,l))return[];const u=[],d=[o.startcap,o.forward,o.back,o.endcap],g=[r.startcap,r.forward,r.back,r.endcap];return d.forEach(function(x){x.virtual||g.forEach(function(C){if(C.virtual)return;const L=x.intersects(C,c);L.length>0&&(L.c1=x,L.c2=C,L.s1=o,L.s2=r,u.push(L))})}),u},makeshape:function(o,s,r){const l=s.points.length,c=o.points.length,u=Te.makeline(s.points[l-1],o.points[0]),d=Te.makeline(o.points[c-1],s.points[0]),g={startcap:u,forward:o,back:s,endcap:d,bbox:Te.findbbox([u,o,s,d])};return g.intersections=function(x){return Te.shapeintersections(g,g.bbox,x,x.bbox,r)},g},getminmax:function(o,s,r){if(!r)return{min:0,max:0};let l=Tr,c=Mr,u,d;r.indexOf(0)===-1&&(r=[0].concat(r)),r.indexOf(1)===-1&&r.push(1);for(let g=0,x=r.length;g<x;g++)u=r[g],d=o.get(u),d[s]<l&&(l=d[s]),d[s]>c&&(c=d[s]);return{min:l,mid:(l+c)/2,max:c,size:c-l}},align:function(o,s){const r=s.p1.x,l=s.p1.y,c=-ln(s.p2.y-l,s.p2.x-r),u=function(d){return{x:(d.x-r)*ri(c)-(d.y-l)*Ui(c),y:(d.x-r)*Ui(c)+(d.y-l)*ri(c)}};return o.map(u)},roots:function(o,s){s=s||{p1:{x:0,y:0},p2:{x:1,y:0}};const r=o.length-1,l=Te.align(o,s),c=function(de){return 0<=de&&de<=1};if(r===2){const de=l[0].y,_e=l[1].y,pe=l[2].y,Ce=de-2*_e+pe;if(Ce!==0){const ke=-di(_e*_e-de*pe),Se=-de+_e,Oe=-(ke+Se)/Ce,Pe=-(-ke+Se)/Ce;return[Oe,Pe].filter(c)}else if(_e!==pe&&Ce===0)return[(2*_e-pe)/(2*_e-2*pe)].filter(c);return[]}const u=l[0].y,d=l[1].y,g=l[2].y,x=l[3].y;let C=-u+3*d-3*g+x,L=3*u-6*d+3*g,A=-3*u+3*d,q=u;if(Te.approximately(C,0)){if(Te.approximately(L,0))return Te.approximately(A,0)?[]:[-q/A].filter(c);const de=di(A*A-4*L*q),_e=2*L;return[(de-A)/_e,(-A-de)/_e].filter(c)}L/=C,A/=C,q/=C;const E=(3*A-L*L)/3,Q=E/3,X=(2*L*L*L-9*L*A+27*q)/27,j=X/2,$=j*j+Q*Q*Q;let he,re,ye,ue,M;if($<0){const de=-E/3,_e=de*de*de,pe=di(_e),Ce=-X/(2*pe),ke=Ce<-1?-1:Ce>1?1:Ce,Se=Go(ke),Oe=hn(pe),Pe=2*Oe;return ye=Pe*ri(Se/3)-L/3,ue=Pe*ri((Se+Xn)/3)-L/3,M=Pe*ri((Se+2*Xn)/3)-L/3,[ye,ue,M].filter(c)}else{if($===0)return he=j<0?hn(-j):-hn(j),ye=2*he-L/3,ue=-he-L/3,[ye,ue].filter(c);{const de=di($);return he=hn(-j+de),re=hn(j+de),[he-re-L/3].filter(c)}}},droots:function(o){if(o.length===3){const s=o[0],r=o[1],l=o[2],c=s-2*r+l;if(c!==0){const u=-di(r*r-s*l),d=-s+r,g=-(u+d)/c,x=-(-u+d)/c;return[g,x]}else if(r!==l&&c===0)return[(2*r-l)/(2*(r-l))];return[]}if(o.length===2){const s=o[0],r=o[1];return s!==r?[s/(s-r)]:[]}return[]},curvature:function(o,s,r,l,c){let u,d,g,x,C=0,L=0;const A=Te.compute(o,s),q=Te.compute(o,r),E=A.x*A.x+A.y*A.y;if(l?(u=di(Ht(A.y*q.z-q.y*A.z,2)+Ht(A.z*q.x-q.z*A.x,2)+Ht(A.x*q.y-q.x*A.y,2)),d=Ht(E+A.z*A.z,3/2)):(u=A.x*q.y-A.y*q.x,d=Ht(E,3/2)),u===0||d===0)return{k:0,r:0};if(C=u/d,L=d/u,!c){const Q=Te.curvature(o-.001,s,r,l,!0).k,X=Te.curvature(o+.001,s,r,l,!0).k;x=(X-C+(C-Q))/2,g=(un(X-C)+un(C-Q))/2}return{k:C,r:L,dk:x,adk:g}},inflections:function(o){if(o.length<4)return[];const s=Te.align(o,{p1:o[0],p2:o.slice(-1)[0]}),r=s[2].x*s[1].y,l=s[3].x*s[1].y,c=s[1].x*s[2].y,u=s[3].x*s[2].y,d=18*(-3*r+2*l+3*c-u),g=18*(3*r-l-3*c),x=18*(c-r);if(Te.approximately(d,0)){if(!Te.approximately(g,0)){let q=-x/g;if(0<=q&&q<=1)return[q]}return[]}const C=2*d;if(Te.approximately(C,0))return[];const L=g*g-4*d*x;if(L<0)return[];const A=Math.sqrt(L);return[(A-g)/C,-(g+A)/C].filter(function(q){return 0<=q&&q<=1})},bboxoverlap:function(o,s){const r=["x","y"],l=r.length;for(let c=0,u,d,g,x;c<l;c++)if(u=r[c],d=o[u].mid,g=s[u].mid,x=(o[u].size+s[u].size)/2,un(d-g)>=x)return!1;return!0},expandbox:function(o,s){s.x.min<o.x.min&&(o.x.min=s.x.min),s.y.min<o.y.min&&(o.y.min=s.y.min),s.z&&s.z.min<o.z.min&&(o.z.min=s.z.min),s.x.max>o.x.max&&(o.x.max=s.x.max),s.y.max>o.y.max&&(o.y.max=s.y.max),s.z&&s.z.max>o.z.max&&(o.z.max=s.z.max),o.x.mid=(o.x.min+o.x.max)/2,o.y.mid=(o.y.min+o.y.max)/2,o.z&&(o.z.mid=(o.z.min+o.z.max)/2),o.x.size=o.x.max-o.x.min,o.y.size=o.y.max-o.y.min,o.z&&(o.z.size=o.z.max-o.z.min)},pairiteration:function(o,s,r){const l=o.bbox(),c=s.bbox(),u=1e5,d=r||.5;if(l.x.size+l.y.size<d&&c.x.size+c.y.size<d)return[(u*(o._t1+o._t2)/2|0)/u+"/"+(u*(s._t1+s._t2)/2|0)/u];let g=o.split(.5),x=s.split(.5),C=[{left:g.left,right:x.left},{left:g.left,right:x.right},{left:g.right,right:x.right},{left:g.right,right:x.left}];C=C.filter(function(A){return Te.bboxoverlap(A.left.bbox(),A.right.bbox())});let L=[];return C.length===0||(C.forEach(function(A){L=L.concat(Te.pairiteration(A.left,A.right,d))}),L=L.filter(function(A,q){return L.indexOf(A)===q})),L},getccenter:function(o,s,r){const l=s.x-o.x,c=s.y-o.y,u=r.x-s.x,d=r.y-s.y,g=l*ri(pi)-c*Ui(pi),x=l*Ui(pi)+c*ri(pi),C=u*ri(pi)-d*Ui(pi),L=u*Ui(pi)+d*ri(pi),A=(o.x+s.x)/2,q=(o.y+s.y)/2,E=(s.x+r.x)/2,Q=(s.y+r.y)/2,X=A+g,j=q+x,$=E+C,he=Q+L,re=Te.lli8(A,q,X,j,E,Q,$,he),ye=Te.dist(re,o);let ue=ln(o.y-re.y,o.x-re.x),M=ln(s.y-re.y,s.x-re.x),de=ln(r.y-re.y,r.x-re.x),_e;return ue<de?((ue>M||M>de)&&(ue+=Xn),ue>de&&(_e=de,de=ue,ue=_e)):de<M&&M<ue?(_e=de,de=ue,ue=_e):de+=Xn,re.s=ue,re.e=de,re.r=ye,re},numberSort:function(o,s){return o-s}};class mn{constructor(s){this.curves=[],this._3d=!1,s&&(this.curves=s,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(s){return Te.pointsToString(s.points)}).join(", ")+"]"}addCurve(s){this.curves.push(s),this._3d=this._3d||s._3d}length(){return this.curves.map(function(s){return s.length()}).reduce(function(s,r){return s+r})}curve(s){return this.curves[s]}bbox(){const s=this.curves;for(var r=s[0].bbox(),l=1;l<s.length;l++)Te.expandbox(r,s[l].bbox());return r}offset(s){const r=[];return this.curves.forEach(function(l){r.push(...l.offset(s))}),new mn(r)}}const{abs:cn,min:As,max:Ts,cos:Zo,sin:Xo,acos:Ko,sqrt:fn}=Math,$o=Math.PI;class ct{constructor(s){let r=s&&s.forEach?s:Array.from(arguments).slice(),l=!1;if(typeof r[0]=="object"){l=r.length;const E=[];r.forEach(function(Q){["x","y","z"].forEach(function(X){typeof Q[X]<"u"&&E.push(Q[X])})}),r=E}let c=!1;const u=r.length;if(l){if(l>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");c=!0}}else if(u!==6&&u!==8&&u!==9&&u!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const d=this._3d=!c&&(u===9||u===12)||s&&s[0]&&typeof s[0].z<"u",g=this.points=[];for(let E=0,Q=d?3:2;E<u;E+=Q){var x={x:r[E],y:r[E+1]};d&&(x.z=r[E+2]),g.push(x)}const C=this.order=g.length-1,L=this.dims=["x","y"];d&&L.push("z"),this.dimlen=L.length;const A=Te.align(g,{p1:g[0],p2:g[C]}),q=Te.dist(g[0],g[C]);this._linear=A.reduce((E,Q)=>E+cn(Q.y),0)<q/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(s,r,l,c){if(typeof c>"u"&&(c=.5),c===0)return new ct(r,r,l);if(c===1)return new ct(s,r,r);const u=ct.getABC(2,s,r,l,c);return new ct(s,u.A,l)}static cubicFromPoints(s,r,l,c,u){typeof c>"u"&&(c=.5);const d=ct.getABC(3,s,r,l,c);typeof u>"u"&&(u=Te.dist(r,d.C));const g=u*(1-c)/c,x=Te.dist(s,l),C=(l.x-s.x)/x,L=(l.y-s.y)/x,A=u*C,q=u*L,E=g*C,Q=g*L,X={x:r.x-A,y:r.y-q},j={x:r.x+E,y:r.y+Q},$=d.A,he={x:$.x+(X.x-$.x)/(1-c),y:$.y+(X.y-$.y)/(1-c)},re={x:$.x+(j.x-$.x)/c,y:$.y+(j.y-$.y)/c},ye={x:s.x+(he.x-s.x)/c,y:s.y+(he.y-s.y)/c},ue={x:l.x+(re.x-l.x)/(1-c),y:l.y+(re.y-l.y)/(1-c)};return new ct(s,ye,ue,l)}static getUtils(){return Te}getUtils(){return ct.getUtils()}static get PolyBezier(){return mn}valueOf(){return this.toString()}toString(){return Te.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const s=this.points,r=s[0].x,l=s[0].y,c=["M",r,l,this.order===2?"Q":"C"];for(let u=1,d=s.length;u<d;u++)c.push(s[u].x),c.push(s[u].y);return c.join(" ")}setRatios(s){if(s.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=s,this._lut=[]}verify(){const s=this.coordDigest();s!==this._print&&(this._print=s,this.update())}coordDigest(){return this.points.map(function(s,r){return""+r+s.x+s.y+(s.z?s.z:0)}).join("")}update(){this._lut=[],this.dpoints=Te.derive(this.points,this._3d),this.computedirection()}computedirection(){const s=this.points,r=Te.angle(s[0],s[this.order],s[1]);this.clockwise=r>0}length(){return Te.length(this.derivative.bind(this))}static getABC(s=2,r,l,c,u=.5){const d=Te.projectionratio(u,s),g=1-d,x={x:d*r.x+g*c.x,y:d*r.y+g*c.y},C=Te.abcratio(u,s);return{A:{x:l.x+(l.x-x.x)/C,y:l.y+(l.y-x.y)/C},B:l,C:x,S:r,E:c}}getABC(s,r){r=r||this.get(s);let l=this.points[0],c=this.points[this.order];return ct.getABC(this.order,l,r,c,s)}getLUT(s){if(this.verify(),s=s||100,this._lut.length===s+1)return this._lut;this._lut=[],s++,this._lut=[];for(let r=0,l,c;r<s;r++)c=r/(s-1),l=this.compute(c),l.t=c,this._lut.push(l);return this._lut}on(s,r){r=r||5;const l=this.getLUT(),c=[];for(let u=0,d,g=0;u<l.length;u++)d=l[u],Te.dist(d,s)<r&&(c.push(d),g+=u/l.length);return c.length?t/=c.length:!1}project(s){const r=this.getLUT(),l=r.length-1,c=Te.closest(r,s),u=c.mpos,d=(u-1)/l,g=(u+1)/l,x=.1/l;let C=c.mdist,L=d,A=L,q;C+=1;for(let E;L<g+x;L+=x)q=this.compute(L),E=Te.dist(s,q),E<C&&(C=E,A=L);return A=A<0?0:A>1?1:A,q=this.compute(A),q.t=A,q.d=C,q}get(s){return this.compute(s)}point(s){return this.points[s]}compute(s){return this.ratios?Te.computeWithRatios(s,this.points,this.ratios,this._3d):Te.compute(s,this.points,this._3d,this.ratios)}raise(){const s=this.points,r=[s[0]],l=s.length;for(let c=1,u,d;c<l;c++)u=s[c],d=s[c-1],r[c]={x:(l-c)/l*u.x+c/l*d.x,y:(l-c)/l*u.y+c/l*d.y};return r[l]=s[l-1],new ct(r)}derivative(s){return Te.compute(s,this.dpoints[0],this._3d)}dderivative(s){return Te.compute(s,this.dpoints[1],this._3d)}align(){let s=this.points;return new ct(Te.align(s,{p1:s[0],p2:s[s.length-1]}))}curvature(s){return Te.curvature(s,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Te.inflections(this.points)}normal(s){return this._3d?this.__normal3(s):this.__normal2(s)}__normal2(s){const r=this.derivative(s),l=fn(r.x*r.x+r.y*r.y);return{t:s,x:-r.y/l,y:r.x/l}}__normal3(s){const r=this.derivative(s),l=this.derivative(s+.01),c=fn(r.x*r.x+r.y*r.y+r.z*r.z),u=fn(l.x*l.x+l.y*l.y+l.z*l.z);r.x/=c,r.y/=c,r.z/=c,l.x/=u,l.y/=u,l.z/=u;const d={x:l.y*r.z-l.z*r.y,y:l.z*r.x-l.x*r.z,z:l.x*r.y-l.y*r.x},g=fn(d.x*d.x+d.y*d.y+d.z*d.z);d.x/=g,d.y/=g,d.z/=g;const x=[d.x*d.x,d.x*d.y-d.z,d.x*d.z+d.y,d.x*d.y+d.z,d.y*d.y,d.y*d.z-d.x,d.x*d.z-d.y,d.y*d.z+d.x,d.z*d.z];return{t:s,x:x[0]*r.x+x[1]*r.y+x[2]*r.z,y:x[3]*r.x+x[4]*r.y+x[5]*r.z,z:x[6]*r.x+x[7]*r.y+x[8]*r.z}}hull(s){let r=this.points,l=[],c=[],u=0;for(c[u++]=r[0],c[u++]=r[1],c[u++]=r[2],this.order===3&&(c[u++]=r[3]);r.length>1;){l=[];for(let d=0,g,x=r.length-1;d<x;d++)g=Te.lerp(s,r[d],r[d+1]),c[u++]=g,l.push(g);r=l}return c}split(s,r){if(s===0&&r)return this.split(r).left;if(r===1)return this.split(s).right;const l=this.hull(s),c={left:this.order===2?new ct([l[0],l[3],l[5]]):new ct([l[0],l[4],l[7],l[9]]),right:this.order===2?new ct([l[5],l[4],l[2]]):new ct([l[9],l[8],l[6],l[3]]),span:l};return c.left._t1=Te.map(0,0,1,this._t1,this._t2),c.left._t2=Te.map(s,0,1,this._t1,this._t2),c.right._t1=Te.map(s,0,1,this._t1,this._t2),c.right._t2=Te.map(1,0,1,this._t1,this._t2),r?(r=Te.map(r,s,1,0,1),c.right.split(r).left):c}extrema(){const s={};let r=[];return this.dims.forEach((function(l){let c=function(d){return d[l]},u=this.dpoints[0].map(c);s[l]=Te.droots(u),this.order===3&&(u=this.dpoints[1].map(c),s[l]=s[l].concat(Te.droots(u))),s[l]=s[l].filter(function(d){return d>=0&&d<=1}),r=r.concat(s[l].sort(Te.numberSort))}).bind(this)),s.values=r.sort(Te.numberSort).filter(function(l,c){return r.indexOf(l)===c}),s}bbox(){const s=this.extrema(),r={};return this.dims.forEach((function(l){r[l]=Te.getminmax(this,l,s[l])}).bind(this)),r}overlaps(s){const r=this.bbox(),l=s.bbox();return Te.bboxoverlap(r,l)}offset(s,r){if(typeof r<"u"){const l=this.get(s),c=this.normal(s),u={c:l,n:c,x:l.x+c.x*r,y:l.y+c.y*r};return this._3d&&(u.z=l.z+c.z*r),u}if(this._linear){const l=this.normal(0),c=this.points.map(function(u){const d={x:u.x+s*l.x,y:u.y+s*l.y};return u.z&&l.z&&(d.z=u.z+s*l.z),d});return[new ct(c)]}return this.reduce().map(function(l){return l._linear?l.offset(s)[0]:l.scale(s)})}simple(){if(this.order===3){const c=Te.angle(this.points[0],this.points[3],this.points[1]),u=Te.angle(this.points[0],this.points[3],this.points[2]);if(c>0&&u<0||c<0&&u>0)return!1}const s=this.normal(0),r=this.normal(1);let l=s.x*r.x+s.y*r.y;return this._3d&&(l+=s.z*r.z),cn(Ko(l))<$o/3}reduce(){let s,r=0,l=0,c=.01,u,d=[],g=[],x=this.extrema().values;for(x.indexOf(0)===-1&&(x=[0].concat(x)),x.indexOf(1)===-1&&x.push(1),r=x[0],s=1;s<x.length;s++)l=x[s],u=this.split(r,l),u._t1=r,u._t2=l,d.push(u),r=l;return d.forEach(function(C){for(r=0,l=0;l<=1;)for(l=r+c;l<=1+c;l+=c)if(u=C.split(r,l),!u.simple()){if(l-=c,cn(r-l)<c)return[];u=C.split(r,l),u._t1=Te.map(r,0,1,C._t1,C._t2),u._t2=Te.map(l,0,1,C._t1,C._t2),g.push(u),r=l;break}r<1&&(u=C.split(r,1),u._t1=Te.map(r,0,1,C._t1,C._t2),u._t2=C._t2,g.push(u))}),g}translate(s,r,l){l=typeof l=="number"?l:r;const c=this.order;let u=this.points.map((d,g)=>(1-g/c)*r+g/c*l);return new ct(this.points.map((d,g)=>({x:d.x+s.x*u[g],y:d.y+s.y*u[g]})))}scale(s){const r=this.order;let l=!1;if(typeof s=="function"&&(l=s),l&&r===2)return this.raise().scale(l);const c=this.clockwise,u=this.points;if(this._linear)return this.translate(this.normal(0),l?l(0):s,l?l(1):s);const d=l?l(0):s,g=l?l(1):s,x=[this.offset(0,10),this.offset(1,10)],C=[],L=Te.lli4(x[0],x[0].c,x[1],x[1].c);if(!L)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(A){const q=C[A*r]=Te.copy(u[A*r]);q.x+=(A?g:d)*x[A].n.x,q.y+=(A?g:d)*x[A].n.y}),l?([0,1].forEach(function(A){if(!(r===2&&A)){var q=u[A+1],E={x:q.x-L.x,y:q.y-L.y},Q=l?l((A+1)/r):s;l&&!c&&(Q=-Q);var X=fn(E.x*E.x+E.y*E.y);E.x/=X,E.y/=X,C[A+1]={x:q.x+Q*E.x,y:q.y+Q*E.y}}}),new ct(C)):([0,1].forEach(A=>{if(r===2&&A)return;const q=C[A*r],E=this.derivative(A),Q={x:q.x+E.x,y:q.y+E.y};C[A+1]=Te.lli4(q,Q,L,u[A+1])}),new ct(C))}outline(s,r,l,c){if(r=r===void 0?s:r,this._linear){const ue=this.normal(0),M=this.points[0],de=this.points[this.points.length-1];let _e,pe,Ce;l===void 0&&(l=s,c=r),_e={x:M.x+ue.x*s,y:M.y+ue.y*s},Ce={x:de.x+ue.x*l,y:de.y+ue.y*l},pe={x:(_e.x+Ce.x)/2,y:(_e.y+Ce.y)/2};const ke=[_e,pe,Ce];_e={x:M.x-ue.x*r,y:M.y-ue.y*r},Ce={x:de.x-ue.x*c,y:de.y-ue.y*c},pe={x:(_e.x+Ce.x)/2,y:(_e.y+Ce.y)/2};const Se=[Ce,pe,_e],Oe=Te.makeline(Se[2],ke[0]),Pe=Te.makeline(ke[2],Se[0]),Je=[Oe,new ct(ke),Pe,new ct(Se)];return new mn(Je)}const u=this.reduce(),d=u.length,g=[];let x=[],C,L=0,A=this.length();const q=typeof l<"u"&&typeof c<"u";function E(ue,M,de,_e,pe){return function(Ce){const ke=_e/de,Se=(_e+pe)/de,Oe=M-ue;return Te.map(Ce,0,1,ue+ke*Oe,ue+Se*Oe)}}u.forEach(function(ue){const M=ue.length();q?(g.push(ue.scale(E(s,l,A,L,M))),x.push(ue.scale(E(-r,-c,A,L,M)))):(g.push(ue.scale(s)),x.push(ue.scale(-r))),L+=M}),x=x.map(function(ue){return C=ue.points,C[3]?ue.points=[C[3],C[2],C[1],C[0]]:ue.points=[C[2],C[1],C[0]],ue}).reverse();const Q=g[0].points[0],X=g[d-1].points[g[d-1].points.length-1],j=x[d-1].points[x[d-1].points.length-1],$=x[0].points[0],he=Te.makeline(j,Q),re=Te.makeline(X,$),ye=[he].concat(g).concat([re]).concat(x);return new mn(ye)}outlineshapes(s,r,l){r=r||s;const c=this.outline(s,r).curves,u=[];for(let d=1,g=c.length;d<g/2;d++){const x=Te.makeshape(c[d],c[g-d],l);x.startcap.virtual=d>1,x.endcap.virtual=d<g/2-1,u.push(x)}return u}intersects(s,r){return s?s.p1&&s.p2?this.lineIntersects(s):(s instanceof ct&&(s=s.reduce()),this.curveintersects(this.reduce(),s,r)):this.selfintersects(r)}lineIntersects(s){const r=As(s.p1.x,s.p2.x),l=As(s.p1.y,s.p2.y),c=Ts(s.p1.x,s.p2.x),u=Ts(s.p1.y,s.p2.y);return Te.roots(this.points,s).filter(d=>{var g=this.get(d);return Te.between(g.x,r,c)&&Te.between(g.y,l,u)})}selfintersects(s){const r=this.reduce(),l=r.length-2,c=[];for(let u=0,d,g,x;u<l;u++)g=r.slice(u,u+1),x=r.slice(u+2),d=this.curveintersects(g,x,s),c.push(...d);return c}curveintersects(s,r,l){const c=[];s.forEach(function(d){r.forEach(function(g){d.overlaps(g)&&c.push({left:d,right:g})})});let u=[];return c.forEach(function(d){const g=Te.pairiteration(d.left,d.right,l);g.length>0&&(u=u.concat(g))}),u}arcs(s){return s=s||.5,this._iterate(s,[])}_error(s,r,l,c){const u=(c-l)/4,d=this.get(l+u),g=this.get(c-u),x=Te.dist(s,r),C=Te.dist(s,d),L=Te.dist(s,g);return cn(C-x)+cn(L-x)}_iterate(s,r){let l=0,c=1,u;do{u=0,c=1;let d=this.get(l),g,x,C,L,A=!1,q=!1,E,Q=c,X=1;do if(q=A,L=C,Q=(l+c)/2,g=this.get(Q),x=this.get(c),C=Te.getccenter(d,g,x),C.interval={start:l,end:c},A=this._error(C,d,l,c)<=s,E=q&&!A,E||(X=c),A){if(c>=1){if(C.interval.end=X=1,L=C,c>1){let $={x:C.x+C.r*Zo(C.e),y:C.y+C.r*Xo(C.e)};C.e+=Te.angle({x:C.x,y:C.y},$,this.get(1))}break}c=c+(c-l)/2}else c=Q;while(!E&&u++<100);if(u>=100)break;L=L||C,r.push(L),l=X}while(c<1);return r}}var Yo=(function(){function o(s,r){var l=[],c=!0,u=!1,d=void 0;try{for(var g=s[Symbol.iterator](),x;!(c=(x=g.next()).done)&&(l.push(x.value),!(r&&l.length===r));c=!0);}catch(C){u=!0,d=C}finally{try{!c&&g.return&&g.return()}finally{if(u)throw d}}return l}return function(s,r){if(Array.isArray(s))return s;if(Symbol.iterator in Object(s))return o(s,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),vn=Math.PI*2,zr=function(s,r,l,c,u,d,g){var x=s.x,C=s.y;x*=r,C*=l;var L=c*x-u*C,A=u*x+c*C;return{x:L+d,y:A+g}},Qo=function(s,r){var l=r===1.5707963267948966?.551915024494:r===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(r/4),c=Math.cos(s),u=Math.sin(s),d=Math.cos(s+r),g=Math.sin(s+r);return[{x:c-u*l,y:u+c*l},{x:d+g*l,y:g-d*l},{x:d,y:g}]},Ms=function(s,r,l,c){var u=s*c-r*l<0?-1:1,d=s*l+r*c;return d>1&&(d=1),d<-1&&(d=-1),u*Math.acos(d)},Jo=function(s,r,l,c,u,d,g,x,C,L,A,q){var E=Math.pow(u,2),Q=Math.pow(d,2),X=Math.pow(A,2),j=Math.pow(q,2),$=E*Q-E*j-Q*X;$<0&&($=0),$/=E*j+Q*X,$=Math.sqrt($)*(g===x?-1:1);var he=$*u/d*q,re=$*-d/u*A,ye=L*he-C*re+(s+l)/2,ue=C*he+L*re+(r+c)/2,M=(A-he)/u,de=(q-re)/d,_e=(-A-he)/u,pe=(-q-re)/d,Ce=Ms(1,0,M,de),ke=Ms(M,de,_e,pe);return x===0&&ke>0&&(ke-=vn),x===1&&ke<0&&(ke+=vn),[ye,ue,Ce,ke]},eu=function(s){var r=s.px,l=s.py,c=s.cx,u=s.cy,d=s.rx,g=s.ry,x=s.xAxisRotation,C=x===void 0?0:x,L=s.largeArcFlag,A=L===void 0?0:L,q=s.sweepFlag,E=q===void 0?0:q,Q=[];if(d===0||g===0)return[];var X=Math.sin(C*vn/360),j=Math.cos(C*vn/360),$=j*(r-c)/2+X*(l-u)/2,he=-X*(r-c)/2+j*(l-u)/2;if($===0&&he===0)return[];d=Math.abs(d),g=Math.abs(g);var re=Math.pow($,2)/Math.pow(d,2)+Math.pow(he,2)/Math.pow(g,2);re>1&&(d*=Math.sqrt(re),g*=Math.sqrt(re));var ye=Jo(r,l,c,u,d,g,A,E,X,j,$,he),ue=Yo(ye,4),M=ue[0],de=ue[1],_e=ue[2],pe=ue[3],Ce=Math.abs(pe)/(vn/4);Math.abs(1-Ce)<1e-7&&(Ce=1);var ke=Math.max(Math.ceil(Ce),1);pe/=ke;for(var Se=0;Se<ke;Se++)Q.push(Qo(_e,pe)),_e+=pe;return Q.map(function(Oe){var Pe=zr(Oe[0],d,g,j,X,M,de),Je=Pe.x,me=Pe.y,Ke=zr(Oe[1],d,g,j,X,M,de),rt=Ke.x,Ve=Ke.y,tt=zr(Oe[2],d,g,j,X,M,de),Kt=tt.x,Bt=tt.y;return{x1:Je,y1:me,x2:rt,y2:Ve,x:Kt,y:Bt}})};function tu(o,s){return o>s?1:o<s?-1:0}class ns{constructor(s=tu,r=!1){this._compare=s,this._root=null,this._size=0,this._noDuplicates=!!r}rotateLeft(s){var r=s.right;r&&(s.right=r.left,r.left&&(r.left.parent=s),r.parent=s.parent),s.parent?s===s.parent.left?s.parent.left=r:s.parent.right=r:this._root=r,r&&(r.left=s),s.parent=r}rotateRight(s){var r=s.left;r&&(s.left=r.right,r.right&&(r.right.parent=s),r.parent=s.parent),s.parent?s===s.parent.left?s.parent.left=r:s.parent.right=r:this._root=r,r&&(r.right=s),s.parent=r}_splay(s){for(;s.parent;){var r=s.parent;r.parent?r.left===s&&r.parent.left===r?(this.rotateRight(r.parent),this.rotateRight(r)):r.right===s&&r.parent.right===r?(this.rotateLeft(r.parent),this.rotateLeft(r)):r.left===s&&r.parent.right===r?(this.rotateRight(r),this.rotateLeft(r)):(this.rotateLeft(r),this.rotateRight(r)):r.left===s?this.rotateRight(r):this.rotateLeft(r)}}splay(s){for(var r,l,c,u,d;s.parent;)r=s.parent,l=r.parent,l&&l.parent?(c=l.parent,c.left===l?c.left=s:c.right=s,s.parent=c):(s.parent=null,this._root=s),u=s.left,d=s.right,s===r.left?(l&&(l.left===r?(r.right?(l.left=r.right,l.left.parent=l):l.left=null,r.right=l,l.parent=r):(u?(l.right=u,u.parent=l):l.right=null,s.left=l,l.parent=s)),d?(r.left=d,d.parent=r):r.left=null,s.right=r,r.parent=s):(l&&(l.right===r?(r.left?(l.right=r.left,l.right.parent=l):l.right=null,r.left=l,l.parent=r):(d?(l.left=d,d.parent=l):l.left=null,s.right=l,l.parent=s)),u?(r.right=u,u.parent=r):r.right=null,s.left=r,r.parent=s)}replace(s,r){s.parent?s===s.parent.left?s.parent.left=r:s.parent.right=r:this._root=r,r&&(r.parent=s.parent)}minNode(s=this._root){if(s)for(;s.left;)s=s.left;return s}maxNode(s=this._root){if(s)for(;s.right;)s=s.right;return s}insert(s,r){var l=this._root,c=null,u=this._compare,d;if(this._noDuplicates)for(;l;){if(c=l,d=u(l.key,s),d===0)return;u(l.key,s)<0?l=l.right:l=l.left}else for(;l;)c=l,u(l.key,s)<0?l=l.right:l=l.left;return l={key:s,data:r,left:null,right:null,parent:c},c?u(c.key,l.key)<0?c.right=l:c.left=l:this._root=l,this.splay(l),this._size++,l}find(s){for(var r=this._root,l=this._compare;r;){var c=l(r.key,s);if(c<0)r=r.right;else if(c>0)r=r.left;else return r}return null}contains(s){for(var r=this._root,l=this._compare;r;){var c=l(s,r.key);if(c===0)return!0;c<0?r=r.left:r=r.right}return!1}remove(s){var r=this.find(s);if(!r)return!1;if(this.splay(r),!r.left)this.replace(r,r.right);else if(!r.right)this.replace(r,r.left);else{var l=this.minNode(r.right);l.parent!==r&&(this.replace(l,l.right),l.right=r.right,l.right.parent=l),this.replace(r,l),l.left=r.left,l.left.parent=l}return this._size--,!0}removeNode(s){if(!s)return!1;if(this.splay(s),!s.left)this.replace(s,s.right);else if(!s.right)this.replace(s,s.left);else{var r=this.minNode(s.right);r.parent!==s&&(this.replace(r,r.right),r.right=s.right,r.right.parent=r),this.replace(s,r),r.left=s.left,r.left.parent=r}return this._size--,!0}erase(s){var r=this.find(s);if(r){this.splay(r);var l=r.left,c=r.right,u=null;l&&(l.parent=null,u=this.maxNode(l),this.splay(u),this._root=u),c&&(l?u.right=c:this._root=c,c.parent=u),this._size--}}pop(){var s=this._root,r=null;if(s){for(;s.left;)s=s.left;r={key:s.key,data:s.data},this.remove(s.key)}return r}next(s){var r=s;if(r)if(r.right)for(r=r.right;r&&r.left;)r=r.left;else for(r=s.parent;r&&r.right===s;)s=r,r=r.parent;return r}prev(s){var r=s;if(r)if(r.left)for(r=r.left;r&&r.right;)r=r.right;else for(r=s.parent;r&&r.left===s;)s=r,r=r.parent;return r}forEach(s){for(var r=this._root,l=[],c=!1,u=0;!c;)r?(l.push(r),r=r.left):l.length>0?(r=l.pop(),s(r,u++),r=r.right):c=!0;return this}range(s,r,l,c){const u=[],d=this._compare;let g=this._root,x;for(;u.length!==0||g;)if(g)u.push(g),g=g.left;else{if(g=u.pop(),x=d(g.key,r),x>0)break;if(d(g.key,s)>=0&&l.call(c,g))return this;g=g.right}return this}keys(){for(var s=this._root,r=[],l=[],c=!1;!c;)s?(r.push(s),s=s.left):r.length>0?(s=r.pop(),l.push(s.key),s=s.right):c=!0;return l}values(){for(var s=this._root,r=[],l=[],c=!1;!c;)s?(r.push(s),s=s.left):r.length>0?(s=r.pop(),l.push(s.data),s=s.right):c=!0;return l}at(s){for(var r=this._root,l=[],c=!1,u=0;!c;)if(r)l.push(r),r=r.left;else if(l.length>0){if(r=l.pop(),u===s)return r;u++,r=r.right}else c=!0;return null}load(s=[],r=[],l=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const c=s.length;return l&&Kr(s,r,0,c-1,this._compare),this._root=Xr(null,s,r,0,c),this._size=c,this}min(){var s=this.minNode(this._root);return s?s.key:null}max(){var s=this.maxNode(this._root);return s?s.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(s,r,l,c,u){return new ns(l,u).load(s,r,c)}}function Xr(o,s,r,l,c){const u=c-l;if(u>0){const d=l+Math.floor(u/2),g=s[d],x=r[d],C={key:g,data:x,parent:o};return C.left=Xr(C,s,r,l,d),C.right=Xr(C,s,r,d+1,c),C}return null}function Kr(o,s,r,l,c){if(r>=l)return;const u=o[r+l>>1];let d=r-1,g=l+1;for(;;){do d++;while(c(o[d],u)<0);do g--;while(c(o[g],u)>0);if(d>=g)break;let x=o[d];o[d]=o[g],o[g]=x,x=s[d],s[d]=s[g],s[g]=x}Kr(o,s,r,g,c),Kr(o,s,g+1,l,c)}const fa=0,da=1,pa=2,ga=3,or=0,$r=1,ur=2,ma=3;function dn(o,s,r){s===null?(o.inOut=!1,o.otherInOut=!0):(o.isSubject===s.isSubject?(o.inOut=!s.inOut,o.otherInOut=s.otherInOut):(o.inOut=!s.otherInOut,o.otherInOut=s.isVertical()?!s.inOut:s.inOut),s&&(o.prevInResult=!zs(s,r)||s.isVertical()?s.prevInResult:s)),zs(o,r)?o.resultTransition=iu(o,r):o.resultTransition=0}function zs(o,s){switch(o.type){case fa:switch(s){case or:return!o.otherInOut;case $r:return o.otherInOut;case ur:return o.isSubject&&o.otherInOut||!o.isSubject&&!o.otherInOut;case ma:return!0}break;case pa:return s===or||s===$r;case ga:return s===ur;case da:return!1}return!1}function iu(o,s){let r=!o.inOut,l=!o.otherInOut,c;switch(s){case or:c=r&&l;break;case $r:c=r||l;break;case ma:c=r^l;break;case ur:o.isSubject?c=r&&!l:c=l&&!r;break}return c?1:-1}class Xi{constructor(s,r,l,c,u){this.left=r,this.point=s,this.otherEvent=l,this.isSubject=c,this.type=u||fa,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(s){const r=this.point,l=this.otherEvent.point;return this.left?(r[0]-s[0])*(l[1]-s[1])-(l[0]-s[0])*(r[1]-s[1])>0:(l[0]-s[0])*(r[1]-s[1])-(r[0]-s[0])*(l[1]-s[1])>0}isAbove(s){return!this.isBelow(s)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const s=new Xi(this.point,this.left,this.otherEvent,this.isSubject,this.type);return s.contourId=this.contourId,s.resultTransition=this.resultTransition,s.prevInResult=this.prevInResult,s.isExteriorRing=this.isExteriorRing,s.inOut=this.inOut,s.otherInOut=this.otherInOut,s}}function Qt(o,s){return o[0]===s[0]?o[1]===s[1]:!1}const si=11102230246251565e-32,At=134217729,nu=(3+8*si)*si;function Lr(o,s,r,l,c){let u,d,g,x,C=s[0],L=l[0],A=0,q=0;L>C==L>-C?(u=C,C=s[++A]):(u=L,L=l[++q]);let E=0;if(A<o&&q<r)for(L>C==L>-C?(d=C+u,g=u-(d-C),C=s[++A]):(d=L+u,g=u-(d-L),L=l[++q]),u=d,g!==0&&(c[E++]=g);A<o&&q<r;)L>C==L>-C?(d=u+C,x=d-u,g=u-(d-x)+(C-x),C=s[++A]):(d=u+L,x=d-u,g=u-(d-x)+(L-x),L=l[++q]),u=d,g!==0&&(c[E++]=g);for(;A<o;)d=u+C,x=d-u,g=u-(d-x)+(C-x),C=s[++A],u=d,g!==0&&(c[E++]=g);for(;q<r;)d=u+L,x=d-u,g=u-(d-x)+(L-x),L=l[++q],u=d,g!==0&&(c[E++]=g);return(u!==0||E===0)&&(c[E++]=u),E}function ru(o,s){let r=s[0];for(let l=1;l<o;l++)r+=s[l];return r}function zn(o){return new Float64Array(o)}const su=(3+16*si)*si,au=(2+12*si)*si,ou=(9+64*si)*si*si,qi=zn(4),Ls=zn(8),Os=zn(12),Ns=zn(16),zt=zn(4);function uu(o,s,r,l,c,u,d){let g,x,C,L,A,q,E,Q,X,j,$,he,re,ye,ue,M,de,_e;const pe=o-c,Ce=r-c,ke=s-u,Se=l-u;ye=pe*Se,q=At*pe,E=q-(q-pe),Q=pe-E,q=At*Se,X=q-(q-Se),j=Se-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=ke*Ce,q=At*ke,E=q-(q-ke),Q=ke-E,q=At*Ce,X=q-(q-Ce),j=Ce-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,qi[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,qi[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,qi[2]=he-(_e-A)+($-A),qi[3]=_e;let Oe=ru(4,qi),Pe=au*d;if(Oe>=Pe||-Oe>=Pe||(A=o-pe,g=o-(pe+A)+(A-c),A=r-Ce,C=r-(Ce+A)+(A-c),A=s-ke,x=s-(ke+A)+(A-u),A=l-Se,L=l-(Se+A)+(A-u),g===0&&x===0&&C===0&&L===0)||(Pe=ou*d+nu*Math.abs(Oe),Oe+=pe*L+Se*g-(ke*C+Ce*x),Oe>=Pe||-Oe>=Pe))return Oe;ye=g*Se,q=At*g,E=q-(q-g),Q=g-E,q=At*Se,X=q-(q-Se),j=Se-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=x*Ce,q=At*x,E=q-(q-x),Q=x-E,q=At*Ce,X=q-(q-Ce),j=Ce-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,zt[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,zt[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,zt[2]=he-(_e-A)+($-A),zt[3]=_e;const Je=Lr(4,qi,4,zt,Ls);ye=pe*L,q=At*pe,E=q-(q-pe),Q=pe-E,q=At*L,X=q-(q-L),j=L-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=ke*C,q=At*ke,E=q-(q-ke),Q=ke-E,q=At*C,X=q-(q-C),j=C-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,zt[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,zt[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,zt[2]=he-(_e-A)+($-A),zt[3]=_e;const me=Lr(Je,Ls,4,zt,Os);ye=g*L,q=At*g,E=q-(q-g),Q=g-E,q=At*L,X=q-(q-L),j=L-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=x*C,q=At*x,E=q-(q-x),Q=x-E,q=At*C,X=q-(q-C),j=C-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,zt[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,zt[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,zt[2]=he-(_e-A)+($-A),zt[3]=_e;const Ke=Lr(me,Os,4,zt,Ns);return Ns[Ke-1]}function lu(o,s,r,l,c,u){const d=(s-u)*(r-c),g=(o-c)*(l-u),x=d-g;if(d===0||g===0||d>0!=g>0)return x;const C=Math.abs(d+g);return Math.abs(x)>=su*C?x:-uu(o,s,r,l,c,u,C)}function Yr(o,s,r){const l=lu(o[0],o[1],s[0],s[1],r[0],r[1]);return l>0?-1:l<0?1:0}function mi(o,s){const r=o.point,l=s.point;return r[0]>l[0]?1:r[0]<l[0]?-1:r[1]!==l[1]?r[1]>l[1]?1:-1:hu(o,s,r)}function hu(o,s,r,l){return o.left!==s.left?o.left?1:-1:Yr(r,o.otherEvent.point,s.otherEvent.point)!==0?o.isBelow(s.otherEvent.point)?-1:1:!o.isSubject&&s.isSubject?1:-1}function gi(o,s,r){const l=new Xi(s,!1,o,o.isSubject),c=new Xi(s,!0,o.otherEvent,o.isSubject);return Qt(o.point,o.otherEvent.point)&&console.warn("what is that, a collapsed segment?",o),l.contourId=c.contourId=o.contourId,mi(c,o.otherEvent)>0&&(o.otherEvent.left=!0,c.left=!1),o.otherEvent.otherEvent=c,o.otherEvent=l,r.push(c),r.push(l),r}function Kn(o,s){return o[0]*s[1]-o[1]*s[0]}function Or(o,s){return o[0]*s[0]+o[1]*s[1]}function cu(o,s,r,l,c){const u=[s[0]-o[0],s[1]-o[1]],d=[l[0]-r[0],l[1]-r[1]];function g(j,$,he){return[j[0]+$*he[0],j[1]+$*he[1]]}const x=[r[0]-o[0],r[1]-o[1]];let C=Kn(u,d),L=C*C;const A=Or(u,u);if(L>0){const j=Kn(x,d)/C;if(j<0||j>1)return null;const $=Kn(x,u)/C;return $<0||$>1?null:j===0||j===1?[g(o,j,u)]:$===0||$===1?[g(r,$,d)]:[g(o,j,u)]}if(C=Kn(x,u),L=C*C,L>0)return null;const q=Or(u,x)/A,E=q+Or(u,d)/A,Q=Math.min(q,E),X=Math.max(q,E);return Q<=1&&X>=0?Q===1?[g(o,Q>0?Q:0,u)]:X===0?[g(o,X<1?X:1,u)]:[g(o,Q>0?Q:0,u),g(o,X<1?X:1,u)]:null}function Nr(o,s,r){const l=cu(o.point,o.otherEvent.point,s.point,s.otherEvent.point),c=l?l.length:0;if(c===0||c===1&&(Qt(o.point,s.point)||Qt(o.otherEvent.point,s.otherEvent.point))||c===2&&o.isSubject===s.isSubject)return 0;if(c===1)return!Qt(o.point,l[0])&&!Qt(o.otherEvent.point,l[0])&&gi(o,l[0],r),!Qt(s.point,l[0])&&!Qt(s.otherEvent.point,l[0])&&gi(s,l[0],r),1;const u=[];let d=!1,g=!1;return Qt(o.point,s.point)?d=!0:mi(o,s)===1?u.push(s,o):u.push(o,s),Qt(o.otherEvent.point,s.otherEvent.point)?g=!0:mi(o.otherEvent,s.otherEvent)===1?u.push(s.otherEvent,o.otherEvent):u.push(o.otherEvent,s.otherEvent),d&&g||d?(s.type=da,o.type=s.inOut===o.inOut?pa:ga,d&&!g&&gi(u[1].otherEvent,u[0].point,r),2):g?(gi(u[0],u[1].point,r),3):u[0]!==u[3].otherEvent?(gi(u[0],u[1].point,r),gi(u[1],u[2].point,r),3):(gi(u[0],u[1].point,r),gi(u[3].otherEvent,u[2].point,r),3)}function fu(o,s){if(o===s)return 0;if(Yr(o.point,o.otherEvent.point,s.point)!==0||Yr(o.point,o.otherEvent.point,s.otherEvent.point)!==0)return Qt(o.point,s.point)?o.isBelow(s.otherEvent.point)?-1:1:o.point[0]===s.point[0]?o.point[1]<s.point[1]?-1:1:mi(o,s)===1?s.isAbove(o.point)?-1:1:o.isBelow(s.point)?-1:1;if(o.isSubject===s.isSubject){let r=o.point,l=s.point;if(r[0]===l[0]&&r[1]===l[1])return r=o.otherEvent.point,l=s.otherEvent.point,r[0]===l[0]&&r[1]===l[1]?0:o.contourId>s.contourId?1:-1}else return o.isSubject?-1:1;return mi(o,s)===1?1:-1}function du(o,s,r,l,c,u){const d=new ns(fu),g=[],x=Math.min(l[2],c[2]);let C,L,A;for(;o.length!==0;){let q=o.pop();if(g.push(q),q.point[0]>x||u===ur)break;if(q.left){L=C=d.insert(q),A=d.minNode(),C!==A?C=d.prev(C):C=null,L=d.next(L);const E=C?C.key:null;let Q;if(dn(q,E,u),L&&Nr(q,L.key,o)===2&&(dn(q,E,u),dn(L.key,q,u)),C&&Nr(C.key,q,o)===2){let X=C;X!==A?X=d.prev(X):X=null,Q=X?X.key:null,dn(E,Q,u),dn(q,E,u)}}else q=q.otherEvent,L=C=d.find(q),C&&L&&(C!==A?C=d.prev(C):C=null,L=d.next(L),d.remove(q),L&&C&&Nr(C.key,L.key,o))}return g}class pu{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function gu(o){let s,r,l,c;const u=[];for(r=0,l=o.length;r<l;r++)s=o[r],(s.left&&s.inResult||!s.left&&s.otherEvent.inResult)&&u.push(s);let d=!1;for(;!d;)for(d=!0,r=0,l=u.length;r<l;r++)r+1<l&&mi(u[r],u[r+1])===1&&(c=u[r],u[r]=u[r+1],u[r+1]=c,d=!1);for(r=0,l=u.length;r<l;r++)s=u[r],s.otherPos=r;for(r=0,l=u.length;r<l;r++)s=u[r],s.left||(c=s.otherPos,s.otherPos=s.otherEvent.otherPos,s.otherEvent.otherPos=c);return u}function mu(o,s,r,l){let c=o+1,u=s[o].point,d;const g=s.length;for(c<g&&(d=s[c].point);c<g&&d[0]===u[0]&&d[1]===u[1];){if(r[c])c++;else return c;c<g&&(d=s[c].point)}for(c=o-1;r[c]&&c>l;)c--;return c}function vu(o,s,r){const l=new pu;if(o.prevInResult!=null){const c=o.prevInResult,u=c.outputContourId;if(c.resultTransition>0){const g=s[u];if(g.holeOf!=null){const x=g.holeOf;s[x].holeIds.push(r),l.holeOf=x,l.depth=s[u].depth}else s[u].holeIds.push(r),l.holeOf=u,l.depth=s[u].depth+1}else l.holeOf=null,l.depth=s[u].depth}else l.holeOf=null,l.depth=0;return l}function _u(o){let s,r;const l=gu(o),c={},u=[];for(s=0,r=l.length;s<r;s++){if(c[s])continue;const d=u.length,g=vu(l[s],u,d),x=q=>{c[q]=!0,q<l.length&&l[q]&&(l[q].outputContourId=d)};let C=s,L=s;const A=l[s].point;for(g.points.push(A);x(C),C=l[C].otherPos,x(C),g.points.push(l[C].point),C=mu(C,l,c,L),!(C==L||C>=l.length||!l[C]););u.push(g)}return u}var $n={exports:{}},Rs;function yu(){if(Rs)return $n.exports;Rs=1,$n.exports=o,$n.exports.default=o;function o(r,l){if(!(this instanceof o))return new o(r,l);if(this.data=r||[],this.length=this.data.length,this.compare=l||s,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)}function s(r,l){return r<l?-1:r>l?1:0}return o.prototype={push:function(r){this.data.push(r),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var r=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),r}},peek:function(){return this.data[0]},_up:function(r){for(var l=this.data,c=this.compare,u=l[r];r>0;){var d=r-1>>1,g=l[d];if(c(u,g)>=0)break;l[r]=g,r=d}l[r]=u},_down:function(r){for(var l=this.data,c=this.compare,u=this.length>>1,d=l[r];r<u;){var g=(r<<1)+1,x=g+1,C=l[g];if(x<this.length&&c(l[x],C)<0&&(g=x,C=l[x]),c(C,d)>=0)break;l[r]=C,r=g}l[r]=d}},$n.exports}var xu=yu();const bu=is(xu),Ds=Math.max,Vs=Math.min;let Yn=0;function Fs(o,s,r,l,c,u){let d,g,x,C,L,A;for(d=0,g=o.length-1;d<g;d++){if(x=o[d],C=o[d+1],L=new Xi(x,!1,void 0,s),A=new Xi(C,!1,L,s),L.otherEvent=A,x[0]===C[0]&&x[1]===C[1])continue;L.contourId=A.contourId=r,u||(L.isExteriorRing=!1,A.isExteriorRing=!1),mi(L,A)>0?A.left=!0:L.left=!0;const q=x[0],E=x[1];c[0]=Vs(c[0],q),c[1]=Vs(c[1],E),c[2]=Ds(c[2],q),c[3]=Ds(c[3],E),l.push(L),l.push(A)}}function wu(o,s,r,l,c){const u=new bu(null,mi);let d,g,x,C,L,A;for(x=0,C=o.length;x<C;x++)for(d=o[x],L=0,A=d.length;L<A;L++)g=L===0,g&&Yn++,Fs(d[L],!0,Yn,u,r,g);for(x=0,C=s.length;x<C;x++)for(d=s[x],L=0,A=d.length;L<A;L++)g=L===0,g&&Yn++,Fs(d[L],!1,Yn,u,l,g);return u}const lr=[];function Cu(o,s,r){let l=null;return o.length*s.length===0&&(l=lr),l}function Su(o,s,r,l,c){let u=null;return(r[0]>l[2]||l[0]>r[2]||r[1]>l[3]||l[1]>r[3])&&(u=lr),u}function Pu(o,s,r){typeof o[0][0][0]=="number"&&(o=[o]),typeof s[0][0][0]=="number"&&(s=[s]);let l=Cu(o,s);if(l)return l===lr?null:l;const c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=wu(o,s,c,u);if(l=Su(o,s,c,u),l)return l===lr?null:l;const g=du(d,o,s,c,u,r),x=_u(g),C=[];for(let L=0;L<x.length;L++){let A=x[L];if(A.isExterior()){let q=[A.points];for(let E=0;E<A.holeIds.length;E++){let Q=A.holeIds[E];q.push(x[Q].points)}C.push(q)}}return C}function ku(o,s){return Pu(o,s,or)}function Iu(o,s){const r=o[0]-s[0],l=o[1]-s[1];return r*r+l*l}function Eu(o){return{vertices:o.vertices,pieces:Array.from(o.pieces.entries()),edges:Array.from(o.edges.entries()),halfEdges:Array.from(o.halfEdges.entries()),boundary:o.boundary,borderPath:o.borderPath}}function va(o,s){let[r,l]=o,[c,u]=o;const d=g=>{r=Math.min(r,g[0]),l=Math.min(l,g[1]),c=Math.max(c,g[0]),u=Math.max(u,g[1])};for(const g of s)g.type==="line"?d(g.p):(d(g.p1),d(g.p2),d(g.p3));return[r,l,c,u]}function _a(o,s){let r=1/0,l=1/0,c=-1/0,u=-1/0;const d=o.halfEdge;let g=s.halfEdges.get(d);if(!g)return o.bounds;const x=C=>{r=Math.min(r,C[0]),l=Math.min(l,C[1]),c=Math.max(c,C[0]),u=Math.max(u,C[1])};do{if(x(g.origin),g.segments){const C=va(g.origin,g.segments);x([C[0],C[1]]),x([C[2],C[3]])}g=s.halfEdges.get(g.next)}while(g&&g.id!==d);return[r,l,c,u]}function Qr(o){if(o.length===0)return[0,0,0,0];let s=o[0][0],r=o[0][1],l=s,c=r;for(let u=1;u<o.length;u++){const d=o[u];s=Math.min(s,d[0]),r=Math.min(r,d[1]),l=Math.max(l,d[0]),c=Math.max(c,d[1])}return[s,r,l,c]}function Au(o,s){return Math.abs(o[0]-s[0])<1e-6&&Math.abs(o[1]-s[1])<1e-6}function ya(o,s,r,l){if(!o.tabs)return;const c=s.halfEdges.get(o.heLeft),u=s.halfEdges.get(o.heRight),d=c.origin,g=u.origin,x=[];let C=d;o.tabs.sort((L,A)=>L.position-A.position);for(const L of o.tabs){const A=L.position-L.size/2,q=[d[0]+(g[0]-d[0])*A,d[1]+(g[1]-d[1])*A];Math.hypot(q[0]-C[0],q[1]-C[1])>1e-6&&x.push({type:"line",p:q});const E=[d[0]+(g[0]-d[0])*(A+L.size),d[1]+(g[1]-d[1])*(A+L.size)],Q=r.createTabSegments(q,E,L,l);x.push(...Q),C=E}Math.hypot(g[0]-C[0],g[1]-C[1])>1e-6&&x.push({type:"line",p:g}),c.segments=x,u.segments=Tu(x,d),o.bounds=va(d,x)}function Tu(o,s){const r=[];for(let l=o.length-1;l>=0;l--){const c=o[l];let u=s;if(l>0){const d=o[l-1];u=d.type==="line"?d.p:d.p3}c.type==="line"?r.push({type:"line",p:u}):r.push({type:"bezier",p1:c.p2,p2:c.p1,p3:u})}return r}function Mu(o,s){const{p:r,radii:l,rotation:c,largeArc:u,sweep:d}=s,[g,x]=o,[C,L]=r,[A,q]=l;return eu({px:g,py:x,cx:C,cy:L,rx:A,ry:q,xAxisRotation:c,largeArcFlag:u?1:0,sweepFlag:d?1:0}).map(X=>({type:"bezier",p1:[X.x1,X.y1],p2:[X.x2,X.y2],p3:[X.x,X.y]}))}function xa(o){const s=[];let r=[];if(o.length===0||o[0].type!=="move")return[];let l=[0,0];for(const c of o)switch(c.type){case"move":r.length>0&&s.push(r),l=c.p,r=[l];break;case"line":r.push(c.p),l=c.p;break;case"bezier":{const{p1:u,p2:d,p3:g}=c,C=new ct([...l,...u,...d,...g]).getLUT(100);r.push(...C.slice(1).map(L=>[L.x,L.y])),l=g;break}case"arc":{const u=Mu(l,c);let d=l;for(const g of u){const C=new ct([...d,...g.p1,...g.p2,...g.p3]).getLUT(100);r.push(...C.slice(1).map(L=>[L.x,L.y])),d=g.p3}l=c.p;break}}return r.length>0&&s.push(r),s}function rs(o,s,r){if(s.length>0&&s[0].type!=="move")throw new Error("Boundary path must start with a 'move' command.");const l=xa(s);let c=0;for(const u of l)Ou(o,u)&&c++;return c%2===1}function zu(o){return Array.isArray(o[0])&&Array.isArray(o[0][0])&&typeof o[0][0][0]=="number"}function Lu(o,s){const r=[o.map(u=>[u[0],u[1]])],l=[s.map(u=>[u[0],u[1]])],c=ku(r,l);return!c||c.length===0?null:zu(c)?c:c.map(u=>u[0].map(d=>[d[0],d[1]]))}function Ou(o,s){const[r,l]=o;let c=!1;for(let u=0,d=s.length-1;u<s.length;d=u++){const[g,x]=s[u],[C,L]=s[d];x>l!=L>l&&r<(C-g)*(l-x)/(L-x)+g&&(c=!c)}return c}function Nu(o,s,r){const l=[];for(const u of o)r.vertices.find(d=>Au(d,u))||r.vertices.push(u);for(const u of o){const d={id:ha(),origin:u,twin:-1,next:-1,prev:-1,piece:s};l.push(d)}const c=l.length;for(let u=0;u<c;u++){const d=(u+1)%c,g=(u+c-1)%c;l[u].next=l[d].id,l[u].prev=l[g].id}return l.forEach(u=>r.halfEdges.set(u.id,u)),l}function ba(o,s,r,l){const c=(d,g)=>`${d[0]},${d[1]}-${g[0]},${g[1]}`,u=o.length;for(let d=0;d<u;d++){const g=o[d],x=g.origin,C=s.halfEdges.get(g.next).origin,L=c(C,x),A=r.get(L),q=ha();let E;if(A!==void 0){const Q=s.halfEdges.get(A);g.twin=Q.id,Q.twin=g.id,E={id:q,heLeft:Q.id,heRight:g.id,bounds:Qr([x,C])},r.delete(L)}else{const Q=c(x,C);if(r.set(Q,g.id),l(x,C))E={id:q,heLeft:g.id,heRight:-1,bounds:Qr([x,C])},s.boundary.push(q);else continue}s.edges.set(q,E)}}function wa(o){return function(){let s=o+=1831565813;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}async function hr(o){return Vo("Puzzle Generation",()=>{const{bounds:s,pieceSize:r,border:l}=o,{pointConfig:c,pieceConfig:u,placementConfig:d,tabConfig:g}=o;console.log(`rebuilding puzzle with dimensions ${s.width}x${s.height}, piece size ${r}`);const x=An.create(l,s,c),C=Tn.create(l,s,u),L=Mn.create(l,s,d),A=Oi.create(l,s,g),q=o.seed??new Date().getTime(),E=wa(q),Q=o.seedPoints??x.generatePoints({width:s.width,height:s.height,pieceSize:r,random:E,border:l});console.log(`${o.seedPoints?"Using":"Generated"} ${Q.length} points`);const X=C.generatePieces(Q,{random:E,pieceSize:r,border:l,bounds:s,customPieces:o.customPieces});if(console.log(`Generated ${X.pieces.size} pieces`),!o.skipTabs){L.placeTabs({topology:X,random:E});for(const $ of X.edges.values())$.heRight!==-1&&$.tabs&&$.tabs.length>0&&ya($,X,A,E)}const j={created:new Date().toISOString(),seed:q,width:s.width,height:s.height,pieceSize:r,pointConfig:c,pieceConfig:u,placementConfig:d,tabConfig:g,seedPoints:Q,vertices:X.vertices,boundary:X.boundary,borderPath:X.borderPath,pieces:X.pieces,edges:X.edges,halfEdges:X.halfEdges,customPieces:o.customPieces};return Promise.resolve(j)})}async function Ru(o,s,r){const l=[...o.seedPoints];let c=0;for(const u of o.pieces.values()){if(u.id===s){l[c]=r;break}c++}return hr({bounds:{width:o.width,height:o.height},border:o.borderPath,pieceSize:o.pieceSize,pointConfig:o.pointConfig,pieceConfig:o.pieceConfig,placementConfig:o.placementConfig,tabConfig:o.tabConfig,seed:o.seed,seedPoints:l,customPieces:o.customPieces,skipTabs:!1})}function Jr(o,s){return[{type:"move",p:[0,0]},{type:"line",p:[o,0]},{type:"line",p:[o,s]},{type:"line",p:[0,s]},{type:"line",p:[0,0]}]}function Du(o){const s=o/2,r=s;return[{type:"move",p:[0,r]},{type:"arc",p:[o,r],radii:[s,s],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,r],radii:[s,s],rotation:0,largeArc:!1,sweep:!0}]}function Vu(o,s){const r=o/2,l=s/2;return[{type:"move",p:[0,l]},{type:"arc",p:[o,l],radii:[r,l],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,l],radii:[r,l],rotation:0,largeArc:!1,sweep:!0}]}function Fu(o,s,r){const l=Math.min(o,s)/2,c=Math.min(r,l);return[{type:"move",p:[c,0]},{type:"line",p:[o-c,0]},{type:"arc",p:[o,c],radii:[c,c],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[o,s-c]},{type:"arc",p:[o-c,s],radii:[c,c],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[c,s]},{type:"arc",p:[0,s-c],radii:[c,c],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[0,c]},{type:"arc",p:[c,0],radii:[c,c],rotation:0,largeArc:!1,sweep:!0}]}function Bu(o,s,r){if(s<0||s>=o.vertices.length){console.warn("moveVertex called with invalid vertex index:",s);return}const l=o.vertices[s];o.vertices[s]=r;const c=[];for(const g of o.halfEdges.values())g.origin[0]===l[0]&&g.origin[1]===l[1]&&c.push(g);const u=new Set,d=[r[0]-l[0],r[1]-l[1]];for(const g of c){g.origin=r,u.add(g.piece);const x=o.halfEdges.get(g.prev);if(x?.segments){const C=x.segments[x.segments.length-1];C.type==="line"?C.p=r:(C.p3=r,C.p1=[C.p1[0]+d[0],C.p1[1]+d[1]],C.p2=[C.p2[0]+d[0],C.p2[1]+d[1]]),u.add(x.piece)}}Uu(o,s);for(const g of u){const x=o.pieces.get(g);x&&(x.bounds=_a(x,o))}}function Uu(o,s){const{seed:r,width:l,height:c,placementConfig:u,tabConfig:d}=o,g=wa(r),x=Jr(l,c),C={width:l,height:c},L=Mn.create(x,C,u),A=Oi.create(x,C,d),q=new Set,E=o.vertices[s],Q=new Map;for(const j of o.edges.values())Q.set(j.heLeft,j),j.heRight!==-1&&Q.set(j.heRight,j);for(const j of o.halfEdges.values()){const $=o.halfEdges.get(j.next)?.origin;if(j.origin===E||$===E){const ye=Q.get(j.id);ye&&q.add(ye)}}L.updateTabPlacements(Array.from(q),{topology:o,random:g});const X=new Set;for(const j of q)if(j.heRight!==-1){const he=o.halfEdges.get(j.heLeft);he&&(he.segments=void 0,X.add(o.pieces.get(he.piece)));const re=o.halfEdges.get(j.heRight);re&&(re.segments=void 0,X.add(o.pieces.get(re.piece))),ya(j,o,A,g)}for(const j of X)j.bounds=_a(j,o)}let _n=null,yn=null,xn=null,bn=null,wn=null,Ti=null,ji=!1,Ei=null;function qu(o,s){_n=r=>{const l=r.target;l.tagName==="INPUT"||l.tagName==="WA-INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable||r.code==="Space"&&(r.preventDefault(),o.isSpacebarPressed||(o.isSpacebarPressed=!0,Qn(o)))},yn=r=>{const l=r.target;l.tagName==="INPUT"||l.tagName==="WA-INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable||r.code==="Space"&&(o.isSpacebarPressed=!1,Qn(o),r.preventDefault())},xn=r=>{if(r.preventDefault(),!o.paperCtx)return;const l=o.paperCtx.scope,c=-Math.sign(r.deltaY)*yo,u=Math.max(vo,Math.min(_o,o.zoom+c));if(u!==o.zoom){const d=new l.Point(r.offsetX,r.offsetY),g=l.view.viewToProject(d),x=u/o.zoom;l.view.scale(x,g),o.zoom=u,s&&s(u),J.redraw()}},bn=r=>{o.isSpacebarPressed&&(ji=!0,Ei={x:r.clientX,y:r.clientY},Qn(o),r.preventDefault())},wn=r=>{if(o.isSpacebarPressed&&r.preventDefault(),ji&&Ei){if(!o.paperCtx)return;const l=o.paperCtx.scope,c=r.clientX-Ei.x,u=r.clientY-Ei.y,d=c/o.zoom,g=u/o.zoom;l.view.translate(new l.Point(d,g)),Ei={x:r.clientX,y:r.clientY}}},Ti=()=>{ji&&(ji=!1,Ei=null,Qn(o))},window.addEventListener("keydown",_n),window.addEventListener("keyup",yn),o.canvas&&(o.canvas.addEventListener("wheel",xn,{passive:!1}),o.canvas.addEventListener("mousedown",bn),o.canvas.addEventListener("mousemove",wn),o.canvas.addEventListener("mouseup",Ti),o.canvas.addEventListener("mouseleave",Ti))}function Hu(o){_n&&(window.removeEventListener("keydown",_n),_n=null),yn&&(window.removeEventListener("keyup",yn),yn=null),o&&(xn&&(o.removeEventListener("wheel",xn),xn=null),bn&&(o.removeEventListener("mousedown",bn),bn=null),wn&&(o.removeEventListener("mousemove",wn),wn=null),Ti&&(o.removeEventListener("mouseup",Ti),o.removeEventListener("mouseleave",Ti),Ti=null)),ji=!1,Ei=null}function Qn(o){if(o.canvas){if(o.isSpacebarPressed){o.canvas.style.cursor=ji?"grabbing":"grab";return}if(o.isDragging){o.canvas.style.cursor="grabbing";return}o.canvas.style.cursor="default"}}function nr(o,s){for(const r of o.children)if(r.data.vertexId===s)return r;return null}function mr(o,s,r){if(!r.paperCtx)return null;const l=r.paperCtx.scope,c=s.getBoundingClientRect();let u,d;if(o instanceof TouchEvent){if(o.changedTouches.length===0)return null;const x=o.changedTouches[0];u=x.clientX,d=x.clientY}else u=o.clientX,d=o.clientY;const g=new l.Point(u-c.left,d-c.top);return l.view.viewToProject(g)}function cr(o){return[o.x,o.y]}function Bs(o,s,r,l){const c=[...o.puzzle.seedPoints];let u=0;for(const d of o.puzzle.pieces.values()){if(d.id===r){c[u]=l;break}u++}hr({bounds:{width:o.puzzle.width,height:o.puzzle.height},border:o.puzzle.borderPath,pieceSize:o.puzzle.pieceSize,pointConfig:o.puzzle.pointConfig,pieceConfig:o.puzzle.pieceConfig,placementConfig:o.puzzle.placementConfig,tabConfig:o.puzzle.tabConfig,seed:o.puzzle.seed,seedPoints:c,skipTabs:!0}).then(d=>{s.draggedSeedPointId===r&&ar(s,d,o.color,o.pointColor)}).catch(d=>{console.error("Failed to regenerate preview:",d)})}function Gu(o,s,r){if(o.redraw=!1,r.isDragging||r.isSpacebarPressed||!r.canvas)return;const l=mr(o,r.canvas,r);if(!l)return;let c=!1;const u=cr(l);if(r.vertexItems){let d=-1,g=mo;const x=la(s.puzzle);for(let C=0;C<s.puzzle.vertices.length;C++){if(x.has(C))continue;const L=Iu(s.puzzle.vertices[C],u);L<g&&(g=L,d=C)}if(d>=0){if(r.hoveredVertexId!==d){if(r.hoveredVertexId>=0){const L=nr(r.vertexItems,r.hoveredVertexId);L&&(L.visible=!1)}const C=nr(r.vertexItems,d);C&&(C.visible=!0,r.hoveredVertexId=d)}c=!0}else if(r.hoveredVertexId>=0){const C=nr(r.vertexItems,r.hoveredVertexId);C&&(C.visible=!1,r.hoveredVertexId=-1)}}s.pointColor&&r.seedPointItems&&r.seedPointItems.hitTest(l,{fill:!0,tolerance:5})&&(c=!0),r.canvas.style.cursor=c?"grab":"default"}function Us(o,s,r){if(o.redraw=!1,!r.canvas||r.isSpacebarPressed)return;if(o instanceof TouchEvent&&o.touches.length>1){r.isDragging=!1,r.draggedVertexId=-1,r.draggedSeedPointId=-1;return}if(o instanceof MouseEvent&&o.button!==0)return;const l=mr(o,r.canvas,r);if(l){if(s.pointColor&&r.seedPointItems){const c=r.seedPointItems.hitTest(l,{fill:!0,tolerance:5});if(c?.item.data.pieceId!==void 0){r.draggedSeedPointId=c.item.data.pieceId,r.isDragging=!1,o instanceof MouseEvent&&(r.documentMouseMove=u=>{const d=u;d.redraw=!1,fr(d,s,r)},r.documentMouseUp=u=>{const d=u;d.redraw=!1,Cn(d,s,r)},document.addEventListener("mousemove",r.documentMouseMove),document.addEventListener("mouseup",r.documentMouseUp));return}}if(r.vertexItems){const c=r.vertexItems.hitTest(l,{fill:!0,tolerance:8});if(c?.item.data.vertexId!==void 0){r.draggedVertexId=c.item.data.vertexId,r.isDragging=!1,o instanceof MouseEvent&&(r.documentMouseMove=u=>{const d=u;d.redraw=!1,fr(d,s,r)},r.documentMouseUp=u=>{const d=u;d.redraw=!1,Cn(d,s,r)},document.addEventListener("mousemove",r.documentMouseMove),document.addEventListener("mouseup",r.documentMouseUp));return}}}}function fr(o,s,r){if(o.redraw=!1,!r.canvas)return;const l=mr(o,r.canvas,r);if(l){if(r.draggedVertexId>=0){r.isDragging=!0,o.preventDefault(),r.canvas.style.cursor="grabbing";const c=cr(l);if(Bu(s.puzzle,r.draggedVertexId,c),r.vertexItems){const u=nr(r.vertexItems,r.draggedVertexId);u&&(u.position=l)}ar(r,s.puzzle,s.color,s.pointColor);return}if(r.draggedSeedPointId>=0){r.isDragging=!0,o.preventDefault(),r.canvas.style.cursor="grabbing";const c=cr(l),u=performance.now();if(u-r.lastRegenerationTime<Cs){r.pendingRegeneration&&clearTimeout(r.pendingRegeneration),r.pendingRegeneration=window.setTimeout(()=>{Bs(s,r,r.draggedSeedPointId,c)},Cs);return}r.lastRegenerationTime=u,Bs(s,r,r.draggedSeedPointId,c)}}}function Cn(o,s,r){if(o.redraw=!1,!r.canvas)return;r.pendingRegeneration&&(clearTimeout(r.pendingRegeneration),r.pendingRegeneration=null);const l=r.draggedVertexId>=0&&r.isDragging,c=r.draggedSeedPointId>=0&&r.isDragging;if(l&&(o.preventDefault(),s.onPuzzleChanged(s.puzzle)),c){o.preventDefault();const u=r.draggedSeedPointId,d=mr(o,r.canvas,r);if(d&&s.onSeedPointMoved){const g=cr(d);s.onSeedPointMoved(u,g)}}r.documentMouseMove&&(document.removeEventListener("mousemove",r.documentMouseMove),r.documentMouseMove=null),r.documentMouseUp&&(document.removeEventListener("mouseup",r.documentMouseUp),r.documentMouseUp=null),r.isDragging=!1,r.draggedVertexId=-1,r.draggedSeedPointId=-1,r.canvas.style.cursor="default"}const ju=()=>{const o={canvas:null,isDragging:!1,draggedVertexId:-1,draggedSeedPointId:-1,lastRegenerationTime:0,pendingRegeneration:null,documentMouseMove:null,documentMouseUp:null,paperCtx:null,backgroundRaster:null,paperPath:null,seedPointItems:null,problemItems:null,vertexItems:null,hoveredVertexId:-1,selectedPieceId:-1,zoom:Ar,isSpacebarPressed:!1},s=(u,d)=>{if(u===o.zoom||!o.paperCtx)return;const g=o.paperCtx.scope,x=u/o.zoom;g.view.scale(x,g.view.center),o.zoom=u,d?.onZoomChanged&&d.onZoomChanged(u),J.redraw()},r=()=>{if(!o.paperCtx)return;const u=o.paperCtx.scope,d=Ar/o.zoom;u.view.scale(d,u.view.center),o.zoom=Ar,u.view.center=new u.Point(u.view.viewSize.width/2,u.view.viewSize.height/2),J.redraw()},l=()=>`${Math.round(o.zoom*100)}%`;let c;return{oncreate:({dom:u,attrs:d})=>{if(o.canvas=u.querySelector("canvas.puzzle-renderer"),!o.canvas){console.error("PuzzleRenderer: couldn't get canvas element");return}Fo(o.canvas,d.width,d.height,o),Bo(o),qu(o,d.onZoomChanged),Es(o,d.imageUrl,d.width,d.height),c=d.imageUrl,d.isDirty||ar(o,d.puzzle,d.color,d.pointColor)},onupdate:({attrs:u})=>{if(!o.canvas){console.error("PuzzleRenderer: couldn't get canvas element");return}u.imageUrl!==c&&(Es(o,u.imageUrl,u.width,u.height),c=u.imageUrl),u.isDirty||ar(o,u.puzzle,u.color,u.pointColor)},onremove:()=>{o.documentMouseMove&&(document.removeEventListener("mousemove",o.documentMouseMove),o.documentMouseMove=null),o.documentMouseUp&&(document.removeEventListener("mouseup",o.documentMouseUp),o.documentMouseUp=null),Hu(o.canvas),qo(o)},view:({attrs:u})=>{const d=l();return J(".puzzle-renderer-wrapper",[J("canvas.puzzle-renderer",{key:"puzzle-renderer-canvas",width:u.width,height:u.height,style:{width:`${u.width}px`,height:`${u.height}px`,touchAction:"manipulation"},onmousedown:g=>Us(g,u,o),onmousemove:g=>{Gu(g,u,o),fr(g,u,o)},onmouseup:g=>Cn(g,u,o),ontouchstart:g=>Us(g,u,o),ontouchmove:g=>fr(g,u,o),ontouchend:g=>Cn(g,u,o),ontouchcancel:g=>Cn(g,u,o)}),J(".puzzle-renderer-controls",{key:"puzzle-renderer-controls"},[J("wa-dropdown.zoom-control",{"onwa-select":g=>{g.redraw=!1;const x=g.detail.item.value;if(x&&typeof x=="string"){const C=parseFloat(x);isNaN(C)||s(C,u)}}},[J("wa-button",{slot:"trigger","with-caret":!0,size:"small",value:o.zoom},d),...xo.map((g,x)=>J("wa-dropdown-item",{type:"checkbox",checked:o.zoom==g?!0:void 0,value:g.toString()},bo[x]))]),J("wa-tooltip",{for:"recenter-button"},"Recenter view"),J("wa-button#recenter-button",{appearance:"plain",size:"large",onclick:()=>{r()}},J("wa-icon",{library:"material",name:"recenter",label:"Recenter view"}))])])}}};function Wu(o,s,r,l="black"){const u=[];for(const x of o.edges.values()){const C=o.halfEdges.get(x.heLeft);if(C)if(u.push(`M ${C.origin[0].toFixed(3)} ${C.origin[1].toFixed(3)}`),C.segments)for(const L of C.segments)switch(L.type){case"bezier":u.push(`C ${L.p1[0].toFixed(3)} ${L.p1[1].toFixed(3)}, ${L.p2[0].toFixed(3)} ${L.p2[1].toFixed(3)}, ${L.p3[0].toFixed(3)} ${L.p3[1].toFixed(3)}`);break;case"line":u.push(`L ${L.p[0].toFixed(3)} ${L.p[1].toFixed(3)}`);break}else{let L;C.twin!==-1?L=o.halfEdges.get(C.twin).origin:L=o.halfEdges.get(C.next).origin,u.push(`L ${L[0].toFixed(3)} ${L[1].toFixed(3)}`)}}const d=u.join(" ");return`
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg
  width="${s}"
  height="${r}"
  viewBox="0 0 ${s} ${r}"
  xmlns="http://www.w3.org/2000/svg"
  version="1.1"
>
  <path
    d="${d}"
    fill="none"
    stroke="${l}"
    stroke-width="1"
    vector-effect="non-scaling-stroke"
  />
</svg>`.trim().replace(/\r\n/g,`
`)}function Zu(o,s="puzzle.svg"){const r=new Blob([o],{type:"image/svg+xml"}),l=URL.createObjectURL(r),c=document.createElement("a");c.href=l,c.download=s,c.hidden=!0,document.body.appendChild(c),c.click(),document.body.removeChild(c),setTimeout(()=>URL.revokeObjectURL(l),100)}const Xu={view:({attrs:o})=>J("wa-button.download-svg",{size:"small",onclick:()=>{const s=Wu(o.puzzle,o.width,o.height,o.color);Zu(s,o.filename??"puzzle.svg")}},"Download SVG")},Ku={view:({attrs:o})=>{const s=o.progressPercent!==void 0&&o.progressPercent<100,r=!s&&o.problems!==void 0&&o.problems==0,l=!s&&o.problems!==void 0&&o.problems>0;return J(".geometry-check-indicator",[J(".label","Geometry Check:"),J("wa-tooltip",{for:"check-geometry-now"},"Check geometry now"),J("wa-button#check-geometry-now",{variant:"neutral",appearance:"plain",size:"small",disabled:s,onclick:c=>{c.redraw=!1,o.onCheckRequested?.()}},J("wa-icon",{library:"material",name:"editor_choice",label:"Check geometry now"})),J("wa-tooltip",{for:"auto-check-geometry"},"Check geometry after every change"),J("wa-checkbox#auto-check-geometry",{checked:o.autoCheck,disabled:s,size:"small",onchange:c=>{c.redraw=!1;const u=c.target;o.onAutocheckChanged?.(u.checked)}},"auto check"),s&&J("wa-progress-bar",{label:"Geometry check progress",value:o.progressPercent??0}),r&&J("wa-badge",{variant:"success",pill:!0},"OK"),l&&J("wa-badge",{variant:"danger",pill:!0},`${o.problems} issue${o.problems===1?"":"s"}`)])}};function $u(o,s,r=800){if(o<=r)return{width:o,height:s};const l=s/o;return{width:r,height:Math.round(r*l)}}const Yu=()=>{const o={inputElement:void 0,imageLoaded:!1,imageName:""};return{view:({attrs:s})=>[J("wa-button.upload-button",{size:"small",disabled:s.disabled===!0,onclick:()=>{o.inputElement&&o.inputElement.click()}},s.label??"Upload Image"),J("input[type=file]",{style:{display:"none"},accept:"image/*",oncreate:({dom:r})=>{o.inputElement=r},onchange:r=>{if(r.redraw=!1,o.inputElement){const l=o.inputElement.files?.[0];l?.type.startsWith("image/")&&createImageBitmap(l).then(c=>{const{width:u,height:d}=$u(c.width,c.height),g=URL.createObjectURL(l);c.close(),o.imageName=l.name,s.onUpload(g,l.name,u,d),o.imageLoaded=!0}).catch(c=>{console.error("could not create a bitmap image: ",c)})}}}),J("span.background-image-label",o.imageName),o.imageLoaded&&J("wa-icon.clear-button",{library:"material",name:"close",label:"Clear background image",onclick:r=>{r.redraw=!1,!s.disabled&&(o.imageName="",o.imageLoaded=!1,s.onClear())}},"Clear")]}},Ca=()=>({view:({attrs:o})=>J("wa-checkbox.boolean-input",{hint:o.config.helpText,disabled:o.disabled,checked:o.value,onchange:s=>{const l=s.target.checked;o.onChange(l)}},o.config.label)}),rr=()=>({view:({attrs:o})=>J("wa-input.number-input",{label:o.config.label,hint:o.config.helpText,type:"number",inputmode:"numeric",size:"small",disabled:o.disabled,value:o.value,min:o.config.min,max:o.config.max,onchange:s=>{const r=s.target,l=parseFloat(r.value??"");o.onChange(isNaN(l)?void 0:l)}})}),Qu=()=>({view:({attrs:o})=>J("wa-slider.range-input",{label:o.config.label,hint:o.config.helpText,disabled:o.disabled,value:o.value,min:o.config.min,max:o.config.max,step:o.config.step,"with-tooltip":!0,onchange:s=>{const l=s.target.value;o.onChange(isNaN(l)?void 0:l)}})}),Sa=()=>({view:({attrs:o})=>J("wa-input.string-input",{label:o.config.label,hint:o.config.helpText,type:"text",size:"small",disabled:o.disabled,value:o.value,oninput:s=>{s.redraw=!1;const l=s.target.value??"";o.onChange(l.length>0?l:void 0)}})}),Ju=()=>({view:({attrs:o})=>{const s=o.registry.getAvailableGenerators();return J(".generator-picker",J("wa-tab-group",{active:o.generator,"onwa-tab-show":r=>{const l=r.detail.name;o.generator!==l&&o.onGeneratorChange(l)}},[...s.map(r=>{const l=o.registry.getUIMetadata(r.name),c=J("wa-tab",{panel:r.name},r.displayName),u=J("wa-tab-panel",{name:r.name},J(".controls",[l?.description?J("p",l.description):null,...l?.controls.map(d=>{switch(d.type){case"range":return J(Qu,{config:d,value:o.config?.[d.name]??d.defaultValue,onChange:g=>{o.onConfigChange(d.name,g)}});case"boolean":return J(Ca,{config:d,value:(o.config?.[d.name]??d.defaultValue)===!0,onChange:g=>{o.onConfigChange(d.name,g)}});case"number":return J(rr,{config:d,value:o.config?.[d.name]??d.defaultValue,onChange:g=>{o.onConfigChange(d.name,g)}});case"string":return J(Sa,{config:d,value:o.config?.[d.name]??d.defaultValue,onChange:g=>{o.onConfigChange(d.name,g)}})}})??[],!l?.description&&l?.controls.length==0?J("p","No controls for this strategy."):null]));return[c,u]})]))}}),qs=[["Square","1:1",1],["Classic Photo","5:4",5/4],["Standard Photo","4:3",4/3],["35mm/DSLR","3:2",3/2],["Widescreen","16:9",16/9],["UltraWide","21:9",21/9],["Panorama","2:1",2/1],["Instagram Portrait","4:5",4/5],["Classic Portrait","3:4",3/4],["DSLR Portrait","2:3",2/3],["Phone Portrait","9:16",9/16],["Tall Poster","9:21",9/21],["Tall Panorama","1:2",1/2]],el={view:({attrs:o})=>{const s=!qs.some(([,,l])=>l===o.ratio),r=qs.map(([l,c,u])=>J("wa-option",{value:String(u)},`${l} [${c}]`));return s&&r.unshift(J("wa-option",{value:"custom"},"Custom")),J(".aspect-ratio-picker",[J("wa-select",{label:"Aspect Ratio",size:"small",disabled:o.disabled,value:s?"custom":String(o.ratio),onchange:l=>{l.redraw=!1;const u=l.target.value;u&&u!=="custom"&&o.onChange(Number(u))}},r),J("wa-slider",{min:.25,max:4,step:.01,"with-tooltip":!0,size:"small",disabled:o.disabled,value:o.ratio,onchange:l=>{l.redraw=!1;const c=l.target;o.onChange(c.value)}})])}},Hs={view:({attrs:o})=>J("wa-color-picker",{label:o.label,value:o.color,size:o.size??"medium",format:"rgb",onchange:s=>{s.redraw=!1;const r=s.target;o.onUpdate(r.value??"")}})},tl=[["rectangle","Rectangle"],["circle","Circle"],["ellipse","Ellipse"],["rounded-rect","Rounded Rectangle"]],il={view:({attrs:o})=>{const s=tl.map(([r,l])=>J("wa-option",{value:r},l));return J("wa-select",{label:"Border Shape",size:"small",disabled:o.disabled,value:o.shape,onchange:r=>{r.redraw=!1;const c=r.target.value;c&&o.onChange(c)}},s)}},Mi=10,Rr="#2196F3",Gs=2,nl="#999999",rl=1,sl=[4,4],js=.5,al=15,ol=10,ul="#4CAF50",ll=2,hl=.1,cl=10,Dr=1,fl=.025,dl=[.25,.5,1,2,4],pl=["25%","50%","100%","200%","400%"];let Sn=null,Pn=null,kn=null,In=null,En=null,zi=null,Wi=!1,Ai=null;function gl(o,s,r){if(!o.paperCtx)throw new Error("PathEditor: Cannot setup mouse handling - Paper.js context not initialized");const l=Nt(o.paperCtx,"PathEditor:setupTool",()=>{const c=o.paperCtx.scope;return new c.Tool});return Sn=c=>{const u=c.target;u.tagName==="INPUT"||u.tagName==="WA-INPUT"||u.tagName==="TEXTAREA"||u.isContentEditable||(c.code==="Space"?(c.preventDefault(),o.isSpacebarPressed||(o.isSpacebarPressed=!0,Xt(o))):c.key==="Shift"&&!o.isShiftPressed?(o.isShiftPressed=!0,Xt(o)):(c.code==="Delete"||c.code==="Backspace")&&(o.mode==="edit"&&o.selectedSegment&&o.path&&o.paperCtx&&o.path.segments.length>2&&(o.selectedSegment.remove(),o.selectedSegment=null,o.selectedHandle=null,Nt(o.paperCtx,"PathEditor:deleteSegment",()=>{s()})),c.preventDefault()))},Pn=c=>{const u=c.target;u.tagName==="INPUT"||u.tagName==="WA-INPUT"||u.tagName==="TEXTAREA"||u.isContentEditable||(c.code==="Space"?(o.isSpacebarPressed=!1,Xt(o),c.preventDefault()):c.key==="Shift"&&(o.isShiftPressed=!1,Xt(o)))},kn=c=>{if(c.preventDefault(),!o.paperCtx)return;const u=o.paperCtx.scope,d=-Math.sign(c.deltaY)*fl,g=Math.max(hl,Math.min(cl,o.zoom+d));if(g!==o.zoom){const x=new u.Point(c.offsetX,c.offsetY),C=u.view.viewToProject(x),L=g/o.zoom;u.view.scale(L,C),o.zoom=g,r()}},In=c=>{o.isSpacebarPressed&&(Wi=!0,Ai={x:c.clientX,y:c.clientY},Xt(o),c.preventDefault())},En=c=>{if(o.isSpacebarPressed&&c.preventDefault(),Wi&&Ai){if(!o.paperCtx)return;const u=o.paperCtx.scope,d=c.clientX-Ai.x,g=c.clientY-Ai.y,x=d/o.zoom,C=g/o.zoom;u.view.translate(new u.Point(x,C)),Ai={x:c.clientX,y:c.clientY}}},zi=()=>{Wi&&(Wi=!1,Ai=null,Xt(o))},window.addEventListener("keydown",Sn),window.addEventListener("keyup",Pn),o.canvas&&(o.canvas.addEventListener("wheel",kn,{passive:!1}),o.canvas.addEventListener("mousedown",In),o.canvas.addEventListener("mousemove",En),o.canvas.addEventListener("mouseup",zi),o.canvas.addEventListener("mouseleave",zi)),l.onMouseDown=c=>{o.isSpacebarPressed||(o.mode==="draw"?vl(o,c,s):yl(o,c))},l.onMouseDrag=c=>{o.isSpacebarPressed||(o.mode==="draw"?_l(o,c):xl(o,c))},l.onMouseUp=()=>{o.isSpacebarPressed||(o.mode==="draw"?o.pendingPoint&&o.path&&o.paperCtx&&(Nt(o.paperCtx,"PathEditor:onMouseUp",()=>{const c=o.paperCtx.scope;if(o.isDraggingCurve&&o.previewPath&&o.previewPath.segments.length>0){const u=o.previewPath.lastSegment,d=new c.Segment(o.pendingPoint,u.handleIn,u.handleOut);if(o.path.add(d),o.path.segments.length>1&&o.previewPath.segments.length>1){const g=o.path.segments[o.path.segments.length-2],x=o.previewPath.segments[0];g.handleOut=x.handleOut}}else o.path.add(o.pendingPoint);o.pendingPoint=null,o.isDraggingCurve=!1,o.previewPath&&(o.previewPath.removeSegments(),o.previewPath.visible=!1),s()}),Xt(o)):o.paperCtx&&Nt(o.paperCtx,"PathEditor:onMouseUp-editMode",()=>{s()}))},l.onMouseMove=c=>{o.isSpacebarPressed||(o.mode==="draw"?Pa(o,c.point):o.mode==="edit"&&Xt(o,c.point))},l.activate(),l}function ml(o){Sn&&(window.removeEventListener("keydown",Sn),Sn=null),Pn&&(window.removeEventListener("keyup",Pn),Pn=null),o&&(kn&&(o.removeEventListener("wheel",kn),kn=null),In&&(o.removeEventListener("mousedown",In),In=null),En&&(o.removeEventListener("mousemove",En),En=null),zi&&(o.removeEventListener("mouseup",zi),o.removeEventListener("mouseleave",zi),zi=null)),Wi=!1,Ai=null}function Xt(o,s){if(o.canvas){if(o.isSpacebarPressed){o.canvas.style.cursor=Wi?"grabbing":"grab";return}if(o.mode==="draw"){o.isNearFirstPoint?o.canvas.style.cursor="copy":o.canvas.style.cursor="crosshair";return}if(o.mode==="edit"){if(o.isShiftPressed){o.canvas.style.cursor="crosshair";return}if(s&&o.path){if(o.selectedSegment!==null||o.path.fullySelected){const u=o.path.hitTest(s,{handles:!0,tolerance:Mi});if(u?.type==="handle-in"||u?.type==="handle-out"){o.canvas.style.cursor="pointer";return}}if(o.path.hitTest(s,{segments:!0,tolerance:Mi})?.segment){o.canvas.style.cursor="move";return}if(o.path.hitTest(s,{stroke:!0,tolerance:Mi})){o.canvas.style.cursor="pointer";return}}}o.canvas.style.cursor="default"}}function vl(o,s,r){if(!(!o.path||!o.paperCtx)){if(o.isNearFirstPoint&&o.path.segments.length>=2){o.path.closed=!0,o.snapIndicator&&(o.snapIndicator.visible=!1),o.mode="edit",o.isNearFirstPoint=!1,o.previewPath&&(o.previewPath.removeSegments(),o.previewPath.visible=!1),Nt(o.paperCtx,"PathEditor:closePathBySnapping",()=>{r()});return}o.path.segments.length>0&&Nt(o.paperCtx,"PathEditor:handleDrawModeDown",()=>{const l=o.paperCtx.scope,c=o.path.lastSegment;c.handleOut&&c.handleOut.length>0&&(c.handleOut=new l.Point(0,0))}),o.pendingPoint=s.point.clone(),o.isDraggingCurve=!1,Pa(o,s.point)}}function _l(o,s){!o.path||!o.previewPath||!o.pendingPoint||!o.paperCtx||Nt(o.paperCtx,"PathEditor:handleDrawModeDrag",()=>{const r=o.paperCtx.scope;o.isDraggingCurve=!0;const l=o.pendingPoint,c=s.point.subtract(l),u=c.multiply(js),d=c.multiply(-js);let g=new r.Point(0,0);if(o.path.segments.length>0){const x=o.path.lastSegment,C=l.subtract(x.point);if(o.path.segments.length>1)if(x.handleIn&&x.handleIn.length>0){const E=x.handleIn.normalize(),Q=C.length;g=E.multiply(-Q)}else if(o.path.segments.length>1){const E=o.path.segments[o.path.segments.length-2];g=x.point.subtract(E.point).multiply(.33)}else g=C.multiply(.33);o.previewPath.removeSegments();const L=new r.Segment(x.point,new r.Point(0,0),g);o.previewPath.add(L);const A=new r.Segment(l,d,u);o.previewPath.add(A),o.previewPath.visible=!0}else{o.previewPath.removeSegments();const x=new r.Segment(l,d,u);o.previewPath.add(x),o.previewPath.visible=!0}})}function Pa(o,s){!o.previewPath||!o.path||!o.paperCtx||Nt(o.paperCtx,"PathEditor:updatePreviewPath",()=>{const r=o.paperCtx.scope;if(o.previewPath.removeSegments(),o.isNearFirstPoint=!1,o.snapIndicator&&(o.snapIndicator.visible=!1),o.path.segments.length>0){const l=o.path.lastSegment.point;if(o.path.segments.length>=2){const c=o.path.firstSegment.point;if(s.getDistance(c)<al){o.isNearFirstPoint=!0,o.previewPath.moveTo(l),o.previewPath.lineTo(c),o.previewPath.visible=!0,o.snapIndicator?(o.snapIndicator.position=c,o.snapIndicator.visible=!0):o.snapIndicator=new r.Path.Circle({center:c,radius:ol,strokeColor:new r.Color(ul),strokeWidth:ll,fillColor:null}),Xt(o);return}}o.previewPath.moveTo(l),o.previewPath.lineTo(s),o.previewPath.visible=!0,Xt(o)}else o.previewPath.visible=!1,Xt(o)})}function yl(o,s){if(!o.path)return;if(o.isShiftPressed){const u=o.path.hitTest(s.point,{stroke:!0,tolerance:Mi});if(u?.location){const d=u.location,g=o.path.insert(d.index+1,d.point);for(const x of o.path.segments)x.selected=!1;g.selected=!0,o.selectedSegment=g,o.selectedHandle=null,o.path.fullySelected=!1;return}return}if(o.selectedSegment!==null||o.path.fullySelected){const u=o.path.hitTest(s.point,{handles:!0,tolerance:Mi});if(u?.type==="handle-in"||u?.type==="handle-out"){o.selectedHandle={segment:u.segment,type:u.type==="handle-in"?"handleIn":"handleOut"},o.selectedSegment=null;return}}const l=o.path.hitTest(s.point,{segments:!0,tolerance:Mi});if(l?.segment){for(const u of o.path.segments)u.selected=!1;o.selectedSegment=l.segment,o.selectedSegment.selected=!0,o.selectedHandle=null;return}if(o.path.hitTest(s.point,{stroke:!0,tolerance:Mi})){o.path.fullySelected=!0,o.selectedSegment=null,o.selectedHandle=null;return}o.selectedSegment=null,o.selectedHandle=null,o.path.selected=!1,o.path.fullySelected=!1;for(const u of o.path.segments)u.selected=!1}function xl(o,s){if(o.selectedSegment)o.selectedSegment.point=o.selectedSegment.point.add(s.delta);else if(o.selectedHandle){const{segment:r,type:l}=o.selectedHandle,c=s.point.subtract(r.point);l==="handleOut"?r.handleOut=c:r.handleIn=c}}const ka=()=>{const o={canvas:null,paperCtx:null,path:null,previewPath:null,mode:"draw",selectedSegment:null,selectedHandle:null,zoom:Dr,isSpacebarPressed:!1,isShiftPressed:!1,pendingPoint:null,isDraggingCurve:!1,isNearFirstPoint:!1,snapIndicator:null};let s=null,r;const l=(C,L)=>{if(o.paperCtx=ua(C,L.width,L.height),o.canvas=C,!o.paperCtx){console.error("PathEditor: Failed to create Paper.js context");return}Nt(o.paperCtx,"PathEditor:initializePaper",()=>{const A=o.paperCtx.scope;if(!sr(A,"PathEditor:initializePaper")){console.error("PathEditor: Paper.js not ready - canvas may have been replaced");return}A.settings.handleSize=8;const q=L.initialPath&&L.initialPath.length>0;if(o.mode=q?"edit":"draw",o.path=new A.Path,o.path.strokeColor=new A.Color(L.strokeColor??Rr),o.path.strokeWidth=Gs,q&&L.initialPath){const E=Zr(L.initialPath,o.paperCtx);o.path.segments=E.segments,o.path.strokeColor=new A.Color(L.strokeColor??Rr),o.path.strokeWidth=Gs}o.previewPath=new A.Path,o.previewPath.strokeColor=new A.Color(nl),o.previewPath.strokeWidth=rl,o.previewPath.dashArray=sl,o.previewPath.visible=!1,s=gl(o,()=>{c(L)},()=>{J.redraw()})})},c=C=>{if(o.path){const L=Mo(o.path);C.onPathChanged(L)}J.redraw()},u=C=>{o.mode==="draw"&&(o.mode="edit",o.pendingPoint=null,o.isDraggingCurve=!1,o.isNearFirstPoint=!1,o.previewPath&&(o.previewPath.removeSegments(),o.previewPath.visible=!1),o.snapIndicator&&(o.snapIndicator.visible=!1),c(C))},d=()=>{s&&(s.remove(),s=null),ml(o.canvas),o.paperCtx&&o.paperCtx.scope.project.remove(),o.canvas=null,o.paperCtx=null,o.path=null,o.previewPath=null,o.snapIndicator=null,o.selectedSegment=null,o.selectedHandle=null},g=C=>{if(C===o.zoom||!o.paperCtx)return;const L=o.paperCtx.scope,A=C/o.zoom;L.view.scale(A,L.view.center),o.zoom=C,J.redraw()},x=()=>`${Math.round(o.zoom*100)}%`;return{oncreate:({dom:C,attrs:L})=>{const A=C.querySelector("canvas");A&&(l(A,L),r=L.initialPath)},onremove:()=>{d()},onupdate:({attrs:C})=>{if(!o.path||!o.paperCtx||(C.strokeColor&&(o.path.strokeColor=new o.paperCtx.scope.Color(C.strokeColor)),C.initialPath===r))return;const L=r?.length??0,A=C.initialPath?.length??0;if(r=C.initialPath,L===A)return;C.initialPath&&C.initialPath.length>0?C.initialPath&&o.paperCtx&&Nt(o.paperCtx,"PathEditor:onupdate-loadPath",()=>{const E=o.paperCtx.scope;if(!sr(E,"PathEditor:onupdate-loadPath")){console.error("PathEditor: Paper.js not ready during path reload - canvas may have been replaced");return}o.path.removeSegments();const Q=Zr(C.initialPath,o.paperCtx);o.path.segments=Q.segments,o.path.strokeColor=new E.Color(C.strokeColor??Rr),o.mode="edit",o.selectedSegment=null,o.selectedHandle=null,o.pendingPoint=null,o.isDraggingCurve=!1,o.isNearFirstPoint=!1,o.snapIndicator&&(o.snapIndicator.visible=!1),J.redraw()}):(o.path.removeSegments(),o.mode="draw",o.selectedSegment=null,o.selectedHandle=null,o.pendingPoint=null,o.isDraggingCurve=!1,o.isNearFirstPoint=!1,o.snapIndicator&&(o.snapIndicator.visible=!1),J.redraw())},view:({attrs:C})=>{const L=x();return J(".path-editor",[J("canvas",{key:"path-editor-canvas",width:C.width,height:C.height,style:{width:`${C.width}px`,height:`${C.height}px`}}),J(".path-editor-controls",{key:"path-editor-controls"},[J(".mode-indicator",`Mode: ${o.mode==="draw"?"Drawing":"Editing"}`),o.mode==="draw"&&J("wa-button.end-drawing-button",{variant:"success",size:"small",onclick:()=>u(C)},"End Drawing"),J("wa-dropdown.zoom-control",{"onwa-select":A=>{A.redraw=!1;const q=A.detail.item.value;if(q&&typeof q=="string"){const E=parseFloat(q);isNaN(E)||g(E)}}},[J("wa-button",{slot:"trigger","with-caret":!0,size:"small",value:o.zoom},L),...dl.map((A,q)=>J("wa-dropdown-item",{type:"checkbox",checked:o.zoom==A?!0:void 0,value:A.toString()},pl[q]))]),J("wa-tooltip",{for:"recenter-button"},"Recenter view"),J("wa-button#recenter-button",{appearance:"plain",size:"large",onclick:()=>{o.paperCtx&&Nt(o.paperCtx,"PathEditor:recenter",()=>{const A=o.paperCtx.scope,q=Dr/o.zoom;A.view.scale(q,A.view.center),o.zoom=Dr,A.view.center=new A.Point(A.view.viewSize.width/2,A.view.viewSize.height/2)})}},J("wa-icon",{library:"material",name:"recenter",label:"Recenter view"}))])])}}};function bl(o,s=.5){const r=[];let l=[0,0];for(const c of o)switch(c.type){case"move":l=c.p,r.push(l);break;case"line":l=c.p,r.push(l);break;case"bezier":{const u=Math.max(8,Math.ceil(Math.hypot(c.p3[0]-l[0],c.p3[1]-l[1])/s));for(let d=1;d<=u;d++){const g=d/u,x=g*g,C=x*g,L=1-g,A=L*L,q=A*L,E=q*l[0]+3*A*g*c.p1[0]+3*L*x*c.p2[0]+C*c.p3[0],Q=q*l[1]+3*A*g*c.p1[1]+3*L*x*c.p2[1]+C*c.p3[1];r.push([E,Q])}l=c.p3;break}case"arc":{const u=Math.max(8,Math.ceil(Math.hypot(c.p[0]-l[0],c.p[1]-l[1])/s));for(let d=1;d<=u;d++){const g=d/u,x=l[0]+g*(c.p[0]-l[0]),C=l[1]+g*(c.p[1]-l[1]);r.push([x,C])}l=c.p;break}}return r}function Ia(o,s=.01){if(o.length<2)return!1;let r=null;for(const g of o)if(g.type==="move"){r=g.p;break}if(!r)return!1;let l=null;for(let g=o.length-1;g>=0;g--){const x=o[g];switch(x.type){case"move":case"line":l=x.p;break;case"bezier":l=x.p3;break;case"arc":l=x.p;break}if(l)break}if(!l)return!1;const c=r[0]-l[0],u=r[1]-l[1];return Math.sqrt(c*c+u*u)<=s}function wl(o,s,r,l){const[c,u]=o,[d,g]=s,[x,C]=r,[L,A]=l,q=(c-d)*(C-A)-(u-g)*(x-L);if(Math.abs(q)<1e-10)return null;const E=((c-x)*(C-A)-(u-C)*(x-L))/q,Q=-((c-d)*(u-C)-(u-g)*(c-x))/q;if(E>0&&E<1&&Q>0&&Q<1){const X=c+E*(d-c),j=u+E*(g-u);return[X,j]}return null}function Jn(o,s,r){const l=o[0]-s[0],c=o[1]-s[1];return Math.sqrt(l*l+c*c)<=r}function Cl(o,s,r,l,c){return Jn(o,r,c)||Jn(o,l,c)||Jn(s,r,c)||Jn(s,l,c)}function Sl(o){const s=bl(o);if(s.length<4)return[];const r=[],l=1;for(let c=0;c<s.length-1;c++)for(let u=c+2;u<s.length-1;u++){const d=s[c],g=s[c+1],x=s[u],C=s[u+1];if(Cl(d,g,x,C,l))continue;const L=wl(d,g,x,C);L&&r.push(L)}return r}function Ws(o){const s=[];let r;Ia(o)||s.push("Path must be closed (first point must equal last point)");const l=Sl(o);return l.length>0&&(s.push(`Path has ${l.length} self-intersection${l.length>1?"s":""}`),r=l),{isValid:s.length===0,errors:s,intersections:r}}function Ea(o){try{const r=new DOMParser().parseFromString(o,"image/svg+xml"),l=r.querySelector("parsererror");if(l)return console.error("[SVGParser] XML parsing error:",l.textContent),{commands:[],warning:"Failed to parse SVG"};const c=r.querySelector("path");if(!c)return console.error("[SVGParser] No path element found in SVG"),{commands:[],warning:"Failed to parse SVG: no path element"};const u=c.getAttribute("d");return u?Pl(u):(console.error("[SVGParser] Path element has no d attribute"),{commands:[],warning:"Failed to parse SVG: Path element has no d attribute"})}catch(s){return console.error("[SVGParser] Error parsing SVG:",s),{commands:[],warning:"Failed to parse SVG"}}}function Pl(o){const s=[];let r=!1;const c=o.replace(/([MmLlHhVvCcSsQqTtAaZz])/g," $1 ").replace(/(\d)-/g,"$1 -").replace(/,/g," ").replace(/\s+/g," ").trim().split(" ").filter(j=>j.length>0);let u=0,d=0,g=0,x=0,C=0,L=0,A=0,q="",E=!0;const Q=()=>{const j=parseFloat(c[u]);return u++,j};for(;u<c.length;){let j=c[u];isNaN(parseFloat(j))?u++:q==="M"?j="L":q==="m"?j="l":j=q;const $=j===j.toLowerCase();switch(j.toUpperCase()){case"M":{if(!E){r=!0,u=c.length;break}E=!1;const re=Q(),ye=Q();$?(d+=re,g+=ye):(d=re,g=ye),x=d,C=g,s.push({type:"move",p:[d,g]}),q=j;break}case"L":{const re=Q(),ye=Q();$?(d+=re,g+=ye):(d=re,g=ye),s.push({type:"line",p:[d,g]}),L=d,A=g,q=j;break}case"H":{const re=Q();$?d+=re:d=re,s.push({type:"line",p:[d,g]}),L=d,A=g,q=j;break}case"V":{const re=Q();$?g+=re:g=re,s.push({type:"line",p:[d,g]}),L=d,A=g,q=j;break}case"C":{const re=Q(),ye=Q(),ue=Q(),M=Q(),de=Q(),_e=Q();let pe=re,Ce=ye,ke=ue,Se=M,Oe=de,Pe=_e;$&&(pe+=d,Ce+=g,ke+=d,Se+=g,Oe+=d,Pe+=g),s.push({type:"bezier",p1:[pe,Ce],p2:[ke,Se],p3:[Oe,Pe]}),L=ke,A=Se,d=Oe,g=Pe,q=j;break}case"S":{const re=Q(),ye=Q(),ue=Q(),M=Q(),de=2*d-L,_e=2*g-A;let pe=re,Ce=ye,ke=ue,Se=M;$&&(pe+=d,Ce+=g,ke+=d,Se+=g),s.push({type:"bezier",p1:[de,_e],p2:[pe,Ce],p3:[ke,Se]}),L=pe,A=Ce,d=ke,g=Se,q=j;break}case"Q":{const re=Q(),ye=Q(),ue=Q(),M=Q();let de=re,_e=ye,pe=ue,Ce=M;$&&(de+=d,_e+=g,pe+=d,Ce+=g);const ke=d+2/3*(de-d),Se=g+2/3*(_e-g),Oe=pe+2/3*(de-pe),Pe=Ce+2/3*(_e-Ce);s.push({type:"bezier",p1:[ke,Se],p2:[Oe,Pe],p3:[pe,Ce]}),L=de,A=_e,d=pe,g=Ce,q=j;break}case"T":{const re=Q(),ye=Q(),ue=2*d-L,M=2*g-A;let de=re,_e=ye;$&&(de+=d,_e+=g);const pe=d+2/3*(ue-d),Ce=g+2/3*(M-g),ke=de+2/3*(ue-de),Se=_e+2/3*(M-_e);s.push({type:"bezier",p1:[pe,Ce],p2:[ke,Se],p3:[de,_e]}),L=ue,A=M,d=de,g=_e,q=j;break}case"A":{Q(),Q(),Q(),Q(),Q();const re=Q(),ye=Q();let ue=re,M=ye;$&&(ue+=d,M+=g),s.push({type:"line",p:[ue,M]}),d=ue,g=M,L=ue,A=M,q=j;break}case"Z":{(d!==x||g!==C)&&(s.push({type:"line",p:[x,C]}),d=x,g=C),q=j;break}}}const X={commands:s};return r&&(X.warning="This SVG contains a compound path. Only the first subpath was imported."),X}function Aa(o,s,r,l=20){if(o.length===0)return o;let c=1/0,u=1/0,d=-1/0,g=-1/0;const x=(re,ye)=>{c=Math.min(c,re),u=Math.min(u,ye),d=Math.max(d,re),g=Math.max(g,ye)};for(const re of o)re.type==="move"||re.type==="line"?x(re.p[0],re.p[1]):re.type==="bezier"&&(x(re.p1[0],re.p1[1]),x(re.p2[0],re.p2[1]),x(re.p3[0],re.p3[1]));const C=d-c,L=g-u,A=s-2*l,q=r-2*l,E=Math.min(A/C,q/L),Q=C*E,X=L*E,j=l+(A-Q)/2-c*E,$=l+(q-X)/2-u*E,he=[];for(const re of o)re.type==="move"||re.type==="line"?he.push({...re,p:[re.p[0]*E+j,re.p[1]*E+$]}):re.type==="bezier"&&he.push({type:"bezier",p1:[re.p1[0]*E+j,re.p1[1]*E+$],p2:[re.p2[0]*E+j,re.p2[1]*E+$],p3:[re.p3[0]*E+j,re.p3[1]*E+$]});return he}const Ta=({attrs:o})=>{const s={el:null,currentAttrs:null,lastNotifiedOpen:o.open,cleanup:()=>{}},r=d=>{s.el&&s.el.open!==d&&(s.el.open=d)},l=d=>{s.lastNotifiedOpen!==d&&(s.lastNotifiedOpen=d,s.currentAttrs?.onStateChanged?.(d))},c=()=>l(!0),u=()=>l(!1);return{oncreate:({attrs:d,dom:g})=>{s.el=g,s.currentAttrs=d,r(d.open),s.el.addEventListener("wa-after-show",c),s.el.addEventListener("wa-after-hide",u),s.cleanup=()=>{s.el?.removeEventListener("wa-after-show",c),s.el?.removeEventListener("wa-after-hide",u),s.el=null,s.currentAttrs=null}},onupdate:({attrs:d})=>{s.currentAttrs=d,r(d.open)},onremove:()=>{s.cleanup()},view:({attrs:d,children:g})=>J("wa-dialog",{id:d.id,label:d.title,class:d.class??d.className,style:{"--width":d.width},open:d.open},d.contentKey!=null?J("div",{key:d.contentKey},g):g)}},kl=()=>{const o={initialPath:[],path:[],name:"",validation:{isValid:!1,errors:[]},prevOpen:!1,prevPieceId:null,contentKey:"initial"};let s=null;const r=g=>{g.piece?(o.contentKey=g.piece.id,o.initialPath=g.piece.path,o.path=g.piece.path,o.name=g.piece.name??"",o.validation=Ws(o.path)):(o.contentKey=`new-${Date.now()}`,o.initialPath=[],o.path=[],o.name="",o.validation={isValid:!1,errors:[]})},l=g=>{if(o.path=g,g.length===0)o.validation={isValid:!1,errors:[]};else{const x=Ws(g);o.validation=x}},c=g=>{o.name=g},u=g=>{o.validation.isValid&&g.onSave(o.path,o.name.length>0?o.name:void 0)},d=(g,x,C)=>{if(!g||g.length===0)return;const L=g[0];if(!L.name.endsWith(".svg")){console.error("Please select an SVG file");return}const A=new FileReader;A.onload=q=>{const E=q.target?.result;if(E){const Q=Ea(E);if(Q.warning&&console.warn("SVG import warning:",Q.warning),Q.commands.length>0){const X=Aa(Q.commands,x,C);if(o.initialPath=X,l(X),!o.name){const j=L.name.replace(/\.svg$/i,"");c(j)}J.redraw()}else console.error("Failed to parse SVG file")}},A.readAsText(L)};return{view:({attrs:g})=>{const x=g.piece?.id??null,C=g.open&&!o.prevOpen,L=x!==o.prevPieceId;g.open&&(C||L)&&r(g),o.prevOpen=g.open,o.prevPieceId=x;const A=g.editorWidth??600,q=g.editorHeight??600;return J(Ta,{open:g.open,title:g.piece?"Edit Whimsy":"Create Whimsy",className:"custom-piece-editor",width:"50vw",contentKey:o.contentKey,onStateChanged:E=>{E||g.onCancel()}},[J(".editor-content",[J(Sa,{config:{type:"string",name:"name",label:"Piece Name (optional)",optional:!0},value:o.name,onChange:E=>{o.name=E??"",J.redraw()}}),o.path.length>0&&(o.validation.isValid?Ia(o.path)&&J(".validation-status",[J(".valid",[J("wa-icon",{library:"material",name:"check_circle",style:"color: green;"}),J("span","Valid piece")])]):o.validation.errors.length>0&&J(".validation-status",[J(".invalid",[J("wa-icon",{library:"material",name:"error",style:"color: red;"}),J("span",o.validation.errors.join(", "))])])),J(".editor-canvas",[J(ka,{initialPath:o.initialPath,onPathChanged:l,width:A,height:q,strokeColor:o.validation.isValid?"#2196F3":"#f44336"})]),J(".import-controls",[J("input",{type:"file",accept:".svg",style:"display: none;",oncreate:E=>{s=E.dom},onchange:E=>{E.redraw=!1;const Q=E.target;d(Q.files,A,q),Q.value=""}}),J("wa-button",{variant:"default",size:"small",onclick:E=>{E.redraw=!1,s?.click()}},"Import SVG")])]),J("div",{slot:"footer",style:"display: flex; gap: 8px; justify-content: flex-end;"},[J("wa-button",{variant:"default",onclick:E=>{E.redraw=!1,g.onCancel()}},"Cancel"),J("wa-button",{variant:"primary",disabled:!o.validation.isValid,onclick:E=>{E.redraw=!1,u(g)}},"Save")])])}}};function Il(o,s,r,l,c=10){const u=document.createElement("canvas");u.width=s,u.height=r;const d=u.getContext("2d");if(!d||o.length===0)return"";d.clearRect(0,0,s,r);const g=El(o);if(!g)return"";const[x,C,L,A]=g,q=L-x,E=A-C,Q=s-2*c,X=r-2*c,j=Math.min(Q/q,X/E),$=q*j,he=E*j,re=c+(Q-$)/2-x*j,ye=c+(X-he)/2-C*j,ue=(M,de)=>[M*j+re,de*j+ye];d.beginPath();for(const M of o)switch(M.type){case"move":{const[de,_e]=ue(M.p[0],M.p[1]);d.moveTo(de,_e);break}case"line":{const[de,_e]=ue(M.p[0],M.p[1]);d.lineTo(de,_e);break}case"bezier":{const[de,_e]=ue(M.p1[0],M.p1[1]),[pe,Ce]=ue(M.p2[0],M.p2[1]),[ke,Se]=ue(M.p3[0],M.p3[1]);d.bezierCurveTo(de,_e,pe,Ce,ke,Se);break}case"arc":{const[de,_e]=ue(M.p[0],M.p[1]);d.lineTo(de,_e);break}}return d.strokeStyle=l,d.lineWidth=2,d.stroke(),u.toDataURL("image/png")}function El(o){if(o.length===0)return null;let s=1/0,r=1/0,l=-1/0,c=-1/0;const u=(d,g)=>{s=Math.min(s,d),r=Math.min(r,g),l=Math.max(l,d),c=Math.max(c,g)};for(const d of o)switch(d.type){case"move":case"line":case"arc":u(d.p[0],d.p[1]);break;case"bezier":u(d.p1[0],d.p1[1]),u(d.p2[0],d.p2[1]),u(d.p3[0],d.p3[1]);break}return s===1/0?null:[s,r,l,c]}const Al={view:({attrs:o})=>J(".custom-piece-tile",{key:o.piece.id,class:o.isSelected?"selected":"",onclick:s=>{s.redraw=!1,o.onClick()},ondblclick:s=>{s.redraw=!1,o.onDoubleClick()}},[J(".custom-piece-tile-thumbnail",o.thumbnail?J("img",{src:o.thumbnail,alt:o.piece.name??"Custom piece"}):J(".custom-piece-tile-placeholder",J("wa-icon",{name:"puzzle-piece"}))),J(".custom-piece-tile-name",o.piece.name??"Unnamed"),o.isSelected?J(".custom-piece-tile-selected-indicator",J("wa-icon",{name:"check-circle"})):null])};function Tl(o){const s=document.createElement("div");document.body.appendChild(s);let r=!1;const l=x=>{r||(r=!0,c(),u(x))},c=()=>{try{J.mount(s,null)}catch(x){console.warn("confirm(): unable to mount Mithril component: ",x)}s.remove()};let u;const d=new Promise(x=>{u=x}),g=()=>{const x={open:!0,contentKey:Math.random()},C=A=>{x.open=!1,J.redraw(),L=A};let L=null;return{view(){return J(Ta,{id:o.id,title:o.title,width:o.width,open:x.open,contentKey:x.contentKey,onStateChanged:A=>{!A&&L!==null&&l(L),!A&&L===null&&r===!1&&l(!1)}},[J(".confirm-body",o.body??"Are you sure?"),J(".confirm-actions",{slot:"footer"},[J("wa-button.btn-cancel",{variant:"neutral",size:"small","data-dialog":"close",onclick:A=>{A.redraw=!1,C(!1)}},o.cancelLabel??"Cancel"),J("wa-button.btn-confirm",{variant:"brand",size:"small","data-dialog":"close",onclick:A=>{A.redraw=!1,C(!0)}},o.confirmLabel??"OK")])])}}};return J.mount(s,g),d}const Ml=()=>{const o=new Map,s=(r,l)=>{const c=r.modified??r.created,u=`${r.id}-${c}-${l}`;if(!o.has(u)){const d=Il(r.path,100,100,l);o.set(u,d)}return o.get(u)??""};return{view:({attrs:r})=>{const l=r.selectedPieceId!==null&&r.selectedPieceId!==void 0,c=l?r.pieces.find(u=>u.id===r.selectedPieceId):null;return J(".whimsy-manager",[J(".whimsy-manager-header",[J("h3","Whimsy Pieces"),J("wa-button",{variant:"primary",size:"small",onclick:u=>{u.redraw=!1,r.onAdd()}},[J("wa-icon",{name:"plus",slot:"prefix"}),"Add"])]),J(".whimsy-grid",r.pieces.length===0?J(".whimsy-empty-state",[J("wa-icon",{name:"puzzle-piece",style:"font-size: 48px; opacity: 0.3;"}),J("p","No whimsy pieces yet"),J("p.hint",'Click "Add" to create one')]):r.pieces.map(u=>{const d=u.id===r.selectedPieceId,g=s(u,r.pieceColor);return J(Al,{key:u.id,piece:u,isSelected:d,thumbnail:g,onClick:()=>{d?r.onSelect(null):r.onSelect(u.id)},onDoubleClick:()=>{r.onEdit(u.id)}})})),J(".whimsy-actions",[J("wa-button",{size:"small",disabled:!l,onclick:u=>{u.redraw=!1,c&&r.onEdit(c.id)}},[J("wa-icon",{name:"pencil",slot:"prefix"}),"Edit"]),J("wa-button",{size:"small",disabled:!l,onclick:u=>{u.redraw=!1,c&&r.onDuplicate(c.id)}},[J("wa-icon",{name:"copy",slot:"prefix"}),"Duplicate"]),J("wa-button",{size:"small",variant:"danger",disabled:!l,onclick:async u=>{u.redraw=!1,c&&await Tl({title:"Delete piece?",body:`Are you sure you want to delete ${c.name??"this piece"}?`,confirmLabel:"Delete"})&&r.onDelete(c.id)}},[J("wa-icon",{name:"trash",slot:"start"}),"Delete"]),J("wa-button",{size:"small",disabled:!l,onclick:u=>{u.redraw=!1,c&&r.onPosition(c.id)}},[J("wa-icon",{name:"arrows-up-down-left-right",slot:"prefix"}),"Position"])])])}}};var Vr,Zs;function Ma(){if(Zs)return Vr;Zs=1;function o(r){var l=r.length,c=1,u=new Array(l),d;for(d=l;d>0;d--)u[d-1]=c,c=c*r[d-1];return{stride:u,data:new Uint32Array(c)}}function s(r){var l=r.length,c=1,u=new Array(l),d=[],g,x;for(g=l;g>0;g--)u[g-1]=c,c=c*r[g-1];for(x=0;x<c;x++)d.push([]);return{stride:u,data:d}}return Vr={integer:o,array:s},Vr}var Fr,Xs;function za(){if(Xs)return Fr;Xs=1,Fr=o;function o(s,r){var l=new Array(s),c=Math.floor(s/2)<<1,u=0,d,g,x,C,L;for(L=0;L<c;L+=2)d=-2*Math.log(r()),g=Math.sqrt(d),x=2*Math.PI*r(),u+=d,l[L]=g*Math.cos(x),l[L+1]=g*Math.sin(x);if(s%2){var A=Math.sqrt(-2*Math.log(r()))*Math.cos(2*Math.PI*r());l[s-1]=A,u+=Math.pow(A,2)}for(C=1/Math.sqrt(u),L=0;L<s;++L)l[L]*=C;return l}return Fr}var Br,Ks;function zl(){return Ks||(Ks=1,Br=function(s,r){s=s||1,r=r||2;for(var l=s*2+1,c=Math.pow(l,r)-1,u=new Array(c),d=0;d<c;d++)for(var g=u[d]=new Array(r),x=d<c/2?d:d+1,C=1;C<=r;C++){var L=x%Math.pow(l,C);g[C-1]=L/Math.pow(l,C-1)-s,x-=L}return u}),Br}var Ur,$s;function La(){if($s)return Ur;$s=1;var o=zl();function s(c){var u=o(2,c),d=[],g;for(u=u.filter(function(x){for(var C=0,L=0;L<c;L++)C+=Math.pow(Math.max(0,Math.abs(x[L])-1),2);return C<c}),g=0;g<c;g++)d.push(0);return u.push(d),u.sort(function(x,C){var L=0,A=0,q;for(q=0;q<c;q++)L+=Math.pow(x[q],2),A+=Math.pow(C[q],2);return L<A?-1:L>A?1:0}),u}var r={};function l(c){return r[c]||(r[c]=s(c)),r[c]}return Ur=l,Ur}var qr,Ys;function Ll(){if(Ys)return qr;Ys=1;var o=Ma().integer,s=za(),r=La();function l(u,d){for(var g=0,x=0;x<u.length;x++)g+=Math.pow(u[x]-d[x],2);return g}function c(u,d){if(typeof u.distanceFunction=="function")throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=u.shape,this.minDistance=u.minDistance,this.maxDistance=u.maxDistance||u.minDistance*2,this.maxTries=Math.ceil(Math.max(1,u.tries||30)),this.rng=d||Math.random;for(var g=0,x=0;x<this.shape.length;x++)g=Math.max(g,this.shape[x]);var C=Math.max(1,g/128|0),L=1e-14*C;this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+L,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=r(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var x=0;x<this.dimension;x++)this.gridShape.push(Math.ceil(this.shape[x]/this.cellSize));this.grid=o(this.gridShape)}return c.prototype.shape=null,c.prototype.dimension=null,c.prototype.minDistance=null,c.prototype.maxDistance=null,c.prototype.minDistancePlusEpsilon=null,c.prototype.squaredMinDistance=null,c.prototype.deltaDistance=null,c.prototype.cellSize=null,c.prototype.maxTries=null,c.prototype.rng=null,c.prototype.neighbourhood=null,c.prototype.currentPoint=null,c.prototype.processList=null,c.prototype.samplePoints=null,c.prototype.gridShape=null,c.prototype.grid=null,c.prototype.addRandomPoint=function(){for(var u=new Array(this.dimension),d=0;d<this.dimension;d++)u[d]=this.rng()*this.shape[d];return this.directAddPoint(u)},c.prototype.addPoint=function(u){var d,g=!0;if(u.length===this.dimension)for(d=0;d<this.dimension&&g;d++)g=u[d]>=0&&u[d]<this.shape[d];else g=!1;return g?this.directAddPoint(u):null},c.prototype.directAddPoint=function(u){var d=0,g=this.grid.stride,x;for(this.processList.push(u),this.samplePoints.push(u),x=0;x<this.dimension;x++)d+=(u[x]/this.cellSize|0)*g[x];return this.grid.data[d]=this.samplePoints.length,u},c.prototype.inNeighbourhood=function(u){var d=this.dimension,g=this.grid.stride,x,C,L,A,q;for(x=0;x<this.neighbourhood.length;x++){for(C=0,L=0;L<d;L++){if(A=(u[L]/this.cellSize|0)+this.neighbourhood[x][L],A<0||A>=this.gridShape[L]){C=-1;break}C+=A*g[L]}if(C!==-1&&this.grid.data[C]!==0&&(q=this.samplePoints[this.grid.data[C]-1],l(u,q)<this.squaredMinDistance))return!0}return!1},c.prototype.next=function(){for(var u,d,g,x,C,L,A;this.processList.length>0;){for(this.currentPoint===null&&(this.currentPoint=this.processList.shift()),x=this.currentPoint,u=0;u<this.maxTries;u++){for(L=!0,g=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),this.dimension===2?(d=this.rng()*Math.PI*2,C=[Math.cos(d),Math.sin(d)]):C=s(this.dimension,this.rng),A=0;L&&A<this.dimension;A++)C[A]=x[A]+C[A]*g,L=C[A]>=0&&C[A]<this.shape[A];if(L&&!this.inNeighbourhood(C))return this.directAddPoint(C)}u===this.maxTries&&(this.currentPoint=null)}return null},c.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},c.prototype.getAllPoints=function(){return this.samplePoints},c.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")},c.prototype.reset=function(){var u=this.grid.data,d=0;for(d=0;d<u.length;d++)u[d]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0},qr=c,qr}var Hr,Qs;function Ol(){if(Qs)return Hr;Qs=1;var o=Ma().array,s=za(),r=La();function l(u,d){for(var g=0,x=0;x<u.length;x++)g+=Math.pow(u[x]-d[x],2);return Math.sqrt(g)}function c(u,d){if(typeof u.distanceFunction!="function")throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=u.shape,this.minDistance=u.minDistance,this.maxDistance=u.maxDistance||u.minDistance*2,this.maxTries=Math.ceil(Math.max(1,u.tries||30)),this.distanceFunction=u.distanceFunction,this.bias=Math.max(0,Math.min(1,u.bias||0)),this.rng=d||Math.random;for(var g=0,x=0;x<this.shape.length;x++)g=Math.max(g,this.shape[x]);var C=Math.max(1,g/128|0),L=1e-14*C;this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+L,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=r(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var x=0;x<this.dimension;x++)this.gridShape.push(Math.ceil(this.shape[x]/this.cellSize));this.grid=o(this.gridShape)}return c.prototype.shape=null,c.prototype.dimension=null,c.prototype.minDistance=null,c.prototype.maxDistance=null,c.prototype.minDistancePlusEpsilon=null,c.prototype.deltaDistance=null,c.prototype.cellSize=null,c.prototype.maxTries=null,c.prototype.distanceFunction=null,c.prototype.bias=null,c.prototype.rng=null,c.prototype.neighbourhood=null,c.prototype.currentPoint=null,c.prototype.currentDistance=null,c.prototype.processList=null,c.prototype.samplePoints=null,c.prototype.sampleDistance=null,c.prototype.gridShape=null,c.prototype.grid=null,c.prototype.addRandomPoint=function(){for(var u=new Array(this.dimension),d=0;d<this.dimension;d++)u[d]=this.rng()*this.shape[d];return this.directAddPoint(u)},c.prototype.addPoint=function(u){var d,g=!0;if(u.length===this.dimension)for(d=0;d<this.dimension&&g;d++)g=u[d]>=0&&u[d]<this.shape[d];else g=!1;return g?this.directAddPoint(u):null},c.prototype.directAddPoint=function(u){var d=0,g=this.grid.stride,x=this.samplePoints.length,C;for(this.processList.push(x),this.samplePoints.push(u),this.sampleDistance.push(this.distanceFunction(u)),C=0;C<this.dimension;C++)d+=(u[C]/this.cellSize|0)*g[C];return this.grid.data[d].push(x),u},c.prototype.inNeighbourhood=function(u){var d=this.dimension,g=this.grid.stride,x,C,L,A,q,E,Q=this.distanceFunction(u);for(x=0;x<this.neighbourhood.length;x++){for(C=0,L=0;L<d;L++){if(A=(u[L]/this.cellSize|0)+this.neighbourhood[x][L],A<0||A>=this.gridShape[L]){C=-1;break}C+=A*g[L]}if(C!==-1&&this.grid.data[C].length>0)for(var X=0;X<this.grid.data[C].length;X++){q=this.samplePoints[this.grid.data[C][X]],E=this.sampleDistance[this.grid.data[C][X]];var j=Math.min(E,Q),$=Math.max(E,Q),he=j+($-j)*this.bias;if(l(u,q)<this.minDistance+this.deltaDistance*he)return!0}}return!1},c.prototype.next=function(){for(var u,d,g,x,C,L,A,q;this.processList.length>0;){if(this.currentPoint===null){var E=this.processList.shift();this.currentPoint=this.samplePoints[E],this.currentDistance=this.sampleDistance[E]}for(x=this.currentPoint,C=this.currentDistance,u=0;u<this.maxTries;u++){for(A=!0,g=this.minDistancePlusEpsilon+this.deltaDistance*(C+(1-C)*this.bias),this.dimension===2?(d=this.rng()*Math.PI*2,L=[Math.cos(d),Math.sin(d)]):L=s(this.dimension,this.rng),q=0;A&&q<this.dimension;q++)L[q]=x[q]+L[q]*g,A=L[q]>=0&&L[q]<this.shape[q];if(A&&!this.inNeighbourhood(L))return this.directAddPoint(L)}u===this.maxTries&&(this.currentPoint=null)}return null},c.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},c.prototype.getAllPoints=function(){return this.samplePoints},c.prototype.getAllPointsWithDistance=function(){var u=new Array(this.samplePoints.length),d=0,g=0,x;for(d=0;d<this.samplePoints.length;d++){for(x=new Array(this.dimension+1),g=0;g<this.dimension;g++)x[g]=this.samplePoints[d][g];x[this.dimension]=this.sampleDistance[d],u[d]=x}return u},c.prototype.reset=function(){var u=this.grid.data,d=0;for(d=0;d<u.length;d++)u[d]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0},Hr=c,Hr}var Gr,Js;function Nl(){if(Js)return Gr;Js=1;var o=Ll(),s=Ol();function r(l,c){this.shape=l.shape,typeof l.distanceFunction=="function"?this.implementation=new s(l,c):this.implementation=new o(l,c)}return r.prototype.implementation=null,r.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()},r.prototype.addPoint=function(l){return this.implementation.addPoint(l)},r.prototype.next=function(){return this.implementation.next()},r.prototype.fill=function(){return this.implementation.fill()},r.prototype.getAllPoints=function(){return this.implementation.getAllPoints()},r.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()},r.prototype.reset=function(){this.implementation.reset()},Gr=r,Gr}var Rl=Nl();const Dl=is(Rl),ss="PoissonPointGenerator",Vl={name:ss,displayName:"Poisson",description:"Generate seed points using Poisson disk sampling. The algorithm produces points that are tightly-packed, but no closer to each other than a specified minimum distance (the piece size), resulting in a natural, organic look.",sortHint:1,controls:[]},Fl=(o,s,r)=>({generatePoints(c){const{width:u,height:d,pieceSize:g,random:x,border:C}=c;return new Dl({shape:[u,d],minDistance:g,tries:20},x).fill().filter(E=>rs(E,C))}});An.register(ss,Fl,Vl);const ai=11102230246251565e-32,Tt=134217729,Bl=(3+8*ai)*ai;function jr(o,s,r,l,c){let u,d,g,x,C=s[0],L=l[0],A=0,q=0;L>C==L>-C?(u=C,C=s[++A]):(u=L,L=l[++q]);let E=0;if(A<o&&q<r)for(L>C==L>-C?(d=C+u,g=u-(d-C),C=s[++A]):(d=L+u,g=u-(d-L),L=l[++q]),u=d,g!==0&&(c[E++]=g);A<o&&q<r;)L>C==L>-C?(d=u+C,x=d-u,g=u-(d-x)+(C-x),C=s[++A]):(d=u+L,x=d-u,g=u-(d-x)+(L-x),L=l[++q]),u=d,g!==0&&(c[E++]=g);for(;A<o;)d=u+C,x=d-u,g=u-(d-x)+(C-x),C=s[++A],u=d,g!==0&&(c[E++]=g);for(;q<r;)d=u+L,x=d-u,g=u-(d-x)+(L-x),L=l[++q],u=d,g!==0&&(c[E++]=g);return(u!==0||E===0)&&(c[E++]=u),E}function Ul(o,s){let r=s[0];for(let l=1;l<o;l++)r+=s[l];return r}function Ln(o){return new Float64Array(o)}const ql=(3+16*ai)*ai,Hl=(2+12*ai)*ai,Gl=(9+64*ai)*ai*ai,Hi=Ln(4),ea=Ln(8),ta=Ln(12),ia=Ln(16),Lt=Ln(4);function jl(o,s,r,l,c,u,d){let g,x,C,L,A,q,E,Q,X,j,$,he,re,ye,ue,M,de,_e;const pe=o-c,Ce=r-c,ke=s-u,Se=l-u;ye=pe*Se,q=Tt*pe,E=q-(q-pe),Q=pe-E,q=Tt*Se,X=q-(q-Se),j=Se-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=ke*Ce,q=Tt*ke,E=q-(q-ke),Q=ke-E,q=Tt*Ce,X=q-(q-Ce),j=Ce-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,Hi[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,Hi[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,Hi[2]=he-(_e-A)+($-A),Hi[3]=_e;let Oe=Ul(4,Hi),Pe=Hl*d;if(Oe>=Pe||-Oe>=Pe||(A=o-pe,g=o-(pe+A)+(A-c),A=r-Ce,C=r-(Ce+A)+(A-c),A=s-ke,x=s-(ke+A)+(A-u),A=l-Se,L=l-(Se+A)+(A-u),g===0&&x===0&&C===0&&L===0)||(Pe=Gl*d+Bl*Math.abs(Oe),Oe+=pe*L+Se*g-(ke*C+Ce*x),Oe>=Pe||-Oe>=Pe))return Oe;ye=g*Se,q=Tt*g,E=q-(q-g),Q=g-E,q=Tt*Se,X=q-(q-Se),j=Se-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=x*Ce,q=Tt*x,E=q-(q-x),Q=x-E,q=Tt*Ce,X=q-(q-Ce),j=Ce-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,Lt[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,Lt[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,Lt[2]=he-(_e-A)+($-A),Lt[3]=_e;const Je=jr(4,Hi,4,Lt,ea);ye=pe*L,q=Tt*pe,E=q-(q-pe),Q=pe-E,q=Tt*L,X=q-(q-L),j=L-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=ke*C,q=Tt*ke,E=q-(q-ke),Q=ke-E,q=Tt*C,X=q-(q-C),j=C-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,Lt[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,Lt[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,Lt[2]=he-(_e-A)+($-A),Lt[3]=_e;const me=jr(Je,ea,4,Lt,ta);ye=g*L,q=Tt*g,E=q-(q-g),Q=g-E,q=Tt*L,X=q-(q-L),j=L-X,ue=Q*j-(ye-E*X-Q*X-E*j),M=x*C,q=Tt*x,E=q-(q-x),Q=x-E,q=Tt*C,X=q-(q-C),j=C-X,de=Q*j-(M-E*X-Q*X-E*j),$=ue-de,A=ue-$,Lt[0]=ue-($+A)+(A-de),he=ye+$,A=he-ye,re=ye-(he-A)+($-A),$=re-M,A=re-$,Lt[1]=re-($+A)+(A-M),_e=he+$,A=_e-he,Lt[2]=he-(_e-A)+($-A),Lt[3]=_e;const Ke=jr(me,ta,4,Lt,ia);return ia[Ke-1]}function er(o,s,r,l,c,u){const d=(s-u)*(r-c),g=(o-c)*(l-u),x=d-g,C=Math.abs(d+g);return Math.abs(x)>=ql*C?x:-jl(o,s,r,l,c,u,C)}const na=Math.pow(2,-52),tr=new Uint32Array(512);class dr{static from(s,r=$l,l=Yl){const c=s.length,u=new Float64Array(c*2);for(let d=0;d<c;d++){const g=s[d];u[2*d]=r(g),u[2*d+1]=l(g)}return new dr(u)}constructor(s){const r=s.length>>1;if(r>0&&typeof s[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=s;const l=Math.max(2*r-5,0);this._triangles=new Uint32Array(l*3),this._halfedges=new Int32Array(l*3),this._hashSize=Math.ceil(Math.sqrt(r)),this._hullPrev=new Uint32Array(r),this._hullNext=new Uint32Array(r),this._hullTri=new Uint32Array(r),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(r),this._dists=new Float64Array(r),this.update()}update(){const{coords:s,_hullPrev:r,_hullNext:l,_hullTri:c,_hullHash:u}=this,d=s.length>>1;let g=1/0,x=1/0,C=-1/0,L=-1/0;for(let pe=0;pe<d;pe++){const Ce=s[2*pe],ke=s[2*pe+1];Ce<g&&(g=Ce),ke<x&&(x=ke),Ce>C&&(C=Ce),ke>L&&(L=ke),this._ids[pe]=pe}const A=(g+C)/2,q=(x+L)/2;let E,Q,X;for(let pe=0,Ce=1/0;pe<d;pe++){const ke=Wr(A,q,s[2*pe],s[2*pe+1]);ke<Ce&&(E=pe,Ce=ke)}const j=s[2*E],$=s[2*E+1];for(let pe=0,Ce=1/0;pe<d;pe++){if(pe===E)continue;const ke=Wr(j,$,s[2*pe],s[2*pe+1]);ke<Ce&&ke>0&&(Q=pe,Ce=ke)}let he=s[2*Q],re=s[2*Q+1],ye=1/0;for(let pe=0;pe<d;pe++){if(pe===E||pe===Q)continue;const Ce=Xl(j,$,he,re,s[2*pe],s[2*pe+1]);Ce<ye&&(X=pe,ye=Ce)}let ue=s[2*X],M=s[2*X+1];if(ye===1/0){for(let ke=0;ke<d;ke++)this._dists[ke]=s[2*ke]-s[0]||s[2*ke+1]-s[1];Zi(this._ids,this._dists,0,d-1);const pe=new Uint32Array(d);let Ce=0;for(let ke=0,Se=-1/0;ke<d;ke++){const Oe=this._ids[ke],Pe=this._dists[Oe];Pe>Se&&(pe[Ce++]=Oe,Se=Pe)}this.hull=pe.subarray(0,Ce),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(er(j,$,he,re,ue,M)<0){const pe=Q,Ce=he,ke=re;Q=X,he=ue,re=M,X=pe,ue=Ce,M=ke}const de=Kl(j,$,he,re,ue,M);this._cx=de.x,this._cy=de.y;for(let pe=0;pe<d;pe++)this._dists[pe]=Wr(s[2*pe],s[2*pe+1],de.x,de.y);Zi(this._ids,this._dists,0,d-1),this._hullStart=E;let _e=3;l[E]=r[X]=Q,l[Q]=r[E]=X,l[X]=r[Q]=E,c[E]=0,c[Q]=1,c[X]=2,u.fill(-1),u[this._hashKey(j,$)]=E,u[this._hashKey(he,re)]=Q,u[this._hashKey(ue,M)]=X,this.trianglesLen=0,this._addTriangle(E,Q,X,-1,-1,-1);for(let pe=0,Ce,ke;pe<this._ids.length;pe++){const Se=this._ids[pe],Oe=s[2*Se],Pe=s[2*Se+1];if(pe>0&&Math.abs(Oe-Ce)<=na&&Math.abs(Pe-ke)<=na||(Ce=Oe,ke=Pe,Se===E||Se===Q||Se===X))continue;let Je=0;for(let tt=0,Kt=this._hashKey(Oe,Pe);tt<this._hashSize&&(Je=u[(Kt+tt)%this._hashSize],!(Je!==-1&&Je!==l[Je]));tt++);Je=r[Je];let me=Je,Ke;for(;Ke=l[me],er(Oe,Pe,s[2*me],s[2*me+1],s[2*Ke],s[2*Ke+1])>=0;)if(me=Ke,me===Je){me=-1;break}if(me===-1)continue;let rt=this._addTriangle(me,Se,l[me],-1,-1,c[me]);c[Se]=this._legalize(rt+2),c[me]=rt,_e++;let Ve=l[me];for(;Ke=l[Ve],er(Oe,Pe,s[2*Ve],s[2*Ve+1],s[2*Ke],s[2*Ke+1])<0;)rt=this._addTriangle(Ve,Se,Ke,c[Se],-1,c[Ve]),c[Se]=this._legalize(rt+2),l[Ve]=Ve,_e--,Ve=Ke;if(me===Je)for(;Ke=r[me],er(Oe,Pe,s[2*Ke],s[2*Ke+1],s[2*me],s[2*me+1])<0;)rt=this._addTriangle(Ke,Se,me,-1,c[me],c[Ke]),this._legalize(rt+2),c[Ke]=rt,l[me]=me,_e--,me=Ke;this._hullStart=r[Se]=me,l[me]=r[Ve]=Se,l[Se]=Ve,u[this._hashKey(Oe,Pe)]=Se,u[this._hashKey(s[2*me],s[2*me+1])]=me}this.hull=new Uint32Array(_e);for(let pe=0,Ce=this._hullStart;pe<_e;pe++)this.hull[pe]=Ce,Ce=l[Ce];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(s,r){return Math.floor(Wl(s-this._cx,r-this._cy)*this._hashSize)%this._hashSize}_legalize(s){const{_triangles:r,_halfedges:l,coords:c}=this;let u=0,d=0;for(;;){const g=l[s],x=s-s%3;if(d=x+(s+2)%3,g===-1){if(u===0)break;s=tr[--u];continue}const C=g-g%3,L=x+(s+1)%3,A=C+(g+2)%3,q=r[d],E=r[s],Q=r[L],X=r[A];if(Zl(c[2*q],c[2*q+1],c[2*E],c[2*E+1],c[2*Q],c[2*Q+1],c[2*X],c[2*X+1])){r[s]=X,r[g]=q;const $=l[A];if($===-1){let re=this._hullStart;do{if(this._hullTri[re]===A){this._hullTri[re]=s;break}re=this._hullPrev[re]}while(re!==this._hullStart)}this._link(s,$),this._link(g,l[d]),this._link(d,A);const he=C+(g+1)%3;u<tr.length&&(tr[u++]=he)}else{if(u===0)break;s=tr[--u]}}return d}_link(s,r){this._halfedges[s]=r,r!==-1&&(this._halfedges[r]=s)}_addTriangle(s,r,l,c,u,d){const g=this.trianglesLen;return this._triangles[g]=s,this._triangles[g+1]=r,this._triangles[g+2]=l,this._link(g,c),this._link(g+1,u),this._link(g+2,d),this.trianglesLen+=3,g}}function Wl(o,s){const r=o/(Math.abs(o)+Math.abs(s));return(s>0?3-r:1+r)/4}function Wr(o,s,r,l){const c=o-r,u=s-l;return c*c+u*u}function Zl(o,s,r,l,c,u,d,g){const x=o-d,C=s-g,L=r-d,A=l-g,q=c-d,E=u-g,Q=x*x+C*C,X=L*L+A*A,j=q*q+E*E;return x*(A*j-X*E)-C*(L*j-X*q)+Q*(L*E-A*q)<0}function Xl(o,s,r,l,c,u){const d=r-o,g=l-s,x=c-o,C=u-s,L=d*d+g*g,A=x*x+C*C,q=.5/(d*C-g*x),E=(C*L-g*A)*q,Q=(d*A-x*L)*q;return E*E+Q*Q}function Kl(o,s,r,l,c,u){const d=r-o,g=l-s,x=c-o,C=u-s,L=d*d+g*g,A=x*x+C*C,q=.5/(d*C-g*x),E=o+(C*L-g*A)*q,Q=s+(d*A-x*L)*q;return{x:E,y:Q}}function Zi(o,s,r,l){if(l-r<=20)for(let c=r+1;c<=l;c++){const u=o[c],d=s[u];let g=c-1;for(;g>=r&&s[o[g]]>d;)o[g+1]=o[g--];o[g+1]=u}else{const c=r+l>>1;let u=r+1,d=l;pn(o,c,u),s[o[r]]>s[o[l]]&&pn(o,r,l),s[o[u]]>s[o[l]]&&pn(o,u,l),s[o[r]]>s[o[u]]&&pn(o,r,u);const g=o[u],x=s[g];for(;;){do u++;while(s[o[u]]<x);do d--;while(s[o[d]]>x);if(d<u)break;pn(o,u,d)}o[r+1]=o[d],o[d]=g,l-u+1>=d-r?(Zi(o,s,u,l),Zi(o,s,r,d-1)):(Zi(o,s,r,d-1),Zi(o,s,u,l))}}function pn(o,s,r){const l=o[s];o[s]=o[r],o[r]=l}function $l(o){return o[0]}function Yl(o){return o[1]}const ra=1e-6;class Li{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(s,r){this._+=`M${this._x0=this._x1=+s},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(s,r){this._+=`L${this._x1=+s},${this._y1=+r}`}arc(s,r,l){s=+s,r=+r,l=+l;const c=s+l,u=r;if(l<0)throw new Error("negative radius");this._x1===null?this._+=`M${c},${u}`:(Math.abs(this._x1-c)>ra||Math.abs(this._y1-u)>ra)&&(this._+="L"+c+","+u),l&&(this._+=`A${l},${l},0,1,1,${s-l},${r}A${l},${l},0,1,1,${this._x1=c},${this._y1=u}`)}rect(s,r,l,c){this._+=`M${this._x0=this._x1=+s},${this._y0=this._y1=+r}h${+l}v${+c}h${-l}Z`}value(){return this._||null}}class es{constructor(){this._=[]}moveTo(s,r){this._.push([s,r])}closePath(){this._.push(this._[0].slice())}lineTo(s,r){this._.push([s,r])}value(){return this._.length?this._:null}}class Ql{constructor(s,[r,l,c,u]=[0,0,960,500]){if(!((c=+c)>=(r=+r))||!((u=+u)>=(l=+l)))throw new Error("invalid bounds");this.delaunay=s,this._circumcenters=new Float64Array(s.points.length*2),this.vectors=new Float64Array(s.points.length*2),this.xmax=c,this.xmin=r,this.ymax=u,this.ymin=l,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:s,hull:r,triangles:l},vectors:c}=this;let u,d;const g=this.circumcenters=this._circumcenters.subarray(0,l.length/3*2);for(let X=0,j=0,$=l.length,he,re;X<$;X+=3,j+=2){const ye=l[X]*2,ue=l[X+1]*2,M=l[X+2]*2,de=s[ye],_e=s[ye+1],pe=s[ue],Ce=s[ue+1],ke=s[M],Se=s[M+1],Oe=pe-de,Pe=Ce-_e,Je=ke-de,me=Se-_e,Ke=(Oe*me-Pe*Je)*2;if(Math.abs(Ke)<1e-9){if(u===void 0){u=d=0;for(const Ve of r)u+=s[Ve*2],d+=s[Ve*2+1];u/=r.length,d/=r.length}const rt=1e9*Math.sign((u-de)*me-(d-_e)*Je);he=(de+ke)/2-rt*me,re=(_e+Se)/2+rt*Je}else{const rt=1/Ke,Ve=Oe*Oe+Pe*Pe,tt=Je*Je+me*me;he=de+(me*Ve-Pe*tt)*rt,re=_e+(Oe*tt-Je*Ve)*rt}g[j]=he,g[j+1]=re}let x=r[r.length-1],C,L=x*4,A,q=s[2*x],E,Q=s[2*x+1];c.fill(0);for(let X=0;X<r.length;++X)x=r[X],C=L,A=q,E=Q,L=x*4,q=s[2*x],Q=s[2*x+1],c[C+2]=c[L]=E-Q,c[C+3]=c[L+1]=q-A}render(s){const r=s==null?s=new Li:void 0,{delaunay:{halfedges:l,inedges:c,hull:u},circumcenters:d,vectors:g}=this;if(u.length<=1)return null;for(let L=0,A=l.length;L<A;++L){const q=l[L];if(q<L)continue;const E=Math.floor(L/3)*2,Q=Math.floor(q/3)*2,X=d[E],j=d[E+1],$=d[Q],he=d[Q+1];this._renderSegment(X,j,$,he,s)}let x,C=u[u.length-1];for(let L=0;L<u.length;++L){x=C,C=u[L];const A=Math.floor(c[C]/3)*2,q=d[A],E=d[A+1],Q=x*4,X=this._project(q,E,g[Q+2],g[Q+3]);X&&this._renderSegment(q,E,X[0],X[1],s)}return r&&r.value()}renderBounds(s){const r=s==null?s=new Li:void 0;return s.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),r&&r.value()}renderCell(s,r){const l=r==null?r=new Li:void 0,c=this._clip(s);if(c===null||!c.length)return;r.moveTo(c[0],c[1]);let u=c.length;for(;c[0]===c[u-2]&&c[1]===c[u-1]&&u>1;)u-=2;for(let d=2;d<u;d+=2)(c[d]!==c[d-2]||c[d+1]!==c[d-1])&&r.lineTo(c[d],c[d+1]);return r.closePath(),l&&l.value()}*cellPolygons(){const{delaunay:{points:s}}=this;for(let r=0,l=s.length/2;r<l;++r){const c=this.cellPolygon(r);c&&(c.index=r,yield c)}}cellPolygon(s){const r=new es;return this.renderCell(s,r),r.value()}_renderSegment(s,r,l,c,u){let d;const g=this._regioncode(s,r),x=this._regioncode(l,c);g===0&&x===0?(u.moveTo(s,r),u.lineTo(l,c)):(d=this._clipSegment(s,r,l,c,g,x))&&(u.moveTo(d[0],d[1]),u.lineTo(d[2],d[3]))}contains(s,r,l){return r=+r,r!==r||(l=+l,l!==l)?!1:this.delaunay._step(s,r,l)===s}*neighbors(s){const r=this._clip(s);if(r)for(const l of this.delaunay.neighbors(s)){const c=this._clip(l);if(c){e:for(let u=0,d=r.length;u<d;u+=2)for(let g=0,x=c.length;g<x;g+=2)if(r[u]===c[g]&&r[u+1]===c[g+1]&&r[(u+2)%d]===c[(g+x-2)%x]&&r[(u+3)%d]===c[(g+x-1)%x]){yield l;break e}}}}_cell(s){const{circumcenters:r,delaunay:{inedges:l,halfedges:c,triangles:u}}=this,d=l[s];if(d===-1)return null;const g=[];let x=d;do{const C=Math.floor(x/3);if(g.push(r[C*2],r[C*2+1]),x=x%3===2?x-2:x+1,u[x]!==s)break;x=c[x]}while(x!==d&&x!==-1);return g}_clip(s){if(s===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const r=this._cell(s);if(r===null)return null;const{vectors:l}=this,c=s*4;return this._simplify(l[c]||l[c+1]?this._clipInfinite(s,r,l[c],l[c+1],l[c+2],l[c+3]):this._clipFinite(s,r))}_clipFinite(s,r){const l=r.length;let c=null,u,d,g=r[l-2],x=r[l-1],C,L=this._regioncode(g,x),A,q=0;for(let E=0;E<l;E+=2)if(u=g,d=x,g=r[E],x=r[E+1],C=L,L=this._regioncode(g,x),C===0&&L===0)A=q,q=0,c?c.push(g,x):c=[g,x];else{let Q,X,j,$,he;if(C===0){if((Q=this._clipSegment(u,d,g,x,C,L))===null)continue;[X,j,$,he]=Q}else{if((Q=this._clipSegment(g,x,u,d,L,C))===null)continue;[$,he,X,j]=Q,A=q,q=this._edgecode(X,j),A&&q&&this._edge(s,A,q,c,c.length),c?c.push(X,j):c=[X,j]}A=q,q=this._edgecode($,he),A&&q&&this._edge(s,A,q,c,c.length),c?c.push($,he):c=[$,he]}if(c)A=q,q=this._edgecode(c[0],c[1]),A&&q&&this._edge(s,A,q,c,c.length);else if(this.contains(s,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return c}_clipSegment(s,r,l,c,u,d){const g=u<d;for(g&&([s,r,l,c,u,d]=[l,c,s,r,d,u]);;){if(u===0&&d===0)return g?[l,c,s,r]:[s,r,l,c];if(u&d)return null;let x,C,L=u||d;L&8?(x=s+(l-s)*(this.ymax-r)/(c-r),C=this.ymax):L&4?(x=s+(l-s)*(this.ymin-r)/(c-r),C=this.ymin):L&2?(C=r+(c-r)*(this.xmax-s)/(l-s),x=this.xmax):(C=r+(c-r)*(this.xmin-s)/(l-s),x=this.xmin),u?(s=x,r=C,u=this._regioncode(s,r)):(l=x,c=C,d=this._regioncode(l,c))}}_clipInfinite(s,r,l,c,u,d){let g=Array.from(r),x;if((x=this._project(g[0],g[1],l,c))&&g.unshift(x[0],x[1]),(x=this._project(g[g.length-2],g[g.length-1],u,d))&&g.push(x[0],x[1]),g=this._clipFinite(s,g))for(let C=0,L=g.length,A,q=this._edgecode(g[L-2],g[L-1]);C<L;C+=2)A=q,q=this._edgecode(g[C],g[C+1]),A&&q&&(C=this._edge(s,A,q,g,C),L=g.length);else this.contains(s,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(g=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return g}_edge(s,r,l,c,u){for(;r!==l;){let d,g;switch(r){case 5:r=4;continue;case 4:r=6,d=this.xmax,g=this.ymin;break;case 6:r=2;continue;case 2:r=10,d=this.xmax,g=this.ymax;break;case 10:r=8;continue;case 8:r=9,d=this.xmin,g=this.ymax;break;case 9:r=1;continue;case 1:r=5,d=this.xmin,g=this.ymin;break}(c[u]!==d||c[u+1]!==g)&&this.contains(s,d,g)&&(c.splice(u,0,d,g),u+=2)}return u}_project(s,r,l,c){let u=1/0,d,g,x;if(c<0){if(r<=this.ymin)return null;(d=(this.ymin-r)/c)<u&&(x=this.ymin,g=s+(u=d)*l)}else if(c>0){if(r>=this.ymax)return null;(d=(this.ymax-r)/c)<u&&(x=this.ymax,g=s+(u=d)*l)}if(l>0){if(s>=this.xmax)return null;(d=(this.xmax-s)/l)<u&&(g=this.xmax,x=r+(u=d)*c)}else if(l<0){if(s<=this.xmin)return null;(d=(this.xmin-s)/l)<u&&(g=this.xmin,x=r+(u=d)*c)}return[g,x]}_edgecode(s,r){return(s===this.xmin?1:s===this.xmax?2:0)|(r===this.ymin?4:r===this.ymax?8:0)}_regioncode(s,r){return(s<this.xmin?1:s>this.xmax?2:0)|(r<this.ymin?4:r>this.ymax?8:0)}_simplify(s){if(s&&s.length>4){for(let r=0;r<s.length;r+=2){const l=(r+2)%s.length,c=(r+4)%s.length;(s[r]===s[l]&&s[l]===s[c]||s[r+1]===s[l+1]&&s[l+1]===s[c+1])&&(s.splice(l,2),r-=2)}s.length||(s=null)}return s}}const Jl=2*Math.PI,Gi=Math.pow;function eh(o){return o[0]}function th(o){return o[1]}function ih(o){const{triangles:s,coords:r}=o;for(let l=0;l<s.length;l+=3){const c=2*s[l],u=2*s[l+1],d=2*s[l+2];if((r[d]-r[c])*(r[u+1]-r[c+1])-(r[u]-r[c])*(r[d+1]-r[c+1])>1e-10)return!1}return!0}function nh(o,s,r){return[o+Math.sin(o+s)*r,s+Math.cos(o-s)*r]}class as{static from(s,r=eh,l=th,c){return new as("length"in s?rh(s,r,l,c):Float64Array.from(sh(s,r,l,c)))}constructor(s){this._delaunator=new dr(s),this.inedges=new Int32Array(s.length/2),this._hullIndex=new Int32Array(s.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const s=this._delaunator,r=this.points;if(s.hull&&s.hull.length>2&&ih(s)){this.collinear=Int32Array.from({length:r.length/2},(q,E)=>E).sort((q,E)=>r[2*q]-r[2*E]||r[2*q+1]-r[2*E+1]);const x=this.collinear[0],C=this.collinear[this.collinear.length-1],L=[r[2*x],r[2*x+1],r[2*C],r[2*C+1]],A=1e-8*Math.hypot(L[3]-L[1],L[2]-L[0]);for(let q=0,E=r.length/2;q<E;++q){const Q=nh(r[2*q],r[2*q+1],A);r[2*q]=Q[0],r[2*q+1]=Q[1]}this._delaunator=new dr(r)}else delete this.collinear;const l=this.halfedges=this._delaunator.halfedges,c=this.hull=this._delaunator.hull,u=this.triangles=this._delaunator.triangles,d=this.inedges.fill(-1),g=this._hullIndex.fill(-1);for(let x=0,C=l.length;x<C;++x){const L=u[x%3===2?x-2:x+1];(l[x]===-1||d[L]===-1)&&(d[L]=x)}for(let x=0,C=c.length;x<C;++x)g[c[x]]=x;c.length<=2&&c.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=c[0],d[c[0]]=1,c.length===2&&(d[c[1]]=0,this.triangles[1]=c[1],this.triangles[2]=c[1]))}voronoi(s){return new Ql(this,s)}*neighbors(s){const{inedges:r,hull:l,_hullIndex:c,halfedges:u,triangles:d,collinear:g}=this;if(g){const A=g.indexOf(s);A>0&&(yield g[A-1]),A<g.length-1&&(yield g[A+1]);return}const x=r[s];if(x===-1)return;let C=x,L=-1;do{if(yield L=d[C],C=C%3===2?C-2:C+1,d[C]!==s)return;if(C=u[C],C===-1){const A=l[(c[s]+1)%l.length];A!==L&&(yield A);return}}while(C!==x)}find(s,r,l=0){if(s=+s,s!==s||(r=+r,r!==r))return-1;const c=l;let u;for(;(u=this._step(l,s,r))>=0&&u!==l&&u!==c;)l=u;return u}_step(s,r,l){const{inedges:c,hull:u,_hullIndex:d,halfedges:g,triangles:x,points:C}=this;if(c[s]===-1||!C.length)return(s+1)%(C.length>>1);let L=s,A=Gi(r-C[s*2],2)+Gi(l-C[s*2+1],2);const q=c[s];let E=q;do{let Q=x[E];const X=Gi(r-C[Q*2],2)+Gi(l-C[Q*2+1],2);if(X<A&&(A=X,L=Q),E=E%3===2?E-2:E+1,x[E]!==s)break;if(E=g[E],E===-1){if(E=u[(d[s]+1)%u.length],E!==Q&&Gi(r-C[E*2],2)+Gi(l-C[E*2+1],2)<A)return E;break}}while(E!==q);return L}render(s){const r=s==null?s=new Li:void 0,{points:l,halfedges:c,triangles:u}=this;for(let d=0,g=c.length;d<g;++d){const x=c[d];if(x<d)continue;const C=u[d]*2,L=u[x]*2;s.moveTo(l[C],l[C+1]),s.lineTo(l[L],l[L+1])}return this.renderHull(s),r&&r.value()}renderPoints(s,r){r===void 0&&(!s||typeof s.moveTo!="function")&&(r=s,s=null),r=r==null?2:+r;const l=s==null?s=new Li:void 0,{points:c}=this;for(let u=0,d=c.length;u<d;u+=2){const g=c[u],x=c[u+1];s.moveTo(g+r,x),s.arc(g,x,r,0,Jl)}return l&&l.value()}renderHull(s){const r=s==null?s=new Li:void 0,{hull:l,points:c}=this,u=l[0]*2,d=l.length;s.moveTo(c[u],c[u+1]);for(let g=1;g<d;++g){const x=2*l[g];s.lineTo(c[x],c[x+1])}return s.closePath(),r&&r.value()}hullPolygon(){const s=new es;return this.renderHull(s),s.value()}renderTriangle(s,r){const l=r==null?r=new Li:void 0,{points:c,triangles:u}=this,d=u[s*=3]*2,g=u[s+1]*2,x=u[s+2]*2;return r.moveTo(c[d],c[d+1]),r.lineTo(c[g],c[g+1]),r.lineTo(c[x],c[x+1]),r.closePath(),l&&l.value()}*trianglePolygons(){const{triangles:s}=this;for(let r=0,l=s.length/3;r<l;++r)yield this.trianglePolygon(r)}trianglePolygon(s){const r=new es;return this.renderTriangle(s,r),r.value()}}function rh(o,s,r,l){const c=o.length,u=new Float64Array(c*2);for(let d=0;d<c;++d){const g=o[d];u[d*2]=s.call(l,g,d,o),u[d*2+1]=r.call(l,g,d,o)}return u}function*sh(o,s,r,l){let c=0;for(const u of o)yield s.call(l,u,c,o),yield r.call(l,u,c,o),++c}function Oa(o){return{originalBorder:o,flattenedPolygon:xa(o)[0]}}function ah(o){if(o.length===0)return[0,0];const s=o.reduce((r,l)=>[r[0]+l[0],r[1]+l[1]],[0,0]);return[s[0]/o.length,s[1]/o.length]}function Na(o,s,r){const l={id:o,site:ah(s),halfEdge:-1,bounds:Qr(s)},c=Nu(s,o,r);return c.length>0&&(l.halfEdge=c[0].id),l}function Ra(o,s){const l=o.map(u=>rs(u,s.originalBorder)).filter(Boolean).length;return l===0?null:l===o.length?o:Lu(o,s.flattenedPolygon)?.[0]??null}const os="VoronoiPieceGenerator",oh={name:os,displayName:"Voronoi",description:"Construct pieces by building a Voronoi diagram from the seed points. Each piece consists of all area of the plane closer to its seed point than any other seed point. In practice, this creates irregular polygons with 3-8 sides.",sortHint:1,controls:[]};function uh(o){return`${o[0].toPrecision(7)},${o[1].toPrecision(7)}`}function sa(o,s){const l=s.flattenedPolygon;for(let c=0;c<l.length;c++){const u=l[c],d=l[(c+1)%l.length];if(lh(o,u,d)<.001)return!0}return!1}function lh(o,s,r){const[l,c]=o,[u,d]=s,[g,x]=r,C=g-u,L=x-d,A=C*C+L*L;if(A===0)return Math.hypot(l-u,c-d);let q=((l-u)*C+(c-d)*L)/A;q=Math.max(0,Math.min(1,q));const E=u+q*C,Q=d+q*L;return Math.hypot(l-E,c-Q)}const hh=(o,s,r)=>{const{width:l,height:c}=s,u=Oa(o);return{generatePieces(g,x){const{border:C}=x;console.log(`VoronoiPieceGenerator using dimensions ${l}x${c}`);const A=as.from(g).voronoi([0,0,l,c]),q={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:C},E=new Map;let Q=0;for(let j=0;j<g.length;j++){const $=g[j],he=A.cellPolygon(j);if(!he)continue;const re=Ra(he,u);if(!re)continue;const ye=Q++,ue=Na(ye,re,q);ue.site=$,q.pieces.set(ye,ue);const M=[];let de=ue.halfEdge;if(de!==-1){const _e=de;do{const pe=q.halfEdges.get(de);M.push(pe),de=pe.next}while(de!==_e)}ba(M,q,E,(_e,pe)=>sa(_e,u)&&sa(pe,u))}const X=new Map;for(const j of q.halfEdges.values()){const $=uh(j.origin);X.has($)||X.set($,j.origin)}return q.vertices=Array.from(X.values()),q}}};Tn.register(os,hh,oh);const pr="SimpleTabPlacementStrategy",ch={name:pr,displayName:"Simple",description:"Creates a single tab in the center of each edge with a random orientation.",sortHint:1,controls:[{type:"range",name:"tabSize",label:"Tab Size",optional:!0,min:.01,max:1,step:.01,defaultValue:.5,helpText:"The width of the tab as a fraction of the edge length"},{type:"number",name:"minEdgeLength",label:"Minimum Edge Length",optional:!0,defaultValue:15,helpText:"Edges shorter than this value will not have a tab"},{type:"number",name:"maxTabSize",label:"Maximum Tab Size",helpText:"Maximum width of a generated tab"}]};function aa(o,s,r,l){if(o.tabs=void 0,!(o.heRight!==-1))return;const u=s.halfEdges.get(o.heLeft),d=s.halfEdges.get(o.heRight);if(!u||!d)return;const g=u.origin,x=d.origin,C=Math.hypot(x[0]-g[0],x[1]-g[1]);if(C>=r.minEdgeLength){let L=r.tabSize;r.maxTabSize&&C*L>r.maxTabSize&&(L=r.maxTabSize/C);const A={position:.5,size:L,convex:l()>.5};o.tabs=[A]}}const fh=(o,s,r)=>{const{tabSize:l=.5,minEdgeLength:c=0,maxTabSize:u}=r,d={tabSize:l,minEdgeLength:c,maxTabSize:u};return{placeTabs(g){const{topology:x,random:C}=g;for(const L of x.edges.values())aa(L,x,d,C)},updateTabPlacements(g,x){const{topology:C,random:L}=x;for(const A of g)aa(A,C,d,L)}}};Mn.register(pr,fh,ch);const us="TraditionalTabGenerator",dh={name:us,displayName:"Traditional",description:"Creates a traditional rounded tab for each (internal) piece edge.",sortHint:1,controls:[{type:"range",name:"jitter",label:"Randomness",defaultValue:8,min:0,max:100,step:1,helpText:"Adds randomness to the tab shape. 0 means completely uniform tabs"},{type:"range",name:"heightToWidthRatio",label:"Tab Height",defaultValue:50,min:5,max:100,step:5,helpText:"The height of the tab as a percent of its width"}]};function ph(o,s,r,l,c,u=!1){const d=s[0]-o[0],g=s[1]-o[1],x=Math.hypot(d,g);if(x===0)return console.warn("Edge has zero length"),[];const C=[d/x,g/x],L=[-C[1],C[0]],A=(Se,Oe)=>[o[0]+(C[0]*Se+L[0]*Oe)*x,o[1]+(C[1]*Se+L[1]*Oe)*x],q=r/100,E=()=>(c()*2-1)*q,Q=E(),X=E(),j=E(),$=E(),he=E(),re=.1625,ye=u?-1:1,ue=l,M=ue/3,_e=[[0,0],[.2,Q*M],[.5+X+$,ye*(-M+j*ue)],[.5-re+X,ye*(M+j*ue)],[.5-2*re+X-$,ye*(ue+j*ue)],[.5+2*re+X-$,ye*(ue+j*ue)],[.5+re+X,ye*(M+j*ue)],[.5+X+$,ye*(-M+j*ue)],[.8,he*M],[1,0]].map(([Se,Oe])=>A(Se,Oe)),pe={type:"bezier",p1:_e[1],p2:_e[2],p3:_e[3]},Ce={type:"bezier",p1:_e[4],p2:_e[5],p3:_e[6]},ke={type:"bezier",p1:_e[7],p2:_e[8],p3:_e[9]};return[pe,Ce,ke]}const gh=(o,s,r)=>{const{jitter:l=8,heightToWidthRatio:c=50}=r;return{createTabSegments(d,g,x,C){const L=!x.convex;return ph(d,g,l,c/100,C,L)}}};Oi.register(us,gh,dh);function mh(o){return new Worker("/puzzle-generator/assets/CheckGeometryWorker-B-2izMXZ.js",{name:o?.name})}function vh(o,s){return new Promise((r,l)=>{const c=new mh;c.onmessage=d=>{const g=d.data;switch(g.type){case"progress":s?.(g.processed,g.total);break;case"done":r(g.results),c.terminate();break;case"error":l(new Error(g.message)),c.terminate();break}},c.onerror=d=>{l(new Error(d.message)),c.terminate()};const u={topology:Eu(o)};c.postMessage(u)})}const Da="GridJitterPointGenerator",_h={name:Da,displayName:"Grid",description:"Generate seed points using a grid with optional random jitter. Has a uniform, regular look, especially with low randomness values.",sortHint:2,controls:[{type:"range",name:"jitter",label:"Randomness",min:0,max:100,step:5,defaultValue:50,helpText:"Amount of jitter to apply to each grid point (0 to 100%)"}]},yh=(o,s,r)=>{const{jitter:l=50}=r;return{generatePoints(u){const{width:d,height:g,pieceSize:x,random:C,border:L}=u,A=[];for(let q=0;q<d;q+=x)for(let E=0;E<g;E+=x){const Q=[q+x/2,E+x/2];l>0&&(Q[0]+=(C()-.5)*(l/100)*x,Q[1]+=(C()-.5)*(l/100)*x),rs(Q,L)&&A.push(Q)}return A}}};An.register(Da,yh,_h);const Va="RectangularPieceGenerator",xh={name:Va,displayName:"Rectangular",description:"Construct pieces from a regular grid. All pieces have 4 sides and are the same size (except when the border is irregular). This generator ignores seed points.",sortHint:2,controls:[]},bh=(o,s,r)=>{const{width:l,height:c}=s,u=Oa(o);return{generatePieces(g,x){const{pieceSize:C,border:L}=x,A={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:L},q=Math.ceil(l/C),E=Math.ceil(c/C),Q=Math.round(l/q),X=Math.round(c/E),j=[];for(let he=0;he<=E;he++){const re=[];for(let ye=0;ye<=q;ye++){const ue=ye*Q,M=he*X;re.push([ue,M])}j.push(re)}A.vertices=j.flat();const $=new Map;for(let he=0;he<E;he++)for(let re=0;re<q;re++){const ye=he*q+re,ue=j[he][re],M=j[he][re+1],de=j[he+1][re],_e=j[he+1][re+1],Ce=Ra([ue,M,_e,de],u);if(!Ce)continue;const ke=Na(ye,Ce,A);A.pieces.set(ye,ke);const Se=[];let Oe=ke.halfEdge;if(Oe!==-1){const Pe=Oe;do{const Je=A.halfEdges.get(Oe);Se.push(Je),Oe=Je.next}while(Oe!==Pe)}ba(Se,A,$,(Pe,Je)=>{const me=(Kt,Bt)=>Math.abs(Kt-Bt)<1e-6,Ke=me(Pe[1],ue[1])&&me(Je[1],ue[1]),rt=me(Pe[0],M[0])&&me(Je[0],M[0]),Ve=me(Pe[1],de[1])&&me(Je[1],de[1]),tt=me(Pe[0],ue[0])&&me(Je[0],ue[0]);return!(Ke||rt||Ve||tt)})}return A}}};Tn.register(Va,bh,xh);const Fa="NullTabGenerator",wh={name:Fa,displayName:"None",description:"Do not generate tabs. All pieces have straight edges.",sortHint:3,controls:[]},Ch=(o,s,r)=>({createTabSegments(c,u,d,g){return[]}});Oi.register(Fa,Ch,wh);const Ba="TriangleTabGenerator",Sh={name:Ba,displayName:"Triangle",description:"Creates a simple triangle between each (internal) piece edge.",sortHint:2,controls:[]},Ph=(o,s,r)=>({createTabSegments(c,u,d,g){const x=[u[0]-c[0],u[1]-c[1]],C=Math.hypot(x[0],x[1]);if(C<1e-6)return[];const L=[x[0]/C,x[1]/C],A=[-L[1],L[0]],q=[c[0]+x[0]/2,c[1]+x[1]/2],E=d.convex?1:-1,Q=C*d.size*E,X=[q[0]+A[0]*Q,q[1]+A[1]*Q],j=[];return j.push({type:"line",p:c}),j.push({type:"line",p:X}),j.push({type:"line",p:u}),j}});Oi.register(Ba,Ph,Sh);let ts=!1;const kh=window.matchMedia("(prefers-color-scheme: dark)");kh.matches&&(ts=!0);const Ih=()=>{const r=ss,l=os,c=us,u={seed:new Date().getTime()%10240,canvasWidth:800,canvasHeight:600,aspectRatio:800/600,distance:40,color:ts?"#DDDDDD":"#333333",drawPoints:!1,pointColor:ts?"#FF0000":"#0000FF",borderShape:"rectangle",borderCornerRadius:50,geometryProblems:{autoCheck:!1,problems:void 0,progress:void 0},dirty:!0,generators:{point:{label:"Seed Points",registry:An,name:r,config:An.getDefaultConfig(r,800,600)},piece:{label:"Piece Generation",registry:Tn,name:l,config:Tn.getDefaultConfig(l,800,600)},placement:{label:"Tab Placement",registry:Mn,name:pr,config:Mn.getDefaultConfig(pr,800,600)},tab:{label:"Tabs",registry:Oi,name:c,config:Oi.getDefaultConfig(c,800,600)}},puzzle:void 0,backgroundImageUrl:void 0,backgroundImageName:"",customPieces:[],selectedCustomPieceId:null,customPieceEditorOpen:!1,editingCustomPieceId:void 0};function d(){const{canvasWidth:j,canvasHeight:$,borderShape:he,borderCornerRadius:re}=u;switch(he){case"rectangle":return Jr(j,$);case"circle":return Du(Math.min(j,$));case"ellipse":return Vu(j,$);case"rounded-rect":return Fu(j,$,re);default:return Jr(j,$)}}function g(){u.customPieceEditorOpen=!0,u.editingCustomPieceId=void 0,J.redraw()}function x(j,$){const he=new Date().toISOString();if(u.editingCustomPieceId)u.customPieces=u.customPieces.map(re=>re.id===u.editingCustomPieceId?{...re,name:$,path:j,modified:he}:re);else{const re={id:`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:$,path:j,transform:{position:[u.canvasWidth/2,u.canvasHeight/2],rotation:0,scale:[1,1]},created:he};u.customPieces=[...u.customPieces,re]}u.customPieceEditorOpen=!1,u.editingCustomPieceId=void 0,u.dirty=!0,J.redraw()}function C(){u.customPieceEditorOpen=!1,u.editingCustomPieceId=void 0,J.redraw()}function L(j){u.selectedCustomPieceId=j,J.redraw()}function A(j){u.customPieces.find(he=>he.id===j)&&(u.editingCustomPieceId=j,u.customPieceEditorOpen=!0,J.redraw())}function q(j){const $=u.customPieces.find(he=>he.id===j);if($){const he=new Date().toISOString(),re=$.name?(()=>{const ue=/^(.*?)\s*\((\d+)\)$/,M=$.name.match(ue);if(M){const de=M[1],_e=parseInt(M[2],10);return`${de} (${_e+1})`}return`${$.name} (2)`})():void 0,ye={id:`custom-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:re,path:[...$.path],transform:{position:[$.transform.position[0]+20,$.transform.position[1]+20],rotation:$.transform.rotation,scale:[...$.transform.scale]},created:he};u.customPieces=[...u.customPieces,ye],u.selectedCustomPieceId=ye.id,u.dirty=!0,J.redraw()}}function E(j){u.customPieces=u.customPieces.filter($=>$.id!==j),u.selectedCustomPieceId===j&&(u.selectedCustomPieceId=null),u.dirty=!0,J.redraw()}function Q(j){console.log(`Position custom piece: ${j}`),alert("Whimsy positioning functionality will be available in Phase 5")}function X(){u.puzzle&&(u.geometryProblems.progress=0,J.redraw(),vh(u.puzzle,(j,$)=>{u.geometryProblems.progress=j/$*100,J.redraw()}).then(j=>{u.geometryProblems.problems=j.length,u.geometryProblems.progress=void 0,u.puzzle&&(u.puzzle.problems=j),J.redraw()}).catch(j=>{u.geometryProblems.progress=void 0,console.error(j),J.redraw()}))}return{oncreate:()=>{hr({bounds:{width:u.canvasWidth,height:u.canvasHeight},border:d(),pieceSize:u.distance,pointConfig:u.generators.point.config,pieceConfig:u.generators.piece.config,placementConfig:u.generators.placement.config,tabConfig:u.generators.tab.config,seed:u.seed,customPieces:u.customPieces}).then(j=>{u.puzzle=j,J.redraw(),u.geometryProblems.autoCheck&&X()}).catch(j=>{console.error(j)})},onupdate:()=>{u.dirty&&(u.dirty=!1,hr({bounds:{width:u.canvasWidth,height:u.canvasHeight},border:d(),pieceSize:u.distance,pointConfig:u.generators.point.config,pieceConfig:u.generators.piece.config,placementConfig:u.generators.placement.config,tabConfig:u.generators.tab.config,seed:u.seed,customPieces:u.customPieces}).then(j=>{u.geometryProblems.problems=void 0,u.geometryProblems.progress=void 0,u.puzzle=j,J.redraw(),u.geometryProblems.autoCheck&&X()}).catch(j=>{console.error(j)}))},onremove:()=>{u.backgroundImageUrl&&(URL.revokeObjectURL(u.backgroundImageUrl),u.backgroundImageUrl=void 0)},view:()=>J(".page",[J("h1","Puzzle Generator"),J(".container",[u.puzzle&&J(".puzzle-stack",[J(ju,{width:u.canvasWidth,height:u.canvasHeight,color:u.color,imageUrl:u.backgroundImageUrl,puzzle:u.puzzle,isDirty:u.dirty,pointColor:u.drawPoints?u.pointColor:void 0,onPuzzleChanged:j=>{u.puzzle=j,J.redraw()},onSeedPointMoved:(j,$)=>{u.dirty=!1,u.puzzle&&Ru(u.puzzle,j,$).then(he=>{u.geometryProblems.problems=void 0,u.geometryProblems.progress=void 0,u.puzzle=he,J.redraw(),u.geometryProblems.autoCheck&&X()}).catch(he=>{console.error("Failed to rebuild puzzle with updated seed point:",he)})}}),J(".actions",[J(Xu,{puzzle:u.puzzle,width:u.canvasWidth,height:u.canvasHeight,color:u.color}),J(Ku,{autoCheck:u.geometryProblems.autoCheck,problems:u.geometryProblems.problems,progressPercent:u.geometryProblems.progress,onCheckRequested:()=>{u.dirty||X(),J.redraw()},onAutocheckChanged:j=>{j!==u.geometryProblems.autoCheck&&(u.geometryProblems.autoCheck=j,J.redraw())}})])]),J(".controls",[J(".background-image",[J(Yu,{label:"Background Image",onUpload:(j,$,he,re)=>{u.backgroundImageUrl&&URL.revokeObjectURL(u.backgroundImageUrl),u.canvasWidth=he,u.canvasHeight=re,u.aspectRatio=he/re,u.backgroundImageUrl=j,u.backgroundImageName=$,u.dirty=!0,J.redraw()},onClear:()=>{u.backgroundImageUrl&&URL.revokeObjectURL(u.backgroundImageUrl),u.backgroundImageUrl=void 0,u.backgroundImageName="",u.dirty=!0,J.redraw()}})]),J(el,{ratio:u.aspectRatio,disabled:u.backgroundImageUrl!==void 0,onChange:j=>{u.aspectRatio=j,u.canvasWidth=u.canvasHeight*j,u.dirty=!0,J.redraw()}}),J(il,{shape:u.borderShape,disabled:u.backgroundImageUrl!==void 0,onChange:j=>{u.borderShape=j,u.dirty=!0,J.redraw()}}),u.borderShape==="rounded-rect"&&J(rr,{config:{name:"cornerRadius",label:"Corner Radius",type:"number"},value:u.borderCornerRadius,onChange:j=>{u.borderCornerRadius=j??50,u.dirty=!0,J.redraw()}}),J(rr,{config:{name:"seed",label:"Seed",type:"number"},value:u.seed,onChange:j=>{u.seed=j??0,u.dirty=!0,J.redraw()}}),J(rr,{config:{name:"pieceSize",label:"Piece size",type:"number"},value:u.distance,onChange:j=>{u.distance=j??0,u.dirty=!0,J.redraw()}}),J(Hs,{label:"Piece color",color:u.color,size:"small",onUpdate:j=>{u.color=j,J.redraw()}}),J(".draw-points",[J(Ca,{config:{name:"drawPoints",label:"Draw seed points",type:"boolean"},value:u.drawPoints,onChange:j=>{u.drawPoints=j,J.redraw()}}),u.drawPoints&&J(Hs,{label:"Seed points color",color:u.pointColor,size:"small",onUpdate:j=>{u.pointColor=j,J.redraw()}})]),J(Ml,{pieces:u.customPieces,selectedPieceId:u.selectedCustomPieceId,pieceColor:u.color,onAdd:g,onSelect:L,onEdit:A,onDuplicate:q,onDelete:E,onPosition:Q}),...Object.entries(u.generators).map(([j,$])=>J("label",[$.label+":",J(Ju,{generator:$.name,registry:$.registry,config:$.config,onGeneratorChange:he=>{he!=$.name&&(console.log(`${j} generator changed to ${he}`),$.name=he,u.generators[j].config=$.registry.getDefaultConfig(he,u.canvasWidth,u.canvasHeight),u.dirty=!0,J.redraw())},onConfigChange:(he,re)=>{console.log(`${j} generator config "${he}" changed to ${String(re)}`),$.config[he]=re,u.dirty=!0,J.redraw()}})]))])]),J(kl,{open:u.customPieceEditorOpen,piece:u.editingCustomPieceId?u.customPieces.find(j=>j.id===u.editingCustomPieceId):void 0,onSave:x,onCancel:C})])}},Eh=()=>{const o={initialPathToLoad:[],pathCommands:[],pathDataDisplay:"No path data yet",svgInputElement:void 0,importStatus:""},s=u=>{o.pathCommands=u,o.pathDataDisplay=JSON.stringify(u,null,2)},r=()=>{o.initialPathToLoad=[],o.pathCommands=[],o.pathDataDisplay="No path data yet",J.redraw()},l=()=>{const u=[{type:"move",p:[469.48276150227287,198.61914195331622]},{type:"line",p:[147.27539529214673,525.2460501911088]},{type:"bezier",p1:[119.6268609401618,551.2189519643504],p2:[149.62606858643616,580],p3:[178.36644877954177,551.7150560673149]},{type:"line",p:[206.99671887066515,523.5384839302747]},{type:"line",p:[241.34793037003863,560.4031774534698]},{type:"line",p:[264.8072838080452,537.7816545144234]},{type:"line",p:[232.96958275167054,503.43044775157955]},{type:"line",p:[252.23977895834645,484.99810098998205]},{type:"line",p:[268.15862475000426,500.91691362593315]},{type:"line",p:[287.4288209566801,483.32241157288445]},{type:"line",p:[273.1856361629428,466.5657068630892]},{type:"line",p:[296.07185058171,443.34292886551395]},{type:"line",p:[330.2814730038454,480.0802571096493]},{type:"line",p:[357.19242550437104,453.43183149484946]},{type:"line",p:[323.7943979441297,416.6172978193763]},{type:"line",p:[501.07659759926975,235.32345658662825]},{type:"bezier",p1:[501.07659759926975,235.32345658662825],p2:[558.04932730116,263.8097503896305],p3:[597.4275549500016,248.7287824622282]},{type:"bezier",p1:[636.805782598843,233.64776716953054],p2:[670.3190972878429,209.35060217868192],p3:[675.3461181738405,165.78319835239148]},{type:"bezier",p1:[680.3731390598382,122.21579452610115],p2:[659.4273055378894,78.6484143824585],p3:[625.9138961182989,49.324204822964475]},{type:"bezier",p1:[592.4005340640038,20],p2:[537.9412437571693,20.837830498960273],p3:[499.4008608168767,39.27018673361687]},{type:"bezier",p1:[460.8604778765839,57.70254770480301],p2:[438.239021248951,92.89158496660718],p3:[437.40117180387267,127.24280120251018]},{type:"bezier",p1:[436.5633223587943,161.59402217494272],p2:[469.4827615022728,198.61914195331644],p3:[469.4827615022728,198.61914195331644]},{type:"line",p:[469.48276150227287,198.61914195331622]}];o.initialPathToLoad=u,o.pathCommands=u,o.pathDataDisplay=JSON.stringify(u,null,2),J.redraw()},c=u=>{if(u.redraw=!1,!o.svgInputElement)return;const d=o.svgInputElement.files?.[0];if(!d)return;if(d.type!=="image/svg+xml"&&!d.name.endsWith(".svg")){o.importStatus="Error: Please select an SVG file",J.redraw();return}const g=new FileReader;g.onload=x=>{const C=x.target?.result;if(!C){o.importStatus="Error: Could not read file",J.redraw();return}const L=Ea(C);if(!L){o.importStatus="Error: Could not parse SVG path",J.redraw();return}const A=Aa(L.commands,800,600);o.initialPathToLoad=A,o.pathCommands=A,o.pathDataDisplay=JSON.stringify(A,null,2),L.warning?o.importStatus=`Warning: ${L.warning}`:o.importStatus=`Imported: ${d.name}`,J.redraw()},g.onerror=()=>{o.importStatus="Error: Failed to read file",J.redraw()},g.readAsText(d),o.svgInputElement.value=""};return{view:()=>J(".page",[J("h1","Path Editor"),J("p","Testing the PathEditor component."),J(".test-page",[J(".test-area",[J(ka,{width:800,height:600,initialPath:o.initialPathToLoad,onPathChanged:s,strokeColor:"#000000ff"})]),J(".controls",[J("h2","Controls"),J(".button-group",[J("button",{onclick:r,style:"background: #f44336;"},"Clear Canvas"),J("button",{onclick:l,style:"background: #4CAF50;"},"Load Sample Path"),J("button",{onclick:()=>{o.svgInputElement&&o.svgInputElement.click()},style:"background: #2196F3;"},"Import SVG"),J("input[type=file]",{style:{display:"none"},accept:".svg,image/svg+xml",oncreate:({dom:u})=>{o.svgInputElement=u},onchange:c})]),o.importStatus&&J("p",{style:`margin-top: 0.5rem; color: ${o.importStatus.startsWith("Error")?"#f44336":o.importStatus.startsWith("Warning")?"#FF9800":"#4CAF50"};`},o.importStatus),J(".instructions",[J("h3",{style:"margin-top: 1rem;"},"Instructions:"),J("p","The editor has two modes:"),J("ul",{style:"margin: 0.5rem 0;"},[J("li",J("strong","Drawing Mode"),": Click to add points (straight lines), or click-drag to add points with smooth bezier curves"),J("ul",{style:"margin-left: 1rem;"},[J("li","Move near the first point to see a green circle indicator - click to close the path"),J("li","Closing the path automatically switches to Edit mode"),J("li","Or click ",J("strong","End Drawing")," to finish without closing")]),J("li",J("strong","Editing Mode"),":"),J("ul",{style:"margin-left: 1rem;"},[J("li","Click anywhere on the path to select it and show all vertices"),J("li","Click a specific vertex to select it (turns blue), then drag to move it"),J("li","Drag curve handles to adjust curve shape"),J("li","Hold ",J("strong","Shift")," and click on the path to insert a new point"),J("li","Select a vertex and press ",J("strong","Delete")," or ",J("strong","Backspace")," to remove it"),J("li","Click empty space to deselect")]),J("li","The mode indicator below the canvas shows the current mode")]),J("h3",{style:"margin-top: 1rem;"},"Pan and Zoom:"),J("ul",{style:"margin: 0.5rem 0;"},[J("li","Hold ",J("strong","Spacebar")," and drag to pan the canvas"),J("li","Use ",J("strong","mouse wheel")," to zoom in/out (zooms toward cursor position)"),J("li","Use the ",J("strong","Zoom dropdown")," to select preset zoom levels (25%, 50%, 100%, 200%, 400%)"),J("li","Click the ",J("strong","Recenter button")," to reset view to 100% zoom and center position")])])]),J(".data-display",[J("h2","Path Data"),J("h3","PathCommand[] Format:"),J("textarea",{readonly:!0,value:o.pathDataDisplay,rows:15,style:"font-family: monospace; font-size: 12px; width: 100%;"})])])])}};function Ah(){const o=window.matchMedia("(prefers-color-scheme: dark)");function s(){o.matches?document.documentElement.classList.add("wa-dark"):document.documentElement.classList.remove("wa-dark")}s(),o.addEventListener("change",s)}Ah();const oa={view:o=>[J(po,{link:"https://github.com/weevilgenius/puzzle-generator"}),J(go),o.children]};fo("material",{resolver:o=>{const s=o.match(/^(.*?)(_(rounded|sharp))?$/);return s?`https://cdn.jsdelivr.net/npm/@material-symbols/svg-400@0.32.0/${s[3]??"outlined"}/${s[1]}.svg`:""},mutator:o=>o.setAttribute("fill","currentColor")});J.route(document.body,"/puzzle",{"/puzzle":{render:()=>J(oa,J(Ih))},"/test":{render:()=>J(oa,J(Eh))}});
//# sourceMappingURL=index-7GnY8DEo.js.map
