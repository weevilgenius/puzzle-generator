import{m as oe,g as Vr,a as Fa}from"./mithril-BiGTF_x2.js";import{r as Ba}from"./webawesome-7D1rN-GI.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))l(f);new MutationObserver(f=>{for(const o of f)if(o.type==="childList")for(const g of o.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function a(f){const o={};return f.integrity&&(o.integrity=f.integrity),f.referrerPolicy&&(o.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?o.credentials="include":f.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(f){if(f.ep)return;f.ep=!0;const o=a(f);fetch(f.href,o)}})();const Ua={view:({attrs:h})=>oe("a.github-corner",{href:h.link,"aria-label":"View source on GitHub",title:"View source on GitHub",target:"_blank"},oe("svg",{width:80,height:80,viewBox:"0 0 250 250","aria-hidden":"true"},[oe("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),oe("path.octo-arm",{fill:"currentColor",style:"transform-origin: 130px 106px;",d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"}),oe("path.octo-body",{fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})]))},qa={view:()=>{const h=oe.route.get();return oe("nav.navigation",[oe("div.nav-links",oe("wa-radio-group",{orientation:"horizontal",value:h,onchange:s=>{s.redraw=!1;const a=s.target;oe.route.set(String(a.value))}},[oe("wa-radio",{appearance:"button",value:"/puzzle"},"Puzzle Generator"),oe("wa-radio",{appearance:"button",value:"/test"},"Test Harness")]))])}};class Jn{generators=new Map;register(s,a,l){this.generators.has(s)&&console.warn(`Generator "${s}" is already registered, overwriting`),this.generators.set(s,{factory:a,uiMetadata:l})}create(s,a,l){const f=this.generators.get(l.name);if(!f)throw new Error(`Unknown generator "${l.name}". Is it registered?`);return f.factory(s,a,l)}getAvailableGenerators(){return Array.from(this.generators.values()).sort((s,a)=>s.uiMetadata.sortHint-a.uiMetadata.sortHint).map(s=>({name:s.uiMetadata.name,displayName:s.uiMetadata.displayName}))}getUIMetadata(s){return this.generators.get(s)?.uiMetadata}getDefaultConfig(s,a,l){const f={name:s,width:a,height:l},o=this.getUIMetadata(s);if(o)for(const g of o.controls)f[g.name]=g.defaultValue;return f}}const vn=new Jn,yn=new Jn,xn=new Jn,Ti=new Jn;let Ha=0;function Hs(){return Ha++}const{abs:tn,cos:ni,sin:Di,acos:Ga,atan2:nn,sqrt:fi,pow:Ht}=Math;function rn(h){return h<0?-Ht(-h,1/3):Ht(h,1/3)}const Gs=Math.PI,Dn=2*Gs,di=Gs/2,ja=1e-6,fr=Number.MAX_SAFE_INTEGER||9007199254740991,dr=Number.MIN_SAFE_INTEGER||-9007199254740991,Wa={x:0,y:0,z:0},Ae={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(h,s){const a=s(h);let l=a.x*a.x+a.y*a.y;return typeof a.z<"u"&&(l+=a.z*a.z),fi(l)},compute:function(h,s,a){if(h===0)return s[0].t=0,s[0];const l=s.length-1;if(h===1)return s[l].t=1,s[l];const f=1-h;let o=s;if(l===0)return s[0].t=h,s[0];if(l===1){const v={x:f*o[0].x+h*o[1].x,y:f*o[0].y+h*o[1].y,t:h};return a&&(v.z=f*o[0].z+h*o[1].z),v}if(l<4){let v=f*f,w=h*h,S,E,k,q=0;l===2?(o=[o[0],o[1],o[2],Wa],S=v,E=f*h*2,k=w):l===3&&(S=v*f,E=v*h*3,k=f*w*3,q=h*w);const L={x:S*o[0].x+E*o[1].x+k*o[2].x+q*o[3].x,y:S*o[0].y+E*o[1].y+k*o[2].y+q*o[3].y,t:h};return a&&(L.z=S*o[0].z+E*o[1].z+k*o[2].z+q*o[3].z),L}const g=JSON.parse(JSON.stringify(s));for(;g.length>1;){for(let v=0;v<g.length-1;v++)g[v]={x:g[v].x+(g[v+1].x-g[v].x)*h,y:g[v].y+(g[v+1].y-g[v].y)*h},typeof g[v].z<"u"&&(g[v].z=g[v].z+(g[v+1].z-g[v].z)*h);g.splice(g.length-1,1)}return g[0].t=h,g[0]},computeWithRatios:function(h,s,a,l){const f=1-h,o=a,g=s;let v=o[0],w=o[1],S=o[2],E=o[3],k;if(v*=f,w*=h,g.length===2)return k=v+w,{x:(v*g[0].x+w*g[1].x)/k,y:(v*g[0].y+w*g[1].y)/k,z:l?(v*g[0].z+w*g[1].z)/k:!1,t:h};if(v*=f,w*=2*f,S*=h*h,g.length===3)return k=v+w+S,{x:(v*g[0].x+w*g[1].x+S*g[2].x)/k,y:(v*g[0].y+w*g[1].y+S*g[2].y)/k,z:l?(v*g[0].z+w*g[1].z+S*g[2].z)/k:!1,t:h};if(v*=f,w*=1.5*f,S*=3*f,E*=h*h*h,g.length===4)return k=v+w+S+E,{x:(v*g[0].x+w*g[1].x+S*g[2].x+E*g[3].x)/k,y:(v*g[0].y+w*g[1].y+S*g[2].y+E*g[3].y)/k,z:l?(v*g[0].z+w*g[1].z+S*g[2].z+E*g[3].z)/k:!1,t:h}},derive:function(h,s){const a=[];for(let l=h,f=l.length,o=f-1;f>1;f--,o--){const g=[];for(let v=0,w;v<o;v++)w={x:o*(l[v+1].x-l[v].x),y:o*(l[v+1].y-l[v].y)},s&&(w.z=o*(l[v+1].z-l[v].z)),g.push(w);a.push(g),l=g}return a},between:function(h,s,a){return s<=h&&h<=a||Ae.approximately(h,s)||Ae.approximately(h,a)},approximately:function(h,s,a){return tn(h-s)<=(a||ja)},length:function(h){const a=Ae.Tvalues.length;let l=0;for(let f=0,o;f<a;f++)o=.5*Ae.Tvalues[f]+.5,l+=Ae.Cvalues[f]*Ae.arcfn(o,h);return .5*l},map:function(h,s,a,l,f){const o=a-s,g=f-l,v=h-s,w=v/o;return l+g*w},lerp:function(h,s,a){const l={x:s.x+h*(a.x-s.x),y:s.y+h*(a.y-s.y)};return s.z!==void 0&&a.z!==void 0&&(l.z=s.z+h*(a.z-s.z)),l},pointToString:function(h){let s=h.x+"/"+h.y;return typeof h.z<"u"&&(s+="/"+h.z),s},pointsToString:function(h){return"["+h.map(Ae.pointToString).join(", ")+"]"},copy:function(h){return JSON.parse(JSON.stringify(h))},angle:function(h,s,a){const l=s.x-h.x,f=s.y-h.y,o=a.x-h.x,g=a.y-h.y,v=l*g-f*o,w=l*o+f*g;return nn(v,w)},round:function(h,s){const a=""+h,l=a.indexOf(".");return parseFloat(a.substring(0,l+1+s))},dist:function(h,s){const a=h.x-s.x,l=h.y-s.y;return fi(a*a+l*l)},closest:function(h,s){let a=Ht(2,63),l,f;return h.forEach(function(o,g){f=Ae.dist(s,o),f<a&&(a=f,l=g)}),{mdist:a,mpos:l}},abcratio:function(h,s){if(s!==2&&s!==3)return!1;if(typeof h>"u")h=.5;else if(h===0||h===1)return h;const a=Ht(h,s)+Ht(1-h,s),l=a-1;return tn(l/a)},projectionratio:function(h,s){if(s!==2&&s!==3)return!1;if(typeof h>"u")h=.5;else if(h===0||h===1)return h;const a=Ht(1-h,s),l=Ht(h,s)+a;return a/l},lli8:function(h,s,a,l,f,o,g,v){const w=(h*l-s*a)*(f-g)-(h-a)*(f*v-o*g),S=(h*l-s*a)*(o-v)-(s-l)*(f*v-o*g),E=(h-a)*(o-v)-(s-l)*(f-g);return E==0?!1:{x:w/E,y:S/E}},lli4:function(h,s,a,l){const f=h.x,o=h.y,g=s.x,v=s.y,w=a.x,S=a.y,E=l.x,k=l.y;return Ae.lli8(f,o,g,v,w,S,E,k)},lli:function(h,s){return Ae.lli4(h,h.c,s,s.c)},makeline:function(h,s){return new ft(h.x,h.y,(h.x+s.x)/2,(h.y+s.y)/2,s.x,s.y)},findbbox:function(h){let s=fr,a=fr,l=dr,f=dr;return h.forEach(function(o){const g=o.bbox();s>g.x.min&&(s=g.x.min),a>g.y.min&&(a=g.y.min),l<g.x.max&&(l=g.x.max),f<g.y.max&&(f=g.y.max)}),{x:{min:s,mid:(s+l)/2,max:l,size:l-s},y:{min:a,mid:(a+f)/2,max:f,size:f-a}}},shapeintersections:function(h,s,a,l,f){if(!Ae.bboxoverlap(s,l))return[];const o=[],g=[h.startcap,h.forward,h.back,h.endcap],v=[a.startcap,a.forward,a.back,a.endcap];return g.forEach(function(w){w.virtual||v.forEach(function(S){if(S.virtual)return;const E=w.intersects(S,f);E.length>0&&(E.c1=w,E.c2=S,E.s1=h,E.s2=a,o.push(E))})}),o},makeshape:function(h,s,a){const l=s.points.length,f=h.points.length,o=Ae.makeline(s.points[l-1],h.points[0]),g=Ae.makeline(h.points[f-1],s.points[0]),v={startcap:o,forward:h,back:s,endcap:g,bbox:Ae.findbbox([o,h,s,g])};return v.intersections=function(w){return Ae.shapeintersections(v,v.bbox,w,w.bbox,a)},v},getminmax:function(h,s,a){if(!a)return{min:0,max:0};let l=fr,f=dr,o,g;a.indexOf(0)===-1&&(a=[0].concat(a)),a.indexOf(1)===-1&&a.push(1);for(let v=0,w=a.length;v<w;v++)o=a[v],g=h.get(o),g[s]<l&&(l=g[s]),g[s]>f&&(f=g[s]);return{min:l,mid:(l+f)/2,max:f,size:f-l}},align:function(h,s){const a=s.p1.x,l=s.p1.y,f=-nn(s.p2.y-l,s.p2.x-a),o=function(g){return{x:(g.x-a)*ni(f)-(g.y-l)*Di(f),y:(g.x-a)*Di(f)+(g.y-l)*ni(f)}};return h.map(o)},roots:function(h,s){s=s||{p1:{x:0,y:0},p2:{x:1,y:0}};const a=h.length-1,l=Ae.align(h,s),f=function(ye){return 0<=ye&&ye<=1};if(a===2){const ye=l[0].y,we=l[1].y,me=l[2].y,Ee=ye-2*we+me;if(Ee!==0){const Me=-fi(we*we-ye*me),Pe=-ye+we,De=-(Me+Pe)/Ee,Se=-(-Me+Pe)/Ee;return[De,Se].filter(f)}else if(we!==me&&Ee===0)return[(2*we-me)/(2*we-2*me)].filter(f);return[]}const o=l[0].y,g=l[1].y,v=l[2].y,w=l[3].y;let S=-o+3*g-3*v+w,E=3*o-6*g+3*v,k=-3*o+3*g,q=o;if(Ae.approximately(S,0)){if(Ae.approximately(E,0))return Ae.approximately(k,0)?[]:[-q/k].filter(f);const ye=fi(k*k-4*E*q),we=2*E;return[(ye-k)/we,(-k-ye)/we].filter(f)}E/=S,k/=S,q/=S;const L=(3*k-E*E)/3,te=L/3,Z=(2*E*E*E-9*E*k+27*q)/27,ne=Z/2,J=ne*ne+te*te*te;let pe,ce,be,he,O;if(J<0){const ye=-L/3,we=ye*ye*ye,me=fi(we),Ee=-Z/(2*me),Me=Ee<-1?-1:Ee>1?1:Ee,Pe=Ga(Me),De=rn(me),Se=2*De;return be=Se*ni(Pe/3)-E/3,he=Se*ni((Pe+Dn)/3)-E/3,O=Se*ni((Pe+2*Dn)/3)-E/3,[be,he,O].filter(f)}else{if(J===0)return pe=ne<0?rn(-ne):-rn(ne),be=2*pe-E/3,he=-pe-E/3,[be,he].filter(f);{const ye=fi(J);return pe=rn(-ne+ye),ce=rn(ne+ye),[pe-ce-E/3].filter(f)}}},droots:function(h){if(h.length===3){const s=h[0],a=h[1],l=h[2],f=s-2*a+l;if(f!==0){const o=-fi(a*a-s*l),g=-s+a,v=-(o+g)/f,w=-(-o+g)/f;return[v,w]}else if(a!==l&&f===0)return[(2*a-l)/(2*(a-l))];return[]}if(h.length===2){const s=h[0],a=h[1];return s!==a?[s/(s-a)]:[]}return[]},curvature:function(h,s,a,l,f){let o,g,v,w,S=0,E=0;const k=Ae.compute(h,s),q=Ae.compute(h,a),L=k.x*k.x+k.y*k.y;if(l?(o=fi(Ht(k.y*q.z-q.y*k.z,2)+Ht(k.z*q.x-q.z*k.x,2)+Ht(k.x*q.y-q.x*k.y,2)),g=Ht(L+k.z*k.z,3/2)):(o=k.x*q.y-k.y*q.x,g=Ht(L,3/2)),o===0||g===0)return{k:0,r:0};if(S=o/g,E=g/o,!f){const te=Ae.curvature(h-.001,s,a,l,!0).k,Z=Ae.curvature(h+.001,s,a,l,!0).k;w=(Z-S+(S-te))/2,v=(tn(Z-S)+tn(S-te))/2}return{k:S,r:E,dk:w,adk:v}},inflections:function(h){if(h.length<4)return[];const s=Ae.align(h,{p1:h[0],p2:h.slice(-1)[0]}),a=s[2].x*s[1].y,l=s[3].x*s[1].y,f=s[1].x*s[2].y,o=s[3].x*s[2].y,g=18*(-3*a+2*l+3*f-o),v=18*(3*a-l-3*f),w=18*(f-a);if(Ae.approximately(g,0)){if(!Ae.approximately(v,0)){let q=-w/v;if(0<=q&&q<=1)return[q]}return[]}const S=2*g;if(Ae.approximately(S,0))return[];const E=v*v-4*g*w;if(E<0)return[];const k=Math.sqrt(E);return[(k-v)/S,-(v+k)/S].filter(function(q){return 0<=q&&q<=1})},bboxoverlap:function(h,s){const a=["x","y"],l=a.length;for(let f=0,o,g,v,w;f<l;f++)if(o=a[f],g=h[o].mid,v=s[o].mid,w=(h[o].size+s[o].size)/2,tn(g-v)>=w)return!1;return!0},expandbox:function(h,s){s.x.min<h.x.min&&(h.x.min=s.x.min),s.y.min<h.y.min&&(h.y.min=s.y.min),s.z&&s.z.min<h.z.min&&(h.z.min=s.z.min),s.x.max>h.x.max&&(h.x.max=s.x.max),s.y.max>h.y.max&&(h.y.max=s.y.max),s.z&&s.z.max>h.z.max&&(h.z.max=s.z.max),h.x.mid=(h.x.min+h.x.max)/2,h.y.mid=(h.y.min+h.y.max)/2,h.z&&(h.z.mid=(h.z.min+h.z.max)/2),h.x.size=h.x.max-h.x.min,h.y.size=h.y.max-h.y.min,h.z&&(h.z.size=h.z.max-h.z.min)},pairiteration:function(h,s,a){const l=h.bbox(),f=s.bbox(),o=1e5,g=a||.5;if(l.x.size+l.y.size<g&&f.x.size+f.y.size<g)return[(o*(h._t1+h._t2)/2|0)/o+"/"+(o*(s._t1+s._t2)/2|0)/o];let v=h.split(.5),w=s.split(.5),S=[{left:v.left,right:w.left},{left:v.left,right:w.right},{left:v.right,right:w.right},{left:v.right,right:w.left}];S=S.filter(function(k){return Ae.bboxoverlap(k.left.bbox(),k.right.bbox())});let E=[];return S.length===0||(S.forEach(function(k){E=E.concat(Ae.pairiteration(k.left,k.right,g))}),E=E.filter(function(k,q){return E.indexOf(k)===q})),E},getccenter:function(h,s,a){const l=s.x-h.x,f=s.y-h.y,o=a.x-s.x,g=a.y-s.y,v=l*ni(di)-f*Di(di),w=l*Di(di)+f*ni(di),S=o*ni(di)-g*Di(di),E=o*Di(di)+g*ni(di),k=(h.x+s.x)/2,q=(h.y+s.y)/2,L=(s.x+a.x)/2,te=(s.y+a.y)/2,Z=k+v,ne=q+w,J=L+S,pe=te+E,ce=Ae.lli8(k,q,Z,ne,L,te,J,pe),be=Ae.dist(ce,h);let he=nn(h.y-ce.y,h.x-ce.x),O=nn(s.y-ce.y,s.x-ce.x),ye=nn(a.y-ce.y,a.x-ce.x),we;return he<ye?((he>O||O>ye)&&(he+=Dn),he>ye&&(we=ye,ye=he,he=we)):ye<O&&O<he?(we=ye,ye=he,he=we):ye+=Dn,ce.s=he,ce.e=ye,ce.r=be,ce},numberSort:function(h,s){return h-s}};class cn{constructor(s){this.curves=[],this._3d=!1,s&&(this.curves=s,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(s){return Ae.pointsToString(s.points)}).join(", ")+"]"}addCurve(s){this.curves.push(s),this._3d=this._3d||s._3d}length(){return this.curves.map(function(s){return s.length()}).reduce(function(s,a){return s+a})}curve(s){return this.curves[s]}bbox(){const s=this.curves;for(var a=s[0].bbox(),l=1;l<s.length;l++)Ae.expandbox(a,s[l].bbox());return a}offset(s){const a=[];return this.curves.forEach(function(l){a.push(...l.offset(s))}),new cn(a)}}const{abs:sn,min:ss,max:as,cos:Za,sin:Ka,acos:Xa,sqrt:an}=Math,Ya=Math.PI;class ft{constructor(s){let a=s&&s.forEach?s:Array.from(arguments).slice(),l=!1;if(typeof a[0]=="object"){l=a.length;const L=[];a.forEach(function(te){["x","y","z"].forEach(function(Z){typeof te[Z]<"u"&&L.push(te[Z])})}),a=L}let f=!1;const o=a.length;if(l){if(l>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");f=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const g=this._3d=!f&&(o===9||o===12)||s&&s[0]&&typeof s[0].z<"u",v=this.points=[];for(let L=0,te=g?3:2;L<o;L+=te){var w={x:a[L],y:a[L+1]};g&&(w.z=a[L+2]),v.push(w)}const S=this.order=v.length-1,E=this.dims=["x","y"];g&&E.push("z"),this.dimlen=E.length;const k=Ae.align(v,{p1:v[0],p2:v[S]}),q=Ae.dist(v[0],v[S]);this._linear=k.reduce((L,te)=>L+sn(te.y),0)<q/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(s,a,l,f){if(typeof f>"u"&&(f=.5),f===0)return new ft(a,a,l);if(f===1)return new ft(s,a,a);const o=ft.getABC(2,s,a,l,f);return new ft(s,o.A,l)}static cubicFromPoints(s,a,l,f,o){typeof f>"u"&&(f=.5);const g=ft.getABC(3,s,a,l,f);typeof o>"u"&&(o=Ae.dist(a,g.C));const v=o*(1-f)/f,w=Ae.dist(s,l),S=(l.x-s.x)/w,E=(l.y-s.y)/w,k=o*S,q=o*E,L=v*S,te=v*E,Z={x:a.x-k,y:a.y-q},ne={x:a.x+L,y:a.y+te},J=g.A,pe={x:J.x+(Z.x-J.x)/(1-f),y:J.y+(Z.y-J.y)/(1-f)},ce={x:J.x+(ne.x-J.x)/f,y:J.y+(ne.y-J.y)/f},be={x:s.x+(pe.x-s.x)/f,y:s.y+(pe.y-s.y)/f},he={x:l.x+(ce.x-l.x)/(1-f),y:l.y+(ce.y-l.y)/(1-f)};return new ft(s,be,he,l)}static getUtils(){return Ae}getUtils(){return ft.getUtils()}static get PolyBezier(){return cn}valueOf(){return this.toString()}toString(){return Ae.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const s=this.points,a=s[0].x,l=s[0].y,f=["M",a,l,this.order===2?"Q":"C"];for(let o=1,g=s.length;o<g;o++)f.push(s[o].x),f.push(s[o].y);return f.join(" ")}setRatios(s){if(s.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=s,this._lut=[]}verify(){const s=this.coordDigest();s!==this._print&&(this._print=s,this.update())}coordDigest(){return this.points.map(function(s,a){return""+a+s.x+s.y+(s.z?s.z:0)}).join("")}update(){this._lut=[],this.dpoints=Ae.derive(this.points,this._3d),this.computedirection()}computedirection(){const s=this.points,a=Ae.angle(s[0],s[this.order],s[1]);this.clockwise=a>0}length(){return Ae.length(this.derivative.bind(this))}static getABC(s=2,a,l,f,o=.5){const g=Ae.projectionratio(o,s),v=1-g,w={x:g*a.x+v*f.x,y:g*a.y+v*f.y},S=Ae.abcratio(o,s);return{A:{x:l.x+(l.x-w.x)/S,y:l.y+(l.y-w.y)/S},B:l,C:w,S:a,E:f}}getABC(s,a){a=a||this.get(s);let l=this.points[0],f=this.points[this.order];return ft.getABC(this.order,l,a,f,s)}getLUT(s){if(this.verify(),s=s||100,this._lut.length===s+1)return this._lut;this._lut=[],s++,this._lut=[];for(let a=0,l,f;a<s;a++)f=a/(s-1),l=this.compute(f),l.t=f,this._lut.push(l);return this._lut}on(s,a){a=a||5;const l=this.getLUT(),f=[];for(let o=0,g,v=0;o<l.length;o++)g=l[o],Ae.dist(g,s)<a&&(f.push(g),v+=o/l.length);return f.length?t/=f.length:!1}project(s){const a=this.getLUT(),l=a.length-1,f=Ae.closest(a,s),o=f.mpos,g=(o-1)/l,v=(o+1)/l,w=.1/l;let S=f.mdist,E=g,k=E,q;S+=1;for(let L;E<v+w;E+=w)q=this.compute(E),L=Ae.dist(s,q),L<S&&(S=L,k=E);return k=k<0?0:k>1?1:k,q=this.compute(k),q.t=k,q.d=S,q}get(s){return this.compute(s)}point(s){return this.points[s]}compute(s){return this.ratios?Ae.computeWithRatios(s,this.points,this.ratios,this._3d):Ae.compute(s,this.points,this._3d,this.ratios)}raise(){const s=this.points,a=[s[0]],l=s.length;for(let f=1,o,g;f<l;f++)o=s[f],g=s[f-1],a[f]={x:(l-f)/l*o.x+f/l*g.x,y:(l-f)/l*o.y+f/l*g.y};return a[l]=s[l-1],new ft(a)}derivative(s){return Ae.compute(s,this.dpoints[0],this._3d)}dderivative(s){return Ae.compute(s,this.dpoints[1],this._3d)}align(){let s=this.points;return new ft(Ae.align(s,{p1:s[0],p2:s[s.length-1]}))}curvature(s){return Ae.curvature(s,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Ae.inflections(this.points)}normal(s){return this._3d?this.__normal3(s):this.__normal2(s)}__normal2(s){const a=this.derivative(s),l=an(a.x*a.x+a.y*a.y);return{t:s,x:-a.y/l,y:a.x/l}}__normal3(s){const a=this.derivative(s),l=this.derivative(s+.01),f=an(a.x*a.x+a.y*a.y+a.z*a.z),o=an(l.x*l.x+l.y*l.y+l.z*l.z);a.x/=f,a.y/=f,a.z/=f,l.x/=o,l.y/=o,l.z/=o;const g={x:l.y*a.z-l.z*a.y,y:l.z*a.x-l.x*a.z,z:l.x*a.y-l.y*a.x},v=an(g.x*g.x+g.y*g.y+g.z*g.z);g.x/=v,g.y/=v,g.z/=v;const w=[g.x*g.x,g.x*g.y-g.z,g.x*g.z+g.y,g.x*g.y+g.z,g.y*g.y,g.y*g.z-g.x,g.x*g.z-g.y,g.y*g.z+g.x,g.z*g.z];return{t:s,x:w[0]*a.x+w[1]*a.y+w[2]*a.z,y:w[3]*a.x+w[4]*a.y+w[5]*a.z,z:w[6]*a.x+w[7]*a.y+w[8]*a.z}}hull(s){let a=this.points,l=[],f=[],o=0;for(f[o++]=a[0],f[o++]=a[1],f[o++]=a[2],this.order===3&&(f[o++]=a[3]);a.length>1;){l=[];for(let g=0,v,w=a.length-1;g<w;g++)v=Ae.lerp(s,a[g],a[g+1]),f[o++]=v,l.push(v);a=l}return f}split(s,a){if(s===0&&a)return this.split(a).left;if(a===1)return this.split(s).right;const l=this.hull(s),f={left:this.order===2?new ft([l[0],l[3],l[5]]):new ft([l[0],l[4],l[7],l[9]]),right:this.order===2?new ft([l[5],l[4],l[2]]):new ft([l[9],l[8],l[6],l[3]]),span:l};return f.left._t1=Ae.map(0,0,1,this._t1,this._t2),f.left._t2=Ae.map(s,0,1,this._t1,this._t2),f.right._t1=Ae.map(s,0,1,this._t1,this._t2),f.right._t2=Ae.map(1,0,1,this._t1,this._t2),a?(a=Ae.map(a,s,1,0,1),f.right.split(a).left):f}extrema(){const s={};let a=[];return this.dims.forEach((function(l){let f=function(g){return g[l]},o=this.dpoints[0].map(f);s[l]=Ae.droots(o),this.order===3&&(o=this.dpoints[1].map(f),s[l]=s[l].concat(Ae.droots(o))),s[l]=s[l].filter(function(g){return g>=0&&g<=1}),a=a.concat(s[l].sort(Ae.numberSort))}).bind(this)),s.values=a.sort(Ae.numberSort).filter(function(l,f){return a.indexOf(l)===f}),s}bbox(){const s=this.extrema(),a={};return this.dims.forEach((function(l){a[l]=Ae.getminmax(this,l,s[l])}).bind(this)),a}overlaps(s){const a=this.bbox(),l=s.bbox();return Ae.bboxoverlap(a,l)}offset(s,a){if(typeof a<"u"){const l=this.get(s),f=this.normal(s),o={c:l,n:f,x:l.x+f.x*a,y:l.y+f.y*a};return this._3d&&(o.z=l.z+f.z*a),o}if(this._linear){const l=this.normal(0),f=this.points.map(function(o){const g={x:o.x+s*l.x,y:o.y+s*l.y};return o.z&&l.z&&(g.z=o.z+s*l.z),g});return[new ft(f)]}return this.reduce().map(function(l){return l._linear?l.offset(s)[0]:l.scale(s)})}simple(){if(this.order===3){const f=Ae.angle(this.points[0],this.points[3],this.points[1]),o=Ae.angle(this.points[0],this.points[3],this.points[2]);if(f>0&&o<0||f<0&&o>0)return!1}const s=this.normal(0),a=this.normal(1);let l=s.x*a.x+s.y*a.y;return this._3d&&(l+=s.z*a.z),sn(Xa(l))<Ya/3}reduce(){let s,a=0,l=0,f=.01,o,g=[],v=[],w=this.extrema().values;for(w.indexOf(0)===-1&&(w=[0].concat(w)),w.indexOf(1)===-1&&w.push(1),a=w[0],s=1;s<w.length;s++)l=w[s],o=this.split(a,l),o._t1=a,o._t2=l,g.push(o),a=l;return g.forEach(function(S){for(a=0,l=0;l<=1;)for(l=a+f;l<=1+f;l+=f)if(o=S.split(a,l),!o.simple()){if(l-=f,sn(a-l)<f)return[];o=S.split(a,l),o._t1=Ae.map(a,0,1,S._t1,S._t2),o._t2=Ae.map(l,0,1,S._t1,S._t2),v.push(o),a=l;break}a<1&&(o=S.split(a,1),o._t1=Ae.map(a,0,1,S._t1,S._t2),o._t2=S._t2,v.push(o))}),v}translate(s,a,l){l=typeof l=="number"?l:a;const f=this.order;let o=this.points.map((g,v)=>(1-v/f)*a+v/f*l);return new ft(this.points.map((g,v)=>({x:g.x+s.x*o[v],y:g.y+s.y*o[v]})))}scale(s){const a=this.order;let l=!1;if(typeof s=="function"&&(l=s),l&&a===2)return this.raise().scale(l);const f=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),l?l(0):s,l?l(1):s);const g=l?l(0):s,v=l?l(1):s,w=[this.offset(0,10),this.offset(1,10)],S=[],E=Ae.lli4(w[0],w[0].c,w[1],w[1].c);if(!E)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(k){const q=S[k*a]=Ae.copy(o[k*a]);q.x+=(k?v:g)*w[k].n.x,q.y+=(k?v:g)*w[k].n.y}),l?([0,1].forEach(function(k){if(!(a===2&&k)){var q=o[k+1],L={x:q.x-E.x,y:q.y-E.y},te=l?l((k+1)/a):s;l&&!f&&(te=-te);var Z=an(L.x*L.x+L.y*L.y);L.x/=Z,L.y/=Z,S[k+1]={x:q.x+te*L.x,y:q.y+te*L.y}}}),new ft(S)):([0,1].forEach(k=>{if(a===2&&k)return;const q=S[k*a],L=this.derivative(k),te={x:q.x+L.x,y:q.y+L.y};S[k+1]=Ae.lli4(q,te,E,o[k+1])}),new ft(S))}outline(s,a,l,f){if(a=a===void 0?s:a,this._linear){const he=this.normal(0),O=this.points[0],ye=this.points[this.points.length-1];let we,me,Ee;l===void 0&&(l=s,f=a),we={x:O.x+he.x*s,y:O.y+he.y*s},Ee={x:ye.x+he.x*l,y:ye.y+he.y*l},me={x:(we.x+Ee.x)/2,y:(we.y+Ee.y)/2};const Me=[we,me,Ee];we={x:O.x-he.x*a,y:O.y-he.y*a},Ee={x:ye.x-he.x*f,y:ye.y-he.y*f},me={x:(we.x+Ee.x)/2,y:(we.y+Ee.y)/2};const Pe=[Ee,me,we],De=Ae.makeline(Pe[2],Me[0]),Se=Ae.makeline(Me[2],Pe[0]),et=[De,new ft(Me),Se,new ft(Pe)];return new cn(et)}const o=this.reduce(),g=o.length,v=[];let w=[],S,E=0,k=this.length();const q=typeof l<"u"&&typeof f<"u";function L(he,O,ye,we,me){return function(Ee){const Me=we/ye,Pe=(we+me)/ye,De=O-he;return Ae.map(Ee,0,1,he+Me*De,he+Pe*De)}}o.forEach(function(he){const O=he.length();q?(v.push(he.scale(L(s,l,k,E,O))),w.push(he.scale(L(-a,-f,k,E,O)))):(v.push(he.scale(s)),w.push(he.scale(-a))),E+=O}),w=w.map(function(he){return S=he.points,S[3]?he.points=[S[3],S[2],S[1],S[0]]:he.points=[S[2],S[1],S[0]],he}).reverse();const te=v[0].points[0],Z=v[g-1].points[v[g-1].points.length-1],ne=w[g-1].points[w[g-1].points.length-1],J=w[0].points[0],pe=Ae.makeline(ne,te),ce=Ae.makeline(Z,J),be=[pe].concat(v).concat([ce]).concat(w);return new cn(be)}outlineshapes(s,a,l){a=a||s;const f=this.outline(s,a).curves,o=[];for(let g=1,v=f.length;g<v/2;g++){const w=Ae.makeshape(f[g],f[v-g],l);w.startcap.virtual=g>1,w.endcap.virtual=g<v/2-1,o.push(w)}return o}intersects(s,a){return s?s.p1&&s.p2?this.lineIntersects(s):(s instanceof ft&&(s=s.reduce()),this.curveintersects(this.reduce(),s,a)):this.selfintersects(a)}lineIntersects(s){const a=ss(s.p1.x,s.p2.x),l=ss(s.p1.y,s.p2.y),f=as(s.p1.x,s.p2.x),o=as(s.p1.y,s.p2.y);return Ae.roots(this.points,s).filter(g=>{var v=this.get(g);return Ae.between(v.x,a,f)&&Ae.between(v.y,l,o)})}selfintersects(s){const a=this.reduce(),l=a.length-2,f=[];for(let o=0,g,v,w;o<l;o++)v=a.slice(o,o+1),w=a.slice(o+2),g=this.curveintersects(v,w,s),f.push(...g);return f}curveintersects(s,a,l){const f=[];s.forEach(function(g){a.forEach(function(v){g.overlaps(v)&&f.push({left:g,right:v})})});let o=[];return f.forEach(function(g){const v=Ae.pairiteration(g.left,g.right,l);v.length>0&&(o=o.concat(v))}),o}arcs(s){return s=s||.5,this._iterate(s,[])}_error(s,a,l,f){const o=(f-l)/4,g=this.get(l+o),v=this.get(f-o),w=Ae.dist(s,a),S=Ae.dist(s,g),E=Ae.dist(s,v);return sn(S-w)+sn(E-w)}_iterate(s,a){let l=0,f=1,o;do{o=0,f=1;let g=this.get(l),v,w,S,E,k=!1,q=!1,L,te=f,Z=1;do if(q=k,E=S,te=(l+f)/2,v=this.get(te),w=this.get(f),S=Ae.getccenter(g,v,w),S.interval={start:l,end:f},k=this._error(S,g,l,f)<=s,L=q&&!k,L||(Z=f),k){if(f>=1){if(S.interval.end=Z=1,E=S,f>1){let J={x:S.x+S.r*Za(S.e),y:S.y+S.r*Ka(S.e)};S.e+=Ae.angle({x:S.x,y:S.y},J,this.get(1))}break}f=f+(f-l)/2}else f=te;while(!L&&o++<100);if(o>=100)break;E=E||S,a.push(E),l=Z}while(f<1);return a}}var Qa=(function(){function h(s,a){var l=[],f=!0,o=!1,g=void 0;try{for(var v=s[Symbol.iterator](),w;!(f=(w=v.next()).done)&&(l.push(w.value),!(a&&l.length===a));f=!0);}catch(S){o=!0,g=S}finally{try{!f&&v.return&&v.return()}finally{if(o)throw g}}return l}return function(s,a){if(Array.isArray(s))return s;if(Symbol.iterator in Object(s))return h(s,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),fn=Math.PI*2,pr=function(s,a,l,f,o,g,v){var w=s.x,S=s.y;w*=a,S*=l;var E=f*w-o*S,k=o*w+f*S;return{x:E+g,y:k+v}},$a=function(s,a){var l=a===1.5707963267948966?.551915024494:a===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(a/4),f=Math.cos(s),o=Math.sin(s),g=Math.cos(s+a),v=Math.sin(s+a);return[{x:f-o*l,y:o+f*l},{x:g+v*l,y:v-g*l},{x:g,y:v}]},os=function(s,a,l,f){var o=s*f-a*l<0?-1:1,g=s*l+a*f;return g>1&&(g=1),g<-1&&(g=-1),o*Math.acos(g)},Ja=function(s,a,l,f,o,g,v,w,S,E,k,q){var L=Math.pow(o,2),te=Math.pow(g,2),Z=Math.pow(k,2),ne=Math.pow(q,2),J=L*te-L*ne-te*Z;J<0&&(J=0),J/=L*ne+te*Z,J=Math.sqrt(J)*(v===w?-1:1);var pe=J*o/g*q,ce=J*-g/o*k,be=E*pe-S*ce+(s+l)/2,he=S*pe+E*ce+(a+f)/2,O=(k-pe)/o,ye=(q-ce)/g,we=(-k-pe)/o,me=(-q-ce)/g,Ee=os(1,0,O,ye),Me=os(O,ye,we,me);return w===0&&Me>0&&(Me-=fn),w===1&&Me<0&&(Me+=fn),[be,he,Ee,Me]},eo=function(s){var a=s.px,l=s.py,f=s.cx,o=s.cy,g=s.rx,v=s.ry,w=s.xAxisRotation,S=w===void 0?0:w,E=s.largeArcFlag,k=E===void 0?0:E,q=s.sweepFlag,L=q===void 0?0:q,te=[];if(g===0||v===0)return[];var Z=Math.sin(S*fn/360),ne=Math.cos(S*fn/360),J=ne*(a-f)/2+Z*(l-o)/2,pe=-Z*(a-f)/2+ne*(l-o)/2;if(J===0&&pe===0)return[];g=Math.abs(g),v=Math.abs(v);var ce=Math.pow(J,2)/Math.pow(g,2)+Math.pow(pe,2)/Math.pow(v,2);ce>1&&(g*=Math.sqrt(ce),v*=Math.sqrt(ce));var be=Ja(a,l,f,o,g,v,k,L,Z,ne,J,pe),he=Qa(be,4),O=he[0],ye=he[1],we=he[2],me=he[3],Ee=Math.abs(me)/(fn/4);Math.abs(1-Ee)<1e-7&&(Ee=1);var Me=Math.max(Math.ceil(Ee),1);me/=Me;for(var Pe=0;Pe<Me;Pe++)te.push($a(we,me)),we+=me;return te.map(function(De){var Se=pr(De[0],g,v,ne,Z,O,ye),et=Se.x,de=Se.y,Xe=pr(De[1],g,v,ne,Z,O,ye),st=Xe.x,Ve=Xe.y,it=pr(De[2],g,v,ne,Z,O,ye),Kt=it.x,Bt=it.y;return{x1:et,y1:de,x2:st,y2:Ve,x:Kt,y:Bt}})};function to(h,s){return h>s?1:h<s?-1:0}class Fr{constructor(s=to,a=!1){this._compare=s,this._root=null,this._size=0,this._noDuplicates=!!a}rotateLeft(s){var a=s.right;a&&(s.right=a.left,a.left&&(a.left.parent=s),a.parent=s.parent),s.parent?s===s.parent.left?s.parent.left=a:s.parent.right=a:this._root=a,a&&(a.left=s),s.parent=a}rotateRight(s){var a=s.left;a&&(s.left=a.right,a.right&&(a.right.parent=s),a.parent=s.parent),s.parent?s===s.parent.left?s.parent.left=a:s.parent.right=a:this._root=a,a&&(a.right=s),s.parent=a}_splay(s){for(;s.parent;){var a=s.parent;a.parent?a.left===s&&a.parent.left===a?(this.rotateRight(a.parent),this.rotateRight(a)):a.right===s&&a.parent.right===a?(this.rotateLeft(a.parent),this.rotateLeft(a)):a.left===s&&a.parent.right===a?(this.rotateRight(a),this.rotateLeft(a)):(this.rotateLeft(a),this.rotateRight(a)):a.left===s?this.rotateRight(a):this.rotateLeft(a)}}splay(s){for(var a,l,f,o,g;s.parent;)a=s.parent,l=a.parent,l&&l.parent?(f=l.parent,f.left===l?f.left=s:f.right=s,s.parent=f):(s.parent=null,this._root=s),o=s.left,g=s.right,s===a.left?(l&&(l.left===a?(a.right?(l.left=a.right,l.left.parent=l):l.left=null,a.right=l,l.parent=a):(o?(l.right=o,o.parent=l):l.right=null,s.left=l,l.parent=s)),g?(a.left=g,g.parent=a):a.left=null,s.right=a,a.parent=s):(l&&(l.right===a?(a.left?(l.right=a.left,l.right.parent=l):l.right=null,a.left=l,l.parent=a):(g?(l.left=g,g.parent=l):l.left=null,s.right=l,l.parent=s)),o?(a.right=o,o.parent=a):a.right=null,s.left=a,a.parent=s)}replace(s,a){s.parent?s===s.parent.left?s.parent.left=a:s.parent.right=a:this._root=a,a&&(a.parent=s.parent)}minNode(s=this._root){if(s)for(;s.left;)s=s.left;return s}maxNode(s=this._root){if(s)for(;s.right;)s=s.right;return s}insert(s,a){var l=this._root,f=null,o=this._compare,g;if(this._noDuplicates)for(;l;){if(f=l,g=o(l.key,s),g===0)return;o(l.key,s)<0?l=l.right:l=l.left}else for(;l;)f=l,o(l.key,s)<0?l=l.right:l=l.left;return l={key:s,data:a,left:null,right:null,parent:f},f?o(f.key,l.key)<0?f.right=l:f.left=l:this._root=l,this.splay(l),this._size++,l}find(s){for(var a=this._root,l=this._compare;a;){var f=l(a.key,s);if(f<0)a=a.right;else if(f>0)a=a.left;else return a}return null}contains(s){for(var a=this._root,l=this._compare;a;){var f=l(s,a.key);if(f===0)return!0;f<0?a=a.left:a=a.right}return!1}remove(s){var a=this.find(s);if(!a)return!1;if(this.splay(a),!a.left)this.replace(a,a.right);else if(!a.right)this.replace(a,a.left);else{var l=this.minNode(a.right);l.parent!==a&&(this.replace(l,l.right),l.right=a.right,l.right.parent=l),this.replace(a,l),l.left=a.left,l.left.parent=l}return this._size--,!0}removeNode(s){if(!s)return!1;if(this.splay(s),!s.left)this.replace(s,s.right);else if(!s.right)this.replace(s,s.left);else{var a=this.minNode(s.right);a.parent!==s&&(this.replace(a,a.right),a.right=s.right,a.right.parent=a),this.replace(s,a),a.left=s.left,a.left.parent=a}return this._size--,!0}erase(s){var a=this.find(s);if(a){this.splay(a);var l=a.left,f=a.right,o=null;l&&(l.parent=null,o=this.maxNode(l),this.splay(o),this._root=o),f&&(l?o.right=f:this._root=f,f.parent=o),this._size--}}pop(){var s=this._root,a=null;if(s){for(;s.left;)s=s.left;a={key:s.key,data:s.data},this.remove(s.key)}return a}next(s){var a=s;if(a)if(a.right)for(a=a.right;a&&a.left;)a=a.left;else for(a=s.parent;a&&a.right===s;)s=a,a=a.parent;return a}prev(s){var a=s;if(a)if(a.left)for(a=a.left;a&&a.right;)a=a.right;else for(a=s.parent;a&&a.left===s;)s=a,a=a.parent;return a}forEach(s){for(var a=this._root,l=[],f=!1,o=0;!f;)a?(l.push(a),a=a.left):l.length>0?(a=l.pop(),s(a,o++),a=a.right):f=!0;return this}range(s,a,l,f){const o=[],g=this._compare;let v=this._root,w;for(;o.length!==0||v;)if(v)o.push(v),v=v.left;else{if(v=o.pop(),w=g(v.key,a),w>0)break;if(g(v.key,s)>=0&&l.call(f,v))return this;v=v.right}return this}keys(){for(var s=this._root,a=[],l=[],f=!1;!f;)s?(a.push(s),s=s.left):a.length>0?(s=a.pop(),l.push(s.key),s=s.right):f=!0;return l}values(){for(var s=this._root,a=[],l=[],f=!1;!f;)s?(a.push(s),s=s.left):a.length>0?(s=a.pop(),l.push(s.data),s=s.right):f=!0;return l}at(s){for(var a=this._root,l=[],f=!1,o=0;!f;)if(a)l.push(a),a=a.left;else if(l.length>0){if(a=l.pop(),o===s)return a;o++,a=a.right}else f=!0;return null}load(s=[],a=[],l=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const f=s.length;return l&&Mr(s,a,0,f-1,this._compare),this._root=Tr(null,s,a,0,f),this._size=f,this}min(){var s=this.minNode(this._root);return s?s.key:null}max(){var s=this.maxNode(this._root);return s?s.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(s,a,l,f,o){return new Fr(l,o).load(s,a,f)}}function Tr(h,s,a,l,f){const o=f-l;if(o>0){const g=l+Math.floor(o/2),v=s[g],w=a[g],S={key:v,data:w,parent:h};return S.left=Tr(S,s,a,l,g),S.right=Tr(S,s,a,g+1,f),S}return null}function Mr(h,s,a,l,f){if(a>=l)return;const o=h[a+l>>1];let g=a-1,v=l+1;for(;;){do g++;while(f(h[g],o)<0);do v--;while(f(h[v],o)>0);if(g>=v)break;let w=h[g];h[g]=h[v],h[v]=w,w=s[g],s[g]=s[v],s[v]=w}Mr(h,s,a,v,f),Mr(h,s,v+1,l,f)}const js=0,Ws=1,Zs=2,Ks=3,Wn=0,Lr=1,Zn=2,Xs=3;function on(h,s,a){s===null?(h.inOut=!1,h.otherInOut=!0):(h.isSubject===s.isSubject?(h.inOut=!s.inOut,h.otherInOut=s.otherInOut):(h.inOut=!s.otherInOut,h.otherInOut=s.isVertical()?!s.inOut:s.inOut),s&&(h.prevInResult=!us(s,a)||s.isVertical()?s.prevInResult:s)),us(h,a)?h.resultTransition=io(h,a):h.resultTransition=0}function us(h,s){switch(h.type){case js:switch(s){case Wn:return!h.otherInOut;case Lr:return h.otherInOut;case Zn:return h.isSubject&&h.otherInOut||!h.isSubject&&!h.otherInOut;case Xs:return!0}break;case Zs:return s===Wn||s===Lr;case Ks:return s===Zn;case Ws:return!1}return!1}function io(h,s){let a=!h.inOut,l=!h.otherInOut,f;switch(s){case Wn:f=a&&l;break;case Lr:f=a||l;break;case Xs:f=a^l;break;case Zn:h.isSubject?f=a&&!l:f=l&&!a;break}return f?1:-1}class qi{constructor(s,a,l,f,o){this.left=a,this.point=s,this.otherEvent=l,this.isSubject=f,this.type=o||js,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(s){const a=this.point,l=this.otherEvent.point;return this.left?(a[0]-s[0])*(l[1]-s[1])-(l[0]-s[0])*(a[1]-s[1])>0:(l[0]-s[0])*(a[1]-s[1])-(a[0]-s[0])*(l[1]-s[1])>0}isAbove(s){return!this.isBelow(s)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const s=new qi(this.point,this.left,this.otherEvent,this.isSubject,this.type);return s.contourId=this.contourId,s.resultTransition=this.resultTransition,s.prevInResult=this.prevInResult,s.isExteriorRing=this.isExteriorRing,s.inOut=this.inOut,s.otherInOut=this.otherInOut,s}}function Qt(h,s){return h[0]===s[0]?h[1]===s[1]:!1}const ri=11102230246251565e-32,Tt=134217729,no=(3+8*ri)*ri;function gr(h,s,a,l,f){let o,g,v,w,S=s[0],E=l[0],k=0,q=0;E>S==E>-S?(o=S,S=s[++k]):(o=E,E=l[++q]);let L=0;if(k<h&&q<a)for(E>S==E>-S?(g=S+o,v=o-(g-S),S=s[++k]):(g=E+o,v=o-(g-E),E=l[++q]),o=g,v!==0&&(f[L++]=v);k<h&&q<a;)E>S==E>-S?(g=o+S,w=g-o,v=o-(g-w)+(S-w),S=s[++k]):(g=o+E,w=g-o,v=o-(g-w)+(E-w),E=l[++q]),o=g,v!==0&&(f[L++]=v);for(;k<h;)g=o+S,w=g-o,v=o-(g-w)+(S-w),S=s[++k],o=g,v!==0&&(f[L++]=v);for(;q<a;)g=o+E,w=g-o,v=o-(g-w)+(E-w),E=l[++q],o=g,v!==0&&(f[L++]=v);return(o!==0||L===0)&&(f[L++]=o),L}function ro(h,s){let a=s[0];for(let l=1;l<h;l++)a+=s[l];return a}function bn(h){return new Float64Array(h)}const so=(3+16*ri)*ri,ao=(2+12*ri)*ri,oo=(9+64*ri)*ri*ri,Vi=bn(4),hs=bn(8),ls=bn(12),cs=bn(16),Ot=bn(4);function uo(h,s,a,l,f,o,g){let v,w,S,E,k,q,L,te,Z,ne,J,pe,ce,be,he,O,ye,we;const me=h-f,Ee=a-f,Me=s-o,Pe=l-o;be=me*Pe,q=Tt*me,L=q-(q-me),te=me-L,q=Tt*Pe,Z=q-(q-Pe),ne=Pe-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=Me*Ee,q=Tt*Me,L=q-(q-Me),te=Me-L,q=Tt*Ee,Z=q-(q-Ee),ne=Ee-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,Vi[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,Vi[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,Vi[2]=pe-(we-k)+(J-k),Vi[3]=we;let De=ro(4,Vi),Se=ao*g;if(De>=Se||-De>=Se||(k=h-me,v=h-(me+k)+(k-f),k=a-Ee,S=a-(Ee+k)+(k-f),k=s-Me,w=s-(Me+k)+(k-o),k=l-Pe,E=l-(Pe+k)+(k-o),v===0&&w===0&&S===0&&E===0)||(Se=oo*g+no*Math.abs(De),De+=me*E+Pe*v-(Me*S+Ee*w),De>=Se||-De>=Se))return De;be=v*Pe,q=Tt*v,L=q-(q-v),te=v-L,q=Tt*Pe,Z=q-(q-Pe),ne=Pe-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=w*Ee,q=Tt*w,L=q-(q-w),te=w-L,q=Tt*Ee,Z=q-(q-Ee),ne=Ee-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,Ot[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,Ot[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,Ot[2]=pe-(we-k)+(J-k),Ot[3]=we;const et=gr(4,Vi,4,Ot,hs);be=me*E,q=Tt*me,L=q-(q-me),te=me-L,q=Tt*E,Z=q-(q-E),ne=E-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=Me*S,q=Tt*Me,L=q-(q-Me),te=Me-L,q=Tt*S,Z=q-(q-S),ne=S-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,Ot[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,Ot[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,Ot[2]=pe-(we-k)+(J-k),Ot[3]=we;const de=gr(et,hs,4,Ot,ls);be=v*E,q=Tt*v,L=q-(q-v),te=v-L,q=Tt*E,Z=q-(q-E),ne=E-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=w*S,q=Tt*w,L=q-(q-w),te=w-L,q=Tt*S,Z=q-(q-S),ne=S-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,Ot[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,Ot[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,Ot[2]=pe-(we-k)+(J-k),Ot[3]=we;const Xe=gr(de,ls,4,Ot,cs);return cs[Xe-1]}function ho(h,s,a,l,f,o){const g=(s-o)*(a-f),v=(h-f)*(l-o),w=g-v;if(g===0||v===0||g>0!=v>0)return w;const S=Math.abs(g+v);return Math.abs(w)>=so*S?w:-uo(h,s,a,l,f,o,S)}function Or(h,s,a){const l=ho(h[0],h[1],s[0],s[1],a[0],a[1]);return l>0?-1:l<0?1:0}function gi(h,s){const a=h.point,l=s.point;return a[0]>l[0]?1:a[0]<l[0]?-1:a[1]!==l[1]?a[1]>l[1]?1:-1:lo(h,s,a)}function lo(h,s,a,l){return h.left!==s.left?h.left?1:-1:Or(a,h.otherEvent.point,s.otherEvent.point)!==0?h.isBelow(s.otherEvent.point)?-1:1:!h.isSubject&&s.isSubject?1:-1}function pi(h,s,a){const l=new qi(s,!1,h,h.isSubject),f=new qi(s,!0,h.otherEvent,h.isSubject);return Qt(h.point,h.otherEvent.point)&&console.warn("what is that, a collapsed segment?",h),l.contourId=f.contourId=h.contourId,gi(f,h.otherEvent)>0&&(h.otherEvent.left=!0,f.left=!1),h.otherEvent.otherEvent=f,h.otherEvent=l,a.push(f),a.push(l),a}function Vn(h,s){return h[0]*s[1]-h[1]*s[0]}function mr(h,s){return h[0]*s[0]+h[1]*s[1]}function co(h,s,a,l,f){const o=[s[0]-h[0],s[1]-h[1]],g=[l[0]-a[0],l[1]-a[1]];function v(ne,J,pe){return[ne[0]+J*pe[0],ne[1]+J*pe[1]]}const w=[a[0]-h[0],a[1]-h[1]];let S=Vn(o,g),E=S*S;const k=mr(o,o);if(E>0){const ne=Vn(w,g)/S;if(ne<0||ne>1)return null;const J=Vn(w,o)/S;return J<0||J>1?null:ne===0||ne===1?[v(h,ne,o)]:J===0||J===1?[v(a,J,g)]:[v(h,ne,o)]}if(S=Vn(w,o),E=S*S,E>0)return null;const q=mr(o,w)/k,L=q+mr(o,g)/k,te=Math.min(q,L),Z=Math.max(q,L);return te<=1&&Z>=0?te===1?[v(h,te>0?te:0,o)]:Z===0?[v(h,Z<1?Z:1,o)]:[v(h,te>0?te:0,o),v(h,Z<1?Z:1,o)]:null}function _r(h,s,a){const l=co(h.point,h.otherEvent.point,s.point,s.otherEvent.point),f=l?l.length:0;if(f===0||f===1&&(Qt(h.point,s.point)||Qt(h.otherEvent.point,s.otherEvent.point))||f===2&&h.isSubject===s.isSubject)return 0;if(f===1)return!Qt(h.point,l[0])&&!Qt(h.otherEvent.point,l[0])&&pi(h,l[0],a),!Qt(s.point,l[0])&&!Qt(s.otherEvent.point,l[0])&&pi(s,l[0],a),1;const o=[];let g=!1,v=!1;return Qt(h.point,s.point)?g=!0:gi(h,s)===1?o.push(s,h):o.push(h,s),Qt(h.otherEvent.point,s.otherEvent.point)?v=!0:gi(h.otherEvent,s.otherEvent)===1?o.push(s.otherEvent,h.otherEvent):o.push(h.otherEvent,s.otherEvent),g&&v||g?(s.type=Ws,h.type=s.inOut===h.inOut?Zs:Ks,g&&!v&&pi(o[1].otherEvent,o[0].point,a),2):v?(pi(o[0],o[1].point,a),3):o[0]!==o[3].otherEvent?(pi(o[0],o[1].point,a),pi(o[1],o[2].point,a),3):(pi(o[0],o[1].point,a),pi(o[3].otherEvent,o[2].point,a),3)}function fo(h,s){if(h===s)return 0;if(Or(h.point,h.otherEvent.point,s.point)!==0||Or(h.point,h.otherEvent.point,s.otherEvent.point)!==0)return Qt(h.point,s.point)?h.isBelow(s.otherEvent.point)?-1:1:h.point[0]===s.point[0]?h.point[1]<s.point[1]?-1:1:gi(h,s)===1?s.isAbove(h.point)?-1:1:h.isBelow(s.point)?-1:1;if(h.isSubject===s.isSubject){let a=h.point,l=s.point;if(a[0]===l[0]&&a[1]===l[1])return a=h.otherEvent.point,l=s.otherEvent.point,a[0]===l[0]&&a[1]===l[1]?0:h.contourId>s.contourId?1:-1}else return h.isSubject?-1:1;return gi(h,s)===1?1:-1}function po(h,s,a,l,f,o){const g=new Fr(fo),v=[],w=Math.min(l[2],f[2]);let S,E,k;for(;h.length!==0;){let q=h.pop();if(v.push(q),q.point[0]>w||o===Zn)break;if(q.left){E=S=g.insert(q),k=g.minNode(),S!==k?S=g.prev(S):S=null,E=g.next(E);const L=S?S.key:null;let te;if(on(q,L,o),E&&_r(q,E.key,h)===2&&(on(q,L,o),on(E.key,q,o)),S&&_r(S.key,q,h)===2){let Z=S;Z!==k?Z=g.prev(Z):Z=null,te=Z?Z.key:null,on(L,te,o),on(q,L,o)}}else q=q.otherEvent,E=S=g.find(q),S&&E&&(S!==k?S=g.prev(S):S=null,E=g.next(E),g.remove(q),E&&S&&_r(S.key,E.key,h))}return v}class go{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function mo(h){let s,a,l,f;const o=[];for(a=0,l=h.length;a<l;a++)s=h[a],(s.left&&s.inResult||!s.left&&s.otherEvent.inResult)&&o.push(s);let g=!1;for(;!g;)for(g=!0,a=0,l=o.length;a<l;a++)a+1<l&&gi(o[a],o[a+1])===1&&(f=o[a],o[a]=o[a+1],o[a+1]=f,g=!1);for(a=0,l=o.length;a<l;a++)s=o[a],s.otherPos=a;for(a=0,l=o.length;a<l;a++)s=o[a],s.left||(f=s.otherPos,s.otherPos=s.otherEvent.otherPos,s.otherEvent.otherPos=f);return o}function _o(h,s,a,l){let f=h+1,o=s[h].point,g;const v=s.length;for(f<v&&(g=s[f].point);f<v&&g[0]===o[0]&&g[1]===o[1];){if(a[f])f++;else return f;f<v&&(g=s[f].point)}for(f=h-1;a[f]&&f>l;)f--;return f}function vo(h,s,a){const l=new go;if(h.prevInResult!=null){const f=h.prevInResult,o=f.outputContourId;if(f.resultTransition>0){const v=s[o];if(v.holeOf!=null){const w=v.holeOf;s[w].holeIds.push(a),l.holeOf=w,l.depth=s[o].depth}else s[o].holeIds.push(a),l.holeOf=o,l.depth=s[o].depth+1}else l.holeOf=null,l.depth=s[o].depth}else l.holeOf=null,l.depth=0;return l}function yo(h){let s,a;const l=mo(h),f={},o=[];for(s=0,a=l.length;s<a;s++){if(f[s])continue;const g=o.length,v=vo(l[s],o,g),w=q=>{f[q]=!0,q<l.length&&l[q]&&(l[q].outputContourId=g)};let S=s,E=s;const k=l[s].point;for(v.points.push(k);w(S),S=l[S].otherPos,w(S),v.points.push(l[S].point),S=_o(S,l,f,E),!(S==E||S>=l.length||!l[S]););o.push(v)}return o}var Fn={exports:{}},fs;function xo(){if(fs)return Fn.exports;fs=1,Fn.exports=h,Fn.exports.default=h;function h(a,l){if(!(this instanceof h))return new h(a,l);if(this.data=a||[],this.length=this.data.length,this.compare=l||s,this.length>0)for(var f=(this.length>>1)-1;f>=0;f--)this._down(f)}function s(a,l){return a<l?-1:a>l?1:0}return h.prototype={push:function(a){this.data.push(a),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var a=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),a}},peek:function(){return this.data[0]},_up:function(a){for(var l=this.data,f=this.compare,o=l[a];a>0;){var g=a-1>>1,v=l[g];if(f(o,v)>=0)break;l[a]=v,a=g}l[a]=o},_down:function(a){for(var l=this.data,f=this.compare,o=this.length>>1,g=l[a];a<o;){var v=(a<<1)+1,w=v+1,S=l[v];if(w<this.length&&f(l[w],S)<0&&(v=w,S=l[w]),f(S,g)>=0)break;l[a]=S,a=v}l[a]=g}},Fn.exports}var bo=xo();const wo=Vr(bo),ds=Math.max,ps=Math.min;let Bn=0;function gs(h,s,a,l,f,o){let g,v,w,S,E,k;for(g=0,v=h.length-1;g<v;g++){if(w=h[g],S=h[g+1],E=new qi(w,!1,void 0,s),k=new qi(S,!1,E,s),E.otherEvent=k,w[0]===S[0]&&w[1]===S[1])continue;E.contourId=k.contourId=a,o||(E.isExteriorRing=!1,k.isExteriorRing=!1),gi(E,k)>0?k.left=!0:E.left=!0;const q=w[0],L=w[1];f[0]=ps(f[0],q),f[1]=ps(f[1],L),f[2]=ds(f[2],q),f[3]=ds(f[3],L),l.push(E),l.push(k)}}function So(h,s,a,l,f){const o=new wo(null,gi);let g,v,w,S,E,k;for(w=0,S=h.length;w<S;w++)for(g=h[w],E=0,k=g.length;E<k;E++)v=E===0,v&&Bn++,gs(g[E],!0,Bn,o,a,v);for(w=0,S=s.length;w<S;w++)for(g=s[w],E=0,k=g.length;E<k;E++)v=E===0,v&&Bn++,gs(g[E],!1,Bn,o,l,v);return o}const Kn=[];function Co(h,s,a){let l=null;return h.length*s.length===0&&(l=Kn),l}function Po(h,s,a,l,f){let o=null;return(a[0]>l[2]||l[0]>a[2]||a[1]>l[3]||l[1]>a[3])&&(o=Kn),o}function ko(h,s,a){typeof h[0][0][0]=="number"&&(h=[h]),typeof s[0][0][0]=="number"&&(s=[s]);let l=Co(h,s);if(l)return l===Kn?null:l;const f=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],g=So(h,s,f,o);if(l=Po(h,s,f,o),l)return l===Kn?null:l;const v=po(g,h,s,f,o,a),w=yo(v),S=[];for(let E=0;E<w.length;E++){let k=w[E];if(k.isExterior()){let q=[k.points];for(let L=0;L<k.holeIds.length;L++){let te=k.holeIds[L];q.push(w[te].points)}S.push(q)}}return S}function Io(h,s){return ko(h,s,Wn)}function Xn(h,s){const a=h[0]-s[0],l=h[1]-s[1];return a*a+l*l}function Eo(h){return{vertices:h.vertices,pieces:Array.from(h.pieces.entries()),edges:Array.from(h.edges.entries()),halfEdges:Array.from(h.halfEdges.entries()),boundary:h.boundary,borderPath:h.borderPath}}function Ys(h,s){let[a,l]=h,[f,o]=h;const g=v=>{a=Math.min(a,v[0]),l=Math.min(l,v[1]),f=Math.max(f,v[0]),o=Math.max(o,v[1])};for(const v of s)v.type==="line"?g(v.p):(g(v.p1),g(v.p2),g(v.p3));return[a,l,f,o]}function Qs(h,s){let a=1/0,l=1/0,f=-1/0,o=-1/0;const g=h.halfEdge;let v=s.halfEdges.get(g);if(!v)return h.bounds;const w=S=>{a=Math.min(a,S[0]),l=Math.min(l,S[1]),f=Math.max(f,S[0]),o=Math.max(o,S[1])};do{if(w(v.origin),v.segments){const S=Ys(v.origin,v.segments);w([S[0],S[1]]),w([S[2],S[3]])}v=s.halfEdges.get(v.next)}while(v&&v.id!==g);return[a,l,f,o]}const ms=100,$s=ms*ms;function Ao(h,s){let a=-1,l=$s;for(let f=0;f<h.vertices.length;f++){const o=Xn(h.vertices[f],s);o<l&&(l=o,a=f)}return a===-1?null:a}function To(h,s){let a=null,l=$s;for(const f of h.pieces.values()){const o=Xn(f.site,s);o<l&&(l=o,a=f.id)}return a}function zr(h){if(h.length===0)return[0,0,0,0];let s=h[0][0],a=h[0][1],l=s,f=a;for(let o=1;o<h.length;o++){const g=h[o];s=Math.min(s,g[0]),a=Math.min(a,g[1]),l=Math.max(l,g[0]),f=Math.max(f,g[1])}return[s,a,l,f]}function Mo(h,s){return Math.abs(h[0]-s[0])<1e-6&&Math.abs(h[1]-s[1])<1e-6}function Js(h,s,a,l){if(!h.tabs)return;const f=s.halfEdges.get(h.heLeft),o=s.halfEdges.get(h.heRight),g=f.origin,v=o.origin,w=[];let S=g;h.tabs.sort((E,k)=>E.position-k.position);for(const E of h.tabs){const k=E.position-E.size/2,q=[g[0]+(v[0]-g[0])*k,g[1]+(v[1]-g[1])*k];Math.hypot(q[0]-S[0],q[1]-S[1])>1e-6&&w.push({type:"line",p:q});const L=[g[0]+(v[0]-g[0])*(k+E.size),g[1]+(v[1]-g[1])*(k+E.size)],te=a.createTabSegments(q,L,E,l);w.push(...te),S=L}Math.hypot(v[0]-S[0],v[1]-S[1])>1e-6&&w.push({type:"line",p:v}),f.segments=w,o.segments=Lo(w,g),h.bounds=Ys(g,w)}function Lo(h,s){const a=[];for(let l=h.length-1;l>=0;l--){const f=h[l];let o=s;if(l>0){const g=h[l-1];o=g.type==="line"?g.p:g.p3}f.type==="line"?a.push({type:"line",p:o}):a.push({type:"bezier",p1:f.p2,p2:f.p1,p3:o})}return a}function Oo(h,s){const{p:a,radii:l,rotation:f,largeArc:o,sweep:g}=s,[v,w]=h,[S,E]=a,[k,q]=l;return eo({px:v,py:w,cx:S,cy:E,rx:k,ry:q,xAxisRotation:f,largeArcFlag:o?1:0,sweepFlag:g?1:0}).map(Z=>({type:"bezier",p1:[Z.x1,Z.y1],p2:[Z.x2,Z.y2],p3:[Z.x,Z.y]}))}function ea(h){const s=[];let a=[];if(h.length===0||h[0].type!=="move")return[];let l=[0,0];for(const f of h)switch(f.type){case"move":a.length>0&&s.push(a),l=f.p,a=[l];break;case"line":a.push(f.p),l=f.p;break;case"bezier":{const{p1:o,p2:g,p3:v}=f,S=new ft([...l,...o,...g,...v]).getLUT(100);a.push(...S.slice(1).map(E=>[E.x,E.y])),l=v;break}case"arc":{const o=Oo(l,f);let g=l;for(const v of o){const S=new ft([...g,...v.p1,...v.p2,...v.p3]).getLUT(100);a.push(...S.slice(1).map(E=>[E.x,E.y])),g=v.p3}l=f.p;break}}return a.length>0&&s.push(a),s}function Br(h,s){if(s.length>0&&s[0].type!=="move")throw new Error("Boundary path must start with a 'move' command.");const a=ea(s);let l=0;for(const f of a)Ro(h,f)&&l++;return l%2===1}function zo(h){return Array.isArray(h[0])&&Array.isArray(h[0][0])&&typeof h[0][0][0]=="number"}function No(h,s){const a=[h.map(o=>[o[0],o[1]])],l=[s.map(o=>[o[0],o[1]])],f=Io(a,l);return!f||f.length===0?null:zo(f)?f:f.map(o=>o[0].map(g=>[g[0],g[1]]))}function Ro(h,s){const[a,l]=h;let f=!1;for(let o=0,g=s.length-1;o<s.length;g=o++){const[v,w]=s[o],[S,E]=s[g];w>l!=E>l&&a<(S-v)*(l-w)/(E-w)+v&&(f=!f)}return f}function Do(h,s,a){const l=[];for(const o of h)a.vertices.find(g=>Mo(g,o))||a.vertices.push(o);for(const o of h){const g={id:Hs(),origin:o,twin:-1,next:-1,prev:-1,piece:s};l.push(g)}const f=l.length;for(let o=0;o<f;o++){const g=(o+1)%f,v=(o+f-1)%f;l[o].next=l[g].id,l[o].prev=l[v].id}return l.forEach(o=>a.halfEdges.set(o.id,o)),l}function ta(h,s,a,l){const f=(g,v)=>`${g[0]},${g[1]}-${v[0]},${v[1]}`,o=h.length;for(let g=0;g<o;g++){const v=h[g],w=v.origin,S=s.halfEdges.get(v.next).origin,E=f(S,w),k=a.get(E),q=Hs();let L;if(k!==void 0){const te=s.halfEdges.get(k);v.twin=te.id,te.twin=v.id,L={id:q,heLeft:te.id,heRight:v.id,bounds:zr([w,S])},a.delete(E)}else{const te=f(w,S);if(a.set(te,v.id),l(w,S))L={id:q,heLeft:v.id,heRight:-1,bounds:zr([w,S])},s.boundary.push(q);else continue}s.edges.set(q,L)}}function ia(h){return function(){let s=h+=1831565813;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}}async function Yn(h){const{bounds:s,pieceSize:a,border:l}=h,{pointConfig:f,pieceConfig:o,placementConfig:g,tabConfig:v}=h;console.log(`rebuilding puzzle with dimensions ${s.width}x${s.height}, piece size ${a}`);const w=vn.create(l,s,f),S=yn.create(l,s,o),E=xn.create(l,s,g),k=Ti.create(l,s,v),q=h.seed??new Date().getTime(),L=ia(q),te=h.seedPoints??w.generatePoints({width:s.width,height:s.height,pieceSize:a,random:L,border:l});console.log(`${h.seedPoints?"Using":"Generated"} ${te.length} points`);const Z=S.generatePieces(te,{random:L,pieceSize:a,border:l,bounds:s});if(console.log(`Generated ${Z.pieces.size} pieces`),!h.skipTabs){E.placeTabs({topology:Z,random:L});for(const J of Z.edges.values())J.heRight!==-1&&J.tabs&&J.tabs.length>0&&Js(J,Z,k,L)}return{created:new Date().toISOString(),seed:q,width:s.width,height:s.height,pieceSize:a,pointConfig:f,pieceConfig:o,placementConfig:g,tabConfig:v,seedPoints:te,vertices:Z.vertices,boundary:Z.boundary,borderPath:Z.borderPath,pieces:Z.pieces,edges:Z.edges,halfEdges:Z.halfEdges}}async function Vo(h,s,a){const l=[...h.seedPoints];let f=0;for(const o of h.pieces.values()){if(o.id===s){l[f]=a;break}f++}return Yn({bounds:{width:h.width,height:h.height},border:h.borderPath,pieceSize:h.pieceSize,pointConfig:h.pointConfig,pieceConfig:h.pieceConfig,placementConfig:h.placementConfig,tabConfig:h.tabConfig,seed:h.seed,seedPoints:l,skipTabs:!1})}function Un(h,s,a,l){const f=s.getContext("2d");if(!f){console.error("Could not get 2D context from canvas");return}f.clearRect(0,0,s.width,s.height);{f.strokeStyle=a,f.lineWidth=1,f.beginPath();for(const o of h.edges.values()){const g=h.halfEdges.get(o.heLeft);if(g)if(f.moveTo(g.origin[0],g.origin[1]),g.segments&&g.segments.length>0)for(const v of g.segments)switch(v.type){case"bezier":f.bezierCurveTo(v.p1[0],v.p1[1],v.p2[0],v.p2[1],v.p3[0],v.p3[1]);break;case"line":f.lineTo(v.p[0],v.p[1]);break}else{let v;g.twin!==-1?v=h.halfEdges.get(g.twin).origin:v=h.halfEdges.get(g.next).origin,f.lineTo(v[0],v[1])}}f.stroke()}if(h.problems&&h.problems.length>0){f.lineWidth=2,f.strokeStyle="red";for(const o of h.problems){const[g,v]=o;f.beginPath(),f.arc(g,v,8,0,2*Math.PI),f.stroke()}}if(l){f.fillStyle=l;for(const o of h.pieces.values()){const[g,v]=o.site;f.beginPath(),f.arc(g,v,3,0,2*Math.PI),f.fill()}}}function Nr(h,s){return[{type:"move",p:[0,0]},{type:"line",p:[h,0]},{type:"line",p:[h,s]},{type:"line",p:[0,s]},{type:"line",p:[0,0]}]}function Fo(h){const s=h/2,a=s;return[{type:"move",p:[0,a]},{type:"arc",p:[h,a],radii:[s,s],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,a],radii:[s,s],rotation:0,largeArc:!1,sweep:!0}]}function Bo(h,s){const a=h/2,l=s/2;return[{type:"move",p:[0,l]},{type:"arc",p:[h,l],radii:[a,l],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,l],radii:[a,l],rotation:0,largeArc:!1,sweep:!0}]}function Uo(h,s,a){const l=Math.min(h,s)/2,f=Math.min(a,l);return[{type:"move",p:[f,0]},{type:"line",p:[h-f,0]},{type:"arc",p:[h,f],radii:[f,f],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[h,s-f]},{type:"arc",p:[h-f,s],radii:[f,f],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[f,s]},{type:"arc",p:[0,s-f],radii:[f,f],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[0,f]},{type:"arc",p:[f,0],radii:[f,f],rotation:0,largeArc:!1,sweep:!0}]}function qo(h,s,a){if(s<0||s>=h.vertices.length){console.warn("moveVertex called with invalid vertex index:",s);return}const l=h.vertices[s];h.vertices[s]=a;const f=[];for(const v of h.halfEdges.values())v.origin[0]===l[0]&&v.origin[1]===l[1]&&f.push(v);const o=new Set,g=[a[0]-l[0],a[1]-l[1]];for(const v of f){v.origin=a,o.add(v.piece);const w=h.halfEdges.get(v.prev);if(w?.segments){const S=w.segments[w.segments.length-1];S.type==="line"?S.p=a:(S.p3=a,S.p1=[S.p1[0]+g[0],S.p1[1]+g[1]],S.p2=[S.p2[0]+g[0],S.p2[1]+g[1]]),o.add(w.piece)}}Ho(h,s);for(const v of o){const w=h.pieces.get(v);w&&(w.bounds=Qs(w,h))}}function Ho(h,s){const{seed:a,width:l,height:f,placementConfig:o,tabConfig:g}=h,v=ia(a),w=Nr(l,f),S={width:l,height:f},E=xn.create(w,S,o),k=Ti.create(w,S,g),q=new Set,L=h.vertices[s],te=new Map;for(const ne of h.edges.values())te.set(ne.heLeft,ne),ne.heRight!==-1&&te.set(ne.heRight,ne);for(const ne of h.halfEdges.values()){const J=h.halfEdges.get(ne.next)?.origin;if(ne.origin===L||J===L){const be=te.get(ne.id);be&&q.add(be)}}E.updateTabPlacements(Array.from(q),{topology:h,random:v});const Z=new Set;for(const ne of q)if(ne.heRight!==-1){const pe=h.halfEdges.get(ne.heLeft);pe&&(pe.segments=void 0,Z.add(h.pieces.get(pe.piece)));const ce=h.halfEdges.get(ne.heRight);ce&&(ce.segments=void 0,Z.add(h.pieces.get(ce.piece))),Js(ne,h,k,v)}for(const ne of Z)ne.bounds=Qs(ne,h)}const _s=50,vs=5,ys=vs*vs,Go=()=>{const h={canvas:null,isDragging:!1,draggedVertexId:-1,draggedSeedPointId:-1,lastRegenerationTime:0,pendingRegeneration:null,documentMouseMove:null,documentMouseUp:null},s=(E,k)=>{if(k.pointColor){for(const q of k.puzzle.pieces.values())if(Xn(q.site,E)<ys)return!0}for(const q of k.puzzle.vertices)if(Xn(q,E)<ys)return!0;return!1},a=E=>{if(!h.canvas)return[0,0];const k=h.canvas.getBoundingClientRect();if(E instanceof TouchEvent){if(E.changedTouches.length>0){const q=E.changedTouches[0];return[q.clientX-k.left,q.clientY-k.top]}}else return[E.clientX-k.left,E.clientY-k.top];return[0,0]},l=(E,k)=>{if(k.pointColor){const L=To(k.puzzle,E);if(L!==null)return{type:"seedPoint",id:L}}const q=Ao(k.puzzle,E);return q!==null?{type:"vertex",id:q}:{type:"none"}},f=(E,k)=>{if(E.redraw=!1,h.isDragging)return;const q=a(E),L=s(q,k);h.canvas&&(h.canvas.style.cursor=L?"grab":"default")},o=(E,k,q)=>{const L=[...E.puzzle.seedPoints];let te=0;for(const Z of E.puzzle.pieces.values()){if(Z.id===k){L[te]=q;break}te++}Yn({bounds:{width:E.puzzle.width,height:E.puzzle.height},border:E.puzzle.borderPath,pieceSize:E.puzzle.pieceSize,pointConfig:E.puzzle.pointConfig,pieceConfig:E.puzzle.pieceConfig,placementConfig:E.puzzle.placementConfig,tabConfig:E.puzzle.tabConfig,seed:E.puzzle.seed,seedPoints:L,skipTabs:!0}).then(Z=>{h.draggedSeedPointId===k&&Un(Z,h.canvas,E.color,E.pointColor)}).catch(Z=>{console.error("Failed to regenerate preview:",Z)})},g=(E,k)=>{if(E.redraw=!1,E instanceof TouchEvent&&E.touches.length>1){h.isDragging=!1,h.draggedVertexId=-1,h.draggedSeedPointId=-1;return}if(E instanceof MouseEvent&&E.button!==0)return;const q=a(E),L=l(q,k);L.type==="vertex"?h.draggedVertexId=L.id:L.type==="seedPoint"&&(h.draggedSeedPointId=L.id),E instanceof MouseEvent&&(h.draggedVertexId>=0||h.draggedSeedPointId>=0)&&(h.documentMouseMove=te=>{const Z=te;Z.redraw=!1,v(Z,k)},h.documentMouseUp=te=>{const Z=te;Z.redraw=!1,w(Z,k)},document.addEventListener("mousemove",h.documentMouseMove),document.addEventListener("mouseup",h.documentMouseUp))},v=(E,k)=>{E.redraw=!1;const q=a(E);if(h.draggedVertexId>=0){h.isDragging=!0,E.preventDefault(),h.canvas&&(h.canvas.style.cursor="grabbing"),qo(k.puzzle,h.draggedVertexId,q),Un(k.puzzle,h.canvas,k.color,k.pointColor);return}if(h.draggedSeedPointId>=0){h.isDragging=!0,E.preventDefault(),h.canvas&&(h.canvas.style.cursor="grabbing");const L=performance.now();if(L-h.lastRegenerationTime<_s){h.pendingRegeneration&&clearTimeout(h.pendingRegeneration),h.pendingRegeneration=window.setTimeout(()=>{o(k,h.draggedSeedPointId,q)},_s);return}h.lastRegenerationTime=L,o(k,h.draggedSeedPointId,q)}},w=(E,k)=>{E.redraw=!1,h.pendingRegeneration&&(clearTimeout(h.pendingRegeneration),h.pendingRegeneration=null);const q=h.draggedVertexId>=0&&h.isDragging,L=h.draggedSeedPointId>=0&&h.isDragging;if(q&&(E.preventDefault(),k.onPuzzleChanged(k.puzzle)),L){E.preventDefault();const te=h.draggedSeedPointId,Z=a(E);k.onSeedPointMoved&&k.onSeedPointMoved(te,Z)}h.documentMouseMove&&(document.removeEventListener("mousemove",h.documentMouseMove),h.documentMouseMove=null),h.documentMouseUp&&(document.removeEventListener("mouseup",h.documentMouseUp),h.documentMouseUp=null),h.canvas&&(h.canvas.style.cursor="default"),h.isDragging=!1,h.draggedVertexId=-1,h.draggedSeedPointId=-1,h.lastRegenerationTime=0},S="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";return{oncreate:({dom:E,attrs:k})=>{if(h.canvas=E.querySelector("canvas.puzzle"),!h.canvas){console.log("couldn't get canvas element");return}k.isDirty||Un(k.puzzle,h.canvas,k.color,k.pointColor)},onupdate:({attrs:E})=>{if(!h.canvas){console.log("couldn't get canvas element");return}E.isDirty||Un(E.puzzle,h.canvas,E.color,E.pointColor)},onremove:()=>{h.documentMouseMove&&(document.removeEventListener("mousemove",h.documentMouseMove),h.documentMouseMove=null),h.documentMouseUp&&(document.removeEventListener("mouseup",h.documentMouseUp),h.documentMouseUp=null)},view:({attrs:E})=>oe(".puzzle-stack",[oe("img.background",{width:E.width,height:E.height,src:E.imageUrl??S}),oe("canvas.puzzle",{width:E.width,height:E.height,style:{width:`${E.width}px`,height:`${E.height}px`,touchAction:"manipulation"},onmousedown:k=>g(k,E),onmousemove:k=>{f(k,E),v(k,E)},onmouseup:k=>w(k,E),ontouchstart:k=>g(k,E),ontouchmove:k=>v(k,E),ontouchend:k=>w(k,E),ontouchcancel:k=>w(k,E)})])}};function jo(h,s,a,l="black"){const o=[];for(const w of h.edges.values()){const S=h.halfEdges.get(w.heLeft);if(S)if(o.push(`M ${S.origin[0].toFixed(3)} ${S.origin[1].toFixed(3)}`),S.segments)for(const E of S.segments)switch(E.type){case"bezier":o.push(`C ${E.p1[0].toFixed(3)} ${E.p1[1].toFixed(3)}, ${E.p2[0].toFixed(3)} ${E.p2[1].toFixed(3)}, ${E.p3[0].toFixed(3)} ${E.p3[1].toFixed(3)}`);break;case"line":o.push(`L ${E.p[0].toFixed(3)} ${E.p[1].toFixed(3)}`);break}else{let E;S.twin!==-1?E=h.halfEdges.get(S.twin).origin:E=h.halfEdges.get(S.next).origin,o.push(`L ${E[0].toFixed(3)} ${E[1].toFixed(3)}`)}}const g=o.join(" ");return`
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg
  width="${s}"
  height="${a}"
  viewBox="0 0 ${s} ${a}"
  xmlns="http://www.w3.org/2000/svg"
  version="1.1"
>
  <path
    d="${g}"
    fill="none"
    stroke="${l}"
    stroke-width="1"
    vector-effect="non-scaling-stroke"
  />
</svg>`.trim().replace(/\r\n/g,`
`)}function Wo(h,s="puzzle.svg"){const a=new Blob([h],{type:"image/svg+xml"}),l=URL.createObjectURL(a),f=document.createElement("a");f.href=l,f.download=s,f.hidden=!0,document.body.appendChild(f),f.click(),document.body.removeChild(f),setTimeout(()=>URL.revokeObjectURL(l),100)}const Zo={view:({attrs:h})=>oe("wa-button.download-svg",{size:"small",onclick:()=>{const s=jo(h.puzzle,h.width,h.height,h.color);Wo(s,h.filename??"puzzle.svg")}},"Download SVG")},Ko={view:({attrs:h})=>{const s=h.progressPercent!==void 0&&h.progressPercent<100,a=!s&&h.problems!==void 0&&h.problems==0,l=!s&&h.problems!==void 0&&h.problems>0;return oe(".geometry-check-indicator",[oe(".label","Geometry Check:"),oe("wa-tooltip",{for:"check-geometry-now"},"Check geometry now"),oe("wa-button#check-geometry-now",{variant:"neutral",appearance:"plain",size:"small",disabled:s,onclick:f=>{f.redraw=!1,h.onCheckRequested?.()}},oe("wa-icon",{library:"material",name:"editor_choice",label:"Check geometry now"})),oe("wa-tooltip",{for:"auto-check-geometry"},"Check geometry after every change"),oe("wa-checkbox#auto-check-geometry",{checked:h.autoCheck,disabled:s,size:"small",onchange:f=>{f.redraw=!1;const o=f.target;h.onAutocheckChanged?.(o.checked)}},"auto check"),s&&oe("wa-progress-bar",{label:"Geometry check progress",value:h.progressPercent??0}),a&&oe("wa-badge",{variant:"success",pill:!0},"OK"),l&&oe("wa-badge",{variant:"danger",pill:!0},`${h.problems} issue${h.problems===1?"":"s"}`)])}};function Xo(h,s,a=800){if(h<=a)return{width:h,height:s};const l=s/h;return{width:a,height:Math.round(a*l)}}const Yo=()=>{const h={inputElement:void 0,imageLoaded:!1,imageName:""};return{view:({attrs:s})=>[oe("wa-button.upload-button",{size:"small",disabled:s.disabled===!0,onclick:()=>{h.inputElement&&h.inputElement.click()}},s.label??"Upload Image"),oe("input[type=file]",{style:{display:"none"},accept:"image/*",oncreate:({dom:a})=>{h.inputElement=a},onchange:a=>{if(a.redraw=!1,h.inputElement){const l=h.inputElement.files?.[0];l?.type.startsWith("image/")&&createImageBitmap(l).then(f=>{const{width:o,height:g}=Xo(f.width,f.height),v=URL.createObjectURL(l);f.close(),h.imageName=l.name,s.onUpload(v,l.name,o,g),h.imageLoaded=!0}).catch(f=>{console.error("could not create a bitmap image: ",f)})}}}),oe("span.background-image-label",h.imageName),h.imageLoaded&&oe("wa-icon.clear-button",{library:"material",name:"close",label:"Clear background image",onclick:a=>{a.redraw=!1,!s.disabled&&(h.imageName="",h.imageLoaded=!1,s.onClear())}},"Clear")]}},na=()=>({view:({attrs:h})=>oe("wa-checkbox.boolean-input",{hint:h.config.helpText,disabled:h.disabled,checked:h.value,onchange:s=>{const l=s.target.checked;h.onChange(l)}},h.config.label)}),Gn=()=>({view:({attrs:h})=>oe("wa-input.number-input",{label:h.config.label,hint:h.config.helpText,type:"number",inputmode:"numeric",size:"small",disabled:h.disabled,value:h.value,min:h.config.min,max:h.config.max,onchange:s=>{const a=s.target,l=parseFloat(a.value??"");h.onChange(isNaN(l)?void 0:l)}})}),Qo=()=>({view:({attrs:h})=>oe("wa-slider.range-input",{label:h.config.label,hint:h.config.helpText,disabled:h.disabled,value:h.value,min:h.config.min,max:h.config.max,step:h.config.step,"with-tooltip":!0,onchange:s=>{const l=s.target.value;h.onChange(isNaN(l)?void 0:l)}})}),$o=()=>({view:({attrs:h})=>oe("wa-input.string-input",{label:h.config.label,hint:h.config.helpText,type:"text",inputmode:"text",size:"small",disabled:h.disabled,value:h.value,onchange:s=>{const l=s.target.value??"";h.onChange(l.length>0?l:void 0)}})}),Jo=()=>({view:({attrs:h})=>{const s=h.registry.getAvailableGenerators();return oe(".generator-picker",oe("wa-tab-group",{active:h.generator,"onwa-tab-show":a=>{const l=a.detail.name;h.generator!==l&&h.onGeneratorChange(l)}},[...s.map(a=>{const l=h.registry.getUIMetadata(a.name),f=oe("wa-tab",{panel:a.name},a.displayName),o=oe("wa-tab-panel",{name:a.name},oe(".controls",[l?.description?oe("p",l.description):null,...l?.controls.map(g=>{switch(g.type){case"range":return oe(Qo,{config:g,value:h.config?.[g.name]??g.defaultValue,onChange:v=>{h.onConfigChange(g.name,v)}});case"boolean":return oe(na,{config:g,value:(h.config?.[g.name]??g.defaultValue)===!0,onChange:v=>{h.onConfigChange(g.name,v)}});case"number":return oe(Gn,{config:g,value:h.config?.[g.name]??g.defaultValue,onChange:v=>{h.onConfigChange(g.name,v)}});case"string":return oe($o,{config:g,value:h.config?.[g.name]??g.defaultValue,onChange:v=>{h.onConfigChange(g.name,v)}})}})??[],!l?.description&&l?.controls.length==0?oe("p","No controls for this strategy."):null]));return[f,o]})]))}}),xs=[["Square","1:1",1],["Classic Photo","5:4",5/4],["Standard Photo","4:3",4/3],["35mm/DSLR","3:2",3/2],["Widescreen","16:9",16/9],["UltraWide","21:9",21/9],["Panorama","2:1",2/1],["Instagram Portrait","4:5",4/5],["Classic Portrait","3:4",3/4],["DSLR Portrait","2:3",2/3],["Phone Portrait","9:16",9/16],["Tall Poster","9:21",9/21],["Tall Panorama","1:2",1/2]],eu={view:({attrs:h})=>{const s=!xs.some(([,,l])=>l===h.ratio),a=xs.map(([l,f,o])=>oe("wa-option",{value:String(o)},`${l} [${f}]`));return s&&a.unshift(oe("wa-option",{value:"custom"},"Custom")),oe(".aspect-ratio-picker",[oe("wa-select",{label:"Aspect Ratio",size:"small",disabled:h.disabled,value:s?"custom":String(h.ratio),onchange:l=>{l.redraw=!1;const o=l.target.value;o&&o!=="custom"&&h.onChange(Number(o))}},a),oe("wa-slider",{min:.25,max:4,step:.01,"with-tooltip":!0,size:"small",disabled:h.disabled,value:h.ratio,onchange:l=>{l.redraw=!1;const f=l.target;h.onChange(f.value)}})])}},bs={view:({attrs:h})=>oe("wa-color-picker",{label:h.label,value:h.color,size:h.size??"medium",format:"rgb",onchange:s=>{s.redraw=!1;const a=s.target;h.onUpdate(a.value??"")}})},tu=[["rectangle","Rectangle"],["circle","Circle"],["ellipse","Ellipse"],["rounded-rect","Rounded Rectangle"]],iu={view:({attrs:h})=>{const s=tu.map(([a,l])=>oe("wa-option",{value:a},l));return oe("wa-select",{label:"Border Shape",size:"small",disabled:h.disabled,value:h.shape,onchange:a=>{a.redraw=!1;const f=a.target.value;f&&h.onChange(f)}},s)}};var vr,ws;function ra(){if(ws)return vr;ws=1;function h(a){var l=a.length,f=1,o=new Array(l),g;for(g=l;g>0;g--)o[g-1]=f,f=f*a[g-1];return{stride:o,data:new Uint32Array(f)}}function s(a){var l=a.length,f=1,o=new Array(l),g=[],v,w;for(v=l;v>0;v--)o[v-1]=f,f=f*a[v-1];for(w=0;w<f;w++)g.push([]);return{stride:o,data:g}}return vr={integer:h,array:s},vr}var yr,Ss;function sa(){if(Ss)return yr;Ss=1,yr=h;function h(s,a){var l=new Array(s),f=Math.floor(s/2)<<1,o=0,g,v,w,S,E;for(E=0;E<f;E+=2)g=-2*Math.log(a()),v=Math.sqrt(g),w=2*Math.PI*a(),o+=g,l[E]=v*Math.cos(w),l[E+1]=v*Math.sin(w);if(s%2){var k=Math.sqrt(-2*Math.log(a()))*Math.cos(2*Math.PI*a());l[s-1]=k,o+=Math.pow(k,2)}for(S=1/Math.sqrt(o),E=0;E<s;++E)l[E]*=S;return l}return yr}var xr,Cs;function nu(){return Cs||(Cs=1,xr=function(s,a){s=s||1,a=a||2;for(var l=s*2+1,f=Math.pow(l,a)-1,o=new Array(f),g=0;g<f;g++)for(var v=o[g]=new Array(a),w=g<f/2?g:g+1,S=1;S<=a;S++){var E=w%Math.pow(l,S);v[S-1]=E/Math.pow(l,S-1)-s,w-=E}return o}),xr}var br,Ps;function aa(){if(Ps)return br;Ps=1;var h=nu();function s(f){var o=h(2,f),g=[],v;for(o=o.filter(function(w){for(var S=0,E=0;E<f;E++)S+=Math.pow(Math.max(0,Math.abs(w[E])-1),2);return S<f}),v=0;v<f;v++)g.push(0);return o.push(g),o.sort(function(w,S){var E=0,k=0,q;for(q=0;q<f;q++)E+=Math.pow(w[q],2),k+=Math.pow(S[q],2);return E<k?-1:E>k?1:0}),o}var a={};function l(f){return a[f]||(a[f]=s(f)),a[f]}return br=l,br}var wr,ks;function ru(){if(ks)return wr;ks=1;var h=ra().integer,s=sa(),a=aa();function l(o,g){for(var v=0,w=0;w<o.length;w++)v+=Math.pow(o[w]-g[w],2);return v}function f(o,g){if(typeof o.distanceFunction=="function")throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=o.shape,this.minDistance=o.minDistance,this.maxDistance=o.maxDistance||o.minDistance*2,this.maxTries=Math.ceil(Math.max(1,o.tries||30)),this.rng=g||Math.random;for(var v=0,w=0;w<this.shape.length;w++)v=Math.max(v,this.shape[w]);var S=Math.max(1,v/128|0),E=1e-14*S;this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+E,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=a(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var w=0;w<this.dimension;w++)this.gridShape.push(Math.ceil(this.shape[w]/this.cellSize));this.grid=h(this.gridShape)}return f.prototype.shape=null,f.prototype.dimension=null,f.prototype.minDistance=null,f.prototype.maxDistance=null,f.prototype.minDistancePlusEpsilon=null,f.prototype.squaredMinDistance=null,f.prototype.deltaDistance=null,f.prototype.cellSize=null,f.prototype.maxTries=null,f.prototype.rng=null,f.prototype.neighbourhood=null,f.prototype.currentPoint=null,f.prototype.processList=null,f.prototype.samplePoints=null,f.prototype.gridShape=null,f.prototype.grid=null,f.prototype.addRandomPoint=function(){for(var o=new Array(this.dimension),g=0;g<this.dimension;g++)o[g]=this.rng()*this.shape[g];return this.directAddPoint(o)},f.prototype.addPoint=function(o){var g,v=!0;if(o.length===this.dimension)for(g=0;g<this.dimension&&v;g++)v=o[g]>=0&&o[g]<this.shape[g];else v=!1;return v?this.directAddPoint(o):null},f.prototype.directAddPoint=function(o){var g=0,v=this.grid.stride,w;for(this.processList.push(o),this.samplePoints.push(o),w=0;w<this.dimension;w++)g+=(o[w]/this.cellSize|0)*v[w];return this.grid.data[g]=this.samplePoints.length,o},f.prototype.inNeighbourhood=function(o){var g=this.dimension,v=this.grid.stride,w,S,E,k,q;for(w=0;w<this.neighbourhood.length;w++){for(S=0,E=0;E<g;E++){if(k=(o[E]/this.cellSize|0)+this.neighbourhood[w][E],k<0||k>=this.gridShape[E]){S=-1;break}S+=k*v[E]}if(S!==-1&&this.grid.data[S]!==0&&(q=this.samplePoints[this.grid.data[S]-1],l(o,q)<this.squaredMinDistance))return!0}return!1},f.prototype.next=function(){for(var o,g,v,w,S,E,k;this.processList.length>0;){for(this.currentPoint===null&&(this.currentPoint=this.processList.shift()),w=this.currentPoint,o=0;o<this.maxTries;o++){for(E=!0,v=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),this.dimension===2?(g=this.rng()*Math.PI*2,S=[Math.cos(g),Math.sin(g)]):S=s(this.dimension,this.rng),k=0;E&&k<this.dimension;k++)S[k]=w[k]+S[k]*v,E=S[k]>=0&&S[k]<this.shape[k];if(E&&!this.inNeighbourhood(S))return this.directAddPoint(S)}o===this.maxTries&&(this.currentPoint=null)}return null},f.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},f.prototype.getAllPoints=function(){return this.samplePoints},f.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")},f.prototype.reset=function(){var o=this.grid.data,g=0;for(g=0;g<o.length;g++)o[g]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0},wr=f,wr}var Sr,Is;function su(){if(Is)return Sr;Is=1;var h=ra().array,s=sa(),a=aa();function l(o,g){for(var v=0,w=0;w<o.length;w++)v+=Math.pow(o[w]-g[w],2);return Math.sqrt(v)}function f(o,g){if(typeof o.distanceFunction!="function")throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=o.shape,this.minDistance=o.minDistance,this.maxDistance=o.maxDistance||o.minDistance*2,this.maxTries=Math.ceil(Math.max(1,o.tries||30)),this.distanceFunction=o.distanceFunction,this.bias=Math.max(0,Math.min(1,o.bias||0)),this.rng=g||Math.random;for(var v=0,w=0;w<this.shape.length;w++)v=Math.max(v,this.shape[w]);var S=Math.max(1,v/128|0),E=1e-14*S;this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+E,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=a(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var w=0;w<this.dimension;w++)this.gridShape.push(Math.ceil(this.shape[w]/this.cellSize));this.grid=h(this.gridShape)}return f.prototype.shape=null,f.prototype.dimension=null,f.prototype.minDistance=null,f.prototype.maxDistance=null,f.prototype.minDistancePlusEpsilon=null,f.prototype.deltaDistance=null,f.prototype.cellSize=null,f.prototype.maxTries=null,f.prototype.distanceFunction=null,f.prototype.bias=null,f.prototype.rng=null,f.prototype.neighbourhood=null,f.prototype.currentPoint=null,f.prototype.currentDistance=null,f.prototype.processList=null,f.prototype.samplePoints=null,f.prototype.sampleDistance=null,f.prototype.gridShape=null,f.prototype.grid=null,f.prototype.addRandomPoint=function(){for(var o=new Array(this.dimension),g=0;g<this.dimension;g++)o[g]=this.rng()*this.shape[g];return this.directAddPoint(o)},f.prototype.addPoint=function(o){var g,v=!0;if(o.length===this.dimension)for(g=0;g<this.dimension&&v;g++)v=o[g]>=0&&o[g]<this.shape[g];else v=!1;return v?this.directAddPoint(o):null},f.prototype.directAddPoint=function(o){var g=0,v=this.grid.stride,w=this.samplePoints.length,S;for(this.processList.push(w),this.samplePoints.push(o),this.sampleDistance.push(this.distanceFunction(o)),S=0;S<this.dimension;S++)g+=(o[S]/this.cellSize|0)*v[S];return this.grid.data[g].push(w),o},f.prototype.inNeighbourhood=function(o){var g=this.dimension,v=this.grid.stride,w,S,E,k,q,L,te=this.distanceFunction(o);for(w=0;w<this.neighbourhood.length;w++){for(S=0,E=0;E<g;E++){if(k=(o[E]/this.cellSize|0)+this.neighbourhood[w][E],k<0||k>=this.gridShape[E]){S=-1;break}S+=k*v[E]}if(S!==-1&&this.grid.data[S].length>0)for(var Z=0;Z<this.grid.data[S].length;Z++){q=this.samplePoints[this.grid.data[S][Z]],L=this.sampleDistance[this.grid.data[S][Z]];var ne=Math.min(L,te),J=Math.max(L,te),pe=ne+(J-ne)*this.bias;if(l(o,q)<this.minDistance+this.deltaDistance*pe)return!0}}return!1},f.prototype.next=function(){for(var o,g,v,w,S,E,k,q;this.processList.length>0;){if(this.currentPoint===null){var L=this.processList.shift();this.currentPoint=this.samplePoints[L],this.currentDistance=this.sampleDistance[L]}for(w=this.currentPoint,S=this.currentDistance,o=0;o<this.maxTries;o++){for(k=!0,v=this.minDistancePlusEpsilon+this.deltaDistance*(S+(1-S)*this.bias),this.dimension===2?(g=this.rng()*Math.PI*2,E=[Math.cos(g),Math.sin(g)]):E=s(this.dimension,this.rng),q=0;k&&q<this.dimension;q++)E[q]=w[q]+E[q]*v,k=E[q]>=0&&E[q]<this.shape[q];if(k&&!this.inNeighbourhood(E))return this.directAddPoint(E)}o===this.maxTries&&(this.currentPoint=null)}return null},f.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},f.prototype.getAllPoints=function(){return this.samplePoints},f.prototype.getAllPointsWithDistance=function(){var o=new Array(this.samplePoints.length),g=0,v=0,w;for(g=0;g<this.samplePoints.length;g++){for(w=new Array(this.dimension+1),v=0;v<this.dimension;v++)w[v]=this.samplePoints[g][v];w[this.dimension]=this.sampleDistance[g],o[g]=w}return o},f.prototype.reset=function(){var o=this.grid.data,g=0;for(g=0;g<o.length;g++)o[g]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0},Sr=f,Sr}var Cr,Es;function au(){if(Es)return Cr;Es=1;var h=ru(),s=su();function a(l,f){this.shape=l.shape,typeof l.distanceFunction=="function"?this.implementation=new s(l,f):this.implementation=new h(l,f)}return a.prototype.implementation=null,a.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()},a.prototype.addPoint=function(l){return this.implementation.addPoint(l)},a.prototype.next=function(){return this.implementation.next()},a.prototype.fill=function(){return this.implementation.fill()},a.prototype.getAllPoints=function(){return this.implementation.getAllPoints()},a.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()},a.prototype.reset=function(){this.implementation.reset()},Cr=a,Cr}var ou=au();const uu=Vr(ou),Ur="PoissonPointGenerator",hu={name:Ur,displayName:"Poisson",description:"Generate seed points using Poisson disk sampling. The algorithm produces points that are tightly-packed, but no closer to each other than a specified minimum distance (the piece size), resulting in a natural, organic look.",sortHint:1,controls:[]},lu=(h,s,a)=>({generatePoints(f){const{width:o,height:g,pieceSize:v,random:w,border:S}=f;return new uu({shape:[o,g],minDistance:v,tries:20},w).fill().filter(L=>Br(L,S))}});vn.register(Ur,lu,hu);const si=11102230246251565e-32,Mt=134217729,cu=(3+8*si)*si;function Pr(h,s,a,l,f){let o,g,v,w,S=s[0],E=l[0],k=0,q=0;E>S==E>-S?(o=S,S=s[++k]):(o=E,E=l[++q]);let L=0;if(k<h&&q<a)for(E>S==E>-S?(g=S+o,v=o-(g-S),S=s[++k]):(g=E+o,v=o-(g-E),E=l[++q]),o=g,v!==0&&(f[L++]=v);k<h&&q<a;)E>S==E>-S?(g=o+S,w=g-o,v=o-(g-w)+(S-w),S=s[++k]):(g=o+E,w=g-o,v=o-(g-w)+(E-w),E=l[++q]),o=g,v!==0&&(f[L++]=v);for(;k<h;)g=o+S,w=g-o,v=o-(g-w)+(S-w),S=s[++k],o=g,v!==0&&(f[L++]=v);for(;q<a;)g=o+E,w=g-o,v=o-(g-w)+(E-w),E=l[++q],o=g,v!==0&&(f[L++]=v);return(o!==0||L===0)&&(f[L++]=o),L}function fu(h,s){let a=s[0];for(let l=1;l<h;l++)a+=s[l];return a}function wn(h){return new Float64Array(h)}const du=(3+16*si)*si,pu=(2+12*si)*si,gu=(9+64*si)*si*si,Fi=wn(4),As=wn(8),Ts=wn(12),Ms=wn(16),zt=wn(4);function mu(h,s,a,l,f,o,g){let v,w,S,E,k,q,L,te,Z,ne,J,pe,ce,be,he,O,ye,we;const me=h-f,Ee=a-f,Me=s-o,Pe=l-o;be=me*Pe,q=Mt*me,L=q-(q-me),te=me-L,q=Mt*Pe,Z=q-(q-Pe),ne=Pe-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=Me*Ee,q=Mt*Me,L=q-(q-Me),te=Me-L,q=Mt*Ee,Z=q-(q-Ee),ne=Ee-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,Fi[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,Fi[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,Fi[2]=pe-(we-k)+(J-k),Fi[3]=we;let De=fu(4,Fi),Se=pu*g;if(De>=Se||-De>=Se||(k=h-me,v=h-(me+k)+(k-f),k=a-Ee,S=a-(Ee+k)+(k-f),k=s-Me,w=s-(Me+k)+(k-o),k=l-Pe,E=l-(Pe+k)+(k-o),v===0&&w===0&&S===0&&E===0)||(Se=gu*g+cu*Math.abs(De),De+=me*E+Pe*v-(Me*S+Ee*w),De>=Se||-De>=Se))return De;be=v*Pe,q=Mt*v,L=q-(q-v),te=v-L,q=Mt*Pe,Z=q-(q-Pe),ne=Pe-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=w*Ee,q=Mt*w,L=q-(q-w),te=w-L,q=Mt*Ee,Z=q-(q-Ee),ne=Ee-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,zt[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,zt[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,zt[2]=pe-(we-k)+(J-k),zt[3]=we;const et=Pr(4,Fi,4,zt,As);be=me*E,q=Mt*me,L=q-(q-me),te=me-L,q=Mt*E,Z=q-(q-E),ne=E-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=Me*S,q=Mt*Me,L=q-(q-Me),te=Me-L,q=Mt*S,Z=q-(q-S),ne=S-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,zt[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,zt[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,zt[2]=pe-(we-k)+(J-k),zt[3]=we;const de=Pr(et,As,4,zt,Ts);be=v*E,q=Mt*v,L=q-(q-v),te=v-L,q=Mt*E,Z=q-(q-E),ne=E-Z,he=te*ne-(be-L*Z-te*Z-L*ne),O=w*S,q=Mt*w,L=q-(q-w),te=w-L,q=Mt*S,Z=q-(q-S),ne=S-Z,ye=te*ne-(O-L*Z-te*Z-L*ne),J=he-ye,k=he-J,zt[0]=he-(J+k)+(k-ye),pe=be+J,k=pe-be,ce=be-(pe-k)+(J-k),J=ce-O,k=ce-J,zt[1]=ce-(J+k)+(k-O),we=pe+J,k=we-pe,zt[2]=pe-(we-k)+(J-k),zt[3]=we;const Xe=Pr(de,Ts,4,zt,Ms);return Ms[Xe-1]}function qn(h,s,a,l,f,o){const g=(s-o)*(a-f),v=(h-f)*(l-o),w=g-v,S=Math.abs(g+v);return Math.abs(w)>=du*S?w:-mu(h,s,a,l,f,o,S)}const Ls=Math.pow(2,-52),Hn=new Uint32Array(512);class Qn{static from(s,a=bu,l=wu){const f=s.length,o=new Float64Array(f*2);for(let g=0;g<f;g++){const v=s[g];o[2*g]=a(v),o[2*g+1]=l(v)}return new Qn(o)}constructor(s){const a=s.length>>1;if(a>0&&typeof s[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=s;const l=Math.max(2*a-5,0);this._triangles=new Uint32Array(l*3),this._halfedges=new Int32Array(l*3),this._hashSize=Math.ceil(Math.sqrt(a)),this._hullPrev=new Uint32Array(a),this._hullNext=new Uint32Array(a),this._hullTri=new Uint32Array(a),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(a),this._dists=new Float64Array(a),this.update()}update(){const{coords:s,_hullPrev:a,_hullNext:l,_hullTri:f,_hullHash:o}=this,g=s.length>>1;let v=1/0,w=1/0,S=-1/0,E=-1/0;for(let me=0;me<g;me++){const Ee=s[2*me],Me=s[2*me+1];Ee<v&&(v=Ee),Me<w&&(w=Me),Ee>S&&(S=Ee),Me>E&&(E=Me),this._ids[me]=me}const k=(v+S)/2,q=(w+E)/2;let L,te,Z;for(let me=0,Ee=1/0;me<g;me++){const Me=kr(k,q,s[2*me],s[2*me+1]);Me<Ee&&(L=me,Ee=Me)}const ne=s[2*L],J=s[2*L+1];for(let me=0,Ee=1/0;me<g;me++){if(me===L)continue;const Me=kr(ne,J,s[2*me],s[2*me+1]);Me<Ee&&Me>0&&(te=me,Ee=Me)}let pe=s[2*te],ce=s[2*te+1],be=1/0;for(let me=0;me<g;me++){if(me===L||me===te)continue;const Ee=yu(ne,J,pe,ce,s[2*me],s[2*me+1]);Ee<be&&(Z=me,be=Ee)}let he=s[2*Z],O=s[2*Z+1];if(be===1/0){for(let Me=0;Me<g;Me++)this._dists[Me]=s[2*Me]-s[0]||s[2*Me+1]-s[1];Ui(this._ids,this._dists,0,g-1);const me=new Uint32Array(g);let Ee=0;for(let Me=0,Pe=-1/0;Me<g;Me++){const De=this._ids[Me],Se=this._dists[De];Se>Pe&&(me[Ee++]=De,Pe=Se)}this.hull=me.subarray(0,Ee),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(qn(ne,J,pe,ce,he,O)<0){const me=te,Ee=pe,Me=ce;te=Z,pe=he,ce=O,Z=me,he=Ee,O=Me}const ye=xu(ne,J,pe,ce,he,O);this._cx=ye.x,this._cy=ye.y;for(let me=0;me<g;me++)this._dists[me]=kr(s[2*me],s[2*me+1],ye.x,ye.y);Ui(this._ids,this._dists,0,g-1),this._hullStart=L;let we=3;l[L]=a[Z]=te,l[te]=a[L]=Z,l[Z]=a[te]=L,f[L]=0,f[te]=1,f[Z]=2,o.fill(-1),o[this._hashKey(ne,J)]=L,o[this._hashKey(pe,ce)]=te,o[this._hashKey(he,O)]=Z,this.trianglesLen=0,this._addTriangle(L,te,Z,-1,-1,-1);for(let me=0,Ee,Me;me<this._ids.length;me++){const Pe=this._ids[me],De=s[2*Pe],Se=s[2*Pe+1];if(me>0&&Math.abs(De-Ee)<=Ls&&Math.abs(Se-Me)<=Ls||(Ee=De,Me=Se,Pe===L||Pe===te||Pe===Z))continue;let et=0;for(let it=0,Kt=this._hashKey(De,Se);it<this._hashSize&&(et=o[(Kt+it)%this._hashSize],!(et!==-1&&et!==l[et]));it++);et=a[et];let de=et,Xe;for(;Xe=l[de],qn(De,Se,s[2*de],s[2*de+1],s[2*Xe],s[2*Xe+1])>=0;)if(de=Xe,de===et){de=-1;break}if(de===-1)continue;let st=this._addTriangle(de,Pe,l[de],-1,-1,f[de]);f[Pe]=this._legalize(st+2),f[de]=st,we++;let Ve=l[de];for(;Xe=l[Ve],qn(De,Se,s[2*Ve],s[2*Ve+1],s[2*Xe],s[2*Xe+1])<0;)st=this._addTriangle(Ve,Pe,Xe,f[Pe],-1,f[Ve]),f[Pe]=this._legalize(st+2),l[Ve]=Ve,we--,Ve=Xe;if(de===et)for(;Xe=a[de],qn(De,Se,s[2*Xe],s[2*Xe+1],s[2*de],s[2*de+1])<0;)st=this._addTriangle(Xe,Pe,de,-1,f[de],f[Xe]),this._legalize(st+2),f[Xe]=st,l[de]=de,we--,de=Xe;this._hullStart=a[Pe]=de,l[de]=a[Ve]=Pe,l[Pe]=Ve,o[this._hashKey(De,Se)]=Pe,o[this._hashKey(s[2*de],s[2*de+1])]=de}this.hull=new Uint32Array(we);for(let me=0,Ee=this._hullStart;me<we;me++)this.hull[me]=Ee,Ee=l[Ee];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(s,a){return Math.floor(_u(s-this._cx,a-this._cy)*this._hashSize)%this._hashSize}_legalize(s){const{_triangles:a,_halfedges:l,coords:f}=this;let o=0,g=0;for(;;){const v=l[s],w=s-s%3;if(g=w+(s+2)%3,v===-1){if(o===0)break;s=Hn[--o];continue}const S=v-v%3,E=w+(s+1)%3,k=S+(v+2)%3,q=a[g],L=a[s],te=a[E],Z=a[k];if(vu(f[2*q],f[2*q+1],f[2*L],f[2*L+1],f[2*te],f[2*te+1],f[2*Z],f[2*Z+1])){a[s]=Z,a[v]=q;const J=l[k];if(J===-1){let ce=this._hullStart;do{if(this._hullTri[ce]===k){this._hullTri[ce]=s;break}ce=this._hullPrev[ce]}while(ce!==this._hullStart)}this._link(s,J),this._link(v,l[g]),this._link(g,k);const pe=S+(v+1)%3;o<Hn.length&&(Hn[o++]=pe)}else{if(o===0)break;s=Hn[--o]}}return g}_link(s,a){this._halfedges[s]=a,a!==-1&&(this._halfedges[a]=s)}_addTriangle(s,a,l,f,o,g){const v=this.trianglesLen;return this._triangles[v]=s,this._triangles[v+1]=a,this._triangles[v+2]=l,this._link(v,f),this._link(v+1,o),this._link(v+2,g),this.trianglesLen+=3,v}}function _u(h,s){const a=h/(Math.abs(h)+Math.abs(s));return(s>0?3-a:1+a)/4}function kr(h,s,a,l){const f=h-a,o=s-l;return f*f+o*o}function vu(h,s,a,l,f,o,g,v){const w=h-g,S=s-v,E=a-g,k=l-v,q=f-g,L=o-v,te=w*w+S*S,Z=E*E+k*k,ne=q*q+L*L;return w*(k*ne-Z*L)-S*(E*ne-Z*q)+te*(E*L-k*q)<0}function yu(h,s,a,l,f,o){const g=a-h,v=l-s,w=f-h,S=o-s,E=g*g+v*v,k=w*w+S*S,q=.5/(g*S-v*w),L=(S*E-v*k)*q,te=(g*k-w*E)*q;return L*L+te*te}function xu(h,s,a,l,f,o){const g=a-h,v=l-s,w=f-h,S=o-s,E=g*g+v*v,k=w*w+S*S,q=.5/(g*S-v*w),L=h+(S*E-v*k)*q,te=s+(g*k-w*E)*q;return{x:L,y:te}}function Ui(h,s,a,l){if(l-a<=20)for(let f=a+1;f<=l;f++){const o=h[f],g=s[o];let v=f-1;for(;v>=a&&s[h[v]]>g;)h[v+1]=h[v--];h[v+1]=o}else{const f=a+l>>1;let o=a+1,g=l;un(h,f,o),s[h[a]]>s[h[l]]&&un(h,a,l),s[h[o]]>s[h[l]]&&un(h,o,l),s[h[a]]>s[h[o]]&&un(h,a,o);const v=h[o],w=s[v];for(;;){do o++;while(s[h[o]]<w);do g--;while(s[h[g]]>w);if(g<o)break;un(h,o,g)}h[a+1]=h[g],h[g]=v,l-o+1>=g-a?(Ui(h,s,o,l),Ui(h,s,a,g-1)):(Ui(h,s,a,g-1),Ui(h,s,o,l))}}function un(h,s,a){const l=h[s];h[s]=h[a],h[a]=l}function bu(h){return h[0]}function wu(h){return h[1]}const Os=1e-6;class Ei{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(s,a){this._+=`M${this._x0=this._x1=+s},${this._y0=this._y1=+a}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(s,a){this._+=`L${this._x1=+s},${this._y1=+a}`}arc(s,a,l){s=+s,a=+a,l=+l;const f=s+l,o=a;if(l<0)throw new Error("negative radius");this._x1===null?this._+=`M${f},${o}`:(Math.abs(this._x1-f)>Os||Math.abs(this._y1-o)>Os)&&(this._+="L"+f+","+o),l&&(this._+=`A${l},${l},0,1,1,${s-l},${a}A${l},${l},0,1,1,${this._x1=f},${this._y1=o}`)}rect(s,a,l,f){this._+=`M${this._x0=this._x1=+s},${this._y0=this._y1=+a}h${+l}v${+f}h${-l}Z`}value(){return this._||null}}class Rr{constructor(){this._=[]}moveTo(s,a){this._.push([s,a])}closePath(){this._.push(this._[0].slice())}lineTo(s,a){this._.push([s,a])}value(){return this._.length?this._:null}}class Su{constructor(s,[a,l,f,o]=[0,0,960,500]){if(!((f=+f)>=(a=+a))||!((o=+o)>=(l=+l)))throw new Error("invalid bounds");this.delaunay=s,this._circumcenters=new Float64Array(s.points.length*2),this.vectors=new Float64Array(s.points.length*2),this.xmax=f,this.xmin=a,this.ymax=o,this.ymin=l,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:s,hull:a,triangles:l},vectors:f}=this;let o,g;const v=this.circumcenters=this._circumcenters.subarray(0,l.length/3*2);for(let Z=0,ne=0,J=l.length,pe,ce;Z<J;Z+=3,ne+=2){const be=l[Z]*2,he=l[Z+1]*2,O=l[Z+2]*2,ye=s[be],we=s[be+1],me=s[he],Ee=s[he+1],Me=s[O],Pe=s[O+1],De=me-ye,Se=Ee-we,et=Me-ye,de=Pe-we,Xe=(De*de-Se*et)*2;if(Math.abs(Xe)<1e-9){if(o===void 0){o=g=0;for(const Ve of a)o+=s[Ve*2],g+=s[Ve*2+1];o/=a.length,g/=a.length}const st=1e9*Math.sign((o-ye)*de-(g-we)*et);pe=(ye+Me)/2-st*de,ce=(we+Pe)/2+st*et}else{const st=1/Xe,Ve=De*De+Se*Se,it=et*et+de*de;pe=ye+(de*Ve-Se*it)*st,ce=we+(De*it-et*Ve)*st}v[ne]=pe,v[ne+1]=ce}let w=a[a.length-1],S,E=w*4,k,q=s[2*w],L,te=s[2*w+1];f.fill(0);for(let Z=0;Z<a.length;++Z)w=a[Z],S=E,k=q,L=te,E=w*4,q=s[2*w],te=s[2*w+1],f[S+2]=f[E]=L-te,f[S+3]=f[E+1]=q-k}render(s){const a=s==null?s=new Ei:void 0,{delaunay:{halfedges:l,inedges:f,hull:o},circumcenters:g,vectors:v}=this;if(o.length<=1)return null;for(let E=0,k=l.length;E<k;++E){const q=l[E];if(q<E)continue;const L=Math.floor(E/3)*2,te=Math.floor(q/3)*2,Z=g[L],ne=g[L+1],J=g[te],pe=g[te+1];this._renderSegment(Z,ne,J,pe,s)}let w,S=o[o.length-1];for(let E=0;E<o.length;++E){w=S,S=o[E];const k=Math.floor(f[S]/3)*2,q=g[k],L=g[k+1],te=w*4,Z=this._project(q,L,v[te+2],v[te+3]);Z&&this._renderSegment(q,L,Z[0],Z[1],s)}return a&&a.value()}renderBounds(s){const a=s==null?s=new Ei:void 0;return s.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),a&&a.value()}renderCell(s,a){const l=a==null?a=new Ei:void 0,f=this._clip(s);if(f===null||!f.length)return;a.moveTo(f[0],f[1]);let o=f.length;for(;f[0]===f[o-2]&&f[1]===f[o-1]&&o>1;)o-=2;for(let g=2;g<o;g+=2)(f[g]!==f[g-2]||f[g+1]!==f[g-1])&&a.lineTo(f[g],f[g+1]);return a.closePath(),l&&l.value()}*cellPolygons(){const{delaunay:{points:s}}=this;for(let a=0,l=s.length/2;a<l;++a){const f=this.cellPolygon(a);f&&(f.index=a,yield f)}}cellPolygon(s){const a=new Rr;return this.renderCell(s,a),a.value()}_renderSegment(s,a,l,f,o){let g;const v=this._regioncode(s,a),w=this._regioncode(l,f);v===0&&w===0?(o.moveTo(s,a),o.lineTo(l,f)):(g=this._clipSegment(s,a,l,f,v,w))&&(o.moveTo(g[0],g[1]),o.lineTo(g[2],g[3]))}contains(s,a,l){return a=+a,a!==a||(l=+l,l!==l)?!1:this.delaunay._step(s,a,l)===s}*neighbors(s){const a=this._clip(s);if(a)for(const l of this.delaunay.neighbors(s)){const f=this._clip(l);if(f){e:for(let o=0,g=a.length;o<g;o+=2)for(let v=0,w=f.length;v<w;v+=2)if(a[o]===f[v]&&a[o+1]===f[v+1]&&a[(o+2)%g]===f[(v+w-2)%w]&&a[(o+3)%g]===f[(v+w-1)%w]){yield l;break e}}}}_cell(s){const{circumcenters:a,delaunay:{inedges:l,halfedges:f,triangles:o}}=this,g=l[s];if(g===-1)return null;const v=[];let w=g;do{const S=Math.floor(w/3);if(v.push(a[S*2],a[S*2+1]),w=w%3===2?w-2:w+1,o[w]!==s)break;w=f[w]}while(w!==g&&w!==-1);return v}_clip(s){if(s===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const a=this._cell(s);if(a===null)return null;const{vectors:l}=this,f=s*4;return this._simplify(l[f]||l[f+1]?this._clipInfinite(s,a,l[f],l[f+1],l[f+2],l[f+3]):this._clipFinite(s,a))}_clipFinite(s,a){const l=a.length;let f=null,o,g,v=a[l-2],w=a[l-1],S,E=this._regioncode(v,w),k,q=0;for(let L=0;L<l;L+=2)if(o=v,g=w,v=a[L],w=a[L+1],S=E,E=this._regioncode(v,w),S===0&&E===0)k=q,q=0,f?f.push(v,w):f=[v,w];else{let te,Z,ne,J,pe;if(S===0){if((te=this._clipSegment(o,g,v,w,S,E))===null)continue;[Z,ne,J,pe]=te}else{if((te=this._clipSegment(v,w,o,g,E,S))===null)continue;[J,pe,Z,ne]=te,k=q,q=this._edgecode(Z,ne),k&&q&&this._edge(s,k,q,f,f.length),f?f.push(Z,ne):f=[Z,ne]}k=q,q=this._edgecode(J,pe),k&&q&&this._edge(s,k,q,f,f.length),f?f.push(J,pe):f=[J,pe]}if(f)k=q,q=this._edgecode(f[0],f[1]),k&&q&&this._edge(s,k,q,f,f.length);else if(this.contains(s,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return f}_clipSegment(s,a,l,f,o,g){const v=o<g;for(v&&([s,a,l,f,o,g]=[l,f,s,a,g,o]);;){if(o===0&&g===0)return v?[l,f,s,a]:[s,a,l,f];if(o&g)return null;let w,S,E=o||g;E&8?(w=s+(l-s)*(this.ymax-a)/(f-a),S=this.ymax):E&4?(w=s+(l-s)*(this.ymin-a)/(f-a),S=this.ymin):E&2?(S=a+(f-a)*(this.xmax-s)/(l-s),w=this.xmax):(S=a+(f-a)*(this.xmin-s)/(l-s),w=this.xmin),o?(s=w,a=S,o=this._regioncode(s,a)):(l=w,f=S,g=this._regioncode(l,f))}}_clipInfinite(s,a,l,f,o,g){let v=Array.from(a),w;if((w=this._project(v[0],v[1],l,f))&&v.unshift(w[0],w[1]),(w=this._project(v[v.length-2],v[v.length-1],o,g))&&v.push(w[0],w[1]),v=this._clipFinite(s,v))for(let S=0,E=v.length,k,q=this._edgecode(v[E-2],v[E-1]);S<E;S+=2)k=q,q=this._edgecode(v[S],v[S+1]),k&&q&&(S=this._edge(s,k,q,v,S),E=v.length);else this.contains(s,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(v=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return v}_edge(s,a,l,f,o){for(;a!==l;){let g,v;switch(a){case 5:a=4;continue;case 4:a=6,g=this.xmax,v=this.ymin;break;case 6:a=2;continue;case 2:a=10,g=this.xmax,v=this.ymax;break;case 10:a=8;continue;case 8:a=9,g=this.xmin,v=this.ymax;break;case 9:a=1;continue;case 1:a=5,g=this.xmin,v=this.ymin;break}(f[o]!==g||f[o+1]!==v)&&this.contains(s,g,v)&&(f.splice(o,0,g,v),o+=2)}return o}_project(s,a,l,f){let o=1/0,g,v,w;if(f<0){if(a<=this.ymin)return null;(g=(this.ymin-a)/f)<o&&(w=this.ymin,v=s+(o=g)*l)}else if(f>0){if(a>=this.ymax)return null;(g=(this.ymax-a)/f)<o&&(w=this.ymax,v=s+(o=g)*l)}if(l>0){if(s>=this.xmax)return null;(g=(this.xmax-s)/l)<o&&(v=this.xmax,w=a+(o=g)*f)}else if(l<0){if(s<=this.xmin)return null;(g=(this.xmin-s)/l)<o&&(v=this.xmin,w=a+(o=g)*f)}return[v,w]}_edgecode(s,a){return(s===this.xmin?1:s===this.xmax?2:0)|(a===this.ymin?4:a===this.ymax?8:0)}_regioncode(s,a){return(s<this.xmin?1:s>this.xmax?2:0)|(a<this.ymin?4:a>this.ymax?8:0)}_simplify(s){if(s&&s.length>4){for(let a=0;a<s.length;a+=2){const l=(a+2)%s.length,f=(a+4)%s.length;(s[a]===s[l]&&s[l]===s[f]||s[a+1]===s[l+1]&&s[l+1]===s[f+1])&&(s.splice(l,2),a-=2)}s.length||(s=null)}return s}}const Cu=2*Math.PI,Bi=Math.pow;function Pu(h){return h[0]}function ku(h){return h[1]}function Iu(h){const{triangles:s,coords:a}=h;for(let l=0;l<s.length;l+=3){const f=2*s[l],o=2*s[l+1],g=2*s[l+2];if((a[g]-a[f])*(a[o+1]-a[f+1])-(a[o]-a[f])*(a[g+1]-a[f+1])>1e-10)return!1}return!0}function Eu(h,s,a){return[h+Math.sin(h+s)*a,s+Math.cos(h-s)*a]}class qr{static from(s,a=Pu,l=ku,f){return new qr("length"in s?Au(s,a,l,f):Float64Array.from(Tu(s,a,l,f)))}constructor(s){this._delaunator=new Qn(s),this.inedges=new Int32Array(s.length/2),this._hullIndex=new Int32Array(s.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const s=this._delaunator,a=this.points;if(s.hull&&s.hull.length>2&&Iu(s)){this.collinear=Int32Array.from({length:a.length/2},(q,L)=>L).sort((q,L)=>a[2*q]-a[2*L]||a[2*q+1]-a[2*L+1]);const w=this.collinear[0],S=this.collinear[this.collinear.length-1],E=[a[2*w],a[2*w+1],a[2*S],a[2*S+1]],k=1e-8*Math.hypot(E[3]-E[1],E[2]-E[0]);for(let q=0,L=a.length/2;q<L;++q){const te=Eu(a[2*q],a[2*q+1],k);a[2*q]=te[0],a[2*q+1]=te[1]}this._delaunator=new Qn(a)}else delete this.collinear;const l=this.halfedges=this._delaunator.halfedges,f=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,g=this.inedges.fill(-1),v=this._hullIndex.fill(-1);for(let w=0,S=l.length;w<S;++w){const E=o[w%3===2?w-2:w+1];(l[w]===-1||g[E]===-1)&&(g[E]=w)}for(let w=0,S=f.length;w<S;++w)v[f[w]]=w;f.length<=2&&f.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=f[0],g[f[0]]=1,f.length===2&&(g[f[1]]=0,this.triangles[1]=f[1],this.triangles[2]=f[1]))}voronoi(s){return new Su(this,s)}*neighbors(s){const{inedges:a,hull:l,_hullIndex:f,halfedges:o,triangles:g,collinear:v}=this;if(v){const k=v.indexOf(s);k>0&&(yield v[k-1]),k<v.length-1&&(yield v[k+1]);return}const w=a[s];if(w===-1)return;let S=w,E=-1;do{if(yield E=g[S],S=S%3===2?S-2:S+1,g[S]!==s)return;if(S=o[S],S===-1){const k=l[(f[s]+1)%l.length];k!==E&&(yield k);return}}while(S!==w)}find(s,a,l=0){if(s=+s,s!==s||(a=+a,a!==a))return-1;const f=l;let o;for(;(o=this._step(l,s,a))>=0&&o!==l&&o!==f;)l=o;return o}_step(s,a,l){const{inedges:f,hull:o,_hullIndex:g,halfedges:v,triangles:w,points:S}=this;if(f[s]===-1||!S.length)return(s+1)%(S.length>>1);let E=s,k=Bi(a-S[s*2],2)+Bi(l-S[s*2+1],2);const q=f[s];let L=q;do{let te=w[L];const Z=Bi(a-S[te*2],2)+Bi(l-S[te*2+1],2);if(Z<k&&(k=Z,E=te),L=L%3===2?L-2:L+1,w[L]!==s)break;if(L=v[L],L===-1){if(L=o[(g[s]+1)%o.length],L!==te&&Bi(a-S[L*2],2)+Bi(l-S[L*2+1],2)<k)return L;break}}while(L!==q);return E}render(s){const a=s==null?s=new Ei:void 0,{points:l,halfedges:f,triangles:o}=this;for(let g=0,v=f.length;g<v;++g){const w=f[g];if(w<g)continue;const S=o[g]*2,E=o[w]*2;s.moveTo(l[S],l[S+1]),s.lineTo(l[E],l[E+1])}return this.renderHull(s),a&&a.value()}renderPoints(s,a){a===void 0&&(!s||typeof s.moveTo!="function")&&(a=s,s=null),a=a==null?2:+a;const l=s==null?s=new Ei:void 0,{points:f}=this;for(let o=0,g=f.length;o<g;o+=2){const v=f[o],w=f[o+1];s.moveTo(v+a,w),s.arc(v,w,a,0,Cu)}return l&&l.value()}renderHull(s){const a=s==null?s=new Ei:void 0,{hull:l,points:f}=this,o=l[0]*2,g=l.length;s.moveTo(f[o],f[o+1]);for(let v=1;v<g;++v){const w=2*l[v];s.lineTo(f[w],f[w+1])}return s.closePath(),a&&a.value()}hullPolygon(){const s=new Rr;return this.renderHull(s),s.value()}renderTriangle(s,a){const l=a==null?a=new Ei:void 0,{points:f,triangles:o}=this,g=o[s*=3]*2,v=o[s+1]*2,w=o[s+2]*2;return a.moveTo(f[g],f[g+1]),a.lineTo(f[v],f[v+1]),a.lineTo(f[w],f[w+1]),a.closePath(),l&&l.value()}*trianglePolygons(){const{triangles:s}=this;for(let a=0,l=s.length/3;a<l;++a)yield this.trianglePolygon(a)}trianglePolygon(s){const a=new Rr;return this.renderTriangle(s,a),a.value()}}function Au(h,s,a,l){const f=h.length,o=new Float64Array(f*2);for(let g=0;g<f;++g){const v=h[g];o[g*2]=s.call(l,v,g,h),o[g*2+1]=a.call(l,v,g,h)}return o}function*Tu(h,s,a,l){let f=0;for(const o of h)yield s.call(l,o,f,h),yield a.call(l,o,f,h),++f}function oa(h){return{originalBorder:h,flattenedPolygon:ea(h)[0]}}function Mu(h){if(h.length===0)return[0,0];const s=h.reduce((a,l)=>[a[0]+l[0],a[1]+l[1]],[0,0]);return[s[0]/h.length,s[1]/h.length]}function ua(h,s,a){const l={id:h,site:Mu(s),halfEdge:-1,bounds:zr(s)},f=Do(s,h,a);return f.length>0&&(l.halfEdge=f[0].id),l}function ha(h,s){const l=h.map(o=>Br(o,s.originalBorder)).filter(Boolean).length;return l===0?null:l===h.length?h:No(h,s.flattenedPolygon)?.[0]??null}const Hr="VoronoiPieceGenerator",Lu={name:Hr,displayName:"Voronoi",description:"Construct pieces by building a Voronoi diagram from the seed points. Each piece consists of all area of the plane closer to its seed point than any other seed point. In practice, this creates irregular polygons with 3-8 sides.",sortHint:1,controls:[]};function Ou(h){return`${h[0].toPrecision(7)},${h[1].toPrecision(7)}`}function zs(h,s){const l=s.flattenedPolygon;for(let f=0;f<l.length;f++){const o=l[f],g=l[(f+1)%l.length];if(zu(h,o,g)<.001)return!0}return!1}function zu(h,s,a){const[l,f]=h,[o,g]=s,[v,w]=a,S=v-o,E=w-g,k=S*S+E*E;if(k===0)return Math.hypot(l-o,f-g);let q=((l-o)*S+(f-g)*E)/k;q=Math.max(0,Math.min(1,q));const L=o+q*S,te=g+q*E;return Math.hypot(l-L,f-te)}const Nu=(h,s,a)=>{const{width:l,height:f}=s,o=oa(h);return{generatePieces(v,w){const{border:S}=w;console.log(`VoronoiPieceGenerator using dimensions ${l}x${f}`);const k=qr.from(v).voronoi([0,0,l,f]),q={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:S},L=new Map;let te=0;for(let ne=0;ne<v.length;ne++){const J=v[ne],pe=k.cellPolygon(ne);if(!pe)continue;const ce=ha(pe,o);if(!ce)continue;const be=te++,he=ua(be,ce,q);he.site=J,q.pieces.set(be,he);const O=[];let ye=he.halfEdge;if(ye!==-1){const we=ye;do{const me=q.halfEdges.get(ye);O.push(me),ye=me.next}while(ye!==we)}ta(O,q,L,(we,me)=>zs(we,o)&&zs(me,o))}const Z=new Map;for(const ne of q.halfEdges.values()){const J=Ou(ne.origin);Z.has(J)||Z.set(J,ne.origin)}return q.vertices=Array.from(Z.values()),q}}};yn.register(Hr,Nu,Lu);const $n="SimpleTabPlacementStrategy",Ru={name:$n,displayName:"Simple",description:"Creates a single tab in the center of each edge with a random orientation.",sortHint:1,controls:[{type:"range",name:"tabSize",label:"Tab Size",optional:!0,min:.01,max:1,step:.01,defaultValue:.5,helpText:"The width of the tab as a fraction of the edge length"},{type:"number",name:"minEdgeLength",label:"Minimum Edge Length",optional:!0,defaultValue:15,helpText:"Edges shorter than this value will not have a tab"},{type:"number",name:"maxTabSize",label:"Maximum Tab Size",helpText:"Maximum width of a generated tab"}]};function Ns(h,s,a,l){if(h.tabs=void 0,!(h.heRight!==-1))return;const o=s.halfEdges.get(h.heLeft),g=s.halfEdges.get(h.heRight);if(!o||!g)return;const v=o.origin,w=g.origin,S=Math.hypot(w[0]-v[0],w[1]-v[1]);if(S>=a.minEdgeLength){let E=a.tabSize;a.maxTabSize&&S*E>a.maxTabSize&&(E=a.maxTabSize/S);const k={position:.5,size:E,convex:l()>.5};h.tabs=[k]}}const Du=(h,s,a)=>{const{tabSize:l=.5,minEdgeLength:f=0,maxTabSize:o}=a,g={tabSize:l,minEdgeLength:f,maxTabSize:o};return{placeTabs(v){const{topology:w,random:S}=v;for(const E of w.edges.values())Ns(E,w,g,S)},updateTabPlacements(v,w){const{topology:S,random:E}=w;for(const k of v)Ns(k,S,g,E)}}};xn.register($n,Du,Ru);const Gr="TraditionalTabGenerator",Vu={name:Gr,displayName:"Traditional",description:"Creates a traditional rounded tab for each (internal) piece edge.",sortHint:1,controls:[{type:"range",name:"jitter",label:"Randomness",defaultValue:8,min:0,max:100,step:1,helpText:"Adds randomness to the tab shape. 0 means completely uniform tabs"},{type:"range",name:"heightToWidthRatio",label:"Tab Height",defaultValue:50,min:5,max:100,step:5,helpText:"The height of the tab as a percent of its width"}]};function Fu(h,s,a,l,f,o=!1){const g=s[0]-h[0],v=s[1]-h[1],w=Math.hypot(g,v);if(w===0)return console.warn("Edge has zero length"),[];const S=[g/w,v/w],E=[-S[1],S[0]],k=(Pe,De)=>[h[0]+(S[0]*Pe+E[0]*De)*w,h[1]+(S[1]*Pe+E[1]*De)*w],q=a/100,L=()=>(f()*2-1)*q,te=L(),Z=L(),ne=L(),J=L(),pe=L(),ce=.1625,be=o?-1:1,he=l,O=he/3,we=[[0,0],[.2,te*O],[.5+Z+J,be*(-O+ne*he)],[.5-ce+Z,be*(O+ne*he)],[.5-2*ce+Z-J,be*(he+ne*he)],[.5+2*ce+Z-J,be*(he+ne*he)],[.5+ce+Z,be*(O+ne*he)],[.5+Z+J,be*(-O+ne*he)],[.8,pe*O],[1,0]].map(([Pe,De])=>k(Pe,De)),me={type:"bezier",p1:we[1],p2:we[2],p3:we[3]},Ee={type:"bezier",p1:we[4],p2:we[5],p3:we[6]},Me={type:"bezier",p1:we[7],p2:we[8],p3:we[9]};return[me,Ee,Me]}const Bu=(h,s,a)=>{const{jitter:l=8,heightToWidthRatio:f=50}=a;return{createTabSegments(g,v,w,S){const E=!w.convex;return Fu(g,v,l,f/100,S,E)}}};Ti.register(Gr,Bu,Vu);function Uu(h){return new Worker("/puzzle-generator/assets/CheckGeometryWorker-oLMqduM_.js",{name:h?.name})}function qu(h,s){return new Promise((a,l)=>{const f=new Uu;f.onmessage=g=>{const v=g.data;switch(v.type){case"progress":s?.(v.processed,v.total);break;case"done":a(v.results),f.terminate();break;case"error":l(new Error(v.message)),f.terminate();break}},f.onerror=g=>{l(new Error(g.message)),f.terminate()};const o={topology:Eo(h)};f.postMessage(o)})}const la="GridJitterPointGenerator",Hu={name:la,displayName:"Grid",description:"Generate seed points using a grid with optional random jitter. Has a uniform, regular look, especially with low randomness values.",sortHint:2,controls:[{type:"range",name:"jitter",label:"Randomness",min:0,max:100,step:5,defaultValue:50,helpText:"Amount of jitter to apply to each grid point (0 to 100%)"}]},Gu=(h,s,a)=>{const{jitter:l=50}=a;return{generatePoints(o){const{width:g,height:v,pieceSize:w,random:S,border:E}=o,k=[];for(let q=0;q<g;q+=w)for(let L=0;L<v;L+=w){const te=[q+w/2,L+w/2];l>0&&(te[0]+=(S()-.5)*(l/100)*w,te[1]+=(S()-.5)*(l/100)*w),Br(te,E)&&k.push(te)}return k}}};vn.register(la,Gu,Hu);const ca="RectangularPieceGenerator",ju={name:ca,displayName:"Rectangular",description:"Construct pieces from a regular grid. All pieces have 4 sides and are the same size (except when the border is irregular). This generator ignores seed points.",sortHint:2,controls:[]},Wu=(h,s,a)=>{const{width:l,height:f}=s,o=oa(h);return{generatePieces(v,w){const{pieceSize:S,border:E}=w,k={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:E},q=Math.ceil(l/S),L=Math.ceil(f/S),te=Math.round(l/q),Z=Math.round(f/L),ne=[];for(let pe=0;pe<=L;pe++){const ce=[];for(let be=0;be<=q;be++){const he=be*te,O=pe*Z;ce.push([he,O])}ne.push(ce)}k.vertices=ne.flat();const J=new Map;for(let pe=0;pe<L;pe++)for(let ce=0;ce<q;ce++){const be=pe*q+ce,he=ne[pe][ce],O=ne[pe][ce+1],ye=ne[pe+1][ce],we=ne[pe+1][ce+1],Ee=ha([he,O,we,ye],o);if(!Ee)continue;const Me=ua(be,Ee,k);k.pieces.set(be,Me);const Pe=[];let De=Me.halfEdge;if(De!==-1){const Se=De;do{const et=k.halfEdges.get(De);Pe.push(et),De=et.next}while(De!==Se)}ta(Pe,k,J,(Se,et)=>{const de=(Kt,Bt)=>Math.abs(Kt-Bt)<1e-6,Xe=de(Se[1],he[1])&&de(et[1],he[1]),st=de(Se[0],O[0])&&de(et[0],O[0]),Ve=de(Se[1],ye[1])&&de(et[1],ye[1]),it=de(Se[0],he[0])&&de(et[0],he[0]);return!(Xe||st||Ve||it)})}return k}}};yn.register(ca,Wu,ju);const fa="NullTabGenerator",Zu={name:fa,displayName:"None",description:"Do not generate tabs. All pieces have straight edges.",sortHint:3,controls:[]},Ku=(h,s,a)=>({createTabSegments(f,o,g,v){return[]}});Ti.register(fa,Ku,Zu);const da="TriangleTabGenerator",Xu={name:da,displayName:"Triangle",description:"Creates a simple triangle between each (internal) piece edge.",sortHint:2,controls:[]},Yu=(h,s,a)=>({createTabSegments(f,o,g,v){const w=[o[0]-f[0],o[1]-f[1]],S=Math.hypot(w[0],w[1]);if(S<1e-6)return[];const E=[w[0]/S,w[1]/S],k=[-E[1],E[0]],q=[f[0]+w[0]/2,f[1]+w[1]/2],L=g.convex?1:-1,te=S*g.size*L,Z=[q[0]+k[0]*te,q[1]+k[1]*te],ne=[];return ne.push({type:"line",p:f}),ne.push({type:"line",p:Z}),ne.push({type:"line",p:o}),ne}});Ti.register(da,Yu,Xu);let Dr=!1;const Qu=window.matchMedia("(prefers-color-scheme: dark)");Qu.matches&&(Dr=!0);const $u=()=>{const a=Ur,l=Hr,f=Gr,o={seed:new Date().getTime()%10240,canvasWidth:800,canvasHeight:600,aspectRatio:800/600,distance:40,color:Dr?"#DDDDDD":"#333333",drawPoints:!1,pointColor:Dr?"#FF0000":"#0000FF",borderShape:"rectangle",borderCornerRadius:50,geometryProblems:{autoCheck:!1,problems:void 0,progress:void 0},dirty:!0,generators:{point:{label:"Seed Points",registry:vn,name:a,config:vn.getDefaultConfig(a,800,600)},piece:{label:"Piece Generation",registry:yn,name:l,config:yn.getDefaultConfig(l,800,600)},placement:{label:"Tab Placement",registry:xn,name:$n,config:xn.getDefaultConfig($n,800,600)},tab:{label:"Tabs",registry:Ti,name:f,config:Ti.getDefaultConfig(f,800,600)}},puzzle:void 0,backgroundImageUrl:void 0,backgroundImageName:""};function g(){const{canvasWidth:w,canvasHeight:S,borderShape:E,borderCornerRadius:k}=o;switch(E){case"rectangle":return Nr(w,S);case"circle":return Fo(Math.min(w,S));case"ellipse":return Bo(w,S);case"rounded-rect":return Uo(w,S,k);default:return Nr(w,S)}}function v(){o.puzzle&&(o.geometryProblems.progress=0,oe.redraw(),qu(o.puzzle,(w,S)=>{o.geometryProblems.progress=w/S*100,oe.redraw()}).then(w=>{o.geometryProblems.problems=w.length,o.geometryProblems.progress=void 0,o.puzzle&&(o.puzzle.problems=w),oe.redraw()}).catch(w=>{o.geometryProblems.progress=void 0,console.error(w),oe.redraw()}))}return{oncreate:()=>{Yn({bounds:{width:o.canvasWidth,height:o.canvasHeight},border:g(),pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,placementConfig:o.generators.placement.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(w=>{o.puzzle=w,oe.redraw(),o.geometryProblems.autoCheck&&v()}).catch(w=>{console.error(w)})},onupdate:()=>{o.dirty&&(o.dirty=!1,Yn({bounds:{width:o.canvasWidth,height:o.canvasHeight},border:g(),pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,placementConfig:o.generators.placement.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(w=>{o.geometryProblems.problems=void 0,o.geometryProblems.progress=void 0,o.puzzle=w,oe.redraw(),o.geometryProblems.autoCheck&&v()}).catch(w=>{console.error(w)}))},onremove:()=>{o.backgroundImageUrl&&(URL.revokeObjectURL(o.backgroundImageUrl),o.backgroundImageUrl=void 0)},view:()=>oe(".page",[oe("h1","Puzzle Generator"),oe(".container",[o.puzzle&&oe(".puzzle-stack",[oe(Go,{width:o.canvasWidth,height:o.canvasHeight,color:o.color,imageUrl:o.backgroundImageUrl,puzzle:o.puzzle,isDirty:o.dirty,pointColor:o.drawPoints?o.pointColor:void 0,onPuzzleChanged:w=>{o.puzzle=w,oe.redraw()},onSeedPointMoved:(w,S)=>{o.dirty=!1,o.puzzle&&Vo(o.puzzle,w,S).then(E=>{o.geometryProblems.problems=void 0,o.geometryProblems.progress=void 0,o.puzzle=E,oe.redraw(),o.geometryProblems.autoCheck&&v()}).catch(E=>{console.error("Failed to rebuild puzzle with updated seed point:",E)})}}),oe(".actions",[oe(Zo,{puzzle:o.puzzle,width:o.canvasWidth,height:o.canvasHeight,color:o.color}),oe(Ko,{autoCheck:o.geometryProblems.autoCheck,problems:o.geometryProblems.problems,progressPercent:o.geometryProblems.progress,onCheckRequested:()=>{o.dirty||v(),oe.redraw()},onAutocheckChanged:w=>{w!==o.geometryProblems.autoCheck&&(o.geometryProblems.autoCheck=w,oe.redraw())}})])]),oe(".controls",[oe(".background-image",[oe(Yo,{label:"Background Image",onUpload:(w,S,E,k)=>{o.backgroundImageUrl&&URL.revokeObjectURL(o.backgroundImageUrl),o.canvasWidth=E,o.canvasHeight=k,o.aspectRatio=E/k,o.backgroundImageUrl=w,o.backgroundImageName=S,o.dirty=!0,oe.redraw()},onClear:()=>{o.backgroundImageUrl&&URL.revokeObjectURL(o.backgroundImageUrl),o.backgroundImageUrl=void 0,o.backgroundImageName="",o.dirty=!0,oe.redraw()}})]),oe(eu,{ratio:o.aspectRatio,disabled:o.backgroundImageUrl!==void 0,onChange:w=>{o.aspectRatio=w,o.canvasWidth=o.canvasHeight*w,o.dirty=!0,oe.redraw()}}),oe(iu,{shape:o.borderShape,disabled:o.backgroundImageUrl!==void 0,onChange:w=>{o.borderShape=w,o.dirty=!0,oe.redraw()}}),o.borderShape==="rounded-rect"&&oe(Gn,{config:{name:"cornerRadius",label:"Corner Radius",type:"number"},value:o.borderCornerRadius,onChange:w=>{o.borderCornerRadius=w??50,o.dirty=!0,oe.redraw()}}),oe(Gn,{config:{name:"seed",label:"Seed",type:"number"},value:o.seed,onChange:w=>{o.seed=w??0,o.dirty=!0,oe.redraw()}}),oe(Gn,{config:{name:"pieceSize",label:"Piece size",type:"number"},value:o.distance,onChange:w=>{o.distance=w??0,o.dirty=!0,oe.redraw()}}),oe(bs,{label:"Piece color",color:o.color,size:"small",onUpdate:w=>{o.color=w,oe.redraw()}}),oe(".draw-points",[oe(na,{config:{name:"drawPoints",label:"Draw seed points",type:"boolean"},value:o.drawPoints,onChange:w=>{o.drawPoints=w,oe.redraw()}}),o.drawPoints&&oe(bs,{label:"Seed points color",color:o.pointColor,size:"small",onUpdate:w=>{o.pointColor=w,oe.redraw()}})]),...Object.entries(o.generators).map(([w,S])=>oe("label",[S.label+":",oe(Jo,{generator:S.name,registry:S.registry,config:S.config,onGeneratorChange:E=>{E!=S.name&&(console.log(`${w} generator changed to ${E}`),S.name=E,o.generators[w].config=S.registry.getDefaultConfig(E,o.canvasWidth,o.canvasHeight),o.dirty=!0,oe.redraw())},onConfigChange:(E,k)=>{console.log(`${w} generator config "${E}" changed to ${String(k)}`),S.config[E]=k,o.dirty=!0,oe.redraw()}})]))])])])}};function Ju(h){throw new Error('Could not dynamically require "'+h+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jn={exports:{}};const eh={},th=Object.freeze(Object.defineProperty({__proto__:null,default:eh},Symbol.toStringTag,{value:"Module"})),Rs=Fa(th);var hn={exports:{}},ih=hn.exports,Ds;function nh(){return Ds||(Ds=1,(function(h,s){(function(a,l){l(s)})(ih,(function(a){var l=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],f=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],o="-----------------------------------------------------------------------------------------------------------------------------------------------------",g="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",v={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},w="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",S={5:w,"5module":w+" export import",6:w+" const class extends export import super"},E=/^in(stanceof)?$/,k=new RegExp("["+g+"]"),q=new RegExp("["+g+o+"]");function L(n,d){for(var A=65536,F=0;F<d.length;F+=2){if(A+=d[F],A>n)return!1;if(A+=d[F+1],A>=n)return!0}return!1}function te(n,d){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&k.test(String.fromCharCode(n)):d===!1?!1:L(n,f)}function Z(n,d){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&q.test(String.fromCharCode(n)):d===!1?!1:L(n,f)||L(n,l)}var ne=function(d,A){A===void 0&&(A={}),this.label=d,this.keyword=A.keyword,this.beforeExpr=!!A.beforeExpr,this.startsExpr=!!A.startsExpr,this.isLoop=!!A.isLoop,this.isAssign=!!A.isAssign,this.prefix=!!A.prefix,this.postfix=!!A.postfix,this.binop=A.binop||null,this.updateContext=null};function J(n,d){return new ne(n,{beforeExpr:!0,binop:d})}var pe={beforeExpr:!0},ce={startsExpr:!0},be={};function he(n,d){return d===void 0&&(d={}),d.keyword=n,be[n]=new ne(n,d)}var O={num:new ne("num",ce),regexp:new ne("regexp",ce),string:new ne("string",ce),name:new ne("name",ce),privateId:new ne("privateId",ce),eof:new ne("eof"),bracketL:new ne("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new ne("]"),braceL:new ne("{",{beforeExpr:!0,startsExpr:!0}),braceR:new ne("}"),parenL:new ne("(",{beforeExpr:!0,startsExpr:!0}),parenR:new ne(")"),comma:new ne(",",pe),semi:new ne(";",pe),colon:new ne(":",pe),dot:new ne("."),question:new ne("?",pe),questionDot:new ne("?."),arrow:new ne("=>",pe),template:new ne("template"),invalidTemplate:new ne("invalidTemplate"),ellipsis:new ne("...",pe),backQuote:new ne("`",ce),dollarBraceL:new ne("${",{beforeExpr:!0,startsExpr:!0}),eq:new ne("=",{beforeExpr:!0,isAssign:!0}),assign:new ne("_=",{beforeExpr:!0,isAssign:!0}),incDec:new ne("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new ne("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:J("||",1),logicalAND:J("&&",2),bitwiseOR:J("|",3),bitwiseXOR:J("^",4),bitwiseAND:J("&",5),equality:J("==/!=/===/!==",6),relational:J("</>/<=/>=",7),bitShift:J("<</>>/>>>",8),plusMin:new ne("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:J("%",10),star:J("*",10),slash:J("/",10),starstar:new ne("**",{beforeExpr:!0}),coalesce:J("??",1),_break:he("break"),_case:he("case",pe),_catch:he("catch"),_continue:he("continue"),_debugger:he("debugger"),_default:he("default",pe),_do:he("do",{isLoop:!0,beforeExpr:!0}),_else:he("else",pe),_finally:he("finally"),_for:he("for",{isLoop:!0}),_function:he("function",ce),_if:he("if"),_return:he("return",pe),_switch:he("switch"),_throw:he("throw",pe),_try:he("try"),_var:he("var"),_const:he("const"),_while:he("while",{isLoop:!0}),_with:he("with"),_new:he("new",{beforeExpr:!0,startsExpr:!0}),_this:he("this",ce),_super:he("super",ce),_class:he("class",ce),_extends:he("extends",pe),_export:he("export"),_import:he("import",ce),_null:he("null",ce),_true:he("true",ce),_false:he("false",ce),_in:he("in",{beforeExpr:!0,binop:7}),_instanceof:he("instanceof",{beforeExpr:!0,binop:7}),_typeof:he("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:he("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:he("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},ye=/\r\n?|\n|\u2028|\u2029/,we=new RegExp(ye.source,"g");function me(n){return n===10||n===13||n===8232||n===8233}function Ee(n,d,A){A===void 0&&(A=n.length);for(var F=d;F<A;F++){var W=n.charCodeAt(F);if(me(W))return F<A-1&&W===13&&n.charCodeAt(F+1)===10?F+2:F+1}return-1}var Me=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Pe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,De=Object.prototype,Se=De.hasOwnProperty,et=De.toString,de=Object.hasOwn||(function(n,d){return Se.call(n,d)}),Xe=Array.isArray||(function(n){return et.call(n)==="[object Array]"}),st=Object.create(null);function Ve(n){return st[n]||(st[n]=new RegExp("^(?:"+n.replace(/ /g,"|")+")$"))}function it(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var Kt=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Bt=function(d,A){this.line=d,this.column=A};Bt.prototype.offset=function(d){return new Bt(this.line,this.column+d)};var Xt=function(d,A,F){this.start=A,this.end=F,d.sourceFile!==null&&(this.source=d.sourceFile)};function Hi(n,d){for(var A=1,F=0;;){var W=Ee(n,F,d);if(W<0)return new Bt(A,d-F);++A,F=W}}var dt={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},mi=!1;function Gi(n){var d={};for(var A in dt)d[A]=n&&de(n,A)?n[A]:dt[A];if(d.ecmaVersion==="latest"?d.ecmaVersion=1e8:d.ecmaVersion==null?(!mi&&typeof console=="object"&&console.warn&&(mi=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),d.ecmaVersion=11):d.ecmaVersion>=2015&&(d.ecmaVersion-=2009),d.allowReserved==null&&(d.allowReserved=d.ecmaVersion<5),(!n||n.allowHashBang==null)&&(d.allowHashBang=d.ecmaVersion>=14),Xe(d.onToken)){var F=d.onToken;d.onToken=function(W){return F.push(W)}}return Xe(d.onComment)&&(d.onComment=ji(d,d.onComment)),d}function ji(n,d){return function(A,F,W,ae,le,Ce){var Oe={type:A?"Block":"Line",value:F,start:W,end:ae};n.locations&&(Oe.loc=new Xt(this,le,Ce)),n.ranges&&(Oe.range=[W,ae]),d.push(Oe)}}var at=1,ut=2,ht=4,Sn=8,ai=16,Cn=32,_i=64,Pn=128,$t=256,vi=512,Mi=at|ut|$t;function Li(n,d){return ut|(n?ht:0)|(d?Sn:0)}var pt=0,yi=1,nt=2,Wi=3,Ye=4,e=5,i=function(d,A,F){this.options=d=Gi(d),this.sourceFile=d.sourceFile,this.keywords=Ve(S[d.ecmaVersion>=6?6:d.sourceType==="module"?"5module":5]);var W="";d.allowReserved!==!0&&(W=v[d.ecmaVersion>=6?6:d.ecmaVersion===5?5:3],d.sourceType==="module"&&(W+=" await")),this.reservedWords=Ve(W);var ae=(W?W+" ":"")+v.strict;this.reservedWordsStrict=Ve(ae),this.reservedWordsStrictBind=Ve(ae+" "+v.strictBind),this.input=String(A),this.containsEsc=!1,F?(this.pos=F,this.lineStart=this.input.lastIndexOf(`
`,F-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(ye).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=O.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=d.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&d.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(at),this.regexpState=null,this.privateNameStack=[]},r={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};i.prototype.parse=function(){var d=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(d)},r.inFunction.get=function(){return(this.currentVarScope().flags&ut)>0},r.inGenerator.get=function(){return(this.currentVarScope().flags&Sn)>0},r.inAsync.get=function(){return(this.currentVarScope().flags&ht)>0},r.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var d=this.scopeStack[n],A=d.flags;if(A&($t|vi))return!1;if(A&ut)return(A&ht)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},r.allowSuper.get=function(){var n=this.currentThisScope(),d=n.flags;return(d&_i)>0||this.options.allowSuperOutsideMethod},r.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Pn)>0},r.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},r.allowNewDotTarget.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var d=this.scopeStack[n],A=d.flags;if(A&($t|vi)||A&ut&&!(A&ai))return!0}return!1},r.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&$t)>0},i.extend=function(){for(var d=[],A=arguments.length;A--;)d[A]=arguments[A];for(var F=this,W=0;W<d.length;W++)F=d[W](F);return F},i.parse=function(d,A){return new this(A,d).parse()},i.parseExpressionAt=function(d,A,F){var W=new this(F,d,A);return W.nextToken(),W.parseExpression()},i.tokenizer=function(d,A){return new this(A,d)},Object.defineProperties(i.prototype,r);var u=i.prototype,c=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;u.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){Pe.lastIndex=n,n+=Pe.exec(this.input)[0].length;var d=c.exec(this.input.slice(n));if(!d)return!1;if((d[1]||d[2])==="use strict"){Pe.lastIndex=n+d[0].length;var A=Pe.exec(this.input),F=A.index+A[0].length,W=this.input.charAt(F);return W===";"||W==="}"||ye.test(A[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(W)||W==="!"&&this.input.charAt(F+1)==="=")}n+=d[0].length,Pe.lastIndex=n,n+=Pe.exec(this.input)[0].length,this.input[n]===";"&&n++}},u.eat=function(n){return this.type===n?(this.next(),!0):!1},u.isContextual=function(n){return this.type===O.name&&this.value===n&&!this.containsEsc},u.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1},u.expectContextual=function(n){this.eatContextual(n)||this.unexpected()},u.canInsertSemicolon=function(){return this.type===O.eof||this.type===O.braceR||ye.test(this.input.slice(this.lastTokEnd,this.start))},u.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},u.semicolon=function(){!this.eat(O.semi)&&!this.insertSemicolon()&&this.unexpected()},u.afterTrailingComma=function(n,d){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),d||this.next(),!0},u.expect=function(n){this.eat(n)||this.unexpected()},u.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var p=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};u.checkPatternErrors=function(n,d){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var A=d?n.parenthesizedAssign:n.parenthesizedBind;A>-1&&this.raiseRecoverable(A,d?"Assigning to rvalue":"Parenthesized pattern")}},u.checkExpressionErrors=function(n,d){if(!n)return!1;var A=n.shorthandAssign,F=n.doubleProto;if(!d)return A>=0||F>=0;A>=0&&this.raise(A,"Shorthand property assignments are valid only in destructuring patterns"),F>=0&&this.raiseRecoverable(F,"Redefinition of __proto__ property")},u.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},u.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var m=i.prototype;m.parseTopLevel=function(n){var d=Object.create(null);for(n.body||(n.body=[]);this.type!==O.eof;){var A=this.parseStatement(null,!0,d);n.body.push(A)}if(this.inModule)for(var F=0,W=Object.keys(this.undefinedExports);F<W.length;F+=1){var ae=W[F];this.raiseRecoverable(this.undefinedExports[ae].start,"Export '"+ae+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var _={kind:"loop"},y={kind:"switch"};m.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Pe.lastIndex=this.pos;var d=Pe.exec(this.input),A=this.pos+d[0].length,F=this.input.charCodeAt(A);if(F===91||F===92)return!0;if(n)return!1;if(F===123||F>55295&&F<56320)return!0;if(te(F,!0)){for(var W=A+1;Z(F=this.input.charCodeAt(W),!0);)++W;if(F===92||F>55295&&F<56320)return!0;var ae=this.input.slice(A,W);if(!E.test(ae))return!0}return!1},m.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Pe.lastIndex=this.pos;var n=Pe.exec(this.input),d=this.pos+n[0].length,A;return!ye.test(this.input.slice(this.pos,d))&&this.input.slice(d,d+8)==="function"&&(d+8===this.input.length||!(Z(A=this.input.charCodeAt(d+8))||A>55295&&A<56320))},m.isUsingKeyword=function(n,d){if(this.options.ecmaVersion<17||!this.isContextual(n?"await":"using"))return!1;Pe.lastIndex=this.pos;var A=Pe.exec(this.input),F=this.pos+A[0].length;if(ye.test(this.input.slice(this.pos,F)))return!1;if(n){var W=F+5,ae;if(this.input.slice(F,W)!=="using"||W===this.input.length||Z(ae=this.input.charCodeAt(W))||ae>55295&&ae<56320)return!1;Pe.lastIndex=W;var le=Pe.exec(this.input);if(le&&ye.test(this.input.slice(W,W+le[0].length)))return!1}if(d){var Ce=F+2,Oe;if(this.input.slice(F,Ce)==="of"&&(Ce===this.input.length||!Z(Oe=this.input.charCodeAt(Ce))&&!(Oe>55295&&Oe<56320)))return!1}var He=this.input.charCodeAt(F);return te(He,!0)||He===92},m.isAwaitUsing=function(n){return this.isUsingKeyword(!0,n)},m.isUsing=function(n){return this.isUsingKeyword(!1,n)},m.parseStatement=function(n,d,A){var F=this.type,W=this.startNode(),ae;switch(this.isLet(n)&&(F=O._var,ae="let"),F){case O._break:case O._continue:return this.parseBreakContinueStatement(W,F.keyword);case O._debugger:return this.parseDebuggerStatement(W);case O._do:return this.parseDoStatement(W);case O._for:return this.parseForStatement(W);case O._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(W,!1,!n);case O._class:return n&&this.unexpected(),this.parseClass(W,!0);case O._if:return this.parseIfStatement(W);case O._return:return this.parseReturnStatement(W);case O._switch:return this.parseSwitchStatement(W);case O._throw:return this.parseThrowStatement(W);case O._try:return this.parseTryStatement(W);case O._const:case O._var:return ae=ae||this.value,n&&ae!=="var"&&this.unexpected(),this.parseVarStatement(W,ae);case O._while:return this.parseWhileStatement(W);case O._with:return this.parseWithStatement(W);case O.braceL:return this.parseBlock(!0,W);case O.semi:return this.parseEmptyStatement(W);case O._export:case O._import:if(this.options.ecmaVersion>10&&F===O._import){Pe.lastIndex=this.pos;var le=Pe.exec(this.input),Ce=this.pos+le[0].length,Oe=this.input.charCodeAt(Ce);if(Oe===40||Oe===46)return this.parseExpressionStatement(W,this.parseExpression())}return this.options.allowImportExportEverywhere||(d||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),F===O._import?this.parseImport(W):this.parseExport(W,A);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(W,!0,!n);var He=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(He)return d&&this.options.sourceType==="script"&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),He==="await using"&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(W,!1,He),this.semicolon(),this.finishNode(W,"VariableDeclaration");var Qe=this.value,ot=this.parseExpression();return F===O.name&&ot.type==="Identifier"&&this.eat(O.colon)?this.parseLabeledStatement(W,Qe,ot,n):this.parseExpressionStatement(W,ot)}},m.parseBreakContinueStatement=function(n,d){var A=d==="break";this.next(),this.eat(O.semi)||this.insertSemicolon()?n.label=null:this.type!==O.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var F=0;F<this.labels.length;++F){var W=this.labels[F];if((n.label==null||W.name===n.label.name)&&(W.kind!=null&&(A||W.kind==="loop")||n.label&&A))break}return F===this.labels.length&&this.raise(n.start,"Unsyntactic "+d),this.finishNode(n,A?"BreakStatement":"ContinueStatement")},m.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")},m.parseDoStatement=function(n){return this.next(),this.labels.push(_),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(O._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(O.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")},m.parseForStatement=function(n){this.next();var d=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(_),this.enterScope(0),this.expect(O.parenL),this.type===O.semi)return d>-1&&this.unexpected(d),this.parseFor(n,null);var A=this.isLet();if(this.type===O._var||this.type===O._const||A){var F=this.startNode(),W=A?"let":this.value;return this.next(),this.parseVar(F,!0,W),this.finishNode(F,"VariableDeclaration"),this.parseForAfterInit(n,F,d)}var ae=this.isContextual("let"),le=!1,Ce=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(Ce){var Oe=this.startNode();return this.next(),Ce==="await using"&&this.next(),this.parseVar(Oe,!0,Ce),this.finishNode(Oe,"VariableDeclaration"),this.parseForAfterInit(n,Oe,d)}var He=this.containsEsc,Qe=new p,ot=this.start,St=d>-1?this.parseExprSubscripts(Qe,"await"):this.parseExpression(!0,Qe);return this.type===O._in||(le=this.options.ecmaVersion>=6&&this.isContextual("of"))?(d>-1?(this.type===O._in&&this.unexpected(d),n.await=!0):le&&this.options.ecmaVersion>=8&&(St.start===ot&&!He&&St.type==="Identifier"&&St.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(n.await=!1)),ae&&le&&this.raise(St.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(St,!1,Qe),this.checkLValPattern(St),this.parseForIn(n,St)):(this.checkExpressionErrors(Qe,!0),d>-1&&this.unexpected(d),this.parseFor(n,St))},m.parseForAfterInit=function(n,d,A){return(this.type===O._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&d.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===O._in?A>-1&&this.unexpected(A):n.await=A>-1),this.parseForIn(n,d)):(A>-1&&this.unexpected(A),this.parseFor(n,d))},m.parseFunctionStatement=function(n,d,A){return this.next(),this.parseFunction(n,T|(A?0:M),!1,d)},m.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(O._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")},m.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(O.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")},m.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(O.braceL),this.labels.push(y),this.enterScope(0);for(var d,A=!1;this.type!==O.braceR;)if(this.type===O._case||this.type===O._default){var F=this.type===O._case;d&&this.finishNode(d,"SwitchCase"),n.cases.push(d=this.startNode()),d.consequent=[],this.next(),F?d.test=this.parseExpression():(A&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),A=!0,d.test=null),this.expect(O.colon)}else d||this.unexpected(),d.consequent.push(this.parseStatement(null));return this.exitScope(),d&&this.finishNode(d,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")},m.parseThrowStatement=function(n){return this.next(),ye.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var x=[];m.parseCatchClauseParam=function(){var n=this.parseBindingAtom(),d=n.type==="Identifier";return this.enterScope(d?Cn:0),this.checkLValPattern(n,d?Ye:nt),this.expect(O.parenR),n},m.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===O._catch){var d=this.startNode();this.next(),this.eat(O.parenL)?d.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),d.param=null,this.enterScope(0)),d.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(d,"CatchClause")}return n.finalizer=this.eat(O._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")},m.parseVarStatement=function(n,d,A){return this.next(),this.parseVar(n,!1,d,A),this.semicolon(),this.finishNode(n,"VariableDeclaration")},m.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(_),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")},m.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")},m.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")},m.parseLabeledStatement=function(n,d,A,F){for(var W=0,ae=this.labels;W<ae.length;W+=1){var le=ae[W];le.name===d&&this.raise(A.start,"Label '"+d+"' is already declared")}for(var Ce=this.type.isLoop?"loop":this.type===O._switch?"switch":null,Oe=this.labels.length-1;Oe>=0;Oe--){var He=this.labels[Oe];if(He.statementStart===n.start)He.statementStart=this.start,He.kind=Ce;else break}return this.labels.push({name:d,kind:Ce,statementStart:this.start}),n.body=this.parseStatement(F?F.indexOf("label")===-1?F+"label":F:"label"),this.labels.pop(),n.label=A,this.finishNode(n,"LabeledStatement")},m.parseExpressionStatement=function(n,d){return n.expression=d,this.semicolon(),this.finishNode(n,"ExpressionStatement")},m.parseBlock=function(n,d,A){for(n===void 0&&(n=!0),d===void 0&&(d=this.startNode()),d.body=[],this.expect(O.braceL),n&&this.enterScope(0);this.type!==O.braceR;){var F=this.parseStatement(null);d.body.push(F)}return A&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(d,"BlockStatement")},m.parseFor=function(n,d){return n.init=d,this.expect(O.semi),n.test=this.type===O.semi?null:this.parseExpression(),this.expect(O.semi),n.update=this.type===O.parenR?null:this.parseExpression(),this.expect(O.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")},m.parseForIn=function(n,d){var A=this.type===O._in;return this.next(),d.type==="VariableDeclaration"&&d.declarations[0].init!=null&&(!A||this.options.ecmaVersion<8||this.strict||d.kind!=="var"||d.declarations[0].id.type!=="Identifier")&&this.raise(d.start,(A?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=d,n.right=A?this.parseExpression():this.parseMaybeAssign(),this.expect(O.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,A?"ForInStatement":"ForOfStatement")},m.parseVar=function(n,d,A,F){for(n.declarations=[],n.kind=A;;){var W=this.startNode();if(this.parseVarId(W,A),this.eat(O.eq)?W.init=this.parseMaybeAssign(d):!F&&A==="const"&&!(this.type===O._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!F&&(A==="using"||A==="await using")&&this.options.ecmaVersion>=17&&this.type!==O._in&&!this.isContextual("of")?this.raise(this.lastTokEnd,"Missing initializer in "+A+" declaration"):!F&&W.id.type!=="Identifier"&&!(d&&(this.type===O._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):W.init=null,n.declarations.push(this.finishNode(W,"VariableDeclarator")),!this.eat(O.comma))break}return n},m.parseVarId=function(n,d){n.id=d==="using"||d==="await using"?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(n.id,d==="var"?yi:nt,!1)};var T=1,M=2,P=4;m.parseFunction=function(n,d,A,F,W){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!F)&&(this.type===O.star&&d&M&&this.unexpected(),n.generator=this.eat(O.star)),this.options.ecmaVersion>=8&&(n.async=!!F),d&T&&(n.id=d&P&&this.type!==O.name?null:this.parseIdent(),n.id&&!(d&M)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?yi:nt:Wi));var ae=this.yieldPos,le=this.awaitPos,Ce=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Li(n.async,n.generator)),d&T||(n.id=this.type===O.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,A,!1,W),this.yieldPos=ae,this.awaitPos=le,this.awaitIdentPos=Ce,this.finishNode(n,d&T?"FunctionDeclaration":"FunctionExpression")},m.parseFunctionParams=function(n){this.expect(O.parenL),n.params=this.parseBindingList(O.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},m.parseClass=function(n,d){this.next();var A=this.strict;this.strict=!0,this.parseClassId(n,d),this.parseClassSuper(n);var F=this.enterClassBody(),W=this.startNode(),ae=!1;for(W.body=[],this.expect(O.braceL);this.type!==O.braceR;){var le=this.parseClassElement(n.superClass!==null);le&&(W.body.push(le),le.type==="MethodDefinition"&&le.kind==="constructor"?(ae&&this.raiseRecoverable(le.start,"Duplicate constructor in the same class"),ae=!0):le.key&&le.key.type==="PrivateIdentifier"&&C(F,le)&&this.raiseRecoverable(le.key.start,"Identifier '#"+le.key.name+"' has already been declared"))}return this.strict=A,this.next(),n.body=this.finishNode(W,"ClassBody"),this.exitClassBody(),this.finishNode(n,d?"ClassDeclaration":"ClassExpression")},m.parseClassElement=function(n){if(this.eat(O.semi))return null;var d=this.options.ecmaVersion,A=this.startNode(),F="",W=!1,ae=!1,le="method",Ce=!1;if(this.eatContextual("static")){if(d>=13&&this.eat(O.braceL))return this.parseClassStaticBlock(A),A;this.isClassElementNameStart()||this.type===O.star?Ce=!0:F="static"}if(A.static=Ce,!F&&d>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===O.star)&&!this.canInsertSemicolon()?ae=!0:F="async"),!F&&(d>=9||!ae)&&this.eat(O.star)&&(W=!0),!F&&!ae&&!W){var Oe=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?le=Oe:F=Oe)}if(F?(A.computed=!1,A.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),A.key.name=F,this.finishNode(A.key,"Identifier")):this.parseClassElementName(A),d<13||this.type===O.parenL||le!=="method"||W||ae){var He=!A.static&&B(A,"constructor"),Qe=He&&n;He&&le!=="method"&&this.raise(A.key.start,"Constructor can't have get/set modifier"),A.kind=He?"constructor":le,this.parseClassMethod(A,W,ae,Qe)}else this.parseClassField(A);return A},m.isClassElementNameStart=function(){return this.type===O.name||this.type===O.privateId||this.type===O.num||this.type===O.string||this.type===O.bracketL||this.type.keyword},m.parseClassElementName=function(n){this.type===O.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)},m.parseClassMethod=function(n,d,A,F){var W=n.key;n.kind==="constructor"?(d&&this.raise(W.start,"Constructor can't be a generator"),A&&this.raise(W.start,"Constructor can't be an async method")):n.static&&B(n,"prototype")&&this.raise(W.start,"Classes may not have a static property named prototype");var ae=n.value=this.parseMethod(d,A,F);return n.kind==="get"&&ae.params.length!==0&&this.raiseRecoverable(ae.start,"getter should have no params"),n.kind==="set"&&ae.params.length!==1&&this.raiseRecoverable(ae.start,"setter should have exactly one param"),n.kind==="set"&&ae.params[0].type==="RestElement"&&this.raiseRecoverable(ae.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")},m.parseClassField=function(n){return B(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&B(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(O.eq)?(this.enterScope(vi|_i),n.value=this.parseMaybeAssign(),this.exitScope()):n.value=null,this.semicolon(),this.finishNode(n,"PropertyDefinition")},m.parseClassStaticBlock=function(n){n.body=[];var d=this.labels;for(this.labels=[],this.enterScope($t|_i);this.type!==O.braceR;){var A=this.parseStatement(null);n.body.push(A)}return this.next(),this.exitScope(),this.labels=d,this.finishNode(n,"StaticBlock")},m.parseClassId=function(n,d){this.type===O.name?(n.id=this.parseIdent(),d&&this.checkLValSimple(n.id,nt,!1)):(d===!0&&this.unexpected(),n.id=null)},m.parseClassSuper=function(n){n.superClass=this.eat(O._extends)?this.parseExprSubscripts(null,!1):null},m.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared},m.exitClassBody=function(){var n=this.privateNameStack.pop(),d=n.declared,A=n.used;if(this.options.checkPrivateFields)for(var F=this.privateNameStack.length,W=F===0?null:this.privateNameStack[F-1],ae=0;ae<A.length;++ae){var le=A[ae];de(d,le.name)||(W?W.used.push(le):this.raiseRecoverable(le.start,"Private field '#"+le.name+"' must be declared in an enclosing class"))}};function C(n,d){var A=d.key.name,F=n[A],W="true";return d.type==="MethodDefinition"&&(d.kind==="get"||d.kind==="set")&&(W=(d.static?"s":"i")+d.kind),F==="iget"&&W==="iset"||F==="iset"&&W==="iget"||F==="sget"&&W==="sset"||F==="sset"&&W==="sget"?(n[A]="true",!1):F?!0:(n[A]=W,!1)}function B(n,d){var A=n.computed,F=n.key;return!A&&(F.type==="Identifier"&&F.name===d||F.type==="Literal"&&F.value===d)}m.parseExportAllDeclaration=function(n,d){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(d,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==O.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ExportAllDeclaration")},m.parseExport=function(n,d){if(this.next(),this.eat(O.star))return this.parseExportAllDeclaration(n,d);if(this.eat(O._default))return this.checkExport(d,"default",this.lastTokStart),n.declaration=this.parseExportDefaultDeclaration(),this.finishNode(n,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())n.declaration=this.parseExportDeclaration(n),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(d,n.declaration.declarations):this.checkExport(d,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[]);else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(d),this.eatContextual("from"))this.type!==O.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause());else{for(var A=0,F=n.specifiers;A<F.length;A+=1){var W=F[A];this.checkUnreserved(W.local),this.checkLocalExport(W.local),W.local.type==="Literal"&&this.raise(W.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[])}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")},m.parseExportDeclaration=function(n){return this.parseStatement(null)},m.parseExportDefaultDeclaration=function(){var n;if(this.type===O._function||(n=this.isAsyncFunction())){var d=this.startNode();return this.next(),n&&this.next(),this.parseFunction(d,T|P,!1,n)}else if(this.type===O._class){var A=this.startNode();return this.parseClass(A,"nullableID")}else{var F=this.parseMaybeAssign();return this.semicolon(),F}},m.checkExport=function(n,d,A){n&&(typeof d!="string"&&(d=d.type==="Identifier"?d.name:d.value),de(n,d)&&this.raiseRecoverable(A,"Duplicate export '"+d+"'"),n[d]=!0)},m.checkPatternExport=function(n,d){var A=d.type;if(A==="Identifier")this.checkExport(n,d,d.start);else if(A==="ObjectPattern")for(var F=0,W=d.properties;F<W.length;F+=1){var ae=W[F];this.checkPatternExport(n,ae)}else if(A==="ArrayPattern")for(var le=0,Ce=d.elements;le<Ce.length;le+=1){var Oe=Ce[le];Oe&&this.checkPatternExport(n,Oe)}else A==="Property"?this.checkPatternExport(n,d.value):A==="AssignmentPattern"?this.checkPatternExport(n,d.left):A==="RestElement"&&this.checkPatternExport(n,d.argument)},m.checkVariableExport=function(n,d){if(n)for(var A=0,F=d;A<F.length;A+=1){var W=F[A];this.checkPatternExport(n,W.id)}},m.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},m.parseExportSpecifier=function(n){var d=this.startNode();return d.local=this.parseModuleExportName(),d.exported=this.eatContextual("as")?this.parseModuleExportName():d.local,this.checkExport(n,d.exported,d.exported.start),this.finishNode(d,"ExportSpecifier")},m.parseExportSpecifiers=function(n){var d=[],A=!0;for(this.expect(O.braceL);!this.eat(O.braceR);){if(A)A=!1;else if(this.expect(O.comma),this.afterTrailingComma(O.braceR))break;d.push(this.parseExportSpecifier(n))}return d},m.parseImport=function(n){return this.next(),this.type===O.string?(n.specifiers=x,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===O.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ImportDeclaration")},m.parseImportSpecifier=function(){var n=this.startNode();return n.imported=this.parseModuleExportName(),this.eatContextual("as")?n.local=this.parseIdent():(this.checkUnreserved(n.imported),n.local=n.imported),this.checkLValSimple(n.local,nt),this.finishNode(n,"ImportSpecifier")},m.parseImportDefaultSpecifier=function(){var n=this.startNode();return n.local=this.parseIdent(),this.checkLValSimple(n.local,nt),this.finishNode(n,"ImportDefaultSpecifier")},m.parseImportNamespaceSpecifier=function(){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLValSimple(n.local,nt),this.finishNode(n,"ImportNamespaceSpecifier")},m.parseImportSpecifiers=function(){var n=[],d=!0;if(this.type===O.name&&(n.push(this.parseImportDefaultSpecifier()),!this.eat(O.comma)))return n;if(this.type===O.star)return n.push(this.parseImportNamespaceSpecifier()),n;for(this.expect(O.braceL);!this.eat(O.braceR);){if(d)d=!1;else if(this.expect(O.comma),this.afterTrailingComma(O.braceR))break;n.push(this.parseImportSpecifier())}return n},m.parseWithClause=function(){var n=[];if(!this.eat(O._with))return n;this.expect(O.braceL);for(var d={},A=!0;!this.eat(O.braceR);){if(A)A=!1;else if(this.expect(O.comma),this.afterTrailingComma(O.braceR))break;var F=this.parseImportAttribute(),W=F.key.type==="Identifier"?F.key.name:F.key.value;de(d,W)&&this.raiseRecoverable(F.key.start,"Duplicate attribute key '"+W+"'"),d[W]=!0,n.push(F)}return n},m.parseImportAttribute=function(){var n=this.startNode();return n.key=this.type===O.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(O.colon),this.type!==O.string&&this.unexpected(),n.value=this.parseExprAtom(),this.finishNode(n,"ImportAttribute")},m.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===O.string){var n=this.parseLiteral(this.value);return Kt.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)},m.adaptDirectivePrologue=function(n){for(var d=0;d<n.length&&this.isDirectiveCandidate(n[d]);++d)n[d].directive=n[d].expression.raw.slice(1,-1)},m.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var z=i.prototype;z.toAssignable=function(n,d,A){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",A&&this.checkPatternErrors(A,!0);for(var F=0,W=n.properties;F<W.length;F+=1){var ae=W[F];this.toAssignable(ae,d),ae.type==="RestElement"&&(ae.argument.type==="ArrayPattern"||ae.argument.type==="ObjectPattern")&&this.raise(ae.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,d);break;case"ArrayExpression":n.type="ArrayPattern",A&&this.checkPatternErrors(A,!0),this.toAssignableList(n.elements,d);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,d),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,d);break;case"ParenthesizedExpression":this.toAssignable(n.expression,d,A);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!d)break;default:this.raise(n.start,"Assigning to rvalue")}else A&&this.checkPatternErrors(A,!0);return n},z.toAssignableList=function(n,d){for(var A=n.length,F=0;F<A;F++){var W=n[F];W&&this.toAssignable(W,d)}if(A){var ae=n[A-1];this.options.ecmaVersion===6&&d&&ae&&ae.type==="RestElement"&&ae.argument.type!=="Identifier"&&this.unexpected(ae.argument.start)}return n},z.parseSpread=function(n){var d=this.startNode();return this.next(),d.argument=this.parseMaybeAssign(!1,n),this.finishNode(d,"SpreadElement")},z.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==O.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")},z.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case O.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(O.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case O.braceL:return this.parseObj(!0)}return this.parseIdent()},z.parseBindingList=function(n,d,A,F){for(var W=[],ae=!0;!this.eat(n);)if(ae?ae=!1:this.expect(O.comma),d&&this.type===O.comma)W.push(null);else{if(A&&this.afterTrailingComma(n))break;if(this.type===O.ellipsis){var le=this.parseRestBinding();this.parseBindingListItem(le),W.push(le),this.type===O.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else W.push(this.parseAssignableListItem(F))}return W},z.parseAssignableListItem=function(n){var d=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(d),d},z.parseBindingListItem=function(n){return n},z.parseMaybeDefault=function(n,d,A){if(A=A||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(O.eq))return A;var F=this.startNodeAt(n,d);return F.left=A,F.right=this.parseMaybeAssign(),this.finishNode(F,"AssignmentPattern")},z.checkLValSimple=function(n,d,A){d===void 0&&(d=pt);var F=d!==pt;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(F?"Binding ":"Assigning to ")+n.name+" in strict mode"),F&&(d===nt&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),A&&(de(A,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),A[n.name]=!0),d!==e&&this.declareName(n.name,d,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":F&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return F&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,d,A);default:this.raise(n.start,(F?"Binding":"Assigning to")+" rvalue")}},z.checkLValPattern=function(n,d,A){switch(d===void 0&&(d=pt),n.type){case"ObjectPattern":for(var F=0,W=n.properties;F<W.length;F+=1){var ae=W[F];this.checkLValInnerPattern(ae,d,A)}break;case"ArrayPattern":for(var le=0,Ce=n.elements;le<Ce.length;le+=1){var Oe=Ce[le];Oe&&this.checkLValInnerPattern(Oe,d,A)}break;default:this.checkLValSimple(n,d,A)}},z.checkLValInnerPattern=function(n,d,A){switch(d===void 0&&(d=pt),n.type){case"Property":this.checkLValInnerPattern(n.value,d,A);break;case"AssignmentPattern":this.checkLValPattern(n.left,d,A);break;case"RestElement":this.checkLValPattern(n.argument,d,A);break;default:this.checkLValPattern(n,d,A)}};var V=function(d,A,F,W,ae){this.token=d,this.isExpr=!!A,this.preserveSpace=!!F,this.override=W,this.generator=!!ae},I={b_stat:new V("{",!1),b_expr:new V("{",!0),b_tmpl:new V("${",!1),p_stat:new V("(",!1),p_expr:new V("(",!0),q_tmpl:new V("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new V("function",!1),f_expr:new V("function",!0),f_expr_gen:new V("function",!0,!1,null,!0),f_gen:new V("function",!1,!1,null,!0)},R=i.prototype;R.initialContext=function(){return[I.b_stat]},R.curContext=function(){return this.context[this.context.length-1]},R.braceIsBlock=function(n){var d=this.curContext();return d===I.f_expr||d===I.f_stat?!0:n===O.colon&&(d===I.b_stat||d===I.b_expr)?!d.isExpr:n===O._return||n===O.name&&this.exprAllowed?ye.test(this.input.slice(this.lastTokEnd,this.start)):n===O._else||n===O.semi||n===O.eof||n===O.parenR||n===O.arrow?!0:n===O.braceL?d===I.b_stat:n===O._var||n===O._const||n===O.name?!1:!this.exprAllowed},R.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var d=this.context[n];if(d.token==="function")return d.generator}return!1},R.updateContext=function(n){var d,A=this.type;A.keyword&&n===O.dot?this.exprAllowed=!1:(d=A.updateContext)?d.call(this,n):this.exprAllowed=A.beforeExpr},R.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)},O.parenR.updateContext=O.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===I.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr},O.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?I.b_stat:I.b_expr),this.exprAllowed=!0},O.dollarBraceL.updateContext=function(){this.context.push(I.b_tmpl),this.exprAllowed=!0},O.parenL.updateContext=function(n){var d=n===O._if||n===O._for||n===O._with||n===O._while;this.context.push(d?I.p_stat:I.p_expr),this.exprAllowed=!0},O.incDec.updateContext=function(){},O._function.updateContext=O._class.updateContext=function(n){n.beforeExpr&&n!==O._else&&!(n===O.semi&&this.curContext()!==I.p_stat)&&!(n===O._return&&ye.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===O.colon||n===O.braceL)&&this.curContext()===I.b_stat)?this.context.push(I.f_expr):this.context.push(I.f_stat),this.exprAllowed=!1},O.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0},O.backQuote.updateContext=function(){this.curContext()===I.q_tmpl?this.context.pop():this.context.push(I.q_tmpl),this.exprAllowed=!1},O.star.updateContext=function(n){if(n===O._function){var d=this.context.length-1;this.context[d]===I.f_expr?this.context[d]=I.f_expr_gen:this.context[d]=I.f_gen}this.exprAllowed=!0},O.name.updateContext=function(n){var d=!1;this.options.ecmaVersion>=6&&n!==O.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(d=!0),this.exprAllowed=d};var b=i.prototype;b.checkPropClash=function(n,d,A){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var F=n.key,W;switch(F.type){case"Identifier":W=F.name;break;case"Literal":W=String(F.value);break;default:return}var ae=n.kind;if(this.options.ecmaVersion>=6){W==="__proto__"&&ae==="init"&&(d.proto&&(A?A.doubleProto<0&&(A.doubleProto=F.start):this.raiseRecoverable(F.start,"Redefinition of __proto__ property")),d.proto=!0);return}W="$"+W;var le=d[W];if(le){var Ce;ae==="init"?Ce=this.strict&&le.init||le.get||le.set:Ce=le.init||le[ae],Ce&&this.raiseRecoverable(F.start,"Redefinition of property")}else le=d[W]={init:!1,get:!1,set:!1};le[ae]=!0}},b.parseExpression=function(n,d){var A=this.start,F=this.startLoc,W=this.parseMaybeAssign(n,d);if(this.type===O.comma){var ae=this.startNodeAt(A,F);for(ae.expressions=[W];this.eat(O.comma);)ae.expressions.push(this.parseMaybeAssign(n,d));return this.finishNode(ae,"SequenceExpression")}return W},b.parseMaybeAssign=function(n,d,A){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var F=!1,W=-1,ae=-1,le=-1;d?(W=d.parenthesizedAssign,ae=d.trailingComma,le=d.doubleProto,d.parenthesizedAssign=d.trailingComma=-1):(d=new p,F=!0);var Ce=this.start,Oe=this.startLoc;(this.type===O.parenL||this.type===O.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var He=this.parseMaybeConditional(n,d);if(A&&(He=A.call(this,He,Ce,Oe)),this.type.isAssign){var Qe=this.startNodeAt(Ce,Oe);return Qe.operator=this.value,this.type===O.eq&&(He=this.toAssignable(He,!1,d)),F||(d.parenthesizedAssign=d.trailingComma=d.doubleProto=-1),d.shorthandAssign>=He.start&&(d.shorthandAssign=-1),this.type===O.eq?this.checkLValPattern(He):this.checkLValSimple(He),Qe.left=He,this.next(),Qe.right=this.parseMaybeAssign(n),le>-1&&(d.doubleProto=le),this.finishNode(Qe,"AssignmentExpression")}else F&&this.checkExpressionErrors(d,!0);return W>-1&&(d.parenthesizedAssign=W),ae>-1&&(d.trailingComma=ae),He},b.parseMaybeConditional=function(n,d){var A=this.start,F=this.startLoc,W=this.parseExprOps(n,d);if(this.checkExpressionErrors(d))return W;if(this.eat(O.question)){var ae=this.startNodeAt(A,F);return ae.test=W,ae.consequent=this.parseMaybeAssign(),this.expect(O.colon),ae.alternate=this.parseMaybeAssign(n),this.finishNode(ae,"ConditionalExpression")}return W},b.parseExprOps=function(n,d){var A=this.start,F=this.startLoc,W=this.parseMaybeUnary(d,!1,!1,n);return this.checkExpressionErrors(d)||W.start===A&&W.type==="ArrowFunctionExpression"?W:this.parseExprOp(W,A,F,-1,n)},b.parseExprOp=function(n,d,A,F,W){var ae=this.type.binop;if(ae!=null&&(!W||this.type!==O._in)&&ae>F){var le=this.type===O.logicalOR||this.type===O.logicalAND,Ce=this.type===O.coalesce;Ce&&(ae=O.logicalAND.binop);var Oe=this.value;this.next();var He=this.start,Qe=this.startLoc,ot=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,W),He,Qe,ae,W),St=this.buildBinary(d,A,n,ot,Oe,le||Ce);return(le&&this.type===O.coalesce||Ce&&(this.type===O.logicalOR||this.type===O.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(St,d,A,F,W)}return n},b.buildBinary=function(n,d,A,F,W,ae){F.type==="PrivateIdentifier"&&this.raise(F.start,"Private identifier can only be left side of binary expression");var le=this.startNodeAt(n,d);return le.left=A,le.operator=W,le.right=F,this.finishNode(le,ae?"LogicalExpression":"BinaryExpression")},b.parseMaybeUnary=function(n,d,A,F){var W=this.start,ae=this.startLoc,le;if(this.isContextual("await")&&this.canAwait)le=this.parseAwait(F),d=!0;else if(this.type.prefix){var Ce=this.startNode(),Oe=this.type===O.incDec;Ce.operator=this.value,Ce.prefix=!0,this.next(),Ce.argument=this.parseMaybeUnary(null,!0,Oe,F),this.checkExpressionErrors(n,!0),Oe?this.checkLValSimple(Ce.argument):this.strict&&Ce.operator==="delete"&&N(Ce.argument)?this.raiseRecoverable(Ce.start,"Deleting local variable in strict mode"):Ce.operator==="delete"&&U(Ce.argument)?this.raiseRecoverable(Ce.start,"Private fields can not be deleted"):d=!0,le=this.finishNode(Ce,Oe?"UpdateExpression":"UnaryExpression")}else if(!d&&this.type===O.privateId)(F||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),le=this.parsePrivateIdent(),this.type!==O._in&&this.unexpected();else{if(le=this.parseExprSubscripts(n,F),this.checkExpressionErrors(n))return le;for(;this.type.postfix&&!this.canInsertSemicolon();){var He=this.startNodeAt(W,ae);He.operator=this.value,He.prefix=!1,He.argument=le,this.checkLValSimple(le),this.next(),le=this.finishNode(He,"UpdateExpression")}}if(!A&&this.eat(O.starstar))if(d)this.unexpected(this.lastTokStart);else return this.buildBinary(W,ae,le,this.parseMaybeUnary(null,!1,!1,F),"**",!1);else return le};function N(n){return n.type==="Identifier"||n.type==="ParenthesizedExpression"&&N(n.expression)}function U(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&U(n.expression)||n.type==="ParenthesizedExpression"&&U(n.expression)}b.parseExprSubscripts=function(n,d){var A=this.start,F=this.startLoc,W=this.parseExprAtom(n,d);if(W.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return W;var ae=this.parseSubscripts(W,A,F,!1,d);return n&&ae.type==="MemberExpression"&&(n.parenthesizedAssign>=ae.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=ae.start&&(n.parenthesizedBind=-1),n.trailingComma>=ae.start&&(n.trailingComma=-1)),ae},b.parseSubscripts=function(n,d,A,F,W){for(var ae=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,le=!1;;){var Ce=this.parseSubscript(n,d,A,F,ae,le,W);if(Ce.optional&&(le=!0),Ce===n||Ce.type==="ArrowFunctionExpression"){if(le){var Oe=this.startNodeAt(d,A);Oe.expression=Ce,Ce=this.finishNode(Oe,"ChainExpression")}return Ce}n=Ce}},b.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(O.arrow)},b.parseSubscriptAsyncArrow=function(n,d,A,F){return this.parseArrowExpression(this.startNodeAt(n,d),A,!0,F)},b.parseSubscript=function(n,d,A,F,W,ae,le){var Ce=this.options.ecmaVersion>=11,Oe=Ce&&this.eat(O.questionDot);F&&Oe&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var He=this.eat(O.bracketL);if(He||Oe&&this.type!==O.parenL&&this.type!==O.backQuote||this.eat(O.dot)){var Qe=this.startNodeAt(d,A);Qe.object=n,He?(Qe.property=this.parseExpression(),this.expect(O.bracketR)):this.type===O.privateId&&n.type!=="Super"?Qe.property=this.parsePrivateIdent():Qe.property=this.parseIdent(this.options.allowReserved!=="never"),Qe.computed=!!He,Ce&&(Qe.optional=Oe),n=this.finishNode(Qe,"MemberExpression")}else if(!F&&this.eat(O.parenL)){var ot=new p,St=this.yieldPos,wi=this.awaitPos,ti=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yt=this.parseExprList(O.parenR,this.options.ecmaVersion>=8,!1,ot);if(W&&!Oe&&this.shouldParseAsyncArrow())return this.checkPatternErrors(ot,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=St,this.awaitPos=wi,this.awaitIdentPos=ti,this.parseSubscriptAsyncArrow(d,A,Yt,le);this.checkExpressionErrors(ot,!0),this.yieldPos=St||this.yieldPos,this.awaitPos=wi||this.awaitPos,this.awaitIdentPos=ti||this.awaitIdentPos;var ui=this.startNodeAt(d,A);ui.callee=n,ui.arguments=Yt,Ce&&(ui.optional=Oe),n=this.finishNode(ui,"CallExpression")}else if(this.type===O.backQuote){(Oe||ae)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var hi=this.startNodeAt(d,A);hi.tag=n,hi.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(hi,"TaggedTemplateExpression")}return n},b.parseExprAtom=function(n,d,A){this.type===O.slash&&this.readRegexp();var F,W=this.potentialArrowAt===this.start;switch(this.type){case O._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),F=this.startNode(),this.next(),this.type===O.parenL&&!this.allowDirectSuper&&this.raise(F.start,"super() call outside constructor of a subclass"),this.type!==O.dot&&this.type!==O.bracketL&&this.type!==O.parenL&&this.unexpected(),this.finishNode(F,"Super");case O._this:return F=this.startNode(),this.next(),this.finishNode(F,"ThisExpression");case O.name:var ae=this.start,le=this.startLoc,Ce=this.containsEsc,Oe=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ce&&Oe.name==="async"&&!this.canInsertSemicolon()&&this.eat(O._function))return this.overrideContext(I.f_expr),this.parseFunction(this.startNodeAt(ae,le),0,!1,!0,d);if(W&&!this.canInsertSemicolon()){if(this.eat(O.arrow))return this.parseArrowExpression(this.startNodeAt(ae,le),[Oe],!1,d);if(this.options.ecmaVersion>=8&&Oe.name==="async"&&this.type===O.name&&!Ce&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return Oe=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(O.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(ae,le),[Oe],!0,d)}return Oe;case O.regexp:var He=this.value;return F=this.parseLiteral(He.value),F.regex={pattern:He.pattern,flags:He.flags},F;case O.num:case O.string:return this.parseLiteral(this.value);case O._null:case O._true:case O._false:return F=this.startNode(),F.value=this.type===O._null?null:this.type===O._true,F.raw=this.type.keyword,this.next(),this.finishNode(F,"Literal");case O.parenL:var Qe=this.start,ot=this.parseParenAndDistinguishExpression(W,d);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(ot)&&(n.parenthesizedAssign=Qe),n.parenthesizedBind<0&&(n.parenthesizedBind=Qe)),ot;case O.bracketL:return F=this.startNode(),this.next(),F.elements=this.parseExprList(O.bracketR,!0,!0,n),this.finishNode(F,"ArrayExpression");case O.braceL:return this.overrideContext(I.b_expr),this.parseObj(!1,n);case O._function:return F=this.startNode(),this.next(),this.parseFunction(F,0);case O._class:return this.parseClass(this.startNode(),!1);case O._new:return this.parseNew();case O.backQuote:return this.parseTemplate();case O._import:return this.options.ecmaVersion>=11?this.parseExprImport(A):this.unexpected();default:return this.parseExprAtomDefault()}},b.parseExprAtomDefault=function(){this.unexpected()},b.parseExprImport=function(n){var d=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===O.parenL&&!n)return this.parseDynamicImport(d);if(this.type===O.dot){var A=this.startNodeAt(d.start,d.loc&&d.loc.start);return A.name="import",d.meta=this.finishNode(A,"Identifier"),this.parseImportMeta(d)}else this.unexpected()},b.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(O.parenR)?n.options=null:(this.expect(O.comma),this.afterTrailingComma(O.parenR)?n.options=null:(n.options=this.parseMaybeAssign(),this.eat(O.parenR)||(this.expect(O.comma),this.afterTrailingComma(O.parenR)||this.unexpected())));else if(!this.eat(O.parenR)){var d=this.start;this.eat(O.comma)&&this.eat(O.parenR)?this.raiseRecoverable(d,"Trailing comma is not allowed in import()"):this.unexpected(d)}return this.finishNode(n,"ImportExpression")},b.parseImportMeta=function(n){this.next();var d=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),d&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")},b.parseLiteral=function(n){var d=this.startNode();return d.value=n,d.raw=this.input.slice(this.start,this.end),d.raw.charCodeAt(d.raw.length-1)===110&&(d.bigint=d.value!=null?d.value.toString():d.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(d,"Literal")},b.parseParenExpression=function(){this.expect(O.parenL);var n=this.parseExpression();return this.expect(O.parenR),n},b.shouldParseArrow=function(n){return!this.canInsertSemicolon()},b.parseParenAndDistinguishExpression=function(n,d){var A=this.start,F=this.startLoc,W,ae=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var le=this.start,Ce=this.startLoc,Oe=[],He=!0,Qe=!1,ot=new p,St=this.yieldPos,wi=this.awaitPos,ti;for(this.yieldPos=0,this.awaitPos=0;this.type!==O.parenR;)if(He?He=!1:this.expect(O.comma),ae&&this.afterTrailingComma(O.parenR,!0)){Qe=!0;break}else if(this.type===O.ellipsis){ti=this.start,Oe.push(this.parseParenItem(this.parseRestBinding())),this.type===O.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else Oe.push(this.parseMaybeAssign(!1,ot,this.parseParenItem));var Yt=this.lastTokEnd,ui=this.lastTokEndLoc;if(this.expect(O.parenR),n&&this.shouldParseArrow(Oe)&&this.eat(O.arrow))return this.checkPatternErrors(ot,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=St,this.awaitPos=wi,this.parseParenArrowList(A,F,Oe,d);(!Oe.length||Qe)&&this.unexpected(this.lastTokStart),ti&&this.unexpected(ti),this.checkExpressionErrors(ot,!0),this.yieldPos=St||this.yieldPos,this.awaitPos=wi||this.awaitPos,Oe.length>1?(W=this.startNodeAt(le,Ce),W.expressions=Oe,this.finishNodeAt(W,"SequenceExpression",Yt,ui)):W=Oe[0]}else W=this.parseParenExpression();if(this.options.preserveParens){var hi=this.startNodeAt(A,F);return hi.expression=W,this.finishNode(hi,"ParenthesizedExpression")}else return W},b.parseParenItem=function(n){return n},b.parseParenArrowList=function(n,d,A,F){return this.parseArrowExpression(this.startNodeAt(n,d),A,!1,F)};var H=[];b.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===O.dot){var d=this.startNodeAt(n.start,n.loc&&n.loc.start);d.name="new",n.meta=this.finishNode(d,"Identifier"),this.next();var A=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),A&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var F=this.start,W=this.startLoc;return n.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),F,W,!0,!1),this.eat(O.parenL)?n.arguments=this.parseExprList(O.parenR,this.options.ecmaVersion>=8,!1):n.arguments=H,this.finishNode(n,"NewExpression")},b.parseTemplateElement=function(n){var d=n.isTagged,A=this.startNode();return this.type===O.invalidTemplate?(d||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),A.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):A.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),A.tail=this.type===O.backQuote,this.finishNode(A,"TemplateElement")},b.parseTemplate=function(n){n===void 0&&(n={});var d=n.isTagged;d===void 0&&(d=!1);var A=this.startNode();this.next(),A.expressions=[];var F=this.parseTemplateElement({isTagged:d});for(A.quasis=[F];!F.tail;)this.type===O.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(O.dollarBraceL),A.expressions.push(this.parseExpression()),this.expect(O.braceR),A.quasis.push(F=this.parseTemplateElement({isTagged:d}));return this.next(),this.finishNode(A,"TemplateLiteral")},b.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===O.name||this.type===O.num||this.type===O.string||this.type===O.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===O.star)&&!ye.test(this.input.slice(this.lastTokEnd,this.start))},b.parseObj=function(n,d){var A=this.startNode(),F=!0,W={};for(A.properties=[],this.next();!this.eat(O.braceR);){if(F)F=!1;else if(this.expect(O.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(O.braceR))break;var ae=this.parseProperty(n,d);n||this.checkPropClash(ae,W,d),A.properties.push(ae)}return this.finishNode(A,n?"ObjectPattern":"ObjectExpression")},b.parseProperty=function(n,d){var A=this.startNode(),F,W,ae,le;if(this.options.ecmaVersion>=9&&this.eat(O.ellipsis))return n?(A.argument=this.parseIdent(!1),this.type===O.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(A,"RestElement")):(A.argument=this.parseMaybeAssign(!1,d),this.type===O.comma&&d&&d.trailingComma<0&&(d.trailingComma=this.start),this.finishNode(A,"SpreadElement"));this.options.ecmaVersion>=6&&(A.method=!1,A.shorthand=!1,(n||d)&&(ae=this.start,le=this.startLoc),n||(F=this.eat(O.star)));var Ce=this.containsEsc;return this.parsePropertyName(A),!n&&!Ce&&this.options.ecmaVersion>=8&&!F&&this.isAsyncProp(A)?(W=!0,F=this.options.ecmaVersion>=9&&this.eat(O.star),this.parsePropertyName(A)):W=!1,this.parsePropertyValue(A,n,F,W,ae,le,d,Ce),this.finishNode(A,"Property")},b.parseGetterSetter=function(n){var d=n.key.name;this.parsePropertyName(n),n.value=this.parseMethod(!1),n.kind=d;var A=n.kind==="get"?0:1;if(n.value.params.length!==A){var F=n.value.start;n.kind==="get"?this.raiseRecoverable(F,"getter should have no params"):this.raiseRecoverable(F,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")},b.parsePropertyValue=function(n,d,A,F,W,ae,le,Ce){(A||F)&&this.type===O.colon&&this.unexpected(),this.eat(O.colon)?(n.value=d?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,le),n.kind="init"):this.options.ecmaVersion>=6&&this.type===O.parenL?(d&&this.unexpected(),n.method=!0,n.value=this.parseMethod(A,F),n.kind="init"):!d&&!Ce&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==O.comma&&this.type!==O.braceR&&this.type!==O.eq?((A||F)&&this.unexpected(),this.parseGetterSetter(n)):this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((A||F)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=W),d?n.value=this.parseMaybeDefault(W,ae,this.copyNode(n.key)):this.type===O.eq&&le?(le.shorthandAssign<0&&(le.shorthandAssign=this.start),n.value=this.parseMaybeDefault(W,ae,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.kind="init",n.shorthand=!0):this.unexpected()},b.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(O.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(O.bracketR),n.key;n.computed=!1}return n.key=this.type===O.num||this.type===O.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},b.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)},b.parseMethod=function(n,d,A){var F=this.startNode(),W=this.yieldPos,ae=this.awaitPos,le=this.awaitIdentPos;return this.initFunction(F),this.options.ecmaVersion>=6&&(F.generator=n),this.options.ecmaVersion>=8&&(F.async=!!d),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Li(d,F.generator)|_i|(A?Pn:0)),this.expect(O.parenL),F.params=this.parseBindingList(O.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(F,!1,!0,!1),this.yieldPos=W,this.awaitPos=ae,this.awaitIdentPos=le,this.finishNode(F,"FunctionExpression")},b.parseArrowExpression=function(n,d,A,F){var W=this.yieldPos,ae=this.awaitPos,le=this.awaitIdentPos;return this.enterScope(Li(A,!1)|ai),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!A),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(d,!0),this.parseFunctionBody(n,!0,!1,F),this.yieldPos=W,this.awaitPos=ae,this.awaitIdentPos=le,this.finishNode(n,"ArrowFunctionExpression")},b.parseFunctionBody=function(n,d,A,F){var W=d&&this.type!==O.braceL,ae=this.strict,le=!1;if(W)n.body=this.parseMaybeAssign(F),n.expression=!0,this.checkParams(n,!1);else{var Ce=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!ae||Ce)&&(le=this.strictDirective(this.end),le&&Ce&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Oe=this.labels;this.labels=[],le&&(this.strict=!0),this.checkParams(n,!ae&&!le&&!d&&!A&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,e),n.body=this.parseBlock(!1,void 0,le&&!ae),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=Oe}this.exitScope()},b.isSimpleParamList=function(n){for(var d=0,A=n;d<A.length;d+=1){var F=A[d];if(F.type!=="Identifier")return!1}return!0},b.checkParams=function(n,d){for(var A=Object.create(null),F=0,W=n.params;F<W.length;F+=1){var ae=W[F];this.checkLValInnerPattern(ae,yi,d?null:A)}},b.parseExprList=function(n,d,A,F){for(var W=[],ae=!0;!this.eat(n);){if(ae)ae=!1;else if(this.expect(O.comma),d&&this.afterTrailingComma(n))break;var le=void 0;A&&this.type===O.comma?le=null:this.type===O.ellipsis?(le=this.parseSpread(F),F&&this.type===O.comma&&F.trailingComma<0&&(F.trailingComma=this.start)):le=this.parseMaybeAssign(!1,F),W.push(le)}return W},b.checkUnreserved=function(n){var d=n.start,A=n.end,F=n.name;if(this.inGenerator&&F==="yield"&&this.raiseRecoverable(d,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&F==="await"&&this.raiseRecoverable(d,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&Mi)&&F==="arguments"&&this.raiseRecoverable(d,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(F==="arguments"||F==="await")&&this.raise(d,"Cannot use "+F+" in class static initialization block"),this.keywords.test(F)&&this.raise(d,"Unexpected keyword '"+F+"'"),!(this.options.ecmaVersion<6&&this.input.slice(d,A).indexOf("\\")!==-1)){var W=this.strict?this.reservedWordsStrict:this.reservedWords;W.test(F)&&(!this.inAsync&&F==="await"&&this.raiseRecoverable(d,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(d,"The keyword '"+F+"' is reserved"))}},b.parseIdent=function(n){var d=this.parseIdentNode();return this.next(!!n),this.finishNode(d,"Identifier"),n||(this.checkUnreserved(d),d.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=d.start)),d},b.parseIdentNode=function(){var n=this.startNode();return this.type===O.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,(n.name==="class"||n.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=O.name):this.unexpected(),n},b.parsePrivateIdent=function(){var n=this.startNode();return this.type===O.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n)),n},b.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var d=this.startNode();return this.next(),this.type===O.semi||this.canInsertSemicolon()||this.type!==O.star&&!this.type.startsExpr?(d.delegate=!1,d.argument=null):(d.delegate=this.eat(O.star),d.argument=this.parseMaybeAssign(n)),this.finishNode(d,"YieldExpression")},b.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var d=this.startNode();return this.next(),d.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(d,"AwaitExpression")};var D=i.prototype;D.raise=function(n,d){var A=Hi(this.input,n);d+=" ("+A.line+":"+A.column+")",this.sourceFile&&(d+=" in "+this.sourceFile);var F=new SyntaxError(d);throw F.pos=n,F.loc=A,F.raisedAt=this.pos,F},D.raiseRecoverable=D.raise,D.curPosition=function(){if(this.options.locations)return new Bt(this.curLine,this.pos-this.lineStart)};var G=i.prototype,K=function(d){this.flags=d,this.var=[],this.lexical=[],this.functions=[]};G.enterScope=function(n){this.scopeStack.push(new K(n))},G.exitScope=function(){this.scopeStack.pop()},G.treatFunctionsAsVarInScope=function(n){return n.flags&ut||!this.inModule&&n.flags&at},G.declareName=function(n,d,A){var F=!1;if(d===nt){var W=this.currentScope();F=W.lexical.indexOf(n)>-1||W.functions.indexOf(n)>-1||W.var.indexOf(n)>-1,W.lexical.push(n),this.inModule&&W.flags&at&&delete this.undefinedExports[n]}else if(d===Ye){var ae=this.currentScope();ae.lexical.push(n)}else if(d===Wi){var le=this.currentScope();this.treatFunctionsAsVar?F=le.lexical.indexOf(n)>-1:F=le.lexical.indexOf(n)>-1||le.var.indexOf(n)>-1,le.functions.push(n)}else for(var Ce=this.scopeStack.length-1;Ce>=0;--Ce){var Oe=this.scopeStack[Ce];if(Oe.lexical.indexOf(n)>-1&&!(Oe.flags&Cn&&Oe.lexical[0]===n)||!this.treatFunctionsAsVarInScope(Oe)&&Oe.functions.indexOf(n)>-1){F=!0;break}if(Oe.var.push(n),this.inModule&&Oe.flags&at&&delete this.undefinedExports[n],Oe.flags&Mi)break}F&&this.raiseRecoverable(A,"Identifier '"+n+"' has already been declared")},G.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)},G.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},G.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var d=this.scopeStack[n];if(d.flags&(Mi|vi|$t))return d}},G.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var d=this.scopeStack[n];if(d.flags&(Mi|vi|$t)&&!(d.flags&ai))return d}};var X=function(d,A,F){this.type="",this.start=A,this.end=0,d.options.locations&&(this.loc=new Xt(d,F)),d.options.directSourceFile&&(this.sourceFile=d.options.directSourceFile),d.options.ranges&&(this.range=[A,0])},$=i.prototype;$.startNode=function(){return new X(this,this.start,this.startLoc)},$.startNodeAt=function(n,d){return new X(this,n,d)};function j(n,d,A,F){return n.type=d,n.end=A,this.options.locations&&(n.loc.end=F),this.options.ranges&&(n.range[1]=A),n}$.finishNode=function(n,d){return j.call(this,n,d,this.lastTokEnd,this.lastTokEndLoc)},$.finishNodeAt=function(n,d,A,F){return j.call(this,n,d,A,F)},$.copyNode=function(n){var d=new X(this,n.start,this.startLoc);for(var A in n)d[A]=n[A];return d};var Q="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",ee="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",re=ee+" Extended_Pictographic",se=re,ue=se+" EBase EComp EMod EPres ExtPict",xe=ue,ke=xe,Te={9:ee,10:re,11:se,12:ue,13:xe,14:ke},ze="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",ge={9:"",10:"",11:"",12:"",13:"",14:ze},_e="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Le="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Re=Le+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Ne=Re+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Be=Ne+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Fe=Be+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",Ge=Fe+" "+Q,Ke={9:Le,10:Re,11:Ne,12:Be,13:Fe,14:Ge},Ue={};function vt(n){var d=Ue[n]={binary:Ve(Te[n]+" "+_e),binaryOfStrings:Ve(ge[n]),nonBinary:{General_Category:Ve(_e),Script:Ve(Ke[n])}};d.nonBinary.Script_Extensions=d.nonBinary.Script,d.nonBinary.gc=d.nonBinary.General_Category,d.nonBinary.sc=d.nonBinary.Script,d.nonBinary.scx=d.nonBinary.Script_Extensions}for(var gt=0,bt=[9,10,11,12,13,14];gt<bt.length;gt+=1){var mt=bt[gt];vt(mt)}var Ie=i.prototype,lt=function(d,A){this.parent=d,this.base=A||this};lt.prototype.separatedFrom=function(d){for(var A=this;A;A=A.parent)for(var F=d;F;F=F.parent)if(A.base===F.base&&A!==F)return!0;return!1},lt.prototype.sibling=function(){return new lt(this.parent,this.base)};var ct=function(d){this.parser=d,this.validFlags="gim"+(d.options.ecmaVersion>=6?"uy":"")+(d.options.ecmaVersion>=9?"s":"")+(d.options.ecmaVersion>=13?"d":"")+(d.options.ecmaVersion>=15?"v":""),this.unicodeProperties=Ue[d.options.ecmaVersion>=14?14:d.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};ct.prototype.reset=function(d,A,F){var W=F.indexOf("v")!==-1,ae=F.indexOf("u")!==-1;this.start=d|0,this.source=A+"",this.flags=F,W&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=ae&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=ae&&this.parser.options.ecmaVersion>=9)},ct.prototype.raise=function(d){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+d)},ct.prototype.at=function(d,A){A===void 0&&(A=!1);var F=this.source,W=F.length;if(d>=W)return-1;var ae=F.charCodeAt(d);if(!(A||this.switchU)||ae<=55295||ae>=57344||d+1>=W)return ae;var le=F.charCodeAt(d+1);return le>=56320&&le<=57343?(ae<<10)+le-56613888:ae},ct.prototype.nextIndex=function(d,A){A===void 0&&(A=!1);var F=this.source,W=F.length;if(d>=W)return W;var ae=F.charCodeAt(d),le;return!(A||this.switchU)||ae<=55295||ae>=57344||d+1>=W||(le=F.charCodeAt(d+1))<56320||le>57343?d+1:d+2},ct.prototype.current=function(d){return d===void 0&&(d=!1),this.at(this.pos,d)},ct.prototype.lookahead=function(d){return d===void 0&&(d=!1),this.at(this.nextIndex(this.pos,d),d)},ct.prototype.advance=function(d){d===void 0&&(d=!1),this.pos=this.nextIndex(this.pos,d)},ct.prototype.eat=function(d,A){return A===void 0&&(A=!1),this.current(A)===d?(this.advance(A),!0):!1},ct.prototype.eatChars=function(d,A){A===void 0&&(A=!1);for(var F=this.pos,W=0,ae=d;W<ae.length;W+=1){var le=ae[W],Ce=this.at(F,A);if(Ce===-1||Ce!==le)return!1;F=this.nextIndex(F,A)}return this.pos=F,!0},Ie.validateRegExpFlags=function(n){for(var d=n.validFlags,A=n.flags,F=!1,W=!1,ae=0;ae<A.length;ae++){var le=A.charAt(ae);d.indexOf(le)===-1&&this.raise(n.start,"Invalid regular expression flag"),A.indexOf(le,ae+1)>-1&&this.raise(n.start,"Duplicate regular expression flag"),le==="u"&&(F=!0),le==="v"&&(W=!0)}this.options.ecmaVersion>=15&&F&&W&&this.raise(n.start,"Invalid regular expression flag")};function yt(n){for(var d in n)return!0;return!1}Ie.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&yt(n.groupNames)&&(n.switchN=!0,this.regexp_pattern(n))},Ie.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames=Object.create(null),n.backReferenceNames.length=0,n.branchID=null,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var d=0,A=n.backReferenceNames;d<A.length;d+=1){var F=A[d];n.groupNames[F]||n.raise("Invalid named capture referenced")}},Ie.regexp_disjunction=function(n){var d=this.options.ecmaVersion>=16;for(d&&(n.branchID=new lt(n.branchID,null)),this.regexp_alternative(n);n.eat(124);)d&&(n.branchID=n.branchID.sibling()),this.regexp_alternative(n);d&&(n.branchID=n.branchID.parent),this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")},Ie.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););},Ie.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1},Ie.regexp_eatAssertion=function(n){var d=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=d}if(n.eat(40)&&n.eat(63)){var A=!1;if(this.options.ecmaVersion>=9&&(A=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!A,!0}return n.pos=d,!1},Ie.regexp_eatQuantifier=function(n,d){return d===void 0&&(d=!1),this.regexp_eatQuantifierPrefix(n,d)?(n.eat(63),!0):!1},Ie.regexp_eatQuantifierPrefix=function(n,d){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,d)},Ie.regexp_eatBracedQuantifier=function(n,d){var A=n.pos;if(n.eat(123)){var F=0,W=-1;if(this.regexp_eatDecimalDigits(n)&&(F=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(W=n.lastIntValue),n.eat(125)))return W!==-1&&W<F&&!d&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!d&&n.raise("Incomplete quantifier"),n.pos=A}return!1},Ie.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)},Ie.regexp_eatReverseSolidusAtomEscape=function(n){var d=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=d}return!1},Ie.regexp_eatUncapturingGroup=function(n){var d=n.pos;if(n.eat(40)){if(n.eat(63)){if(this.options.ecmaVersion>=16){var A=this.regexp_eatModifiers(n),F=n.eat(45);if(A||F){for(var W=0;W<A.length;W++){var ae=A.charAt(W);A.indexOf(ae,W+1)>-1&&n.raise("Duplicate regular expression modifiers")}if(F){var le=this.regexp_eatModifiers(n);!A&&!le&&n.current()===58&&n.raise("Invalid regular expression modifiers");for(var Ce=0;Ce<le.length;Ce++){var Oe=le.charAt(Ce);(le.indexOf(Oe,Ce+1)>-1||A.indexOf(Oe)>-1)&&n.raise("Duplicate regular expression modifiers")}}}}if(n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}}n.pos=d}return!1},Ie.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1},Ie.regexp_eatModifiers=function(n){for(var d="",A=0;(A=n.current())!==-1&&Nt(A);)d+=it(A),n.advance();return d};function Nt(n){return n===105||n===109||n===115}Ie.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)},Ie.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1},Ie.regexp_eatSyntaxCharacter=function(n){var d=n.current();return Gt(d)?(n.lastIntValue=d,n.advance(),!0):!1};function Gt(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}Ie.regexp_eatPatternCharacters=function(n){for(var d=n.pos,A=0;(A=n.current())!==-1&&!Gt(A);)n.advance();return n.pos!==d},Ie.regexp_eatExtendedPatternCharacter=function(n){var d=n.current();return d!==-1&&d!==36&&!(d>=40&&d<=43)&&d!==46&&d!==63&&d!==91&&d!==94&&d!==124?(n.advance(),!0):!1},Ie.regexp_groupSpecifier=function(n){if(n.eat(63)){this.regexp_eatGroupName(n)||n.raise("Invalid group");var d=this.options.ecmaVersion>=16,A=n.groupNames[n.lastStringValue];if(A)if(d)for(var F=0,W=A;F<W.length;F+=1){var ae=W[F];ae.separatedFrom(n.branchID)||n.raise("Duplicate capture group name")}else n.raise("Duplicate capture group name");d?(A||(n.groupNames[n.lastStringValue]=[])).push(n.branchID):n.groupNames[n.lastStringValue]=!0}},Ie.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1},Ie.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=it(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=it(n.lastIntValue);return!0}return!1},Ie.regexp_eatRegExpIdentifierStart=function(n){var d=n.pos,A=this.options.ecmaVersion>=11,F=n.current(A);return n.advance(A),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,A)&&(F=n.lastIntValue),Rt(F)?(n.lastIntValue=F,!0):(n.pos=d,!1)};function Rt(n){return te(n,!0)||n===36||n===95}Ie.regexp_eatRegExpIdentifierPart=function(n){var d=n.pos,A=this.options.ecmaVersion>=11,F=n.current(A);return n.advance(A),F===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,A)&&(F=n.lastIntValue),Dt(F)?(n.lastIntValue=F,!0):(n.pos=d,!1)};function Dt(n){return Z(n,!0)||n===36||n===95||n===8204||n===8205}Ie.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)},Ie.regexp_eatBackReference=function(n){var d=n.pos;if(this.regexp_eatDecimalEscape(n)){var A=n.lastIntValue;if(n.switchU)return A>n.maxBackReference&&(n.maxBackReference=A),!0;if(A<=n.numCapturingParens)return!0;n.pos=d}return!1},Ie.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1},Ie.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)},Ie.regexp_eatCControlLetter=function(n){var d=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=d}return!1},Ie.regexp_eatZero=function(n){return n.current()===48&&!oi(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1},Ie.regexp_eatControlEscape=function(n){var d=n.current();return d===116?(n.lastIntValue=9,n.advance(),!0):d===110?(n.lastIntValue=10,n.advance(),!0):d===118?(n.lastIntValue=11,n.advance(),!0):d===102?(n.lastIntValue=12,n.advance(),!0):d===114?(n.lastIntValue=13,n.advance(),!0):!1},Ie.regexp_eatControlLetter=function(n){var d=n.current();return kt(d)?(n.lastIntValue=d%32,n.advance(),!0):!1};function kt(n){return n>=65&&n<=90||n>=97&&n<=122}Ie.regexp_eatRegExpUnicodeEscapeSequence=function(n,d){d===void 0&&(d=!1);var A=n.pos,F=d||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var W=n.lastIntValue;if(F&&W>=55296&&W<=56319){var ae=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var le=n.lastIntValue;if(le>=56320&&le<=57343)return n.lastIntValue=(W-55296)*1024+(le-56320)+65536,!0}n.pos=ae,n.lastIntValue=W}return!0}if(F&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&Lt(n.lastIntValue))return!0;F&&n.raise("Invalid unicode escape"),n.pos=A}return!1};function Lt(n){return n>=0&&n<=1114111}Ie.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var d=n.current();return d!==99&&(!n.switchN||d!==107)?(n.lastIntValue=d,n.advance(),!0):!1},Ie.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var d=n.current();if(d>=49&&d<=57){do n.lastIntValue=10*n.lastIntValue+(d-48),n.advance();while((d=n.current())>=48&&d<=57);return!0}return!1};var jt=0,xt=1,It=2;Ie.regexp_eatCharacterClassEscape=function(n){var d=n.current();if(kn(d))return n.lastIntValue=-1,n.advance(),xt;var A=!1;if(n.switchU&&this.options.ecmaVersion>=9&&((A=d===80)||d===112)){n.lastIntValue=-1,n.advance();var F;if(n.eat(123)&&(F=this.regexp_eatUnicodePropertyValueExpression(n))&&n.eat(125))return A&&F===It&&n.raise("Invalid property name"),F;n.raise("Invalid property name")}return jt};function kn(n){return n===100||n===68||n===115||n===83||n===119||n===87}Ie.regexp_eatUnicodePropertyValueExpression=function(n){var d=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var A=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var F=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,A,F),xt}}if(n.pos=d,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var W=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,W)}return jt},Ie.regexp_validateUnicodePropertyNameAndValue=function(n,d,A){de(n.unicodeProperties.nonBinary,d)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[d].test(A)||n.raise("Invalid property value")},Ie.regexp_validateUnicodePropertyNameOrValue=function(n,d){if(n.unicodeProperties.binary.test(d))return xt;if(n.switchV&&n.unicodeProperties.binaryOfStrings.test(d))return It;n.raise("Invalid property name")},Ie.regexp_eatUnicodePropertyName=function(n){var d=0;for(n.lastStringValue="";Zi(d=n.current());)n.lastStringValue+=it(d),n.advance();return n.lastStringValue!==""};function Zi(n){return kt(n)||n===95}Ie.regexp_eatUnicodePropertyValue=function(n){var d=0;for(n.lastStringValue="";In(d=n.current());)n.lastStringValue+=it(d),n.advance();return n.lastStringValue!==""};function In(n){return Zi(n)||oi(n)}Ie.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)},Ie.regexp_eatCharacterClass=function(n){if(n.eat(91)){var d=n.eat(94),A=this.regexp_classContents(n);return n.eat(93)||n.raise("Unterminated character class"),d&&A===It&&n.raise("Negated character class may contain strings"),!0}return!1},Ie.regexp_classContents=function(n){return n.current()===93?xt:n.switchV?this.regexp_classSetExpression(n):(this.regexp_nonEmptyClassRanges(n),xt)},Ie.regexp_nonEmptyClassRanges=function(n){for(;this.regexp_eatClassAtom(n);){var d=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var A=n.lastIntValue;n.switchU&&(d===-1||A===-1)&&n.raise("Invalid character class"),d!==-1&&A!==-1&&d>A&&n.raise("Range out of order in character class")}}},Ie.regexp_eatClassAtom=function(n){var d=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var A=n.current();(A===99||Jt(A))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=d}var F=n.current();return F!==93?(n.lastIntValue=F,n.advance(),!0):!1},Ie.regexp_eatClassEscape=function(n){var d=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=d}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)},Ie.regexp_classSetExpression=function(n){var d=xt,A;if(!this.regexp_eatClassSetRange(n))if(A=this.regexp_eatClassSetOperand(n)){A===It&&(d=It);for(var F=n.pos;n.eatChars([38,38]);){if(n.current()!==38&&(A=this.regexp_eatClassSetOperand(n))){A!==It&&(d=xt);continue}n.raise("Invalid character in character class")}if(F!==n.pos)return d;for(;n.eatChars([45,45]);)this.regexp_eatClassSetOperand(n)||n.raise("Invalid character in character class");if(F!==n.pos)return d}else n.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(n)){if(A=this.regexp_eatClassSetOperand(n),!A)return d;A===It&&(d=It)}},Ie.regexp_eatClassSetRange=function(n){var d=n.pos;if(this.regexp_eatClassSetCharacter(n)){var A=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassSetCharacter(n)){var F=n.lastIntValue;return A!==-1&&F!==-1&&A>F&&n.raise("Range out of order in character class"),!0}n.pos=d}return!1},Ie.regexp_eatClassSetOperand=function(n){return this.regexp_eatClassSetCharacter(n)?xt:this.regexp_eatClassStringDisjunction(n)||this.regexp_eatNestedClass(n)},Ie.regexp_eatNestedClass=function(n){var d=n.pos;if(n.eat(91)){var A=n.eat(94),F=this.regexp_classContents(n);if(n.eat(93))return A&&F===It&&n.raise("Negated character class may contain strings"),F;n.pos=d}if(n.eat(92)){var W=this.regexp_eatCharacterClassEscape(n);if(W)return W;n.pos=d}return null},Ie.regexp_eatClassStringDisjunction=function(n){var d=n.pos;if(n.eatChars([92,113])){if(n.eat(123)){var A=this.regexp_classStringDisjunctionContents(n);if(n.eat(125))return A}else n.raise("Invalid escape");n.pos=d}return null},Ie.regexp_classStringDisjunctionContents=function(n){for(var d=this.regexp_classString(n);n.eat(124);)this.regexp_classString(n)===It&&(d=It);return d},Ie.regexp_classString=function(n){for(var d=0;this.regexp_eatClassSetCharacter(n);)d++;return d===1?xt:It},Ie.regexp_eatClassSetCharacter=function(n){var d=n.pos;if(n.eat(92))return this.regexp_eatCharacterEscape(n)||this.regexp_eatClassSetReservedPunctuator(n)?!0:n.eat(98)?(n.lastIntValue=8,!0):(n.pos=d,!1);var A=n.current();return A<0||A===n.lookahead()&&En(A)||An(A)?!1:(n.advance(),n.lastIntValue=A,!0)};function En(n){return n===33||n>=35&&n<=38||n>=42&&n<=44||n===46||n>=58&&n<=64||n===94||n===96||n===126}function An(n){return n===40||n===41||n===45||n===47||n>=91&&n<=93||n>=123&&n<=125}Ie.regexp_eatClassSetReservedPunctuator=function(n){var d=n.current();return Oi(d)?(n.lastIntValue=d,n.advance(),!0):!1};function Oi(n){return n===33||n===35||n===37||n===38||n===44||n===45||n>=58&&n<=62||n===64||n===96||n===126}Ie.regexp_eatClassControlLetter=function(n){var d=n.current();return oi(d)||d===95?(n.lastIntValue=d%32,n.advance(),!0):!1},Ie.regexp_eatHexEscapeSequence=function(n){var d=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=d}return!1},Ie.regexp_eatDecimalDigits=function(n){var d=n.pos,A=0;for(n.lastIntValue=0;oi(A=n.current());)n.lastIntValue=10*n.lastIntValue+(A-48),n.advance();return n.pos!==d};function oi(n){return n>=48&&n<=57}Ie.regexp_eatHexDigits=function(n){var d=n.pos,A=0;for(n.lastIntValue=0;xi(A=n.current());)n.lastIntValue=16*n.lastIntValue+bi(A),n.advance();return n.pos!==d};function xi(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function bi(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}Ie.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var d=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var A=n.lastIntValue;d<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=d*64+A*8+n.lastIntValue:n.lastIntValue=d*8+A}else n.lastIntValue=d;return!0}return!1},Ie.regexp_eatOctalDigit=function(n){var d=n.current();return Jt(d)?(n.lastIntValue=d-48,n.advance(),!0):(n.lastIntValue=0,!1)};function Jt(n){return n>=48&&n<=55}Ie.regexp_eatFixedHexDigits=function(n,d){var A=n.pos;n.lastIntValue=0;for(var F=0;F<d;++F){var W=n.current();if(!xi(W))return n.pos=A,!1;n.lastIntValue=16*n.lastIntValue+bi(W),n.advance()}return!0};var Ut=function(d){this.type=d.type,this.value=d.value,this.start=d.start,this.end=d.end,d.options.locations&&(this.loc=new Xt(d,d.startLoc,d.endLoc)),d.options.ranges&&(this.range=[d.start,d.end])},We=i.prototype;We.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ut(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},We.getToken=function(){return this.next(),new Ut(this)},typeof Symbol<"u"&&(We[Symbol.iterator]=function(){var n=this;return{next:function(){var d=n.getToken();return{done:d.type===O.eof,value:d}}}}),We.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(O.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())},We.readToken=function(n){return te(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)},We.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var d=this.input.charCodeAt(this.pos+1);return d<=56319||d>=57344?n:(n<<10)+d-56613888},We.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),d=this.pos,A=this.input.indexOf("*/",this.pos+=2);if(A===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=A+2,this.options.locations)for(var F=void 0,W=d;(F=Ee(this.input,W,this.pos))>-1;)++this.curLine,W=this.lineStart=F;this.options.onComment&&this.options.onComment(!0,this.input.slice(d+2,A),d,this.pos,n,this.curPosition())},We.skipLineComment=function(n){for(var d=this.pos,A=this.options.onComment&&this.curPosition(),F=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!me(F);)F=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(d+n,this.pos),d,this.pos,A,this.curPosition())},We.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&Me.test(String.fromCharCode(n)))++this.pos;else break e}}},We.finishToken=function(n,d){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var A=this.type;this.type=n,this.value=d,this.updateContext(A)},We.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var d=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&d===46?(this.pos+=3,this.finishToken(O.ellipsis)):(++this.pos,this.finishToken(O.dot))},We.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(O.assign,2):this.finishOp(O.slash,1)},We.readToken_mult_modulo_exp=function(n){var d=this.input.charCodeAt(this.pos+1),A=1,F=n===42?O.star:O.modulo;return this.options.ecmaVersion>=7&&n===42&&d===42&&(++A,F=O.starstar,d=this.input.charCodeAt(this.pos+2)),d===61?this.finishOp(O.assign,A+1):this.finishOp(F,A)},We.readToken_pipe_amp=function(n){var d=this.input.charCodeAt(this.pos+1);if(d===n){if(this.options.ecmaVersion>=12){var A=this.input.charCodeAt(this.pos+2);if(A===61)return this.finishOp(O.assign,3)}return this.finishOp(n===124?O.logicalOR:O.logicalAND,2)}return d===61?this.finishOp(O.assign,2):this.finishOp(n===124?O.bitwiseOR:O.bitwiseAND,1)},We.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(O.assign,2):this.finishOp(O.bitwiseXOR,1)},We.readToken_plus_min=function(n){var d=this.input.charCodeAt(this.pos+1);return d===n?d===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||ye.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(O.incDec,2):d===61?this.finishOp(O.assign,2):this.finishOp(O.plusMin,1)},We.readToken_lt_gt=function(n){var d=this.input.charCodeAt(this.pos+1),A=1;return d===n?(A=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+A)===61?this.finishOp(O.assign,A+1):this.finishOp(O.bitShift,A)):d===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(d===61&&(A=2),this.finishOp(O.relational,A))},We.readToken_eq_excl=function(n){var d=this.input.charCodeAt(this.pos+1);return d===61?this.finishOp(O.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&d===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(O.arrow)):this.finishOp(n===61?O.eq:O.prefix,1)},We.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var d=this.input.charCodeAt(this.pos+1);if(d===46){var A=this.input.charCodeAt(this.pos+2);if(A<48||A>57)return this.finishOp(O.questionDot,2)}if(d===63){if(n>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(O.assign,3)}return this.finishOp(O.coalesce,2)}}return this.finishOp(O.question,1)},We.readToken_numberSign=function(){var n=this.options.ecmaVersion,d=35;if(n>=13&&(++this.pos,d=this.fullCharCodeAtPos(),te(d,!0)||d===92))return this.finishToken(O.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+it(d)+"'")},We.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(O.parenL);case 41:return++this.pos,this.finishToken(O.parenR);case 59:return++this.pos,this.finishToken(O.semi);case 44:return++this.pos,this.finishToken(O.comma);case 91:return++this.pos,this.finishToken(O.bracketL);case 93:return++this.pos,this.finishToken(O.bracketR);case 123:return++this.pos,this.finishToken(O.braceL);case 125:return++this.pos,this.finishToken(O.braceR);case 58:return++this.pos,this.finishToken(O.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(O.backQuote);case 48:var d=this.input.charCodeAt(this.pos+1);if(d===120||d===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(d===111||d===79)return this.readRadixNumber(8);if(d===98||d===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(O.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+it(n)+"'")},We.finishOp=function(n,d){var A=this.input.slice(this.pos,this.pos+d);return this.pos+=d,this.finishToken(n,A)},We.readRegexp=function(){for(var n,d,A=this.pos;;){this.pos>=this.input.length&&this.raise(A,"Unterminated regular expression");var F=this.input.charAt(this.pos);if(ye.test(F)&&this.raise(A,"Unterminated regular expression"),n)n=!1;else{if(F==="[")d=!0;else if(F==="]"&&d)d=!1;else if(F==="/"&&!d)break;n=F==="\\"}++this.pos}var W=this.input.slice(A,this.pos);++this.pos;var ae=this.pos,le=this.readWord1();this.containsEsc&&this.unexpected(ae);var Ce=this.regexpState||(this.regexpState=new ct(this));Ce.reset(A,W,le),this.validateRegExpFlags(Ce),this.validateRegExpPattern(Ce);var Oe=null;try{Oe=new RegExp(W,le)}catch{}return this.finishToken(O.regexp,{pattern:W,flags:le,value:Oe})},We.readInt=function(n,d,A){for(var F=this.options.ecmaVersion>=12&&d===void 0,W=A&&this.input.charCodeAt(this.pos)===48,ae=this.pos,le=0,Ce=0,Oe=0,He=d??1/0;Oe<He;++Oe,++this.pos){var Qe=this.input.charCodeAt(this.pos),ot=void 0;if(F&&Qe===95){W&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ce===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Oe===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ce=Qe;continue}if(Qe>=97?ot=Qe-97+10:Qe>=65?ot=Qe-65+10:Qe>=48&&Qe<=57?ot=Qe-48:ot=1/0,ot>=n)break;Ce=Qe,le=le*n+ot}return F&&Ce===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ae||d!=null&&this.pos-ae!==d?null:le};function Vt(n,d){return d?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function qt(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}We.readRadixNumber=function(n){var d=this.pos;this.pos+=2;var A=this.readInt(n);return A==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(A=qt(this.input.slice(d,this.pos)),++this.pos):te(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(O.num,A)},We.readNumber=function(n){var d=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(d,"Invalid number");var A=this.pos-d>=2&&this.input.charCodeAt(d)===48;A&&this.strict&&this.raise(d,"Invalid number");var F=this.input.charCodeAt(this.pos);if(!A&&!n&&this.options.ecmaVersion>=11&&F===110){var W=qt(this.input.slice(d,this.pos));return++this.pos,te(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(O.num,W)}A&&/[89]/.test(this.input.slice(d,this.pos))&&(A=!1),F===46&&!A&&(++this.pos,this.readInt(10),F=this.input.charCodeAt(this.pos)),(F===69||F===101)&&!A&&(F=this.input.charCodeAt(++this.pos),(F===43||F===45)&&++this.pos,this.readInt(10)===null&&this.raise(d,"Invalid number")),te(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ae=Vt(this.input.slice(d,this.pos),A);return this.finishToken(O.num,ae)},We.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),d;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var A=++this.pos;d=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,d>1114111&&this.invalidStringToken(A,"Code point out of bounds")}else d=this.readHexChar(4);return d},We.readString=function(n){for(var d="",A=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var F=this.input.charCodeAt(this.pos);if(F===n)break;F===92?(d+=this.input.slice(A,this.pos),d+=this.readEscapedChar(!1),A=this.pos):F===8232||F===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(me(F)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return d+=this.input.slice(A,this.pos++),this.finishToken(O.string,d)};var Ft={};We.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===Ft)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1},We.invalidStringToken=function(n,d){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ft;this.raise(n,d)},We.readTmplToken=function(){for(var n="",d=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var A=this.input.charCodeAt(this.pos);if(A===96||A===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===O.template||this.type===O.invalidTemplate)?A===36?(this.pos+=2,this.finishToken(O.dollarBraceL)):(++this.pos,this.finishToken(O.backQuote)):(n+=this.input.slice(d,this.pos),this.finishToken(O.template,n));if(A===92)n+=this.input.slice(d,this.pos),n+=this.readEscapedChar(!0),d=this.pos;else if(me(A)){switch(n+=this.input.slice(d,this.pos),++this.pos,A){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(A);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),d=this.pos}else++this.pos}},We.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(O.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")},We.readEscapedChar=function(n){var d=this.input.charCodeAt(++this.pos);switch(++this.pos,d){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return it(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var A=this.pos-1;this.invalidStringToken(A,"Invalid escape sequence in template string")}default:if(d>=48&&d<=55){var F=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],W=parseInt(F,8);return W>255&&(F=F.slice(0,-1),W=parseInt(F,8)),this.pos+=F.length-1,d=this.input.charCodeAt(this.pos),(F!=="0"||d===56||d===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-F.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(W)}return me(d)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(d)}},We.readHexChar=function(n){var d=this.pos,A=this.readInt(16,n);return A===null&&this.invalidStringToken(d,"Bad character escape sequence"),A},We.readWord1=function(){this.containsEsc=!1;for(var n="",d=!0,A=this.pos,F=this.options.ecmaVersion>=6;this.pos<this.input.length;){var W=this.fullCharCodeAtPos();if(Z(W,F))this.pos+=W<=65535?1:2;else if(W===92){this.containsEsc=!0,n+=this.input.slice(A,this.pos);var ae=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var le=this.readCodePoint();(d?te:Z)(le,F)||this.invalidStringToken(ae,"Invalid Unicode escape"),n+=it(le),A=this.pos}else break;d=!1}return n+this.input.slice(A,this.pos)},We.readWord=function(){var n=this.readWord1(),d=O.name;return this.keywords.test(n)&&(d=be[n]),this.finishToken(d,n)};var ei="8.15.0";i.acorn={Parser:i,version:ei,defaultOptions:dt,Position:Bt,SourceLocation:Xt,getLineInfo:Hi,Node:X,TokenType:ne,tokTypes:O,keywordTypes:be,TokContext:V,tokContexts:I,isIdentifierChar:Z,isIdentifierStart:te,Token:Ut,isNewLine:me,lineBreak:ye,lineBreakG:we,nonASCIIwhitespace:Me};function Ki(n,d){return i.parse(n,d)}function Xi(n,d,A){return i.parseExpressionAt(n,d,A)}function Yi(n,d){return i.tokenizer(n,d)}a.Node=X,a.Parser=i,a.Position=Bt,a.SourceLocation=Xt,a.TokContext=V,a.Token=Ut,a.TokenType=ne,a.defaultOptions=dt,a.getLineInfo=Hi,a.isIdentifierChar=Z,a.isIdentifierStart=te,a.isNewLine=me,a.keywordTypes=be,a.lineBreak=ye,a.lineBreakG=we,a.nonASCIIwhitespace=Me,a.parse=Ki,a.parseExpressionAt=Xi,a.tokContexts=I,a.tokTypes=O,a.tokenizer=Yi,a.version=ei}))})(hn,hn.exports)),hn.exports}/*!
 * Paper.js v0.12.18 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jrg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Wed Jul 17 14:57:24 2024 +0200
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jrg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */var rh=jn.exports,Vs;function sh(){return Vs||(Vs=1,(function(h){(function(s,a){s=s||Rs;var l=s.window,f=s.document,o=new function(){var e=/^(statics|enumerable|beans|preserve)$/,i=[],r=i.slice,u=Object.create,c=Object.getOwnPropertyDescriptor,p=Object.defineProperty,m=i.forEach||function(P,C){for(var B=0,z=this.length;B<z;B++)P.call(C,this[B],B,this)},_=function(P,C){for(var B in this)this.hasOwnProperty(B)&&P.call(C,this[B],B,this)},y=Object.assign||function(P){for(var C=1,B=arguments.length;C<B;C++){var z=arguments[C];for(var V in z)z.hasOwnProperty(V)&&(P[V]=z[V])}return P},x=function(P,C,B){if(P){var z=c(P,"length");(z&&typeof z.value=="number"?m:_).call(P,C,B=B||P)}return B};function T(P,C,B,z,V){var I={};function R(D,G){G=G||(G=c(C,D))&&(G.get?G:G.value),typeof G=="string"&&G[0]==="#"&&(G=P[G.substring(1)]||G);var K=typeof G=="function",X=G,$=V||K&&!G.base?G&&G.get?D in P:P[D]:null,j;(!V||!$)&&(K&&$&&(G.base=$),K&&z!==!1&&(j=D.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(I[j[3].toLowerCase()+j[4]]=j[2]),(!X||K||!X.get||typeof X.get!="function"||!M.isPlainObject(X))&&(X={value:X,writable:!0}),(c(P,D)||{configurable:!0}).configurable&&(X.configurable=!0,X.enumerable=B??!j),p(P,D,X))}if(C){for(var b in C)C.hasOwnProperty(b)&&!e.test(b)&&R(b);for(var b in I){var N=I[b],U=P["set"+N],H=P["get"+N]||U&&P["is"+N];H&&(z===!0||H.length===0)&&R(b,{get:H,set:U})}}return P}function M(){for(var P=0,C=arguments.length;P<C;P++){var B=arguments[P];B&&y(this,B)}return this}return T(M,{inject:function(P){if(P){var C=P.statics===!0?P:P.statics,B=P.beans,z=P.preserve;C!==P&&T(this.prototype,P,P.enumerable,B,z),T(this,C,null,B,z)}for(var V=1,I=arguments.length;V<I;V++)this.inject(arguments[V]);return this},extend:function(){for(var P=this,C,B,z=0,V,I=arguments.length;z<I&&!(C&&B);z++)V=arguments[z],C=C||V.initialize,B=B||V.prototype;return C=C||function(){P.apply(this,arguments)},B=C.prototype=B||u(this.prototype),p(B,"constructor",{value:C,writable:!0,configurable:!0}),T(C,this),arguments.length&&this.inject.apply(C,arguments),C.base=P,C}}).inject({enumerable:!1,initialize:M,set:M,inject:function(){for(var P=0,C=arguments.length;P<C;P++){var B=arguments[P];B&&T(this,B,B.enumerable,B.beans,B.preserve)}return this},extend:function(){var P=u(this);return P.inject.apply(P,arguments)},each:function(P,C){return x(this,P,C)},clone:function(){return new this.constructor(this)},statics:{set:y,each:x,create:u,define:p,describe:c,clone:function(P){return y(new P.constructor,P)},isPlainObject:function(P){var C=P!=null&&P.constructor;return C&&(C===Object||C===M||C.name==="Object")},pick:function(P,C){return P!==a?P:C},slice:function(P,C,B){return r.call(P,C,B)}}})};h.exports=o,o.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+o.each(this,function(e,i){if(!/^_/.test(i)){var r=typeof e;this.push(i+": "+(r==="number"?E.instance.number(e):r==="string"?"'"+e+"'":e))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(e){return o.importJSON(e,this)},exportJSON:function(e){return o.exportJSON(this,e)},toJSON:function(){return o.serialize(this)},set:function(e,i){return e&&o.filter(this,e,i,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function e(){var i=e.base.apply(this,arguments),r=i.prototype._class;return r&&!o.exports[r]&&(o.exports[r]=i),i},equals:function(e,i){if(e===i)return!0;if(e&&e.equals)return e.equals(i);if(i&&i.equals)return i.equals(e);if(e&&i&&typeof e=="object"&&typeof i=="object"){if(Array.isArray(e)&&Array.isArray(i)){var r=e.length;if(r!==i.length)return!1;for(;r--;)if(!o.equals(e[r],i[r]))return!1}else{var u=Object.keys(e),r=u.length;if(r!==Object.keys(i).length)return!1;for(;r--;){var c=u[r];if(!(i.hasOwnProperty(c)&&o.equals(e[c],i[c])))return!1}}return!0}return!1},read:function(e,i,r,u){if(this===o){var c=this.peek(e,i);return e.__index++,c}var p=this.prototype,m=p._readIndex,_=i||m&&e.__index||0,y=e.length,x=e[_];if(u=u||y-_,x instanceof this||r&&r.readNull&&x==null&&u<=1)return m&&(e.__index=_+1),x&&r&&r.clone?x.clone():x;if(x=o.create(p),m&&(x.__read=!0),x=x.initialize.apply(x,_>0||_+u<y?o.slice(e,_,_+u):e)||x,m){e.__index=_+x.__read;var T=x.__filtered;T&&(e.__filtered=T,x.__filtered=a),x.__read=a}return x},peek:function(e,i){return e[e.__index=i||e.__index||0]},remain:function(e){return e.length-(e.__index||0)},readList:function(e,i,r,u){for(var c=[],p,m=i||0,_=u?m+u:e.length,y=m;y<_;y++)c.push(Array.isArray(p=e[y])?this.read(p,0,r):this.read(e,y,r,1));return c},readNamed:function(e,i,r,u,c){var p=this.getNamed(e,i),m=p!==a;if(m){var _=e.__filtered;if(!_){var y=this.getSource(e);_=e.__filtered=o.create(y),_.__unfiltered=y}_[i]=a}return this.read(m?[p]:e,r,u,c)},readSupported:function(e,i){var r=this.getSource(e),u=this,c=!1;return r&&Object.keys(r).forEach(function(p){if(p in i){var m=u.readNamed(e,p);m!==a&&(i[p]=m),c=!0}}),c},getSource:function(e){var i=e.__source;if(i===a){var r=e.length===1&&e[0];i=e.__source=r&&o.isPlainObject(r)?r:null}return i},getNamed:function(e,i){var r=this.getSource(e);if(r)return i?r[i]:e.__filtered||r},hasNamed:function(e,i){return!!this.getNamed(e,i)},filter:function(e,i,r,u){var c;function p(T){if(!(r&&T in r)&&!(c&&T in c)){var M=i[T];M!==a&&(e[T]=M)}}if(u){for(var m={},_=0,y,x=u.length;_<x;_++)(y=u[_])in i&&(p(y),m[y]=!0);c=m}return Object.keys(i.__unfiltered||i).forEach(p),e},isPlainValue:function(e,i){return o.isPlainObject(e)||Array.isArray(e)||i&&typeof e=="string"},serialize:function(e,i,r,u){i=i||{};var c=!u,p;if(c&&(i.formatter=new E(i.precision),u={length:0,definitions:{},references:{},add:function(M,P){var C="#"+M._id,B=this.references[C];if(!B){this.length++;var z=P.call(M),V=M._class;V&&z[0]!==V&&z.unshift(V),this.definitions[C]=z,B=this.references[C]=[C]}return B}}),e&&e._serialize){p=e._serialize(i,u);var m=e._class;m&&!e._compactSerialize&&(c||!r)&&p[0]!==m&&p.unshift(m)}else if(Array.isArray(e)){p=[];for(var _=0,y=e.length;_<y;_++)p[_]=o.serialize(e[_],i,r,u)}else if(o.isPlainObject(e)){p={};for(var x=Object.keys(e),_=0,y=x.length;_<y;_++){var T=x[_];p[T]=o.serialize(e[T],i,r,u)}}else typeof e=="number"?p=i.formatter.number(e,i.precision):p=e;return c&&u.length>0?[["dictionary",u.definitions],p]:p},deserialize:function(e,i,r,u,c){var p=e,m=!r,_=m&&e&&e.length&&e[0][0]==="dictionary";if(r=r||{},Array.isArray(e)){var y=e[0],x=y==="dictionary";if(e.length==1&&/^#/.test(y))return r.dictionary[y];y=o.exports[y],p=[];for(var T=y?1:0,M=e.length;T<M;T++)p.push(o.deserialize(e[T],i,r,x,_));if(y){var P=p;i?p=i(y,P,m||c):p=new y(P)}}else if(o.isPlainObject(e)){p={},u&&(r.dictionary=p);for(var C in e)p[C]=o.deserialize(e[C],i,r)}return _?p[1]:p},exportJSON:function(e,i){var r=o.serialize(e,i);return i&&i.asString==!1?r:JSON.stringify(r)},importJSON:function(e,i){return o.deserialize(typeof e=="string"?JSON.parse(e):e,function(r,u,c){var p=c&&i&&i.constructor===r,m=p?i:o.create(r.prototype);if(u.length===1&&m instanceof O&&(p||!(m instanceof we))){var _=u[0];o.isPlainObject(_)&&(_.insert=!1,p&&(u=u.concat([O.INSERT])))}return(p?m.set:r).apply(m,u),p&&(i=null),m})},push:function(e,i){var r=i.length;if(r<4096)e.push.apply(e,i);else{var u=e.length;e.length+=r;for(var c=0;c<r;c++)e[u+c]=i[c]}return e},splice:function(e,i,r,u){var c=i&&i.length,p=r===a;r=p?e.length:r,r>e.length&&(r=e.length);for(var m=0;m<c;m++)i[m]._index=r+m;if(p)return o.push(e,i),[];var _=[r,u];i&&o.push(_,i);for(var y=e.splice.apply(e,_),m=0,x=y.length;m<x;m++)y[m]._index=a;for(var m=r+c,x=e.length;m<x;m++)e[m]._index=m;return y},capitalize:function(e){return e.replace(/\b[a-z]/g,function(i){return i.toUpperCase()})},camelize:function(e){return e.replace(/-(.)/g,function(i,r){return r.toUpperCase()})},hyphenate:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var g={on:function(e,i){if(typeof e!="string")o.each(e,function(p,m){this.on(m,p)},this);else{var r=this._eventTypes,u=r&&r[e],c=this._callbacks=this._callbacks||{};c=c[e]=c[e]||[],c.indexOf(i)===-1&&(c.push(i),u&&u.install&&c.length===1&&u.install.call(this,e))}return this},off:function(e,i){if(typeof e!="string"){o.each(e,function(m,_){this.off(_,m)},this);return}var r=this._eventTypes,u=r&&r[e],c=this._callbacks&&this._callbacks[e],p;return c&&(!i||(p=c.indexOf(i))!==-1&&c.length===1?(u&&u.uninstall&&u.uninstall.call(this,e),delete this._callbacks[e]):p!==-1&&c.splice(p,1)),this},once:function(e,i){return this.on(e,function r(){i.apply(this,arguments),this.off(e,r)})},emit:function(e,i){var r=this._callbacks&&this._callbacks[e];if(!r)return!1;var u=o.slice(arguments,1),c=i&&i.target&&!i.currentTarget;r=r.slice(),c&&(i.currentTarget=this);for(var p=0,m=r.length;p<m;p++)if(r[p].apply(this,u)==!1){i&&i.stop&&i.stop();break}return c&&delete i.currentTarget,!0},responds:function(e){return!!(this._callbacks&&this._callbacks[e])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(e){var i=this._eventTypes,r=this._callbacks,u=e?"install":"uninstall";if(i){for(var c in r)if(r[c].length>0){var p=i[c],m=p&&p[u];m&&m.call(this,c)}}},statics:{inject:function e(i){var r=i._events;if(r){var u={};o.each(r,function(c,p){var m=typeof c=="string",_=m?c:p,y=o.capitalize(_),x=_.substring(2).toLowerCase();u[x]=m?{}:c,_="_"+_,i["get"+y]=function(){return this[_]},i["set"+y]=function(T){var M=this[_];M&&this.off(x,M),T&&this.on(x,T),this[_]=T}}),i._eventTypes=u}return e.base.apply(this,arguments)}}},v=o.extend({_class:"PaperScope",initialize:function e(){Ye=this,this.settings=new o({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var r=pt.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in r||"mozDash"in r,nativeBlendModes:yi.nativeModes},pt.release(r)}if(!this.agent){var u=s.navigator.userAgent.toLowerCase(),c=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(u)||[])[0],p=c==="darwin"?"mac":c,m=i.agent=i.browser={platform:p};p&&(m[p]=!0),u.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(_,y,x,T,M){if(!m.chrome){var P=y==="opera"?T:/^(node|trident)$/.test(y)?M:x;m.version=P,m.versionNumber=parseFloat(P),y={trident:"msie",jsdom:"node"}[y]||y,m.name=y,m[y]=!0}}),m.chrome&&delete m.webkit,m.atom&&delete m.chrome}},version:"0.12.18",getView:function(){var e=this.project;return e&&e._view},getPaper:function(){return this},execute:function(e,i){var r=Ye.PaperScript.execute(e,this,i);return ht.updateFocus(),r},install:function(e){var i=this;o.each(["project","view","tool"],function(u){o.define(e,u,{configurable:!0,get:function(){return i[u]}})});for(var r in this)!/^_/.test(r)&&this[r]&&(e[r]=this[r])},setup:function(e){return Ye=this,this.project=new he(e),this},createCanvas:function(e,i){return pt.getCanvas(e,i)},activate:function(){Ye=this},clear:function(){for(var e=this.projects,i=this.tools,r=e.length-1;r>=0;r--)e[r].remove();for(var r=i.length-1;r>=0;r--)i[r].remove()},remove:function(){this.clear(),delete v._scopes[this._id]},statics:new function(){function e(i){return i+="Attribute",function(r,u){return r[i](u)||r[i]("data-paper-"+u)}}return{_scopes:{},_id:0,get:function(i){return this._scopes[i]||null},getAttribute:e("get"),hasAttribute:e("has")}}}),w=o.extend(g,{initialize:function(e){this._scope=Ye,this._index=this._scope[this._list].push(this)-1,(e||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var e=this._scope[this._reference];return e&&e!==this&&e.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",e),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(o.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),S={findItemBoundsCollisions:function(e,i,r){function u(m){for(var _=new Array(m.length),y=0;y<m.length;y++){var x=m[y].getBounds();_[y]=[x.left,x.top,x.right,x.bottom]}return _}var c=u(e),p=!i||i===e?c:u(i);return this.findBoundsCollisions(c,p,r||0)},findCurveBoundsCollisions:function(e,i,r,u){function c(P){for(var C=Math.min,B=Math.max,z=new Array(P.length),V=0;V<P.length;V++){var I=P[V];z[V]=[C(I[0],I[2],I[4],I[6]),C(I[1],I[3],I[5],I[7]),B(I[0],I[2],I[4],I[6]),B(I[1],I[3],I[5],I[7])]}return z}var p=c(e),m=!i||i===e?p:c(i);if(u){for(var _=this.findBoundsCollisions(p,m,r||0,!1,!0),y=this.findBoundsCollisions(p,m,r||0,!0,!0),x=[],T=0,M=_.length;T<M;T++)x[T]={hor:_[T],ver:y[T]};return x}return this.findBoundsCollisions(p,m,r||0)},findBoundsCollisions:function(e,i,r,u,c){var p=!i||e===i,m=p?e:e.concat(i),_=e.length,y=m.length;function x(ke,Te,ze){for(var ge=0,_e=ke.length;ge<_e;){var Le=_e+ge>>>1;m[ke[Le]][Te]<ze?ge=Le+1:_e=Le}return ge-1}for(var T=u?1:0,M=T+2,P=u?0:1,C=P+2,B=new Array(y),z=0;z<y;z++)B[z]=z;B.sort(function(ke,Te){return m[ke][T]-m[Te][T]});for(var V=[],I=new Array(_),z=0;z<y;z++){var R=B[z],b=m[R],N=p?R:R-_,U=R<_,H=p||!U,D=U?[]:null;if(V.length){var G=x(V,M,b[T]-r)+1;if(V.splice(0,G),p&&c){D=D.concat(V);for(var K=0;K<V.length;K++){var X=V[K];I[X].push(N)}}else for(var $=b[C],j=b[P],K=0;K<V.length;K++){var X=V[K],Q=m[X],ee=X<_,re=p||X>=_;(c||(U&&re||H&&ee)&&$>=Q[P]-r&&j<=Q[C]+r)&&(U&&re&&D.push(p?X:X-_),H&&ee&&I[X].push(N))}}if(U&&(e===i&&D.push(R),I[R]=D),V.length){var se=b[M],ue=x(V,M,se);V.splice(ue+1,0,R)}else V.push(R)}for(var z=0;z<I.length;z++){var xe=I[z];xe&&xe.sort(function(Te,ze){return Te-ze})}return I}},E=o.extend({initialize:function(e){this.precision=o.pick(e,5),this.multiplier=Math.pow(10,this.precision)},number:function(e){return this.precision<16?Math.round(e*this.multiplier)/this.multiplier:e},pair:function(e,i,r){return this.number(e)+(r||",")+this.number(i)},point:function(e,i){return this.number(e.x)+(i||",")+this.number(e.y)},size:function(e,i){return this.number(e.width)+(i||",")+this.number(e.height)},rectangle:function(e,i){return this.point(e,i)+(i||",")+this.size(e,i)}});E.instance=new E;var k=new function(){var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],i=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],r=Math.abs,u=Math.sqrt,c=Math.pow,p=Math.log2||function(M){return Math.log(M)*Math.LOG2E},m=1e-12,_=112e-18;function y(M,P,C){return M<P?P:M>C?C:M}function x(M,P,C){function B(G){var K=G*134217729,X=G-K,$=X+K,j=G-$;return[$,j]}var z=P*P-M*C,V=P*P+M*C;if(r(z)*3<V){var I=B(M),R=B(P),b=B(C),N=P*P,U=R[0]*R[0]-N+2*R[0]*R[1]+R[1]*R[1],H=M*C,D=I[0]*b[0]-H+I[0]*b[1]+I[1]*b[0]+I[1]*b[1];z=N-H+(U-D)}return z}function T(){var M=Math.max.apply(Math,arguments);return M&&(M<1e-8||M>1e8)?c(2,-Math.round(p(M))):0}return{EPSILON:m,MACHINE_EPSILON:_,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(u(2)-1)/3,isZero:function(M){return M>=-m&&M<=m},isMachineZero:function(M){return M>=-_&&M<=_},clamp:y,integrate:function(M,P,C,B){for(var z=e[B-2],V=i[B-2],I=(C-P)*.5,R=I+P,b=0,N=B+1>>1,U=B&1?V[b++]*M(R):0;b<N;){var H=I*z[b];U+=V[b++]*(M(R+H)+M(R-H))}return I*U},findRoot:function(M,P,C,B,z,V,I){for(var R=0;R<V;R++){var b=M(C),N=b/P(C),U=C-N;if(r(N)<I){C=U;break}b>0?(z=C,C=U<=B?(B+z)*.5:U):(B=C,C=U>=z?(B+z)*.5:U)}return y(C,B,z)},solveQuadratic:function(M,P,C,B,z,V){var I,R=1/0;if(r(M)<m){if(r(P)<m)return r(C)<m?-1:0;I=-C/P}else{P*=-.5;var b=x(M,P,C);if(b&&r(b)<_){var N=T(r(M),r(P),r(C));N&&(M*=N,P*=N,C*=N,b=x(M,P,C))}if(b>=-_){var U=b<0?0:u(b),H=P+(P<0?-U:U);H===0?(I=C/M,R=-I):(I=H/M,R=C/H)}}var D=0,G=z==null,K=z-m,X=V+m;return isFinite(I)&&(G||I>K&&I<X)&&(B[D++]=G?I:y(I,z,V)),R!==I&&isFinite(R)&&(G||R>K&&R<X)&&(B[D++]=G?R:y(R,z,V)),D},solveCubic:function(M,P,C,B,z,V,I){var R=T(r(M),r(P),r(C),r(B)),b,N,U,H,D;R&&(M*=R,P*=R,C*=R,B*=R);function G(ue){b=ue;var xe=M*b;N=xe+P,U=N*b+C,H=(xe+N)*b+U,D=U*b+B}if(r(M)<m)M=P,N=C,U=B,b=1/0;else if(r(B)<m)N=P,U=C,b=0;else{G(-(P/M)/3);var K=D/M,X=c(r(K),1/3),$=K<0?-1:1,j=-H/M,Q=j>0?1.324717957244746*Math.max(X,u(j)):X,ee=b-$*Q;if(ee!==b){do G(ee),ee=H===0?b:b-D/H/(1+_);while($*ee>$*b);r(M)*b*b>r(B/b)&&(U=-B/b,N=(U-C)/b)}}var re=k.solveQuadratic(M,N,U,z,V,I),se=V==null;return isFinite(b)&&(re===0||re>0&&b!==z[0]&&b!==z[1])&&(se||b>V-m&&b<I+m)&&(z[re++]=se?b:y(b,V,I)),re}}},q={_id:1,_pools:{},get:function(e){if(e){var i=this._pools[e];return i||(i=this._pools[e]={_id:1}),i._id++}else return this._id++}},L=o.extend({_class:"Point",_readIndex:!0,initialize:function(i,r){var u=typeof i,c=this.__read,p=0;if(u==="number"){var m=typeof r=="number";this._set(i,m?r:i),c&&(p=m?2:1)}else if(u==="undefined"||i===null)this._set(0,0),c&&(p=i===null?1:0);else{var _=u==="string"?i.split(/[\s,]+/)||[]:i;p=1,Array.isArray(_)?this._set(+_[0],+(_.length>1?_[1]:_[0])):"x"in _?this._set(_.x||0,_.y||0):"width"in _?this._set(_.width||0,_.height||0):"angle"in _?(this._set(_.length||0,0),this.setAngle(_.angle||0)):(this._set(0,0),p=0)}return c&&(this.__read=p),this},set:"#initialize",_set:function(e,i){return this.x=e,this.y=i,this},equals:function(e){return this===e||e&&(this.x===e.x&&this.y===e.y||Array.isArray(e)&&this.x===e[0]&&this.y===e[1])||!1},clone:function(){return new L(this.x,this.y)},toString:function(){var e=E.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.x),i.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(e){if(this.isZero()){var i=this._angle||0;this._set(Math.cos(i)*e,Math.sin(i)*e)}else{var r=e/this.getLength();k.isZero(r)&&this.getAngle(),this._set(this.x*r,this.y*r)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(e){this.setAngleInRadians.call(this,e*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var e=L.read(arguments),i=this.getLength()*e.getLength();if(k.isZero(i))return NaN;var r=this.dot(e)/i;return Math.acos(r<-1?-1:r>1?1:r)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(e){if(this._angle=e,!this.isZero()){var i=this.getLength();this._set(Math.cos(e)*i,Math.sin(e)*i)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var e=L.read(arguments);return Math.atan2(this.cross(e),this.dot(e))*180/Math.PI},getDistance:function(){var e=arguments,i=L.read(e),r=i.x-this.x,u=i.y-this.y,c=r*r+u*u,p=o.read(e);return p?c:Math.sqrt(c)},normalize:function(e){e===a&&(e=1);var i=this.getLength(),r=i!==0?e/i:0,u=new L(this.x*r,this.y*r);return r>=0&&(u._angle=this._angle),u},rotate:function(e,i){if(e===0)return this.clone();e=e*Math.PI/180;var r=i?this.subtract(i):this,u=Math.sin(e),c=Math.cos(e);return r=new L(r.x*c-r.y*u,r.x*u+r.y*c),i?r.add(i):r},transform:function(e){return e?e._transformPoint(this):this},add:function(){var e=L.read(arguments);return new L(this.x+e.x,this.y+e.y)},subtract:function(){var e=L.read(arguments);return new L(this.x-e.x,this.y-e.y)},multiply:function(){var e=L.read(arguments);return new L(this.x*e.x,this.y*e.y)},divide:function(){var e=L.read(arguments);return new L(this.x/e.x,this.y/e.y)},modulo:function(){var e=L.read(arguments);return new L(this.x%e.x,this.y%e.y)},negate:function(){return new L(-this.x,-this.y)},isInside:function(){return J.read(arguments).contains(this)},isClose:function(){var e=arguments,i=L.read(e),r=o.read(e);return this.getDistance(i)<=r},isCollinear:function(){var e=L.read(arguments);return L.isCollinear(this.x,this.y,e.x,e.y)},isColinear:"#isCollinear",isOrthogonal:function(){var e=L.read(arguments);return L.isOrthogonal(this.x,this.y,e.x,e.y)},isZero:function(){var e=k.isZero;return e(this.x)&&e(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(e){return this.x*(e>1&&e<4?-1:1)>=0&&this.y*(e>2?-1:1)>=0},dot:function(){var e=L.read(arguments);return this.x*e.x+this.y*e.y},cross:function(){var e=L.read(arguments);return this.x*e.y-this.y*e.x},project:function(){var e=L.read(arguments),i=e.isZero()?0:this.dot(e)/e.dot(e);return new L(e.x*i,e.y*i)},statics:{min:function(){var e=arguments,i=L.read(e),r=L.read(e);return new L(Math.min(i.x,r.x),Math.min(i.y,r.y))},max:function(){var e=arguments,i=L.read(e),r=L.read(e);return new L(Math.max(i.x,r.x),Math.max(i.y,r.y))},random:function(){return new L(Math.random(),Math.random())},isCollinear:function(e,i,r,u){return Math.abs(e*u-i*r)<=Math.sqrt((e*e+i*i)*(r*r+u*u))*1e-8},isOrthogonal:function(e,i,r,u){return Math.abs(e*r+i*u)<=Math.sqrt((e*e+i*i)*(r*r+u*u))*1e-8}}},o.each(["round","ceil","floor","abs"],function(e){var i=Math[e];this[e]=function(){return new L(i(this.x),i(this.y))}},{})),te=L.extend({initialize:function(i,r,u,c){this._x=i,this._y=r,this._owner=u,this._setter=c},_set:function(e,i,r){return this._x=e,this._y=i,r||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),Z=o.extend({_class:"Size",_readIndex:!0,initialize:function(i,r){var u=typeof i,c=this.__read,p=0;if(u==="number"){var m=typeof r=="number";this._set(i,m?r:i),c&&(p=m?2:1)}else if(u==="undefined"||i===null)this._set(0,0),c&&(p=i===null?1:0);else{var _=u==="string"?i.split(/[\s,]+/)||[]:i;p=1,Array.isArray(_)?this._set(+_[0],+(_.length>1?_[1]:_[0])):"width"in _?this._set(_.width||0,_.height||0):"x"in _?this._set(_.x||0,_.y||0):(this._set(0,0),p=0)}return c&&(this.__read=p),this},set:"#initialize",_set:function(e,i){return this.width=e,this.height=i,this},equals:function(e){return e===this||e&&(this.width===e.width&&this.height===e.height||Array.isArray(e)&&this.width===e[0]&&this.height===e[1])||!1},clone:function(){return new Z(this.width,this.height)},toString:function(){var e=E.instance;return"{ width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.width),i.number(this.height)]},add:function(){var e=Z.read(arguments);return new Z(this.width+e.width,this.height+e.height)},subtract:function(){var e=Z.read(arguments);return new Z(this.width-e.width,this.height-e.height)},multiply:function(){var e=Z.read(arguments);return new Z(this.width*e.width,this.height*e.height)},divide:function(){var e=Z.read(arguments);return new Z(this.width/e.width,this.height/e.height)},modulo:function(){var e=Z.read(arguments);return new Z(this.width%e.width,this.height%e.height)},negate:function(){return new Z(-this.width,-this.height)},isZero:function(){var e=k.isZero;return e(this.width)&&e(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(e,i){return new Z(Math.min(e.width,i.width),Math.min(e.height,i.height))},max:function(e,i){return new Z(Math.max(e.width,i.width),Math.max(e.height,i.height))},random:function(){return new Z(Math.random(),Math.random())}}},o.each(["round","ceil","floor","abs"],function(e){var i=Math[e];this[e]=function(){return new Z(i(this.width),i(this.height))}},{})),ne=Z.extend({initialize:function(i,r,u,c){this._width=i,this._height=r,this._owner=u,this._setter=c},_set:function(e,i,r){return this._width=e,this._height=i,r||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(e){this._width=e,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(e){this._height=e,this._owner[this._setter](this)}}),J=o.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(i,r,u,c){var p=arguments,m=typeof i,_;if(m==="number"?(this._set(i,r,u,c),_=4):m==="undefined"||i===null?(this._set(0,0,0,0),_=i===null?1:0):p.length===1&&(Array.isArray(i)?(this._set.apply(this,i),_=1):i.x!==a||i.width!==a?(this._set(i.x||0,i.y||0,i.width||0,i.height||0),_=1):i.from===a&&i.to===a&&(this._set(0,0,0,0),o.readSupported(p,this)&&(_=1))),_===a){var y=L.readNamed(p,"from"),x=o.peek(p),T=y.x,M=y.y,P,C;if(x&&x.x!==a||o.hasNamed(p,"to")){var B=L.readNamed(p,"to");P=B.x-T,C=B.y-M,P<0&&(T=B.x,P=-P),C<0&&(M=B.y,C=-C)}else{var z=Z.read(p);P=z.width,C=z.height}this._set(T,M,P,C),_=p.__index}var V=p.__filtered;return V&&(this.__filtered=V),this.__read&&(this.__read=_),this},set:"#initialize",_set:function(e,i,r,u){return this.x=e,this.y=i,this.width=r,this.height=u,this},clone:function(){return new J(this.x,this.y,this.width,this.height)},equals:function(e){var i=o.isPlainValue(e)?J.read(arguments):e;return i===this||i&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height||!1},toString:function(){var e=E.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+", width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.x),i.number(this.y),i.number(this.width),i.number(this.height)]},getPoint:function(e){var i=e?L:te;return new i(this.x,this.y,this,"setPoint")},setPoint:function(){var e=L.read(arguments);this.x=e.x,this.y=e.y},getSize:function(e){var i=e?Z:ne;return new i(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var e=Z.read(arguments),i=this._sx,r=this._sy,u=e.width,c=e.height;i&&(this.x+=(this.width-u)*i),r&&(this.y+=(this.height-c)*r),this.width=u,this.height=c,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(e){if(!this._fw){var i=e-this.x;this.width-=this._sx===.5?i*2:i}this.x=e,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(e){if(!this._fh){var i=e-this.y;this.height-=this._sy===.5?i*2:i}this.y=e,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(e){if(!this._fw){var i=e-this.x;this.width=this._sx===.5?i*2:i}this.x=e-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(e){if(!this._fh){var i=e-this.y;this.height=this._sy===.5?i*2:i}this.y=e-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(e){this._fw||this._sx===.5?this.x=e-this.width/2:(this._sx&&(this.x+=(e-this.x)*2*this._sx),this.width=(e-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(e){this._fh||this._sy===.5?this.y=e-this.height/2:(this._sy&&(this.y+=(e-this.y)*2*this._sy),this.height=(e-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(e){var i=e?L:te;return new i(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var e=L.read(arguments);return this.setCenterX(e.x),this.setCenterY(e.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(e){return e&&e.width!==a||(Array.isArray(e)?e:arguments).length===4?this._containsRectangle(J.read(arguments)):this._containsPoint(L.read(arguments))},_containsPoint:function(e){var i=e.x,r=e.y;return i>=this.x&&r>=this.y&&i<=this.x+this.width&&r<=this.y+this.height},_containsRectangle:function(e){var i=e.x,r=e.y;return i>=this.x&&r>=this.y&&i+e.width<=this.x+this.width&&r+e.height<=this.y+this.height},intersects:function(){var e=J.read(arguments),i=o.read(arguments)||0;return e.x+e.width>this.x-i&&e.y+e.height>this.y-i&&e.x<this.x+this.width+i&&e.y<this.y+this.height+i},intersect:function(){var e=J.read(arguments),i=Math.max(this.x,e.x),r=Math.max(this.y,e.y),u=Math.min(this.x+this.width,e.x+e.width),c=Math.min(this.y+this.height,e.y+e.height);return new J(i,r,u-i,c-r)},unite:function(){var e=J.read(arguments),i=Math.min(this.x,e.x),r=Math.min(this.y,e.y),u=Math.max(this.x+this.width,e.x+e.width),c=Math.max(this.y+this.height,e.y+e.height);return new J(i,r,u-i,c-r)},include:function(){var e=L.read(arguments),i=Math.min(this.x,e.x),r=Math.min(this.y,e.y),u=Math.max(this.x+this.width,e.x),c=Math.max(this.y+this.height,e.y);return new J(i,r,u-i,c-r)},expand:function(){var e=Z.read(arguments),i=e.width,r=e.height;return new J(this.x-i/2,this.y-r/2,this.width+i,this.height+r)},scale:function(e,i){return this.expand(this.width*e-this.width,this.height*(i===a?e:i)-this.height)}},o.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(e,i){var r=e.join(""),u=/^[RL]/.test(r);i>=4&&(e[1]+=u?"Y":"X");var c=e[u?0:1],p=e[u?1:0],m="get"+c,_="get"+p,y="set"+c,x="set"+p,T="get"+r,M="set"+r;this[T]=function(P){var C=P?L:te;return new C(this[m](),this[_](),this,M)},this[M]=function(){var P=L.read(arguments);this[y](P.x),this[x](P.y)}},{beans:!0})),pe=J.extend({initialize:function(i,r,u,c,p,m){this._set(i,r,u,c,!0),this._owner=p,this._setter=m},_set:function(e,i,r,u,c){return this._x=e,this._y=i,this._width=r,this._height=u,c||this._owner[this._setter](this),this}},new function(){var e=J.prototype;return o.each(["x","y","width","height"],function(i){var r=o.capitalize(i),u="_"+i;this["get"+r]=function(){return this[u]},this["set"+r]=function(c){this[u]=c,this._dontNotify||this._owner[this._setter](this)}},o.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(i){var r="set"+i;this[r]=function(){this._dontNotify=!0,e[r].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(i){var r=this._owner;r._changeSelection&&r._changeSelection(2,i)}}))}),ce=o.extend({_class:"Matrix",initialize:function e(i,r){var u=arguments,c=u.length,p=!0;if(c>=6?this._set.apply(this,u):c===1||c===2?i instanceof e?this._set(i._a,i._b,i._c,i._d,i._tx,i._ty,r):Array.isArray(i)?this._set.apply(this,r?i.concat([r]):i):p=!1:c?p=!1:this.reset(),!p)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(e,i,r,u,c,p,m){return this._a=e,this._b=i,this._c=r,this._d=u,this._tx=c,this._ty=p,m||this._changed(),this},_serialize:function(e,i){return o.serialize(this.getValues(),e,!0,i)},_changed:function(){var e=this._owner;e&&(e._applyMatrix?e.transform(null,!0):e._changed(25))},clone:function(){return new ce(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(e){return e===this||e&&this._a===e._a&&this._b===e._b&&this._c===e._c&&this._d===e._d&&this._tx===e._tx&&this._ty===e._ty},toString:function(){var e=E.instance;return"[["+[e.number(this._a),e.number(this._c),e.number(this._tx)].join(", ")+"], ["+[e.number(this._b),e.number(this._d),e.number(this._ty)].join(", ")+"]]"},reset:function(e){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,e||this._changed(),this},apply:function(e,i){var r=this._owner;return r?(r.transform(null,o.pick(e,!0),i),this.isIdentity()):!1},translate:function(){var e=L.read(arguments),i=e.x,r=e.y;return this._tx+=i*this._a+r*this._c,this._ty+=i*this._b+r*this._d,this._changed(),this},scale:function(){var e=arguments,i=L.read(e),r=L.read(e,0,{readNull:!0});return r&&this.translate(r),this._a*=i.x,this._b*=i.x,this._c*=i.y,this._d*=i.y,r&&this.translate(r.negate()),this._changed(),this},rotate:function(e){e*=Math.PI/180;var i=L.read(arguments,1),r=i.x,u=i.y,c=Math.cos(e),p=Math.sin(e),m=r-r*c+u*p,_=u-r*p-u*c,y=this._a,x=this._b,T=this._c,M=this._d;return this._a=c*y+p*T,this._b=c*x+p*M,this._c=-p*y+c*T,this._d=-p*x+c*M,this._tx+=m*y+_*T,this._ty+=m*x+_*M,this._changed(),this},shear:function(){var e=arguments,i=L.read(e),r=L.read(e,0,{readNull:!0});r&&this.translate(r);var u=this._a,c=this._b;return this._a+=i.y*this._c,this._b+=i.y*this._d,this._c+=i.x*u,this._d+=i.x*c,r&&this.translate(r.negate()),this._changed(),this},skew:function(){var e=arguments,i=L.read(e),r=L.read(e,0,{readNull:!0}),u=Math.PI/180,c=new L(Math.tan(i.x*u),Math.tan(i.y*u));return this.shear(c,r)},append:function(e,i){if(e){var r=this._a,u=this._b,c=this._c,p=this._d,m=e._a,_=e._c,y=e._b,x=e._d,T=e._tx,M=e._ty;this._a=m*r+y*c,this._c=_*r+x*c,this._b=m*u+y*p,this._d=_*u+x*p,this._tx+=T*r+M*c,this._ty+=T*u+M*p,i||this._changed()}return this},prepend:function(e,i){if(e){var r=this._a,u=this._b,c=this._c,p=this._d,m=this._tx,_=this._ty,y=e._a,x=e._c,T=e._b,M=e._d,P=e._tx,C=e._ty;this._a=y*r+x*u,this._c=y*c+x*p,this._b=T*r+M*u,this._d=T*c+M*p,this._tx=y*m+x*_+P,this._ty=T*m+M*_+C,i||this._changed()}return this},appended:function(e){return this.clone().append(e)},prepended:function(e){return this.clone().prepend(e)},invert:function(){var e=this._a,i=this._b,r=this._c,u=this._d,c=this._tx,p=this._ty,m=e*u-i*r,_=null;return m&&!isNaN(m)&&isFinite(c)&&isFinite(p)&&(this._a=u/m,this._b=-i/m,this._c=-r/m,this._d=e/m,this._tx=(r*p-u*c)/m,this._ty=(i*c-e*p)/m,_=this),_},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new ce(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var e=this._a*this._d-this._c*this._b;return e&&!isNaN(e)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(e,i,r){return arguments.length<3?this._transformPoint(L.read(arguments)):this._transformCoordinates(e,i,r)},_transformPoint:function(e,i,r){var u=e.x,c=e.y;return i||(i=new L),i._set(u*this._a+c*this._c+this._tx,u*this._b+c*this._d+this._ty,r)},_transformCoordinates:function(e,i,r){for(var u=0,c=2*r;u<c;u+=2){var p=e[u],m=e[u+1];i[u]=p*this._a+m*this._c+this._tx,i[u+1]=p*this._b+m*this._d+this._ty}return i},_transformCorners:function(e){var i=e.x,r=e.y,u=i+e.width,c=r+e.height,p=[i,r,u,r,u,c,i,c];return this._transformCoordinates(p,p,4)},_transformBounds:function(e,i,r){for(var u=this._transformCorners(e),c=u.slice(0,2),p=c.slice(),m=2;m<8;m++){var _=u[m],y=m&1;_<c[y]?c[y]=_:_>p[y]&&(p[y]=_)}return i||(i=new J),i._set(c[0],c[1],p[0]-c[0],p[1]-c[1],r)},inverseTransform:function(){return this._inverseTransform(L.read(arguments))},_inverseTransform:function(e,i,r){var u=this._a,c=this._b,p=this._c,m=this._d,_=this._tx,y=this._ty,x=u*m-c*p,T=null;if(x&&!isNaN(x)&&isFinite(_)&&isFinite(y)){var M=e.x-this._tx,P=e.y-this._ty;i||(i=new L),T=i._set((M*m-P*p)/x,(P*u-M*c)/x,r)}return T},decompose:function(){var e=this._a,i=this._b,r=this._c,u=this._d,c=e*u-i*r,p=Math.sqrt,m=Math.atan2,_=180/Math.PI,y,x,T;if(e!==0||i!==0){var M=p(e*e+i*i);y=Math.acos(e/M)*(i>0?1:-1),x=[M,c/M],T=[m(e*r+i*u,M*M),0]}else if(r!==0||u!==0){var P=p(r*r+u*u);y=Math.asin(r/P)*(u>0?1:-1),x=[c/P,P],T=[0,m(e*r+i*u,P*P)]}else y=0,T=x=[0,0];return{translation:this.getTranslation(),rotation:y*_,scaling:new L(x),skewing:new L(T[0]*_,T[1]*_)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new L(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(e){this.isIdentity()||e.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},o.each(["a","b","c","d","tx","ty"],function(e){var i=o.capitalize(e),r="_"+e;this["get"+i]=function(){return this[r]},this["set"+i]=function(u){this[r]=u,this._changed()}},{})),be=o.extend({_class:"Line",initialize:function(i,r,u,c,p){var m=!1;arguments.length>=4?(this._px=i,this._py=r,this._vx=u,this._vy=c,m=p):(this._px=i.x,this._py=i.y,this._vx=r.x,this._vy=r.y,m=u),m||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new L(this._px,this._py)},getVector:function(){return new L(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(e,i){return be.intersect(this._px,this._py,this._vx,this._vy,e._px,e._py,e._vx,e._vy,!0,i)},getSide:function(e,i){return be.getSide(this._px,this._py,this._vx,this._vy,e.x,e.y,!0,i)},getDistance:function(e){return Math.abs(this.getSignedDistance(e))},getSignedDistance:function(e){return be.getSignedDistance(this._px,this._py,this._vx,this._vy,e.x,e.y,!0)},isCollinear:function(e){return L.isCollinear(this._vx,this._vy,e._vx,e._vy)},isOrthogonal:function(e){return L.isOrthogonal(this._vx,this._vy,e._vx,e._vy)},statics:{intersect:function(e,i,r,u,c,p,m,_,y,x){y||(r-=e,u-=i,m-=c,_-=p);var T=r*_-u*m;if(!k.isMachineZero(T)){var M=e-c,P=i-p,C=(m*P-_*M)/T,B=(r*P-u*M)/T,z=1e-12,V=-z,I=1+z;if(x||V<C&&C<I&&V<B&&B<I)return x||(C=C<=0?0:C>=1?1:C),new L(e+C*r,i+C*u)}},getSide:function(e,i,r,u,c,p,m,_){m||(r-=e,u-=i);var y=c-e,x=p-i,T=y*u-x*r;return!_&&k.isMachineZero(T)&&(T=(y*r+y*r)/(r*r+u*u),T>=0&&T<=1&&(T=0)),T<0?-1:T>0?1:0},getSignedDistance:function(e,i,r,u,c,p,m){return m||(r-=e,u-=i),r===0?u>0?c-e:e-c:u===0?r<0?p-i:i-p:((c-e)*u-(p-i)*r)/(u>r?u*Math.sqrt(1+r*r/(u*u)):r*Math.sqrt(1+u*u/(r*r)))},getDistance:function(e,i,r,u,c,p,m){return Math.abs(be.getSignedDistance(e,i,r,u,c,p,m))}}}),he=w.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(i){w.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new ji(null,null,this),this._view=ht.create(this,i||pt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(e,i){return o.serialize(this._children,e,!0,i)},_changed:function(e,i){if(e&1){var r=this._view;r&&(r._needsUpdate=!0,!r._requested&&r._autoUpdate&&r.requestUpdate())}var u=this._changes;if(u&&i){var c=this._changesById,p=i._id,m=c[p];m?m.flags|=e:u.push(c[p]={item:i,flags:e})}},clear:function(){for(var e=this._children,i=e.length-1;i>=0;i--)e[i].remove()},isEmpty:function(){return!this._children.length},remove:function e(){return e.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(e){this._currentStyle.set(e)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new we({project:this,insert:!0})},getSymbolDefinitions:function(){var e=[],i={};return this.getItems({class:Me,match:function(r){var u=r._definition,c=u._id;return i[c]||(i[c]=!0,e.push(u)),!1}}),e},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var e=this._selectionItems,i=[];for(var r in e){var u=e[r],c=u._selection;c&1&&u.isInserted()?i.push(u):c||this._updateSelection(u)}return i},_updateSelection:function(e){var i=e._id,r=this._selectionItems;e._selection?r[i]!==e&&(this._selectionCount++,r[i]=e):r[i]===e&&(this._selectionCount--,delete r[i])},selectAll:function(){for(var e=this._children,i=0,r=e.length;i<r;i++)e[i].setFullySelected(!0)},deselectAll:function(){var e=this._selectionItems;for(var i in e)e[i].setFullySelected(!1)},addLayer:function(e){return this.insertLayer(a,e)},insertLayer:function(e,i){if(i instanceof we){i._remove(!1,!0),o.splice(this._children,[i],e,0),i._setProject(this,!0);var r=i._name;r&&i.setName(r),this._changes&&i._changed(5),this._activeLayer||(this._activeLayer=i)}else i=null;return i},_insertItem:function(e,i,r){return i=this.insertLayer(e,i)||(this._activeLayer||this._insertItem(a,new we(O.NO_INSERT),!0)).insertChild(e,i),r&&i.activate&&i.activate(),i},getItems:function(e){return O._getItems(this,e)},getItem:function(e){return O._getItems(this,e,null,null,!0)[0]||null},importJSON:function(e){this.activate();var i=this._activeLayer;return o.importJSON(e,i&&i.isEmpty()&&i)},removeOn:function(e){var i=this._removeSets;if(i){e==="mouseup"&&(i.mousedrag=null);var r=i[e];if(r){for(var u in r){var c=r[u];for(var p in i){var m=i[p];m&&m!=r&&delete m[c._id]}c.remove()}i[e]=null}}},draw:function(e,i,r){this._updateVersion++,e.save(),i.applyToContext(e);for(var u=this._children,c=new o({offset:new L(0,0),pixelRatio:r,viewMatrix:i.isIdentity()?null:i,matrices:[new ce],updateMatrix:!0}),p=0,m=u.length;p<m;p++)u[p].draw(e,c);if(e.restore(),this._selectionCount>0){e.save(),e.strokeWidth=1;var _=this._selectionItems,y=this._scope.settings.handleSize,x=this._updateVersion;for(var T in _)_[T]._drawSelection(e,i,y,_,x);e.restore()}}}),O=o.extend(g,{statics:{extend:function e(i){return i._serializeFields&&(i._serializeFields=o.set({},this.prototype._serializeFields,i._serializeFields)),e.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new ce,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var e=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return o.each(e,function(i){this._events[i]={install:function(r){this.getView()._countItemEvent(r,1)},uninstall:function(r){this.getView()._countItemEvent(r,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:e}})},{initialize:function(){},_initialize:function(e,i){var r=e&&o.isPlainObject(e),u=r&&e.internal===!0,c=this._matrix=new ce,p=r&&e.project||Ye.project,m=Ye.settings;return this._id=u?null:q.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&m.applyMatrix,i&&c.translate(i),c._owner=this,this._style=new ji(p._currentStyle,this,p),u||r&&e.insert==!1||!m.insertItems&&!(r&&e.insert==!0)?this._setProject(p):(r&&e.parent||p)._insertItem(a,this,!0),r&&e!==O.NO_INSERT&&e!==O.INSERT&&this.set(e,{internal:!0,insert:!0,project:!0,parent:!0}),r},_serialize:function(e,i){var r={},u=this;function c(p){for(var m in p){var _=u[m];o.equals(_,m==="leading"?p.fontSize*1.2:p[m])||(r[m]=o.serialize(_,e,m!=="data",i))}}return c(this._serializeFields),this instanceof ye||c(this._style._defaults),[this._class,r]},_changed:function(e){var i=this._symbol,r=this._parent||i,u=this._project;e&8&&(this._bounds=this._position=this._decomposed=a),e&16&&(this._globalMatrix=a),r&&e&72&&O._clearBoundsCache(r),e&2&&O._clearBoundsCache(this),u&&u._changed(e,this),i&&i._changed(e)},getId:function(){return this._id},getName:function(){return this._name},setName:function(e){if(this._name&&this._removeNamed(),e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(e&&i){var r=i._children,u=i._namedChildren;(u[e]=u[e]||[]).push(this),e in r||(r[e]=this)}this._name=e||a,this._changed(256)},getStyle:function(){return this._style},setStyle:function(e){this.getStyle().set(e)}},o.each(["locked","visible","blendMode","opacity","guide"],function(e){var i=o.capitalize(e),r="_"+e,u={locked:256,visible:265};this["get"+i]=function(){return this[r]},this["set"+i]=function(c){c!=this[r]&&(this[r]=c,this._changed(u[e]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(e){if(e!==this._selection){this._selection=e;var i=this._project;i&&(i._updateSelection(this),this._changed(257))}},_changeSelection:function(e,i){var r=this._selection;this.setSelection(i?r|e:r&~e)},isSelected:function(){if(this._selectChildren){for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i].isSelected())return!0}return!!(this._selection&1)},setSelected:function(e){if(this._selectChildren)for(var i=this._children,r=0,u=i.length;r<u;r++)i[r].setSelected(e);this._changeSelection(1,e)},isFullySelected:function(){var e=this._children,i=!!(this._selection&1);if(e&&i){for(var r=0,u=e.length;r<u;r++)if(!e[r].isFullySelected())return!1;return!0}return i},setFullySelected:function(e){var i=this._children;if(i)for(var r=0,u=i.length;r<u;r++)i[r].setFullySelected(e);this._changeSelection(1,e)},isClipMask:function(){return this._clipMask},setClipMask:function(e){this._clipMask!=(e=!!e)&&(this._clipMask=e,e&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(e){this._data=e},getPosition:function(e){var i=e?L:te,r=this._position||(this._position=this._getPositionFromBounds());return new i(r.x,r.y,this,"setPosition")},setPosition:function(){this.translate(L.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(e){return this._pivot?this._matrix._transformPoint(this._pivot):(e||this.getBounds()).getCenter(!0)},getPivot:function(){var e=this._pivot;return e?new te(e.x,e.y,this,"setPivot"):null},setPivot:function(){this._pivot=L.read(arguments,0,{clone:!0,readNull:!0}),this._position=a}},o.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(e,i){this[i]=function(r){return this.getBounds(r,e)}},{beans:!0,getBounds:function(e,i){var r=i||e instanceof ce,u=o.set({},r?i:e,this._boundsOptions);(!u.stroke||this.getStrokeScaling())&&(u.cacheItem=this);var c=this._getCachedBounds(r&&e,u).rect;return arguments.length?c:new pe(c.x,c.y,c.width,c.height,this,"setBounds")},setBounds:function(){var e=J.read(arguments),i=this.getBounds(),r=this._matrix,u=new ce,c=e.getCenter();u.translate(c),(e.width!=i.width||e.height!=i.height)&&(r.isInvertible()||(r.set(r._backup||new ce().translate(r.getTranslation())),i=this.getBounds()),u.scale(i.width!==0?e.width/i.width:0,i.height!==0?e.height/i.height:0)),c=i.getCenter(),u.translate(-c.x,-c.y),this.transform(u)},_getBounds:function(e,i){var r=this._children;return!r||!r.length?new J:(O._updateBoundsCache(this,i.cacheItem),O._getBounds(r,e,i))},_getBoundsCacheKey:function(e,i){return[e.stroke?1:0,e.handle?1:0,i?1:0].join("")},_getCachedBounds:function(e,i,r){e=e&&e._orNullIfIdentity();var u=i.internal&&!r,c=i.cacheItem,p=u?null:this._matrix._orNullIfIdentity(),m=c&&(!e||e.equals(p))&&this._getBoundsCacheKey(i,u),_=this._bounds;if(O._updateBoundsCache(this._parent||this._symbol,c),m&&_&&m in _){var y=_[m];return{rect:y.rect.clone(),nonscaling:y.nonscaling}}var x=this._getBounds(e||p,i),T=x.rect||x,M=this._style,P=x.nonscaling||M.hasStroke()&&!M.getStrokeScaling();if(m){_||(this._bounds=_={});var y=_[m]={rect:T.clone(),nonscaling:P,internal:u}}return{rect:T,nonscaling:P}},_getStrokeMatrix:function(e,i){var r=this.getStrokeScaling()?null:i&&i.internal?this:this._parent||this._symbol&&this._symbol._item,u=r?r.getViewMatrix().invert():e;return u&&u._shiftless()},statics:{_updateBoundsCache:function(e,i){if(e&&i){var r=i._id,u=e._boundsCache=e._boundsCache||{ids:{},list:[]};u.ids[r]||(u.list.push(i),u.ids[r]=i)}},_clearBoundsCache:function(e){var i=e._boundsCache;if(i){e._bounds=e._position=e._boundsCache=a;for(var r=0,u=i.list,c=u.length;r<c;r++){var p=u[r];p!==e&&(p._bounds=p._position=a,p._boundsCache&&O._clearBoundsCache(p))}}},_getBounds:function(e,i,r){var u=1/0,c=-u,p=u,m=c,_=!1;r=r||{};for(var y=0,x=e.length;y<x;y++){var T=e[y];if(T._visible&&!T.isEmpty(!0)){var M=T._getCachedBounds(i&&i.appended(T._matrix),r,!0),P=M.rect;u=Math.min(P.x,u),p=Math.min(P.y,p),c=Math.max(P.x+P.width,c),m=Math.max(P.y+P.height,m),M.nonscaling&&(_=!0)}}return{rect:isFinite(u)?new J(u,p,c-u,m-p):new J,nonscaling:_}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var e=this._decompose();return e?e.rotation:0},setRotation:function(e){var i=this.getRotation();if(i!=null&&e!=null){var r=this._decomposed;this.rotate(e-i),r&&(r.rotation=e,this._decomposed=r)}},getScaling:function(){var e=this._decompose(),i=e&&e.scaling;return new te(i?i.x:1,i?i.y:1,this,"setScaling")},setScaling:function(){var e=this.getScaling(),i=L.read(arguments,0,{clone:!0,readNull:!0});if(e&&i&&!e.equals(i)){var r=this.getRotation(),u=this._decomposed,c=new ce,p=k.isZero;if(p(e.x)||p(e.y))c.translate(u.translation),r&&c.rotate(r),c.scale(i.x,i.y),this._matrix.set(c);else{var m=this.getPosition(!0);c.translate(m),r&&c.rotate(r),c.scale(i.x/e.x,i.y/e.y),r&&c.rotate(-r),c.translate(m.negate()),this.transform(c)}u&&(u.scaling=i,this._decomposed=u)}},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},getGlobalMatrix:function(e){var i=this._globalMatrix;if(i)for(var r=this._parent,u=[];r;){if(!r._globalMatrix){i=null;for(var c=0,p=u.length;c<p;c++)u[c]._globalMatrix=null;break}u.push(r),r=r._parent}if(!i){i=this._globalMatrix=this._matrix.clone();var r=this._parent;r&&i.prepend(r.getGlobalMatrix(!0))}return e?i:i.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(e){(this._applyMatrix=this._canApplyMatrix&&!!e)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(e,i){if(this._project!==e){this._project&&this._installEvents(!1),this._project=e;for(var r=this._children,u=0,c=r&&r.length;u<c;u++)r[u]._setProject(e);i=!0}i&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function e(i){e.base.call(this,i);for(var r=this._children,u=0,c=r&&r.length;u<c;u++)r[u]._installEvents(i)},getLayer:function(){for(var e=this;e=e._parent;)if(e instanceof we)return e;return null},getParent:function(){return this._parent},setParent:function(e){return e.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(e){this.removeChildren(),this.addChildren(e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var e=this._getOwner();return e&&e._children[this._index+1]||null},getPreviousSibling:function(){var e=this._getOwner();return e&&e._children[this._index-1]||null},getIndex:function(){return this._index},setIndex:function(e){var i=this._parent,r=i&&i._children;r&&i.insertChildren(e in r?e:a,[this])},equals:function(e){return e===this||e&&this._class===e._class&&this._style.equals(e._style)&&this._matrix.equals(e._matrix)&&this._locked===e._locked&&this._visible===e._visible&&this._blendMode===e._blendMode&&this._opacity===e._opacity&&this._clipMask===e._clipMask&&this._guide===e._guide&&this._equals(e)||!1},_equals:function(e){return o.equals(this._children,e._children)},clone:function(e){var i=new this.constructor(O.NO_INSERT),r=this._children,u=o.pick(e?e.insert:a,e===a||e===!0),c=o.pick(e?e.deep:a,!0);r&&i.copyAttributes(this),(!r||c)&&i.copyContent(this),r||i.copyAttributes(this),u&&i.insertAbove(this);var p=this._name,m=this._parent;if(p&&m){for(var r=m._children,_=p,y=1;r[p];)p=_+" "+y++;p!==_&&i.setName(p)}return i},copyContent:function(e){for(var i=e._children,r=0,u=i&&i.length;r<u;r++)this.addChild(i[r].clone(!1),!0)},copyAttributes:function(e,i){this.setStyle(e._style);for(var r=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],u=0,c=r.length;u<c;u++){var p=r[u];e.hasOwnProperty(p)&&(this[p]=e[p])}i||this._matrix.set(e._matrix,!0),this.setApplyMatrix(e._applyMatrix),this.setPivot(e._pivot),this.setSelection(e._selection);var m=e._data,_=e._name;this._data=m?o.clone(m):null,_&&this.setName(_)},rasterize:function(e,i){var r,u,c;o.isPlainObject(e)?(r=e.resolution,u=e.insert,c=e.raster):(r=e,u=i),c||(c=new Ee(O.NO_INSERT));var p=this.getStrokeBounds(),m=(r||this.getView().getResolution())/72,_=p.getTopLeft().floor(),y=p.getBottomRight().ceil(),x=new Z(y.subtract(_)),T=x.multiply(m);if(c.setSize(T,!0),!T.isZero()){var M=c.getContext(!0),P=new ce().scale(m).translate(_.negate());M.save(),P.applyToContext(M),this.draw(M,new o({matrices:[P]})),M.restore()}return c._matrix.set(new ce().translate(_.add(x.divide(2))).scale(1/m)),(u===a||u)&&c.insertAbove(this),c},contains:function(){var e=this._matrix;return e.isInvertible()&&!!this._contains(e._inverseTransform(L.read(arguments)))},_contains:function(e){var i=this._children;if(i){for(var r=i.length-1;r>=0;r--)if(i[r].contains(e))return!0;return!1}return e.isInside(this.getInternalBounds())},isInside:function(){return J.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Ve.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(e,i){return e instanceof O?this._asPathItem().getIntersections(e._asPathItem(),null,i,!0).length>0:!1}},new function(){function e(){var u=arguments;return this._hitTest(L.read(u),De.getOptions(u))}function i(){var u=arguments,c=L.read(u),p=De.getOptions(u),m=[];return this._hitTest(c,new o({all:m},p)),m}function r(u,c,p,m){var _=this._children;if(_)for(var y=_.length-1;y>=0;y--){var x=_[y],T=x!==m&&x._hitTest(u,c,p);if(T&&!c.all)return T}return null}return he.inject({hitTest:e,hitTestAll:i,_hitTest:r}),{hitTest:e,hitTestAll:i,_hitTestChildren:r}},{_hitTest:function(e,i,r){if(this._locked||!this._visible||this._guide&&!i.guides||this.isEmpty())return null;var u=this._matrix,c=r?r.appended(u):this.getGlobalMatrix().prepend(this.getView()._matrix),p=Math.max(i.tolerance,1e-12),m=i._tolerancePadding=new Z(Ve._getStrokePadding(p,u._shiftless().invert()));if(e=u._inverseTransform(e),!e||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(m.multiply(2))._containsPoint(e))return null;var _=!(i.guides&&!this._guide||i.selected&&!this.isSelected()||i.type&&i.type!==o.hyphenate(this._class)||i.class&&!(this instanceof i.class)),y=i.match,x=this,T,M;function P(b){return b&&y&&!y(b)&&(b=null),b&&i.all&&i.all.push(b),b}function C(b,N){var U=N?T["get"+N]():x.getPosition();if(e.subtract(U).divide(m).length<=1)return new De(b,x,{name:N?o.hyphenate(N):b,point:U})}var B=i.position,z=i.center,V=i.bounds;if(_&&this._parent&&(B||z||V)){if((z||V)&&(T=this.getInternalBounds()),M=B&&C("position")||z&&C("center","Center"),!M&&V)for(var I=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],R=0;R<8&&!M;R++)M=C("bounds",I[R]);M=P(M)}return M||(M=this._hitTestChildren(e,i,c)||_&&P(this._hitTestSelf(e,i,c,this.getStrokeScaling()?null:c._shiftless().invert()))||null),M&&M.point&&(M.point=u.transform(M.point)),M},_hitTestSelf:function(e,i){if(i.fill&&this.hasFill()&&this._contains(e))return new De("fill",this)},matches:function(e,i){function r(m,_){for(var y in m)if(m.hasOwnProperty(y)){var x=m[y],T=_[y];if(o.isPlainObject(x)&&o.isPlainObject(T)){if(!r(x,T))return!1}else if(!o.equals(x,T))return!1}return!0}var u=typeof e;if(u==="object"){for(var c in e)if(e.hasOwnProperty(c)&&!this.matches(c,e[c]))return!1;return!0}else{if(u==="function")return e(this);if(e==="match")return i(this);var p=/^(empty|editable)$/.test(e)?this["is"+o.capitalize(e)]():e==="type"?o.hyphenate(this._class):this[e];if(e==="class"){if(typeof i=="function")return this instanceof i;p=this._class}if(typeof i=="function")return!!i(p);if(i){if(i.test)return i.test(p);if(o.isPlainObject(i))return r(i,p)}return o.equals(p,i)}},getItems:function(e){return O._getItems(this,e,this._matrix)},getItem:function(e){return O._getItems(this,e,this._matrix,null,!0)[0]||null},statics:{_getItems:function e(i,r,u,c,p){if(!c){var m=typeof r=="object"&&r,_=m&&m.overlapping,y=m&&m.inside,x=_||y,P=x&&J.read([x]);c={items:[],recursive:m&&m.recursive!==!1,inside:!!y,overlapping:!!_,rect:P,path:_&&new Ve.Rectangle({rectangle:P,insert:!1})},m&&(r=o.filter({},r,{recursive:!0,inside:!0,overlapping:!0}))}var T=i._children,M=c.items,P=c.rect;u=P&&(u||new ce);for(var C=0,B=T&&T.length;C<B;C++){var z=T[C],V=u&&u.appended(z._matrix),I=!0;if(P){var x=z.getBounds(V);if(!P.intersects(x))continue;P.contains(x)||c.overlapping&&(x.contains(P)||c.path.intersects(z,V))||(I=!1)}if(I&&z.matches(r)&&(M.push(z),p)||(c.recursive!==!1&&e(z,r,V,c,p),p&&M.length>0))break}return M}}},{importJSON:function(e){var i=o.importJSON(e,this);return i!==this?this.addChild(i):i},addChild:function(e){return this.insertChild(a,e)},insertChild:function(e,i){var r=i?this.insertChildren(e,[i]):null;return r&&r[0]},addChildren:function(e){return this.insertChildren(this._children.length,e)},insertChildren:function(e,i){var r=this._children;if(r&&i&&i.length>0){i=o.slice(i);for(var u={},c=i.length-1;c>=0;c--){var p=i[c],m=p&&p._id;!p||u[m]?i.splice(c,1):(p._remove(!1,!0),u[m]=!0)}o.splice(r,i,e,0);for(var _=this._project,y=_._changes,c=0,x=i.length;c<x;c++){var p=i[c],T=p._name;p._parent=this,p._setProject(_,!0),T&&p.setName(T),y&&p._changed(5)}this._changed(11)}else i=null;return i},_insertItem:"#insertChild",_insertAt:function(e,i){var r=e&&e._getOwner(),u=e!==this&&r?this:null;return u&&(u._remove(!1,!0),r._insertItem(e._index+i,u)),u},insertAbove:function(e){return this._insertAt(e,1)},insertBelow:function(e){return this._insertAt(e,0)},sendToBack:function(){var e=this._getOwner();return e?e._insertItem(0,this):null},bringToFront:function(){var e=this._getOwner();return e?e._insertItem(a,this):null},appendTop:"#addChild",appendBottom:function(e){return this.insertChild(0,e)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(e){return e._insertItem(a,this)},copyTo:function(e){return this.clone(!1).addTo(e)},reduce:function(e){var i=this._children;if(i&&i.length===1){var r=i[0].reduce(e);return this._parent?(r.insertAbove(this),this.remove()):r.remove(),r}return this},_removeNamed:function(){var e=this._getOwner();if(e){var i=e._children,r=e._namedChildren,u=this._name,c=r[u],p=c?c.indexOf(this):-1;p!==-1&&(i[u]==this&&delete i[u],c.splice(p,1),c.length?i[u]=c[0]:delete r[u])}},_remove:function(e,i){var r=this._getOwner(),u=this._project,c=this._index;return this._style&&this._style._dispose(),r?(this._name&&this._removeNamed(),c!=null&&(u._activeLayer===this&&(u._activeLayer=this.getNextSibling()||this.getPreviousSibling()),o.splice(r._children,null,c,1)),this._installEvents(!1),e&&u._changes&&this._changed(5),i&&r._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(e){var i=e&&e.insertBelow(this);return i&&this.remove(),i},removeChildren:function(e,i){if(!this._children)return null;e=e||0,i=o.pick(i,this._children.length);for(var r=o.splice(this._children,null,e,i-e),u=r.length-1;u>=0;u--)r[u]._remove(!0,!1);return r.length>0&&this._changed(11),r},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var e=0,i=this._children.length;e<i;e++)this._children[e]._index=e;this._changed(11)}},isEmpty:function(e){var i=this._children,r=i?i.length:0;if(e){for(var u=0;u<r;u++)if(!i[u].isEmpty(e))return!1;return!0}return!r},isEditable:function(){for(var e=this;e;){if(!e._visible||e._locked)return!1;e=e._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(e){function i(m){var _=[];do _.unshift(m);while(m=m._parent);return _}for(var r=i(this),u=i(e),c=0,p=Math.min(r.length,u.length);c<p;c++)if(r[c]!=u[c])return r[c]._index<u[c]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(e){return this._getOrder(e)===-1},isBelow:function(e){return this._getOrder(e)===1},isParent:function(e){return this._parent===e},isChild:function(e){return e&&e._parent===this},isDescendant:function(e){for(var i=this;i=i._parent;)if(i===e)return!0;return!1},isAncestor:function(e){return e?e.isDescendant(this):!1},isSibling:function(e){return this._parent===e._parent},isGroupedWith:function(e){for(var i=this._parent;i;){if(i._parent&&/^(Group|Layer|CompoundPath)$/.test(i._class)&&e.isDescendant(i))return!0;i=i._parent}return!1}},o.each(["rotate","scale","shear","skew"],function(e){var i=e==="rotate";this[e]=function(){var r=arguments,u=(i?o:L).read(r),c=L.read(r,0,{readNull:!0});return this.transform(new ce()[e](u,c||this.getPosition(!0)))}},{translate:function(){var e=new ce;return this.transform(e.translate.apply(e,arguments))},transform:function(e,i,r){var u=this._matrix,c=e&&!e.isIdentity(),p=r&&this._canApplyMatrix||this._applyMatrix&&(c||!u.isIdentity()||i&&this._children);if(!c&&!p)return this;if(c){!e.isInvertible()&&u.isInvertible()&&(u._backup=u.getValues()),u.prepend(e,!0);var m=this._style,_=m.getFillColor(!0),y=m.getStrokeColor(!0);_&&_.transform(e),y&&y.transform(e)}if(p&&(p=this._transformContent(u,i,r))){var x=this._pivot;x&&u._transformPoint(x,x,!0),u.reset(!0),r&&this._canApplyMatrix&&(this._applyMatrix=!0)}var T=this._bounds,M=this._position;(c||p)&&this._changed(25);var P=c&&T&&e.decompose();if(P&&P.skewing.isZero()&&P.rotation%90===0){for(var C in T){var B=T[C];if(B.nonscaling)delete T[C];else if(p||!B.internal){var z=B.rect;e._transformBounds(z,z)}}this._bounds=T;var V=T[this._getBoundsCacheKey(this._boundsOptions||{})];V&&(this._position=this._getPositionFromBounds(V.rect))}else c&&M&&this._pivot&&(this._position=e._transformPoint(M,M));return this},_transformContent:function(e,i,r){var u=this._children;if(u){for(var c=0,p=u.length;c<p;c++)u[c].transform(e,i,r);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(L.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(L.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(L.read(arguments))},localToParent:function(){return this._matrix._transformPoint(L.read(arguments))},fitBounds:function(e,i){e=J.read(arguments);var r=this.getBounds(),u=r.height/r.width,c=e.height/e.width,p=(i?u>c:u<c)?e.width/r.width:e.height/r.height,m=new J(new L,new Z(r.width*p,r.height*p));m.setCenter(e.getCenter()),this.setBounds(m)}}),{_setStyles:function(e,i,r){var u=this._style,c=this._matrix;if(u.hasFill()&&(e.fillStyle=u.getFillColor().toCanvasStyle(e,c)),u.hasStroke()){e.strokeStyle=u.getStrokeColor().toCanvasStyle(e,c),e.lineWidth=u.getStrokeWidth();var p=u.getStrokeJoin(),m=u.getStrokeCap(),_=u.getMiterLimit();if(p&&(e.lineJoin=p),m&&(e.lineCap=m),_&&(e.miterLimit=_),Ye.support.nativeDash){var y=u.getDashArray(),x=u.getDashOffset();y&&y.length&&("setLineDash"in e?(e.setLineDash(y),e.lineDashOffset=x):(e.mozDash=y,e.mozDashOffset=x))}}if(u.hasShadow()){var T=i.pixelRatio||1,M=r._shiftless().prepend(new ce().scale(T,T)),P=M.transform(new L(u.getShadowBlur(),0)),C=M.transform(this.getShadowOffset());e.shadowColor=u.getShadowColor().toCanvasStyle(e),e.shadowBlur=P.getLength(),e.shadowOffsetX=C.x,e.shadowOffsetY=C.y}},draw:function(e,i,r){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var u=i.matrices,c=i.viewMatrix,p=this._matrix,m=u[u.length-1].appended(p);if(m.isInvertible()){c=c?c.appended(m):m,u.push(m),i.updateMatrix&&(this._globalMatrix=m);var _=this._blendMode,y=k.clamp(this._opacity,0,1),x=_==="normal",T=yi.nativeModes[_],M=x&&y===1||i.dontStart||i.clip||(T||x&&y<1)&&this._canComposite(),P=i.pixelRatio||1,C,B,z;if(!M){var V=this.getStrokeBounds(c);if(!V.width||!V.height){u.pop();return}z=i.offset,B=i.offset=V.getTopLeft().floor(),C=e,e=pt.getContext(V.getSize().ceil().add(1).multiply(P)),P!==1&&e.scale(P,P)}e.save();var I=r?r.appended(p):this._canScaleStroke&&!this.getStrokeScaling(!0)&&c,R=!M&&i.clipItem,b=!I||R;if(M?(e.globalAlpha=y,T&&(e.globalCompositeOperation=_)):b&&e.translate(-B.x,-B.y),b&&(M?p:c).applyToContext(e),R&&i.clipItem.draw(e,i.extend({clip:!0})),I){e.setTransform(P,0,0,P,0,0);var N=i.offset;N&&e.translate(-N.x,-N.y)}this._draw(e,i,c,I),e.restore(),u.pop(),i.clip&&!i.dontFinish&&e.clip(this.getFillRule()),M||(yi.process(_,e,C,y,B.subtract(z).multiply(P)),pt.release(e),i.offset=z)}}},_isUpdated:function(e){var i=this._parent;if(i instanceof it)return i._isUpdated(e);var r=this._updateVersion===e;return!r&&i&&i._visible&&i._isUpdated(e)&&(this._updateVersion=e,r=!0),r},_drawSelection:function(e,i,r,u,c){var p=this._selection,m=p&1,_=p&2||m&&this._selectBounds,y=p&4;if(this._drawSelected||(m=!1),(m||_||y)&&this._isUpdated(c)){var x,T=this.getSelectedColor(!0)||(x=this.getLayer())&&x.getSelectedColor(!0),M=i.appended(this.getGlobalMatrix(!0)),P=r/2;if(e.strokeStyle=e.fillStyle=T?T.toCanvasStyle(e):"#009dec",m&&this._drawSelected(e,M,u),y){var C=this.getPosition(!0),B=this._parent,z=B?B.localToGlobal(C):C,V=z.x,I=z.y;e.beginPath(),e.arc(V,I,P,0,Math.PI*2,!0),e.stroke();for(var R=[[0,-1],[1,0],[0,1],[-1,0]],b=P,N=r+1,U=0;U<4;U++){var H=R[U],D=H[0],G=H[1];e.moveTo(V+D*b,I+G*b),e.lineTo(V+D*N,I+G*N),e.stroke()}}if(_){var K=M._transformCorners(this.getInternalBounds());e.beginPath();for(var U=0;U<8;U++)e[U?"lineTo":"moveTo"](K[U],K[++U]);e.closePath(),e.stroke();for(var U=0;U<8;U++)e.fillRect(K[U]-P,K[++U]-P,r,r)}}},_canComposite:function(){return!1}},o.each(["down","drag","up","move"],function(e){this["removeOn"+o.capitalize(e)]=function(){var i={};return i[e]=!0,this.removeOn(i)}},{removeOn:function(e){for(var i in e)if(e[i]){var r="mouse"+i,u=this._project,c=u._removeSets=u._removeSets||{};c[r]=c[r]||{},c[r][this._id]=this}return this}}),{tween:function(e,i,r){r||(r=i,i=e,e=null,r||(r=i,i=null));var u=r&&r.easing,c=r&&r.start,p=r!=null&&(typeof r=="number"?r:r.duration),m=new Mi(this,e,i,p,u,c);function _(y){m._handleFrame(y.time*1e3),m.running||this.off("frame",_)}return p&&this.on("frame",_),m},tweenTo:function(e,i){return this.tween(null,e,i)},tweenFrom:function(e,i){return this.tween(e,null,i)}}),ye=O.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(i){this._children=[],this._namedChildren={},this._initialize(i)||this.addChildren(Array.isArray(i)?i:arguments)},_changed:function e(i){e.base.call(this,i),i&2050&&(this._clipItem=a)},_getClipItem:function(){var e=this._clipItem;if(e===a){e=null;for(var i=this._children,r=0,u=i.length;r<u;r++)if(i[r]._clipMask){e=i[r];break}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(e){var i=this.getFirstChild();i&&i.setClipMask(e)},_getBounds:function e(i,r){var u=this._getClipItem();return u?u._getCachedBounds(u._matrix.prepended(i),o.set({},r,{stroke:!1})):e.base.call(this,i,r)},_hitTestChildren:function e(i,r,u){var c=this._getClipItem();return(!c||c.contains(i))&&e.base.call(this,i,r,u,c)},_draw:function(e,i){var r=i.clip,u=!r&&this._getClipItem();i=i.extend({clipItem:u,clip:!1}),r?(e.beginPath(),i.dontStart=i.dontFinish=!0):u&&u.draw(e,i.extend({clip:!0}));for(var c=this._children,p=0,m=c.length;p<m;p++){var _=c[p];_!==u&&_.draw(e,i)}}}),we=ye.extend({_class:"Layer",initialize:function(){ye.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function e(){return this._parent?e.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),me=O.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(i,r){this._initialize(i,r)},_equals:function(e){return this._type===e._type&&this._size.equals(e._size)&&o.equals(this._radius,e._radius)},copyContent:function(e){this.setType(e._type),this.setSize(e._size),this.setRadius(e._radius)},getType:function(){return this._type},setType:function(e){this._type=e},getShape:"#getType",setShape:"#setType",getSize:function(){var e=this._size;return new ne(e.width,e.height,this,"setSize")},setSize:function(){var e=Z.read(arguments);if(!this._size)this._size=e.clone();else if(!this._size.equals(e)){var i=this._type,r=e.width,u=e.height;i==="rectangle"?this._radius.set(Z.min(this._radius,e.divide(2).abs())):i==="circle"?(r=u=(r+u)/2,this._radius=r/2):i==="ellipse"&&this._radius._set(r/2,u/2),this._size._set(r,u),this._changed(9)}},getRadius:function(){var e=this._radius;return this._type==="circle"?e:new ne(e.width,e.height,this,"setRadius")},setRadius:function(e){var i=this._type;if(i==="circle"){if(e===this._radius)return;var r=e*2;this._radius=e,this._size._set(r,r)}else if(e=Z.read(arguments),!this._radius)this._radius=e.clone();else{if(this._radius.equals(e))return;if(this._radius.set(e),i==="rectangle"){var r=Z.max(this._size,e.multiply(2));this._size.set(r)}else i==="ellipse"&&this._size._set(e.width*2,e.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(e){var i=new Ve[o.capitalize(this._type)]({center:new L,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),Ye.settings.applyMatrix&&i.setApplyMatrix(!0),(e===a||e)&&i.insertAbove(this),i},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(e,i,r,u){var c=this._style,p=c.hasFill(),m=c.hasStroke(),_=i.dontFinish||i.clip,y=!u;if(p||m||_){var x=this._type,T=this._radius,M=x==="circle";if(i.dontStart||e.beginPath(),y&&M)e.arc(0,0,T,0,Math.PI*2,!0);else{var P=M?T:T.width,C=M?T:T.height,B=this._size,z=B.width,V=B.height;if(y&&x==="rectangle"&&P===0&&C===0)e.rect(-z/2,-V/2,z,V);else{var I=z/2,R=V/2,b=1-.5522847498307936,N=P*b,U=C*b,H=[-I,-R+C,-I,-R+U,-I+N,-R,-I+P,-R,I-P,-R,I-N,-R,I,-R+U,I,-R+C,I,R-C,I,R-U,I-N,R,I-P,R,-I+P,R,-I+N,R,-I,R-U,-I,R-C];u&&u.transform(H,H,32),e.moveTo(H[0],H[1]),e.bezierCurveTo(H[2],H[3],H[4],H[5],H[6],H[7]),I!==P&&e.lineTo(H[8],H[9]),e.bezierCurveTo(H[10],H[11],H[12],H[13],H[14],H[15]),R!==C&&e.lineTo(H[16],H[17]),e.bezierCurveTo(H[18],H[19],H[20],H[21],H[22],H[23]),I!==P&&e.lineTo(H[24],H[25]),e.bezierCurveTo(H[26],H[27],H[28],H[29],H[30],H[31])}}e.closePath()}!_&&(p||m)&&(this._setStyles(e,i,r),p&&(e.fill(c.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),m&&e.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(e,i){var r=new J(this._size).setCenter(0,0),u=this._style,c=i.stroke&&u.hasStroke()&&u.getStrokeWidth();return e&&(r=e._transformBounds(r)),c?r.expand(Ve._getStrokePadding(c,this._getStrokeMatrix(e,i))):r}},new function(){function e(r,u,c){var p=r._radius;if(!p.isZero())for(var m=r._size.divide(2),_=1;_<=4;_++){var y=new L(_>1&&_<4?-1:1,_>2?-1:1),x=y.multiply(m),T=x.subtract(y.multiply(p)),M=new J(c?x.add(y.multiply(c)):x,T);if(M.contains(u))return{point:T,quadrant:_}}}function i(r,u,c,p){var m=r.divide(u);return(!p||m.isInQuadrant(p))&&m.subtract(m.normalize()).multiply(u).divide(c).length<=1}return{_contains:function r(u){if(this._type==="rectangle"){var c=e(this,u);return c?u.subtract(c.point).divide(this._radius).getLength()<=1:r.base.call(this,u)}else return u.divide(this.size).getLength()<=.5},_hitTestSelf:function r(u,c,p,m){var _=!1,y=this._style,x=c.stroke&&y.hasStroke(),T=c.fill&&y.hasFill();if(x||T){var M=this._type,P=this._radius,C=x?y.getStrokeWidth()/2:0,B=c._tolerancePadding.add(Ve._getStrokePadding(C,!y.getStrokeScaling()&&m));if(M==="rectangle"){var z=B.multiply(2),V=e(this,u,z);if(V)_=i(u.subtract(V.point),P,B,V.quadrant);else{var I=new J(this._size).setCenter(0,0),R=I.expand(z),b=I.expand(z.negate());_=R._containsPoint(u)&&!b._containsPoint(u)}}else _=i(u,P,B)}return _?new De(x?"stroke":"fill",this):r.base.apply(this,arguments)}}},{statics:new function(){function e(i,r,u,c,p){var m=o.create(me.prototype);return m._type=i,m._size=u,m._radius=c,m._initialize(o.getNamed(p),r),m}return{Circle:function(){var i=arguments,r=L.readNamed(i,"center"),u=o.readNamed(i,"radius");return e("circle",r,new Z(u*2),u,i)},Rectangle:function(){var i=arguments,r=J.readNamed(i,"rectangle"),u=Z.min(Z.readNamed(i,"radius"),r.getSize(!0).divide(2));return e("rectangle",r.getCenter(!0),r.getSize(!0),u,i)},Ellipse:function(){var i=arguments,r=me._readEllipse(i),u=r.radius;return e("ellipse",r.center,u.multiply(2),u,i)},_readEllipse:function(i){var r,u;if(o.hasNamed(i,"radius"))r=L.readNamed(i,"center"),u=Z.readNamed(i,"radius");else{var c=J.readNamed(i,"rectangle");r=c.getCenter(!0),u=c.getSize(!0).divide(2)}return{center:r,radius:u}}}}}),Ee=O.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(i,r){if(!this._initialize(i,r!==a&&L.read(arguments))){var u,c=typeof i,p=c==="string"?f.getElementById(i):c==="object"?i:null;if(p&&p!==O.NO_INSERT){if(p.getContext||p.naturalHeight!=null)u=p;else if(p){var m=Z.read(arguments);m.isZero()||(u=pt.getCanvas(m))}}u?this.setImage(u):this.setSource(i)}this._size||(this._size=new Z,this._loaded=!1)},_equals:function(e){return this.getSource()===e.getSource()},copyContent:function(e){var i=e._image,r=e._canvas;if(i)this._setImage(i);else if(r){var u=pt.getCanvas(e._size);u.getContext("2d").drawImage(r,0,0),this._setImage(u)}this._crossOrigin=e._crossOrigin},getSize:function(){var e=this._size;return new ne(e?e.width:0,e?e.height:0,this,"setSize")},setSize:function(e,i){var r=Z.read(arguments);if(r.equals(this._size))i&&this.clear();else if(r.width>0&&r.height>0){var u=!i&&this.getElement();this._setImage(pt.getCanvas(r)),u&&this.getContext(!0).drawImage(u,0,0,r.width,r.height)}else this._canvas&&pt.release(this._canvas),this._size=r.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(e){this.setSize(e,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(e){this.setSize(this.getWidth(),e)},getLoaded:function(){return this._loaded},isEmpty:function(){var e=this._size;return!e||e.width===0&&e.height===0},getResolution:function(){var e=this._matrix,i=new L(0,0).transform(e),r=new L(1,0).transform(e).subtract(i),u=new L(0,1).transform(e).subtract(i);return new Z(72/r.getLength(),72/u.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(e){var i=this;function r(u){var c=i.getView(),p=u&&u.type||"load";c&&i.responds(p)&&(Ye=c._scope,i.emit(p,new ai(u)))}this._setImage(e),this._loaded?setTimeout(r,0):e&&ut.add(e,{load:function(u){i._setImage(e),r(u)},error:r})},_setImage:function(e){this._canvas&&pt.release(this._canvas),e&&e.getContext?(this._image=null,this._canvas=e,this._loaded=!0):(this._image=e,this._canvas=null,this._loaded=!!(e&&e.src&&e.complete)),this._size=new Z(e?e.naturalWidth||e.width:0,e?e.naturalHeight||e.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var e=pt.getContext(this._size);try{this._image&&e.drawImage(this._image,0,0),this._canvas=e.canvas}catch{pt.release(e)}}return this._canvas},setCanvas:"#setImage",getContext:function(e){return this._context||(this._context=this.getCanvas().getContext("2d")),e&&(this._image=null,this._changed(1025)),this._context},setContext:function(e){this._context=e},getSource:function(){var e=this._image;return e&&e.src||this.toDataURL()},setSource:function(e){var i=new s.Image,r=this._crossOrigin;r&&(i.crossOrigin=r),e&&(i.src=e),this.setImage(i)},getCrossOrigin:function(){var e=this._image;return e&&e.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(e){this._crossOrigin=e;var i=this._image;i&&(i.crossOrigin=e)},getSmoothing:function(){return this._smoothing},setSmoothing:function(e){this._smoothing=typeof e=="string"?e:e?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var e=J.read(arguments),i=pt.getContext(e.getSize());return i.drawImage(this.getCanvas(),e.x,e.y,e.width,e.height,0,0,e.width,e.height),i.canvas},getSubRaster:function(){var e=J.read(arguments),i=new Ee(O.NO_INSERT);return i._setImage(this.getSubCanvas(e)),i.translate(e.getCenter().subtract(this.getSize().divide(2))),i._matrix.prepend(this._matrix),i.insertAbove(this),i},toDataURL:function(){var e=this._image,i=e&&e.src;if(/^data:/.test(i))return i;var r=this.getCanvas();return r?r.toDataURL.apply(r,arguments):null},drawImage:function(e){var i=L.read(arguments,1);this.getContext(!0).drawImage(e,i.x,i.y)},getAverageColor:function(e){var i,r;if(e?e instanceof st?(r=e,i=e.getBounds()):typeof e=="object"&&("width"in e?i=new J(e):"x"in e&&(i=new J(e.x-.5,e.y-.5,1,1))):i=this.getBounds(),!i)return null;var u=32,c=Math.min(i.width,u),p=Math.min(i.height,u),m=Ee._sampleContext;m?m.clearRect(0,0,u+1,u+1):m=Ee._sampleContext=pt.getContext(new Z(u)),m.save();var _=new ce().scale(c/i.width,p/i.height).translate(-i.x,-i.y);_.applyToContext(m),r&&r.draw(m,new o({clip:!0,matrices:[_]})),this._matrix.applyToContext(m);var y=this.getElement(),x=this._size;y&&m.drawImage(y,-x.width/2,-x.height/2),m.restore();for(var T=m.getImageData(.5,.5,Math.ceil(c),Math.ceil(p)).data,M=[0,0,0],P=0,C=0,B=T.length;C<B;C+=4){var z=T[C+3];P+=z,z/=255,M[0]+=T[C]*z,M[1]+=T[C+1]*z,M[2]+=T[C+2]*z}for(var C=0;C<3;C++)M[C]/=P;return P?dt.read(M):null},getPixel:function(){var e=L.read(arguments),i=this.getContext().getImageData(e.x,e.y,1,1).data;return new dt("rgb",[i[0]/255,i[1]/255,i[2]/255],i[3]/255)},setPixel:function(){var e=arguments,i=L.read(e),r=dt.read(e),u=r._convert("rgb"),c=r._alpha,p=this.getContext(!0),m=p.createImageData(1,1),_=m.data;_[0]=u[0]*255,_[1]=u[1]*255,_[2]=u[2]*255,_[3]=c!=null?c*255:255,p.putImageData(m,i.x,i.y)},clear:function(){var e=this._size;this.getContext(!0).clearRect(0,0,e.width+1,e.height+1)},createImageData:function(){var e=Z.read(arguments);return this.getContext().createImageData(e.width,e.height)},getImageData:function(){var e=J.read(arguments);return e.isEmpty()&&(e=new J(this._size)),this.getContext().getImageData(e.x,e.y,e.width,e.height)},putImageData:function(e){var i=L.read(arguments,1);this.getContext(!0).putImageData(e,i.x,i.y)},setImageData:function(e){this.setSize(e),this.getContext(!0).putImageData(e,0,0)},_getBounds:function(e,i){var r=new J(this._size).setCenter(0,0);return e?e._transformBounds(r):r},_hitTestSelf:function(e){if(this._contains(e)){var i=this;return new De("pixel",i,{offset:e.add(i._size.divide(2)).round(),color:{get:function(){return i.getPixel(this.offset)}}})}},_draw:function(e,i,r){var u=this.getElement();if(u&&u.width>0&&u.height>0){e.globalAlpha=k.clamp(this._opacity,0,1),this._setStyles(e,i,r);var c=this._smoothing,p=c==="off";at.setPrefixed(e,p?"imageSmoothingEnabled":"imageSmoothingQuality",p?!1:c),e.drawImage(u,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),Me=O.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(i,r){this._initialize(i,r!==a&&L.read(arguments,1))||this.setDefinition(i instanceof Pe?i:new Pe(i))},_equals:function(e){return this._definition===e._definition},copyContent:function(e){this.setDefinition(e._definition)},getDefinition:function(){return this._definition},setDefinition:function(e){this._definition=e,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(e,i){var r=this._definition._item;return r._getCachedBounds(r._matrix.prepended(e),i)},_hitTestSelf:function(e,i,r){var u=i.extend({all:!1}),c=this._definition._item._hitTest(e,u,r);return c&&(c.item=this),c},_draw:function(e,i){this._definition._item.draw(e,i)}}),Pe=o.extend({_class:"SymbolDefinition",initialize:function(i,r){this._id=q.get(),this.project=Ye.project,i&&this.setItem(i,r)},_serialize:function(e,i){return i.add(this,function(){return o.serialize([this._class,this._item],e,!1,i)})},_changed:function(e){e&8&&O._clearBoundsCache(this),e&1&&this.project._changed(e)},getItem:function(){return this._item},setItem:function(e,i){e._symbol&&(e=e.clone()),this._item&&(this._item._symbol=null),this._item=e,e.remove(),e.setSelected(!1),i||e.setPosition(new L),e._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(e){return new Me(this,e)},clone:function(){return new Pe(this._item.clone(!1))},equals:function(e){return e===this||e&&this._item.equals(e._item)||!1}}),De=o.extend({_class:"HitResult",initialize:function(i,r,u){this.type=i,this.item=r,u&&this.inject(u)},statics:{getOptions:function(e){var i=e&&o.read(e);return new o({type:null,tolerance:Ye.settings.hitTolerance,fill:!i,stroke:!i,segments:!i,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},i)}}}),Se=o.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(i,r,u,c,p,m){var _=arguments.length,y,x,T,M;_>0&&(i==null||typeof i=="object"?_===1&&i&&"point"in i?(y=i.point,x=i.handleIn,T=i.handleOut,M=i.selection):(y=i,x=r,T=u,M=c):(y=[i,r],x=u!==a?[u,c]:null,T=p!==a?[p,m]:null)),new et(y,this,"_point"),new et(x,this,"_handleIn"),new et(T,this,"_handleOut"),M&&this.setSelection(M)},_serialize:function(e,i){var r=this._point,u=this._selection,c=u||this.hasHandles()?[r,this._handleIn,this._handleOut]:r;return u&&c.push(u),o.serialize(c,e,!0,i)},_changed:function(e){var i=this._path;if(i){var r=i._curves,u=this._index,c;r&&((!e||e===this._point||e===this._handleIn)&&(c=u>0?r[u-1]:i._closed?r[r.length-1]:null)&&c._changed(),(!e||e===this._point||e===this._handleOut)&&(c=r[u])&&c._changed()),i._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(L.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(L.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(L.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var e=this._handleIn,i=this._handleOut;return!e.isZero()&&!i.isZero()&&e.isCollinear(i)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(e){var i=this._selection,r=this._path;this._selection=e=e||0,r&&e!==i&&(r._updateSelection(this,i,e),r._changed(257))},_changeSelection:function(e,i){var r=this._selection;this.setSelection(i?r|e:r&~e)},isSelected:function(){return!!(this._selection&7)},setSelected:function(e){this._changeSelection(7,e)},getIndex:function(){return this._index!==a?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var e=this._path,i=this._index;return e?(i>0&&!e._closed&&i===e._segments.length-1&&i--,e.getCurves()[i]||null):null},getLocation:function(){var e=this.getCurve();return e?new Xe(e,this===e._segment1?0:1):null},getNext:function(){var e=this._path&&this._path._segments;return e&&(e[this._index+1]||this._path._closed&&e[0])||null},smooth:function(e,i,r){var u=e||{},c=u.type,p=u.factor,m=this.getPrevious(),_=this.getNext(),y=(m||this)._point,x=this._point,T=(_||this)._point,M=y.getDistance(x),P=x.getDistance(T);if(!c||c==="catmull-rom"){var C=p===a?.5:p,B=Math.pow(M,C),z=B*B,V=Math.pow(P,C),I=V*V;if(!i&&m){var R=2*I+3*V*B+z,b=3*V*(V+B);this.setHandleIn(b!==0?new L((I*y._x+R*x._x-z*T._x)/b-x._x,(I*y._y+R*x._y-z*T._y)/b-x._y):new L)}if(!r&&_){var R=2*z+3*B*V+I,b=3*B*(B+V);this.setHandleOut(b!==0?new L((z*T._x+R*x._x-I*y._x)/b-x._x,(z*T._y+R*x._y-I*y._y)/b-x._y):new L)}}else if(c==="geometric"){if(m&&_){var N=y.subtract(T),U=p===a?.4:p,H=U*M/(M+P);i||this.setHandleIn(N.multiply(H)),r||this.setHandleOut(N.multiply(H-U))}}else throw new Error("Smoothing method '"+c+"' not supported.")},getPrevious:function(){var e=this._path&&this._path._segments;return e&&(e[this._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var e=this._path;return e&&this._index===e._segments.length-1||!1},reverse:function(){var e=this._handleIn,i=this._handleOut,r=e.clone();e.set(i),i.set(r)},reversed:function(){return new Se(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Se(this._point,this._handleIn,this._handleOut)},equals:function(e){return e===this||e&&this._class===e._class&&this._point.equals(e._point)&&this._handleIn.equals(e._handleIn)&&this._handleOut.equals(e._handleOut)||!1},toString:function(){var e=["point: "+this._point];return this._handleIn.isZero()||e.push("handleIn: "+this._handleIn),this._handleOut.isZero()||e.push("handleOut: "+this._handleOut),"{ "+e.join(", ")+" }"},transform:function(e){this._transformCoordinates(e,new Array(6),!0),this._changed()},interpolate:function(e,i,r){var u=1-r,c=r,p=e._point,m=i._point,_=e._handleIn,y=i._handleIn,x=i._handleOut,T=e._handleOut;this._point._set(u*p._x+c*m._x,u*p._y+c*m._y,!0),this._handleIn._set(u*_._x+c*y._x,u*_._y+c*y._y,!0),this._handleOut._set(u*T._x+c*x._x,u*T._y+c*x._y,!0),this._changed()},_transformCoordinates:function(e,i,r){var u=this._point,c=!r||!this._handleIn.isZero()?this._handleIn:null,p=!r||!this._handleOut.isZero()?this._handleOut:null,m=u._x,_=u._y,y=2;return i[0]=m,i[1]=_,c&&(i[y++]=c._x+m,i[y++]=c._y+_),p&&(i[y++]=p._x+m,i[y++]=p._y+_),e&&(e._transformCoordinates(i,i,y/2),m=i[0],_=i[1],r?(u._x=m,u._y=_,y=2,c&&(c._x=i[y++]-m,c._y=i[y++]-_),p&&(p._x=i[y++]-m,p._y=i[y++]-_)):(c||(i[y++]=m,i[y++]=_),p||(i[y++]=m,i[y++]=_))),i}}),et=L.extend({initialize:function(i,r,u){var c,p,m;if(!i)c=p=0;else if((c=i[0])!==a)p=i[1];else{var _=i;(c=_.x)===a&&(_=L.read(arguments),c=_.x),p=_.y,m=_.selected}this._x=c,this._y=p,this._owner=r,r[u]=this,m&&this.setSelected(!0)},_set:function(e,i){return this._x=e,this._y=i,this._owner._changed(this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner._changed(this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner._changed(this)},isZero:function(){var e=k.isZero;return e(this._x)&&e(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){var e=this._owner;return this===e._point?1:this===e._handleIn?2:this===e._handleOut?4:0}}),de=o.extend({_class:"Curve",beans:!0,initialize:function(i,r,u,c,p,m,_,y){var x=arguments.length,T,M,P,C,B,z;x===3?(this._path=i,T=r,M=u):x?x===1?"segment1"in i?(T=new Se(i.segment1),M=new Se(i.segment2)):"point1"in i?(P=i.point1,B=i.handle1,z=i.handle2,C=i.point2):Array.isArray(i)&&(P=[i[0],i[1]],C=[i[6],i[7]],B=[i[2]-i[0],i[3]-i[1]],z=[i[4]-i[6],i[5]-i[7]]):x===2?(T=new Se(i),M=new Se(r)):x===4?(P=i,B=r,z=u,C=c):x===8&&(P=[i,r],C=[_,y],B=[u-i,c-r],z=[p-_,m-y]):(T=new Se,M=new Se),this._segment1=T||new Se(P,null,B),this._segment2=M||new Se(C,z,null)},_serialize:function(e,i){return o.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],e,!0,i)},_changed:function(){this._length=this._bounds=a},clone:function(){return new de(this._segment1,this._segment2)},toString:function(){var e=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||e.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||e.push("handle2: "+this._segment2._handleIn),e.push("point2: "+this._segment2._point),"{ "+e.join(", ")+" }"},classify:function(){return de.classify(this.getValues())},remove:function(){var e=!1;if(this._path){var i=this._segment2,r=i._handleOut;e=i.remove(),e&&this._segment1._handleOut.set(r)}return e},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(L.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(L.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(L.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(L.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var e=this._path;return e&&this._segment1._index===e._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(e){this.getPoint1().setSelected(e),this.getHandle1().setSelected(e),this.getHandle2().setSelected(e),this.getPoint2().setSelected(e)},getValues:function(e){return de.getValues(this._segment1,this._segment2,e)},getPoints:function(){for(var e=this.getValues(),i=[],r=0;r<8;r+=2)i.push(new L(e[r],e[r+1]));return i}},{getLength:function(){return this._length==null&&(this._length=de.getLength(this.getValues(),0,1)),this._length},getArea:function(){return de.getArea(this.getValues())},getLine:function(){return new be(this._segment1._point,this._segment2._point)},getPart:function(e,i){return new de(de.getPart(this.getValues(),e,i))},getPartLength:function(e,i){return de.getLength(this.getValues(),e,i)},divideAt:function(e){return this.divideAtTime(e&&e.curve===this?e.time:this.getTimeAt(e))},divideAtTime:function(e,i){var r=1e-8,u=1-r,c=null;if(e>=r&&e<=u){var p=de.subdivide(this.getValues(),e),m=p[0],_=p[1],y=i||this.hasHandles(),x=this._segment1,T=this._segment2,M=this._path;y&&(x._handleOut._set(m[2]-m[0],m[3]-m[1]),T._handleIn._set(_[4]-_[6],_[5]-_[7]));var P=m[6],C=m[7],B=new Se(new L(P,C),y&&new L(m[4]-P,m[5]-C),y&&new L(_[2]-P,_[3]-C));M?(M.insert(x._index+1,B),c=this.getNext()):(this._segment2=B,this._changed(),c=new de(B,T))}return c},splitAt:function(e){var i=this._path;return i?i.splitAt(e):null},splitAtTime:function(e){return this.splitAt(this.getLocationAtTime(e))},divide:function(e,i){return this.divideAtTime(e===a?.5:i?e:this.getTimeAt(e))},split:function(e,i){return this.splitAtTime(e===a?.5:i?e:this.getTimeAt(e))},reversed:function(){return new de(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(e,i,r,u){var c=e._point,p=e._handleOut,m=i._handleIn,_=i._point,y=c.x,x=c.y,T=_.x,M=_.y,P=u?[y,x,y,x,T,M,T,M]:[y,x,y+p._x,x+p._y,T+m._x,M+m._y,T,M];return r&&r._transformCoordinates(P,P,4),P},subdivide:function(e,i){var r=e[0],u=e[1],c=e[2],p=e[3],m=e[4],_=e[5],y=e[6],x=e[7];i===a&&(i=.5);var T=1-i,M=T*r+i*c,P=T*u+i*p,C=T*c+i*m,B=T*p+i*_,z=T*m+i*y,V=T*_+i*x,I=T*M+i*C,R=T*P+i*B,b=T*C+i*z,N=T*B+i*V,U=T*I+i*b,H=T*R+i*N;return[[r,u,M,P,I,R,U,H],[U,H,b,N,z,V,y,x]]},getMonoCurves:function(e,i){var r=[],u=i?0:1,c=e[u+0],p=e[u+2],m=e[u+4],_=e[u+6];if(c>=p==p>=m&&p>=m==m>=_||de.isStraight(e))r.push(e);else{var y=3*(p-m)-c+_,x=2*(c+m)-4*p,T=p-c,M=1e-8,P=1-M,C=[],B=k.solveQuadratic(y,x,T,C,M,P);if(!B)r.push(e);else{C.sort();var z=C[0],V=de.subdivide(e,z);r.push(V[0]),B>1&&(z=(C[1]-z)/(1-z),V=de.subdivide(V[1],z),r.push(V[0])),r.push(V[1])}}return r},solveCubic:function(e,i,r,u,c,p){var m=e[i],_=e[i+2],y=e[i+4],x=e[i+6],T=0;if(!(m<r&&x<r&&_<r&&y<r||m>r&&x>r&&_>r&&y>r)){var M=3*(_-m),P=3*(y-_)-M,C=x-m-M-P;T=k.solveCubic(C,P,M,m-r,u,c,p)}return T},getTimeOf:function(e,i){var r=new L(e[0],e[1]),u=new L(e[6],e[7]),c=1e-12,p=1e-7,m=i.isClose(r,c)?0:i.isClose(u,c)?1:null;if(m===null)for(var _=[i.x,i.y],y=[],x=0;x<2;x++)for(var T=de.solveCubic(e,x,_[x],y,0,1),M=0;M<T;M++){var P=y[M];if(i.isClose(de.getPoint(e,P),p))return P}return i.isClose(r,p)?0:i.isClose(u,p)?1:null},getNearestTime:function(e,i){if(de.isStraight(e)){var r=e[0],u=e[1],c=e[6],p=e[7],m=c-r,_=p-u,y=m*m+_*_;if(y===0)return 0;var x=((i.x-r)*m+(i.y-u)*_)/y;return x<1e-12?0:x>.999999999999?1:de.getTimeOf(e,new L(r+x*m,u+x*_))}var T=100,M=1/0,P=0;function C(V){if(V>=0&&V<=1){var I=i.getDistance(de.getPoint(e,V),!0);if(I<M)return M=I,P=V,!0}}for(var B=0;B<=T;B++)C(B/T);for(var z=1/(T*2);z>1e-8;)!C(P-z)&&!C(P+z)&&(z/=2);return P},getPart:function(e,i,r){var u=i>r;if(u){var c=i;i=r,r=c}return i>0&&(e=de.subdivide(e,i)[1]),r<1&&(e=de.subdivide(e,(r-i)/(1-i))[0]),u?[e[6],e[7],e[4],e[5],e[2],e[3],e[0],e[1]]:e},isFlatEnough:function(e,i){var r=e[0],u=e[1],c=e[2],p=e[3],m=e[4],_=e[5],y=e[6],x=e[7],T=3*c-2*r-y,M=3*p-2*u-x,P=3*m-2*y-r,C=3*_-2*x-u;return Math.max(T*T,P*P)+Math.max(M*M,C*C)<=16*i*i},getArea:function(e){var i=e[0],r=e[1],u=e[2],c=e[3],p=e[4],m=e[5],_=e[6],y=e[7];return 3*((y-r)*(u+p)-(_-i)*(c+m)+c*(i-p)-u*(r-m)+y*(p+i/3)-_*(m+r/3))/20},getBounds:function(e){for(var i=e.slice(0,2),r=i.slice(),u=[0,0],c=0;c<2;c++)de._addBounds(e[c],e[c+2],e[c+4],e[c+6],c,0,i,r,u);return new J(i[0],i[1],r[0]-i[0],r[1]-i[1])},_addBounds:function(e,i,r,u,c,p,m,_,y){function x(U,H){var D=U-H,G=U+H;D<m[c]&&(m[c]=D),G>_[c]&&(_[c]=G)}p/=2;var T=m[c]+p,M=_[c]-p;if(e<T||i<T||r<T||u<T||e>M||i>M||r>M||u>M)if(i<e!=i<u&&r<e!=r<u)x(e,0),x(u,0);else{var P=3*(i-r)-e+u,C=2*(e+r)-4*i,B=i-e,z=k.solveQuadratic(P,C,B,y),V=1e-8,I=1-V;x(u,0);for(var R=0;R<z;R++){var b=y[R],N=1-b;V<=b&&b<=I&&x(N*N*N*e+3*N*N*b*i+3*N*b*b*r+b*b*b*u,p)}}}}},o.each(["getBounds","getStrokeBounds","getHandleBounds"],function(e){this[e]=function(){this._bounds||(this._bounds={});var i=this._bounds[e];return i||(i=this._bounds[e]=Ve[e]([this._segment1,this._segment2],!1,this._path)),i.clone()}},{}),o.each({isStraight:function(e,i,r,u){if(i.isZero()&&r.isZero())return!0;var c=u.subtract(e);if(c.isZero())return!1;if(c.isCollinear(i)&&c.isCollinear(r)){var p=new be(e,u),m=1e-7;if(p.getDistance(e.add(i))<m&&p.getDistance(u.add(r))<m){var _=c.dot(c),y=c.dot(i)/_,x=c.dot(r)/_;return y>=0&&y<=1&&x<=0&&x>=-1}}return!1},isLinear:function(e,i,r,u){var c=u.subtract(e).divide(3);return i.equals(c)&&r.negate().equals(c)}},function(e,i){this[i]=function(r){var u=this._segment1,c=this._segment2;return e(u._point,u._handleOut,c._handleIn,c._point,r)},this.statics[i]=function(r,u){var c=r[0],p=r[1],m=r[6],_=r[7];return e(new L(c,p),new L(r[2]-c,r[3]-p),new L(r[4]-m,r[5]-_),new L(m,_),u)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(e){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(e||0)},isCollinear:function(e){return e&&this.isStraight()&&e.isStraight()&&this.getLine().isCollinear(e.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(e,i){return this.getLocationAtTime(i?e:this.getTimeAt(e))},getLocationAtTime:function(e){return e!=null&&e>=0&&e<=1?new Xe(this,e):null},getTimeAt:function(e,i){return de.getTimeAt(this.getValues(),e,i)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var e=L.read(arguments);return e.isZero()?[]:de.getTimesWithTangent(this.getValues(),e)},getOffsetAtTime:function(e){return this.getPartLength(0,e)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(L.read(arguments)))},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getTimeOf:function(){return de.getTimeOf(this.getValues(),L.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var e=L.read(arguments),i=this.getValues(),r=de.getNearestTime(i,e),u=de.getPoint(i,r);return new Xe(this,r,u,null,e.getDistance(u))},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e&&e.getPoint()}},new function(){var e=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return o.each(e,function(i){this[i+"At"]=function(r,u){var c=this.getValues();return de[i](c,u?r:de.getTimeAt(c,r))},this[i+"AtTime"]=function(r){return de[i](this.getValues(),r)}},{statics:{_evaluateMethods:e}})},new function(){function e(u){var c=u[0],p=u[1],m=u[2],_=u[3],y=u[4],x=u[5],T=u[6],M=u[7],P=9*(m-y)+3*(T-c),C=6*(c+y)-12*m,B=3*(m-c),z=9*(_-x)+3*(M-p),V=6*(p+x)-12*_,I=3*(_-p);return function(R){var b=(P*R+C)*R+B,N=(z*R+V)*R+I;return Math.sqrt(b*b+N*N)}}function i(u,c){return Math.max(2,Math.min(16,Math.ceil(Math.abs(c-u)*32)))}function r(u,c,p,m){if(c==null||c<0||c>1)return null;var _=u[0],y=u[1],x=u[2],T=u[3],M=u[4],P=u[5],C=u[6],B=u[7],z=k.isZero;z(x-_)&&z(T-y)&&(x=_,T=y),z(M-C)&&z(P-B)&&(M=C,P=B);var V=3*(x-_),I=3*(M-x)-V,R=C-_-V-I,b=3*(T-y),N=3*(P-T)-b,U=B-y-b-N,H,D;if(p===0)H=c===0?_:c===1?C:((R*c+I)*c+V)*c+_,D=c===0?y:c===1?B:((U*c+N)*c+b)*c+y;else{var G=1e-8,K=1-G;if(c<G?(H=V,D=b):c>K?(H=3*(C-M),D=3*(B-P)):(H=(3*R*c+2*I)*c+V,D=(3*U*c+2*N)*c+b),m){H===0&&D===0&&(c<G||c>K)&&(H=M-x,D=P-T);var X=Math.sqrt(H*H+D*D);X&&(H/=X,D/=X)}if(p===3){var M=6*R*c+2*I,P=6*U*c+2*N,$=Math.pow(H*H+D*D,3/2);H=$!==0?(H*P-D*M)/$:0,D=0}}return p===2?new L(D,-H):new L(H,D)}return{statics:{classify:function(u){var c=u[0],p=u[1],m=u[2],_=u[3],y=u[4],x=u[5],T=u[6],M=u[7],P=c*(M-x)+p*(y-T)+T*x-M*y,C=m*(p-M)+_*(T-c)+c*M-p*T,B=y*(_-p)+x*(c-m)+m*p-_*c,z=3*B,V=z-C,I=V-C+P,R=Math.sqrt(I*I+V*V+z*z),b=R!==0?1/R:0,N=k.isZero,U="serpentine";I*=b,V*=b,z*=b;function H(X,$,j){var Q=$!==a,ee=Q&&$>0&&$<1,re=Q&&j>0&&j<1;return Q&&(!(ee||re)||X==="loop"&&!(ee&&re))&&(X="arch",ee=re=!1),{type:X,roots:ee||re?ee&&re?$<j?[$,j]:[j,$]:[ee?$:j]:null}}if(N(I))return N(V)?H(N(z)?"line":"quadratic"):H(U,z/(3*V));var D=3*V*V-4*I*z;if(N(D))return H("cusp",V/(2*I));var G=D>0?Math.sqrt(D/3):Math.sqrt(-D),K=2*I;return H(D>0?U:"loop",(V+G)/K,(V-G)/K)},getLength:function(u,c,p,m){if(c===a&&(c=0),p===a&&(p=1),de.isStraight(u)){var _=u;p<1&&(_=de.subdivide(_,p)[0],c/=p),c>0&&(_=de.subdivide(_,c)[1]);var y=_[6]-_[0],x=_[7]-_[1];return Math.sqrt(y*y+x*x)}return k.integrate(m||e(u),c,p,i(c,p))},getTimeAt:function(u,c,p){if(p===a&&(p=c<0?1:0),c===0)return p;var m=Math.abs,_=1e-12,y=c>0,x=y?p:0,T=y?1:p,M=e(u),P=de.getLength(u,x,T,M),C=m(c)-P;if(m(C)<_)return y?T:x;if(C>_)return null;var B=c/P,z=0;function V(I){return z+=k.integrate(M,p,I,i(p,I)),p=I,z-c}return k.findRoot(V,M,p+B,x,T,32,1e-12)},getPoint:function(u,c){return r(u,c,0,!1)},getTangent:function(u,c){return r(u,c,1,!0)},getWeightedTangent:function(u,c){return r(u,c,1,!1)},getNormal:function(u,c){return r(u,c,2,!0)},getWeightedNormal:function(u,c){return r(u,c,2,!1)},getCurvature:function(u,c){return r(u,c,3,!1).x},getPeaks:function(u){var c=u[0],p=u[1],m=u[2],_=u[3],y=u[4],x=u[5],T=u[6],M=u[7],P=-c+3*m-3*y+T,C=3*c-6*m+3*y,B=-3*c+3*m,z=-p+3*_-3*x+M,V=3*p-6*_+3*x,I=-3*p+3*_,R=1e-8,b=1-R,N=[];return k.solveCubic(9*(P*P+z*z),9*(P*C+V*z),2*(C*C+V*V)+3*(B*P+I*z),B*C+V*I,N,R,b),N.sort()}}}},new function(){function e(C,B,z,V,I,R,b){var N=!b&&z.getPrevious()===I,U=!b&&z!==I&&z.getNext()===I,H=1e-8,D=1-H;if(V!==null&&V>=(N?H:0)&&V<=(U?D:1)&&R!==null&&R>=(U?H:0)&&R<=(N?D:1)){var G=new Xe(z,V,null,b),K=new Xe(I,R,null,b);G._intersection=K,K._intersection=G,(!B||B(G))&&Xe.insert(C,G,!0)}}function i(C,B,z,V,I,R,b,N,U,H,D,G,K){if(++U>=4096||++N>=40)return U;var X=1e-9,$=B[0],j=B[1],Q=B[6],ee=B[7],re=be.getSignedDistance,se=re($,j,Q,ee,B[2],B[3]),ue=re($,j,Q,ee,B[4],B[5]),xe=se*ue>0?3/4:4/9,ke=xe*Math.min(0,se,ue),Te=xe*Math.max(0,se,ue),ze=re($,j,Q,ee,C[0],C[1]),ge=re($,j,Q,ee,C[2],C[3]),_e=re($,j,Q,ee,C[4],C[5]),Le=re($,j,Q,ee,C[6],C[7]),Re=r(ze,ge,_e,Le),Ne=Re[0],Be=Re[1],Fe,Ge;if(se===0&&ue===0&&ze===0&&ge===0&&_e===0&&Le===0||(Fe=u(Ne,Be,ke,Te))==null||(Ge=u(Ne.reverse(),Be.reverse(),ke,Te))==null)return U;var Ke=H+(D-H)*Fe,Ue=H+(D-H)*Ge;if(Math.max(K-G,Ue-Ke)<X){var vt=(Ke+Ue)/2,gt=(G+K)/2;e(I,R,b?V:z,b?gt:vt,b?z:V,b?vt:gt)}else{C=de.getPart(C,Fe,Ge);var bt=K-G;if(Ge-Fe>.8)if(Ue-Ke>bt){var mt=de.subdivide(C,.5),vt=(Ke+Ue)/2;U=i(B,mt[0],V,z,I,R,!b,N,U,G,K,Ke,vt),U=i(B,mt[1],V,z,I,R,!b,N,U,G,K,vt,Ue)}else{var mt=de.subdivide(B,.5),gt=(G+K)/2;U=i(mt[0],C,V,z,I,R,!b,N,U,G,gt,Ke,Ue),U=i(mt[1],C,V,z,I,R,!b,N,U,gt,K,Ke,Ue)}else bt===0||bt>=X?U=i(B,C,V,z,I,R,!b,N,U,G,K,Ke,Ue):U=i(C,B,z,V,I,R,b,N,U,Ke,Ue,G,K)}return U}function r(C,B,z,V){var I=[0,C],R=[1/3,B],b=[2/3,z],N=[1,V],U=B-(2*C+V)/3,H=z-(C+2*V)/3,D;if(U*H<0)D=[[I,R,N],[I,b,N]];else{var G=U/H;D=[G>=2?[I,R,N]:G<=.5?[I,b,N]:[I,R,b,N],[I,N]]}return(U||H)<0?D.reverse():D}function u(C,B,z,V){return C[0][1]<z?c(C,!0,z):B[0][1]>V?c(B,!1,V):C[0][0]}function c(C,B,z){for(var V=C[0][0],I=C[0][1],R=1,b=C.length;R<b;R++){var N=C[R][0],U=C[R][1];if(B?U>=z:U<=z)return U===z?N:V+(z-I)*(N-V)/(U-I);V=N,I=U}return null}function p(C,B,z,V,I){var R=k.isZero;if(R(V)&&R(I)){var b=de.getTimeOf(C,new L(B,z));return b===null?[]:[b]}for(var N=Math.atan2(-I,V),U=Math.sin(N),H=Math.cos(N),D=[],G=[],K=0;K<8;K+=2){var X=C[K]-B,$=C[K+1]-z;D.push(X*H-$*U,X*U+$*H)}return de.solveCubic(D,1,0,G,0,1),G}function m(C,B,z,V,I,R,b){for(var N=B[0],U=B[1],H=B[6],D=B[7],G=p(C,N,U,H-N,D-U),K=0,X=G.length;K<X;K++){var $=G[K],j=de.getPoint(C,$),Q=de.getTimeOf(B,j);Q!==null&&e(I,R,b?V:z,b?Q:$,b?z:V,b?$:Q)}}function _(C,B,z,V,I,R){var b=be.intersect(C[0],C[1],C[6],C[7],B[0],B[1],B[6],B[7]);b&&e(I,R,z,de.getTimeOf(C,b),V,de.getTimeOf(B,b))}function y(C,B,z,V,I,R){var b=1e-12,N=Math.min,U=Math.max;if(U(C[0],C[2],C[4],C[6])+b>N(B[0],B[2],B[4],B[6])&&N(C[0],C[2],C[4],C[6])-b<U(B[0],B[2],B[4],B[6])&&U(C[1],C[3],C[5],C[7])+b>N(B[1],B[3],B[5],B[7])&&N(C[1],C[3],C[5],C[7])-b<U(B[1],B[3],B[5],B[7])){var H=M(C,B);if(H)for(var D=0;D<2;D++){var G=H[D];e(I,R,z,G[0],V,G[1],!0)}else{var K=de.isStraight(C),X=de.isStraight(B),$=K&&X,j=K&&!X,Q=I.length;if(($?_:K||X?m:i)(j?B:C,j?C:B,j?V:z,j?z:V,I,R,j,0,0,0,1,0,1),!$||I.length===Q)for(var D=0;D<4;D++){var ee=D>>1,re=D&1,se=ee*6,ue=re*6,xe=new L(C[se],C[se+1]),ke=new L(B[ue],B[ue+1]);xe.isClose(ke,b)&&e(I,R,z,ee,V,re)}}}return I}function x(C,B,z,V){var I=de.classify(C);if(I.type==="loop"){var R=I.roots;e(z,V,B,R[0],B,R[1])}return z}function T(C,B,z,V,I,R){var b=1e-7,N=!B;N&&(B=C);for(var U=C.length,H=B.length,D=new Array(U),G=N?D:new Array(H),K=[],X=0;X<U;X++)D[X]=C[X].getValues(V);if(!N)for(var X=0;X<H;X++)G[X]=B[X].getValues(I);for(var $=S.findCurveBoundsCollisions(D,G,b),j=0;j<U;j++){var Q=C[j],ee=D[j];N&&x(ee,Q,K,z);var re=$[j];if(re)for(var se=0;se<re.length;se++){if(R&&K.length)return K;var ue=re[se];if(!N||ue>j){var xe=B[ue],ke=G[ue];y(ee,ke,Q,xe,K,z)}}}return K}function M(C,B){function z(Le){var Re=Le[6]-Le[0],Ne=Le[7]-Le[1];return Re*Re+Ne*Ne}var V=Math.abs,I=be.getDistance,R=1e-8,b=1e-7,N=de.isStraight(C),U=de.isStraight(B),H=N&&U,D=z(C)<z(B),G=D?B:C,K=D?C:B,X=G[0],$=G[1],j=G[6]-X,Q=G[7]-$;if(I(X,$,j,Q,K[0],K[1],!0)<b&&I(X,$,j,Q,K[6],K[7],!0)<b)!H&&I(X,$,j,Q,G[2],G[3],!0)<b&&I(X,$,j,Q,G[4],G[5],!0)<b&&I(X,$,j,Q,K[2],K[3],!0)<b&&I(X,$,j,Q,K[4],K[5],!0)<b&&(N=U=H=!0);else if(H)return null;if(N^U)return null;for(var ee=[C,B],re=[],se=0;se<4&&re.length<2;se++){var ue=se&1,xe=ue^1,ke=se>>1,Te=de.getTimeOf(ee[ue],new L(ee[xe][ke?6:0],ee[xe][ke?7:1]));if(Te!=null){var ze=ue?[ke,Te]:[Te,ke];(!re.length||V(ze[0]-re[0][0])>R&&V(ze[1]-re[0][1])>R)&&re.push(ze)}if(se>2&&!re.length)break}if(re.length!==2)re=null;else if(!H){var ge=de.getPart(C,re[0][0],re[1][0]),_e=de.getPart(B,re[0][1],re[1][1]);(V(_e[2]-ge[2])>b||V(_e[3]-ge[3])>b||V(_e[4]-ge[4])>b||V(_e[5]-ge[5])>b)&&(re=null)}return re}function P(C,B){var z=C[0],V=C[1],I=C[2],R=C[3],b=C[4],N=C[5],U=C[6],H=C[7],D=B.normalize(),G=D.x,K=D.y,X=3*U-9*b+9*I-3*z,$=3*H-9*N+9*R-3*V,j=6*b-12*I+6*z,Q=6*N-12*R+6*V,ee=3*I-3*z,re=3*R-3*V,se=2*X*K-2*$*G,ue=[];if(Math.abs(se)<k.CURVETIME_EPSILON){var xe=X*re-$*ee,se=X*Q-$*j;if(se!=0){var ke=-xe/se;ke>=0&&ke<=1&&ue.push(ke)}}else{var Te=(j*j-4*X*ee)*K*K+(-2*j*Q+4*$*ee+4*X*re)*G*K+(Q*Q-4*$*re)*G*G,ze=j*K-Q*G;if(Te>=0&&se!=0){var ge=Math.sqrt(Te),_e=-(ze+ge)/se,Le=(-ze+ge)/se;_e>=0&&_e<=1&&ue.push(_e),Le>=0&&Le<=1&&ue.push(Le)}}return ue}return{getIntersections:function(C){var B=this.getValues(),z=C&&C!==this&&C.getValues();return z?y(B,z,this,C,[]):x(B,this,[])},statics:{getOverlaps:M,getIntersections:T,getCurveLineIntersections:p,getTimesWithTangent:P}}}),Xe=o.extend({_class:"CurveLocation",initialize:function(i,r,u,c,p){if(r>=.99999999){var m=i.getNext();m&&(r=0,i=m)}this._setCurve(i),this._time=r,this._point=u||i.getPointAtTime(r),this._overlap=c,this._distance=p,this._intersection=this._next=this._previous=null},_setPath:function(e){this._path=e,this._version=e?e._version:0},_setCurve:function(e){this._setPath(e._path),this._curve=e,this._segment=null,this._segment1=e._segment1,this._segment2=e._segment2},_setSegment:function(e){var i=e.getCurve();i?this._setCurve(i):(this._setPath(e._path),this._segment1=e,this._segment2=null),this._segment=e,this._time=e===this._segment1?0:1,this._point=e._point.clone()},getSegment:function(){var e=this._segment;if(!e){var i=this.getCurve(),r=this.getTime();r===0?e=i._segment1:r===1?e=i._segment2:r!=null&&(e=i.getPartLength(0,r)<i.getPartLength(r,1)?i._segment1:i._segment2),this._segment=e}return e},getCurve:function(){var e=this._path,i=this;e&&e._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function r(u){var c=u&&u.getCurve();if(c&&(i._time=c.getTimeOf(i._point))!=null)return i._setCurve(c),c}return this._curve||r(this._segment)||r(this._segment1)||r(this._segment2.getPrevious())},getPath:function(){var e=this.getCurve();return e&&e._path},getIndex:function(){var e=this.getCurve();return e&&e.getIndex()},getTime:function(){var e=this.getCurve(),i=this._time;return e&&i==null?this._time=e.getTimeOf(this._point):i},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var e=this._offset;if(e==null){e=0;var i=this.getPath(),r=this.getIndex();if(i&&r!=null)for(var u=i.getCurves(),c=0;c<r;c++)e+=u[c].getLength();this._offset=e+=this.getCurveOffset()}return e},getCurveOffset:function(){var e=this._curveOffset;if(e==null){var i=this.getCurve(),r=this.getTime();this._curveOffset=e=r!=null&&i&&i.getPartLength(0,r)}return e},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var e=this.getCurve(),i=e&&e.divideAtTime(this.getTime());return i&&this._setSegment(i._segment1),i},split:function(){var e=this.getCurve(),i=e._path,r=e&&e.splitAtTime(this.getTime());return r&&this._setSegment(i.getLastSegment()),r},equals:function(e,i){var r=this===e;if(!r&&e instanceof Xe){var u=this.getCurve(),c=e.getCurve(),p=u._path,m=c._path;if(p===m){var _=Math.abs,y=1e-7,x=_(this.getOffset()-e.getOffset()),T=!i&&this._intersection,M=!i&&e._intersection;r=(x<y||p&&_(p.getLength()-x)<y)&&(!T&&!M||T&&M&&T.equals(M,!0))}}return r},toString:function(){var e=[],i=this.getPoint(),r=E.instance;i&&e.push("point: "+i);var u=this.getIndex();u!=null&&e.push("index: "+u);var c=this.getTime();return c!=null&&e.push("time: "+r.number(c)),this._distance!=null&&e.push("distance: "+r.number(this._distance)),"{ "+e.join(", ")+" }"},isTouching:function(){var e=this._intersection;if(e&&this.getTangent().isCollinear(e.getTangent())){var i=this.getCurve(),r=e.getCurve();return!(i.isStraight()&&r.isStraight()&&i.getLine().intersect(r.getLine()))}return!1},isCrossing:function(){var e=this._intersection;if(!e)return!1;var i=this.getTime(),r=e.getTime(),u=1e-8,c=1-u,p=i>=u&&i<=c,m=r>=u&&r<=c;if(p&&m)return!this.isTouching();var _=this.getCurve(),y=_&&i<u?_.getPrevious():_,x=e.getCurve(),T=x&&r<u?x.getPrevious():x;if(i>c&&(_=_.getNext()),r>c&&(x=x.getNext()),!y||!_||!T||!x)return!1;var M=[];function P(G,K){var X=G.getValues(),$=de.classify(X).roots||de.getPeaks(X),j=$.length,Q=de.getLength(X,K&&j?$[j-1]:0,!K&&j?$[0]:1);M.push(j?Q:Q/32)}function C(G,K,X){return K<X?G>K&&G<X:G>K||G<X}p||(P(y,!0),P(_,!1)),m||(P(T,!0),P(x,!1));var B=this.getPoint(),z=Math.min.apply(Math,M),V=p?_.getTangentAtTime(i):_.getPointAt(z).subtract(B),I=p?V.negate():y.getPointAt(-z).subtract(B),R=m?x.getTangentAtTime(r):x.getPointAt(z).subtract(B),b=m?R.negate():T.getPointAt(-z).subtract(B),N=I.getAngle(),U=V.getAngle(),H=b.getAngle(),D=R.getAngle();return!!(p?C(N,H,D)^C(U,H,D)&&C(N,D,H)^C(U,D,H):C(H,N,U)^C(D,N,U)&&C(H,U,N)^C(D,U,N))},hasOverlap:function(){return!!this._overlap}},o.each(de._evaluateMethods,function(e){var i=e+"At";this[e]=function(){var r=this.getCurve(),u=this.getTime();return u!=null&&r&&r[i](u,!0)}},{preserve:!0}),new function(){function e(i,r,u){var c=i.length,p=0,m=c-1;function _(B,z){for(var V=B+z;V>=-1&&V<=c;V+=z){var I=i[(V%c+c)%c];if(!r.getPoint().isClose(I.getPoint(),1e-7))break;if(r.equals(I))return I}return null}for(;p<=m;){var y=p+m>>>1,x=i[y],T;if(u&&(T=r.equals(x)?x:_(y,-1)||_(y,1)))return r._overlap&&(T._overlap=T._intersection._overlap=!0),T;var M=r.getPath(),P=x.getPath(),C=M!==P?M._id-P._id:r.getIndex()+r.getTime()-(x.getIndex()+x.getTime());C<0?m=y-1:p=y+1}return i.splice(p,0,r),r}return{statics:{insert:e,expand:function(i){for(var r=i.slice(),u=i.length-1;u>=0;u--)e(r,i[u]._intersection,!1);return r}}}}),st=O.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(e){var i,r,u;if(o.isPlainObject(e)?(r=e.segments,i=e.pathData):Array.isArray(e)?r=e:typeof e=="string"&&(i=e),r){var c=r[0];u=c&&Array.isArray(c[0])}else i&&(u=(i.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(i));var p=u?it:Ve;return new p(e)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(e){this.isClockwise()!=(e=!!e)&&this.reverse()},setPathData:function(e){var i=e&&e.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),r,u=!1,c,p,m=new L,_=new L;function y(b,N){var U=+r[b];return u&&(U+=m[N]),U}function x(b){return new L(y(b,"x"),y(b+1,"y"))}this.clear();for(var T=0,M=i&&i.length;T<M;T++){var P=i[T],C=P[0],B=C.toLowerCase();r=P.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var z=r&&r.length;switch(u=C===B,c==="z"&&!/[mz]/.test(B)&&this.moveTo(m),B){case"m":case"l":for(var V=B==="m",I=0;I<z;I+=2)this[V?"moveTo":"lineTo"](m=x(I)),V&&(_=m,V=!1);p=m;break;case"h":case"v":var R=B==="h"?"x":"y";m=m.clone();for(var I=0;I<z;I++)m[R]=y(I,R),this.lineTo(m);p=m;break;case"c":for(var I=0;I<z;I+=6)this.cubicCurveTo(x(I),p=x(I+2),m=x(I+4));break;case"s":for(var I=0;I<z;I+=4)this.cubicCurveTo(/[cs]/.test(c)?m.multiply(2).subtract(p):m,p=x(I),m=x(I+2)),c=B;break;case"q":for(var I=0;I<z;I+=4)this.quadraticCurveTo(p=x(I),m=x(I+2));break;case"t":for(var I=0;I<z;I+=2)this.quadraticCurveTo(p=/[qt]/.test(c)?m.multiply(2).subtract(p):m,m=x(I)),c=B;break;case"a":for(var I=0;I<z;I+=7)this.arcTo(m=x(I+5),new Z(+r[I],+r[I+1]),+r[I+2],+r[I+4],+r[I+3]);break;case"z":this.closePath(1e-12),m=_;break}c=B}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(e){var i=e.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(e):{};return i.onPath||!!(this.getFillRule()==="evenodd"?i.windingL&1||i.windingR&1:i.winding)},getIntersections:function(e,i,r,u){var c=this===e||!e,p=this._matrix._orNullIfIdentity(),m=c?p:(r||e._matrix)._orNullIfIdentity();return c||this.getBounds(p).intersects(e.getBounds(m),1e-12)?de.getIntersections(this.getCurves(),!c&&e.getCurves(),i,p,m,u):[]},getCrossings:function(e){return this.getIntersections(e,function(i){return i.isCrossing()})},getNearestLocation:function(){for(var e=L.read(arguments),i=this.getCurves(),r=1/0,u=null,c=0,p=i.length;c<p;c++){var m=i[c].getNearestLocation(e);m._distance<r&&(r=m._distance,u=m)}return u},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e&&e.getPoint()},interpolate:function(e,i,r){var u=!this._children,c=u?"_segments":"_children",p=e[c],m=i[c],_=this[c];if(!p||!m||p.length!==m.length)throw new Error("Invalid operands in interpolate() call: "+e+", "+i);var y=_.length,x=m.length;if(y<x)for(var T=u?Se:Ve,M=y;M<x;M++)this.add(new T);else y>x&&this[u?"removeSegments":"removeChildren"](x,y);for(var M=0;M<x;M++)_[M].interpolate(p[M],m[M],r);u&&(this.setClosed(e._closed),this._changed(9))},compare:function(e){var i=!1;if(e){var r=this._children||[this],u=e._children?e._children.slice():[e],c=r.length,p=u.length,m=[],_=0;i=!0;for(var y=S.findItemBoundsCollisions(r,u,k.GEOMETRIC_EPSILON),x=c-1;x>=0&&i;x--){var T=r[x];i=!1;var M=y[x];if(M)for(var P=M.length-1;P>=0&&!i;P--)T.compare(u[M[P]])&&(m[M[P]]||(m[M[P]]=!0,_++),i=!0)}i=i&&_===p}return i}}),Ve=st.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(i){this._closed=!1,this._segments=[],this._version=0;var r=arguments,u=Array.isArray(i)?typeof i[0]=="object"?i:r:i&&i.size===a&&(i.x!==a||i.point!==a)?r:null;u&&u.length>0?this.setSegments(u):(this._curves=a,this._segmentSelection=0,!u&&typeof i=="string"&&(this.setPathData(i),i=null)),this._initialize(!u&&i)},_equals:function(e){return this._closed===e._closed&&o.equals(this._segments,e._segments)},copyContent:function(e){this.setSegments(e._segments),this._closed=e._closed},_changed:function e(i){if(e.base.call(this,i),i&8){if(this._length=this._area=a,i&32)this._version++;else if(this._curves)for(var r=0,u=this._curves.length;r<u;r++)this._curves[r]._changed()}else i&64&&(this._bounds=a)},getStyle:function(){var e=this._parent;return(e instanceof it?e:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var i=this.isFullySelected(),r=e&&e.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=a,r){var u=e[r-1];typeof u=="boolean"&&(this.setClosed(u),r--),this._add(Se.readList(e,0,{},r))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var e=this._curves,i=this._segments;if(!e){var r=this._countCurves();e=this._curves=new Array(r);for(var u=0;u<r;u++)e[u]=new de(this,i[u],i[u+1]||i[0])}return e},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var e=this.getCurves();return e[e.length-1]},isClosed:function(){return this._closed},setClosed:function(e){if(this._closed!=(e=!!e)){if(this._closed=e,this._curves){var i=this._curves.length=this._countCurves();e&&(this._curves[i-1]=new de(this,this._segments[i-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(e,i){var r=this._segments,u=r.length,c=new E(i),p=new Array(6),m=!0,_,y,x,T,M,P,C,B,z=[];function V(R,b){if(R._transformCoordinates(e,p),_=p[0],y=p[1],m)z.push("M"+c.pair(_,y)),m=!1;else if(M=p[2],P=p[3],M===_&&P===y&&C===x&&B===T){if(!b){var N=_-x,U=y-T;z.push(N===0?"v"+c.number(U):U===0?"h"+c.number(N):"l"+c.pair(N,U))}}else z.push("c"+c.pair(C-x,B-T)+" "+c.pair(M-x,P-T)+" "+c.pair(_-x,y-T));x=_,T=y,C=p[4],B=p[5]}if(!u)return"";for(var I=0;I<u;I++)V(r[I]);return this._closed&&u>0&&(V(r[0],!0),z.push("z")),z.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(e){for(var i=this._segments,r=new Array(6),u=0,c=i.length;u<c;u++)i[u]._transformCoordinates(e,r,!0);return!0},_add:function(e,m){for(var r=this._segments,u=this._curves,c=e.length,p=m==null,m=p?r.length:m,_=0;_<c;_++){var y=e[_];y._path&&(y=e[_]=y.clone()),y._path=this,y._index=m+_,y._selection&&this._updateSelection(y,0,y._selection)}if(p)o.push(r,e);else{r.splice.apply(r,[m,0].concat(e));for(var _=m+c,x=r.length;_<x;_++)r[_]._index=_}if(u){var T=this._countCurves(),M=m>0&&m+c-1===T?m-1:m,P=M,C=Math.min(M+c,T);e._curves&&(u.splice.apply(u,[M,0].concat(e._curves)),P+=e._curves.length);for(var _=P;_<C;_++)u.splice(_,0,new de(this,null,null));this._adjustCurves(M,C)}return this._changed(41),e},_adjustCurves:function(e,i){for(var r=this._segments,u=this._curves,c,p=e;p<i;p++)c=u[p],c._path=this,c._segment1=r[p],c._segment2=r[p+1]||r[0],c._changed();(c=u[this._closed&&!e?r.length-1:e-1])&&(c._segment2=r[e]||r[0],c._changed()),(c=u[i])&&(c._segment1=r[i],c._changed())},_countCurves:function(){var e=this._segments.length;return!this._closed&&e>0?e-1:e},add:function(e){var i=arguments;return i.length>1&&typeof e!="number"?this._add(Se.readList(i)):this._add([Se.read(i)])[0]},insert:function(e,i){var r=arguments;return r.length>2&&typeof i!="number"?this._add(Se.readList(r,1),e):this._add([Se.read(r,1)],e)[0]},addSegment:function(){return this._add([Se.read(arguments)])[0]},insertSegment:function(e){return this._add([Se.read(arguments,1)],e)[0]},addSegments:function(e){return this._add(Se.readList(e))},insertSegments:function(e,i){return this._add(Se.readList(i),e)},removeSegment:function(e){return this.removeSegments(e,e+1)[0]||null},removeSegments:function(e,i,r){e=e||0,i=o.pick(i,this._segments.length);var u=this._segments,c=this._curves,p=u.length,m=u.splice(e,i-e),_=m.length;if(!_)return m;for(var y=0;y<_;y++){var x=m[y];x._selection&&this._updateSelection(x,x._selection,0),x._index=x._path=null}for(var y=e,T=u.length;y<T;y++)u[y]._index=y;if(c){for(var M=e>0&&i===p+(this._closed?1:0)?e-1:e,c=c.splice(M,_),y=c.length-1;y>=0;y--)c[y]._path=null;r&&(m._curves=c.slice(1)),this._adjustCurves(M,M)}return this._changed(41),m},clear:"#removeSegments",hasHandles:function(){for(var e=this._segments,i=0,r=e.length;i<r;i++)if(e[i].hasHandles())return!0;return!1},clearHandles:function(){for(var e=this._segments,i=0,r=e.length;i<r;i++)e[i].clearHandles()},getLength:function(){if(this._length==null){for(var e=this.getCurves(),i=0,r=0,u=e.length;r<u;r++)i+=e[r].getLength();this._length=i}return this._length},getArea:function(){var e=this._area;if(e==null){var i=this._segments,r=this._closed;e=0;for(var u=0,c=i.length;u<c;u++){var p=u+1===c;e+=de.getArea(de.getValues(i[u],i[p?0:u+1],null,p&&!r))}this._area=e}return e},isFullySelected:function(){var e=this._segments.length;return this.isSelected()&&e>0&&this._segmentSelection===e*7},setFullySelected:function(e){e&&this._selectSegments(!0),this.setSelected(e)},setSelection:function e(i){i&1||this._selectSegments(!1),e.base.call(this,i)},_selectSegments:function(e){var i=this._segments,r=i.length,u=e?7:0;this._segmentSelection=u*r;for(var c=0;c<r;c++)i[c]._selection=u},_updateSelection:function(e,i,r){e._selection=r;var u=this._segmentSelection+=r-i;u>0&&this.setSelected(!0)},divideAt:function(e){var i=this.getLocationAt(e),r;return i&&(r=i.getCurve().divideAt(i.getCurveOffset()))?r._segment1:null},splitAt:function(e){var i=this.getLocationAt(e),r=i&&i.index,u=i&&i.time,c=1e-8,p=1-c;u>p&&(r++,u=0);var m=this.getCurves();if(r>=0&&r<m.length){u>=c&&m[r++].divideAtTime(u);var _=this.removeSegments(r,this._segments.length,!0),y;return this._closed?(this.setClosed(!1),y=this):(y=new Ve(O.NO_INSERT),y.insertAbove(this),y.copyAttributes(this)),y._add(_,0),this.addSegment(_[0]),y}return null},split:function(e,i){var r,u=i===a?e:(r=this.getCurves()[e])&&r.getLocationAtTime(i);return u!=null?this.splitAt(u):null},join:function(e,i){var r=i||0;if(e&&e!==this){var u=e._segments,c=this.getLastSegment(),p=e.getLastSegment();if(!p)return this;c&&c._point.isClose(p._point,r)&&e.reverse();var m=e.getFirstSegment();if(c&&c._point.isClose(m._point,r))c.setHandleOut(m._handleOut),this._add(u.slice(1));else{var _=this.getFirstSegment();_&&_._point.isClose(m._point,r)&&e.reverse(),p=e.getLastSegment(),_&&_._point.isClose(p._point,r)?(_.setHandleIn(p._handleIn),this._add(u.slice(0,u.length-1),0)):this._add(u.slice())}e._closed&&this._add([u[0]]),e.remove()}var y=this.getFirstSegment(),x=this.getLastSegment();return y!==x&&y._point.isClose(x._point,r)&&(y.setHandleIn(x._handleIn),x.remove(),this.setClosed(!0)),this},reduce:function(e){for(var i=this.getCurves(),r=e&&e.simplify,u=r?1e-7:0,c=i.length-1;c>=0;c--){var p=i[c];!p.hasHandles()&&(!p.hasLength(u)||r&&p.isCollinear(p.getNext()))&&p.remove()}return this},reverse:function(){this._segments.reverse();for(var e=0,i=this._segments.length;e<i;e++){var r=this._segments[e],u=r._handleIn;r._handleIn=r._handleOut,r._handleOut=u,r._index=e}this._curves=null,this._changed(9)},flatten:function(e){for(var i=new Kt(this,e||.25,256,!0),r=i.parts,u=r.length,c=[],p=0;p<u;p++)c.push(new Se(r[p].curve.slice(0,2)));!this._closed&&u>0&&c.push(new Se(r[u-1].curve.slice(6))),this.setSegments(c)},simplify:function(e){var i=new Bt(this).fit(e||2.5);return i&&this.setSegments(i),!!i},smooth:function(e){var i=this,r=e||{},u=r.type||"asymmetric",c=this._segments,p=c.length,m=this._closed;function _(Ne,Be){var Fe=Ne&&Ne.index;if(Fe!=null){var Ge=Ne.path;if(Ge&&Ge!==i)throw new Error(Ne._class+" "+Fe+" of "+Ge+" is not part of "+i);Be&&Ne instanceof de&&Fe++}else Fe=typeof Ne=="number"?Ne:Be;return Math.min(Fe<0&&m?Fe%p:Fe<0?Fe+p:Fe,p-1)}var y=m&&r.from===a&&r.to===a,x=_(r.from,0),T=_(r.to,p-1);if(x>T)if(m)x-=p;else{var M=x;x=T,T=M}if(/^(?:asymmetric|continuous)$/.test(u)){var P=u==="asymmetric",C=Math.min,B=T-x+1,z=B-1,V=y?C(B,4):1,I=V,R=V,b=[];if(m||(I=C(1,x),R=C(1,p-T-1)),z+=I+R,z<=1)return;for(var N=0,U=x-I;N<=z;N++,U++)b[N]=c[(U<0?U+p:U)%p]._point;for(var H=b[0]._x+2*b[1]._x,D=b[0]._y+2*b[1]._y,G=2,K=z-1,X=[H],$=[D],j=[G],Q=[],ee=[],N=1;N<z;N++){var re=N<K,se=re||P?1:2,ue=re?4:P?2:7,xe=re?4:P?3:8,ke=re?2:P?0:1,Te=se/G;G=j[N]=ue-Te,H=X[N]=xe*b[N]._x+ke*b[N+1]._x-Te*H,D=$[N]=xe*b[N]._y+ke*b[N+1]._y-Te*D}Q[K]=X[K]/j[K],ee[K]=$[K]/j[K];for(var N=z-2;N>=0;N--)Q[N]=(X[N]-Q[N+1])/j[N],ee[N]=($[N]-ee[N+1])/j[N];Q[z]=(3*b[z]._x-Q[K])/2,ee[z]=(3*b[z]._y-ee[K])/2;for(var N=I,ze=z-R,U=x;N<=ze;N++,U++){var ge=c[U<0?U+p:U],_e=ge._point,Le=Q[N]-_e._x,Re=ee[N]-_e._y;(y||N<ze)&&ge.setHandleOut(Le,Re),(y||N>I)&&ge.setHandleIn(-Le,-Re)}}else for(var N=x;N<=T;N++)c[N<0?N+p:N].smooth(r,!y&&N===x,!y&&N===T)},toShape:function(e){if(!this._closed)return null;var i=this._segments,r,u,c,p;function m(P,C){var B=i[P],z=B.getNext(),V=i[C],I=V.getNext();return B._handleOut.isZero()&&z._handleIn.isZero()&&V._handleOut.isZero()&&I._handleIn.isZero()&&z._point.subtract(B._point).isCollinear(I._point.subtract(V._point))}function _(P){var C=i[P],B=C.getPrevious(),z=C.getNext();return B._handleOut.isZero()&&C._handleIn.isZero()&&C._handleOut.isZero()&&z._handleIn.isZero()&&C._point.subtract(B._point).isOrthogonal(z._point.subtract(C._point))}function y(P){var C=i[P],B=C.getNext(),z=C._handleOut,V=B._handleIn,I=.5522847498307936;if(z.isOrthogonal(V)){var R=C._point,b=B._point,N=new be(R,z,!0).intersect(new be(b,V,!0),!0);return N&&k.isZero(z.getLength()/N.subtract(R).getLength()-I)&&k.isZero(V.getLength()/N.subtract(b).getLength()-I)}return!1}function x(P,C){return i[P]._point.getDistance(i[C]._point)}if(!this.hasHandles()&&i.length===4&&m(0,2)&&m(1,3)&&_(1)?(r=me.Rectangle,u=new Z(x(0,3),x(0,1)),p=i[1]._point.add(i[2]._point).divide(2)):i.length===8&&y(0)&&y(2)&&y(4)&&y(6)&&m(1,5)&&m(3,7)?(r=me.Rectangle,u=new Z(x(1,6),x(0,3)),c=u.subtract(new Z(x(0,7),x(1,2))).divide(2),p=i[3]._point.add(i[4]._point).divide(2)):i.length===4&&y(0)&&y(1)&&y(2)&&y(3)&&(k.isZero(x(0,2)-x(1,3))?(r=me.Circle,c=x(0,2)/2):(r=me.Ellipse,c=new Z(x(2,0)/2,x(3,1)/2)),p=i[1]._point),r){var T=this.getPosition(!0),M=new r({center:T,size:u,radius:c,insert:!1});return M.copyAttributes(this,!0),M._matrix.prepend(this._matrix),M.rotate(p.subtract(T).getAngle()+90),(e===a||e)&&M.insertAbove(this),M}return null},toPath:"#clone",compare:function e(i){if(!i||i instanceof it)return e.base.call(this,i);var r=this.getCurves(),u=i.getCurves(),c=r.length,p=u.length;if(!c||!p)return c==p;for(var m=r[0].getValues(),_=[],y=0,x,T=0,M,P=0;P<p;P++){var V=u[P].getValues();_.push(V);var C=de.getOverlaps(m,V);if(C){x=!P&&C[0][0]>0?p-1:P,M=C[0][1];break}}for(var B=Math.abs,z=1e-8,V=_[x],I;m&&V;){var C=de.getOverlaps(m,V);if(C){var R=C[0][0];if(B(R-T)<z){T=C[1][0],T===1&&(m=++y<c?r[y].getValues():null,T=0);var b=C[0][1];if(B(b-M)<z){if(I||(I=[x,b]),M=C[1][1],M===1&&(++x>=p&&(x=0),V=_[x]||u[x].getValues(),M=0),!m)return I[0]===x&&I[1]===M;continue}}}break}return!1},_hitTestSelf:function(e,i,r,u){var c=this,p=this.getStyle(),m=this._segments,_=m.length,y=this._closed,x=i._tolerancePadding,T=x,M,P,C,B,z,V,I=i.stroke&&p.hasStroke(),R=i.fill&&p.hasFill(),b=i.curves,N=I?p.getStrokeWidth()/2:R&&i.tolerance>0||b?0:null;N!==null&&(N>0?(M=p.getStrokeJoin(),P=p.getStrokeCap(),C=p.getMiterLimit(),T=T.add(Ve._getStrokePadding(N,u))):M=P="round");function U(Q,ee){return e.subtract(Q).divide(ee).length<=1}function H(Q,ee,re){if(!i.selected||ee.isSelected()){var se=Q._point;if(ee!==se&&(ee=ee.add(se)),U(ee,T))return new De(re,c,{segment:Q,point:ee})}}function D(Q,ee){return(ee||i.segments)&&H(Q,Q._point,"segment")||!ee&&i.handles&&(H(Q,Q._handleIn,"handle-in")||H(Q,Q._handleOut,"handle-out"))}function G(Q){B.add(Q)}function K(Q){var ee=y||Q._index>0&&Q._index<_-1;if((ee?M:P)==="round")return U(Q._point,T);if(B=new Ve({internal:!0,closed:!0}),ee?Q.isSmooth()||Ve._addBevelJoin(Q,M,N,C,null,u,G,!0):P==="square"&&Ve._addSquareCap(Q,P,N,null,u,G,!0),!B.isEmpty()){var re;return B.contains(e)||(re=B.getNearestLocation(e))&&U(re.getPoint(),x)}}if(i.ends&&!i.segments&&!y){if(V=D(m[0],!0)||D(m[_-1],!0))return V}else if(i.segments||i.handles){for(var X=0;X<_;X++)if(V=D(m[X]))return V}if(N!==null){if(z=this.getNearestLocation(e),z){var $=z.getTime();$===0||$===1&&_>1?K(z.getSegment())||(z=null):U(z.getPoint(),T)||(z=null)}if(!z&&M==="miter"&&_>1)for(var X=0;X<_;X++){var j=m[X];if(e.getDistance(j._point)<=C*N&&K(j)){z=j.getLocation();break}}}return!z&&R&&this._contains(e)||z&&!I&&!b?new De("fill",this):z?new De(I?"stroke":"curve",this,{location:z,point:z.getPoint()}):null}},o.each(de._evaluateMethods,function(e){this[e+"At"]=function(i){var r=this.getLocationAt(i);return r&&r[e]()}},{beans:!1,getLocationOf:function(){for(var e=L.read(arguments),i=this.getCurves(),r=0,u=i.length;r<u;r++){var c=i[r].getLocationOf(e);if(c)return c}return null},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getLocationAt:function(e){if(typeof e=="number"){for(var i=this.getCurves(),r=0,u=0,c=i.length;u<c;u++){var p=r,m=i[u];if(r+=m.getLength(),r>e)return m.getLocationAt(e-p)}if(i.length>0&&e<=this.getLength())return new Xe(i[i.length-1],1)}else if(e&&e.getPath&&e.getPath()===this)return e;return null},getOffsetsWithTangent:function(){var e=L.read(arguments);if(e.isZero())return[];for(var i=[],r=0,u=this.getCurves(),c=0,p=u.length;c<p;c++){for(var m=u[c],_=m.getTimesWithTangent(e),y=0,x=_.length;y<x;y++){var T=r+m.getOffsetAtTime(_[y]);i.indexOf(T)<0&&i.push(T)}r+=m.length}return i}}),new function(){function e(r,u,c,p){if(p<=0)return;var m=p/2,_=p-2,y=m-1,x=new Array(6),T,M;function P(R){var b=x[R],N=x[R+1];(T!=b||M!=N)&&(r.beginPath(),r.moveTo(T,M),r.lineTo(b,N),r.stroke(),r.beginPath(),r.arc(b,N,m,0,Math.PI*2,!0),r.fill())}for(var C=0,B=u.length;C<B;C++){var z=u[C],V=z._selection;if(z._transformCoordinates(c,x),T=x[0],M=x[1],V&2&&P(2),V&4&&P(4),r.fillRect(T-m,M-m,p,p),_>0&&!(V&1)){var I=r.fillStyle;r.fillStyle="#ffffff",r.fillRect(T-y,M-y,_,_),r.fillStyle=I}}}function i(r,u,c){var p=u._segments,m=p.length,_=new Array(6),y=!0,x,T,M,P,C,B,z,V;function I(b){if(c)b._transformCoordinates(c,_),x=_[0],T=_[1];else{var N=b._point;x=N._x,T=N._y}if(y)r.moveTo(x,T),y=!1;else{if(c)C=_[2],B=_[3];else{var U=b._handleIn;C=x+U._x,B=T+U._y}C===x&&B===T&&z===M&&V===P?r.lineTo(x,T):r.bezierCurveTo(z,V,C,B,x,T)}if(M=x,P=T,c)z=_[4],V=_[5];else{var U=b._handleOut;z=M+U._x,V=P+U._y}}for(var R=0;R<m;R++)I(p[R]);u._closed&&m>0&&I(p[0])}return{_draw:function(r,u,c,p){var m=u.dontStart,_=u.dontFinish||u.clip,y=this.getStyle(),x=y.hasFill(),T=y.hasStroke(),M=y.getDashArray(),P=!Ye.support.nativeDash&&T&&M&&M.length;m||r.beginPath(),(x||T&&!P||_)&&(i(r,this,p),this._closed&&r.closePath());function C(b){return M[(b%P+P)%P]}if(!_&&(x||T)&&(this._setStyles(r,u,c),x&&(r.fill(y.getFillRule()),r.shadowColor="rgba(0,0,0,0)"),T)){if(P){m||r.beginPath();for(var B=new Kt(this,.25,32,!1,p),z=B.length,V=-y.getDashOffset(),I,R=0;V>0;)V-=C(R--)+C(R--);for(;V<z;)I=V+C(R++),(V>0||I>0)&&B.drawPart(r,Math.max(V,0),Math.max(I,0)),V=I+C(R++)}r.stroke()}},_drawSelected:function(r,u){r.beginPath(),i(r,this,u),r.stroke(),e(r,this._segments,u,Ye.settings.handleSize)}}},new function(){function e(i){var r=i._segments;if(!r.length)throw new Error("Use a moveTo() command first");return r[r.length-1]}return{moveTo:function(){var i=this._segments;i.length===1&&this.removeSegment(0),i.length||this._add([new Se(L.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Se(L.read(arguments))])},cubicCurveTo:function(){var i=arguments,r=L.read(i),u=L.read(i),c=L.read(i),p=e(this);p.setHandleOut(r.subtract(p._point)),this._add([new Se(c,u.subtract(c))])},quadraticCurveTo:function(){var i=arguments,r=L.read(i),u=L.read(i),c=e(this)._point;this.cubicCurveTo(r.add(c.subtract(r).multiply(1/3)),r.add(u.subtract(r).multiply(1/3)),u)},curveTo:function(){var i=arguments,r=L.read(i),u=L.read(i),c=o.pick(o.read(i),.5),p=1-c,m=e(this)._point,_=r.subtract(m.multiply(p*p)).subtract(u.multiply(c*c)).divide(2*c*p);if(_.isNaN())throw new Error("Cannot put a curve through points with parameter = "+c);this.quadraticCurveTo(_,u)},arcTo:function(){var i=arguments,r=Math.abs,u=Math.sqrt,c=e(this),p=c._point,m=L.read(i),_,y=o.peek(i),x=o.pick(y,!0),T,M,P,C;if(typeof x=="boolean")var B=p.add(m).divide(2),_=B.add(B.subtract(p).rotate(x?-90:90));else if(o.remain(i)<=2)_=m,m=L.read(i);else if(!p.equals(m)){var z=Z.read(i),V=k.isZero;if(V(z.width)||V(z.height))return this.lineTo(m);var I=o.read(i),x=!!o.read(i),R=!!o.read(i),B=p.add(m).divide(2),b=p.subtract(B).rotate(-I),N=b.x,U=b.y,H=r(z.width),D=r(z.height),G=H*H,K=D*D,X=N*N,$=U*U,j=u(X/G+$/K);if(j>1&&(H*=j,D*=j,G=H*H,K=D*D),j=(G*K-G*$-K*X)/(G*$+K*X),r(j)<1e-12&&(j=0),j<0)throw new Error("Cannot create an arc with the given arguments");T=new L(H*U/D,-D*N/H).multiply((R===x?-1:1)*u(j)).rotate(I).add(B),C=new ce().translate(T).rotate(I).scale(H,D),P=C._inverseTransform(p),M=P.getDirectedAngle(C._inverseTransform(m)),!x&&M>0?M-=360:x&&M<0&&(M+=360)}if(_){var Q=new be(p.add(_).divide(2),_.subtract(p).rotate(90),!0),ee=new be(_.add(m).divide(2),m.subtract(_).rotate(90),!0),re=new be(p,m),se=re.getSide(_);if(T=Q.intersect(ee,!0),!T){if(!se)return this.lineTo(m);throw new Error("Cannot create an arc with the given arguments")}P=p.subtract(T),M=P.getDirectedAngle(m.subtract(T));var ue=re.getSide(T,!0);ue===0?M=se*r(M):se===ue&&(M+=M<0?360:-360)}if(M){for(var xe=1e-5,ke=r(M),Te=ke>=360?4:Math.ceil((ke-xe)/90),ze=M/Te,ge=ze*Math.PI/360,_e=4/3*Math.sin(ge)/(1+Math.cos(ge)),Le=[],Re=0;Re<=Te;Re++){var b=m,Ne=null;if(Re<Te&&(Ne=P.rotate(90).multiply(_e),C?(b=C._transformPoint(P),Ne=C._transformPoint(P.add(Ne)).subtract(b)):b=T.add(P)),!Re)c.setHandleOut(Ne);else{var Be=P.rotate(-90).multiply(_e);C&&(Be=C._transformPoint(P.add(Be)).subtract(b)),Le.push(new Se(b,Be,Ne))}P=P.rotate(ze)}this._add(Le)}},lineBy:function(){var i=L.read(arguments),r=e(this)._point;this.lineTo(r.add(i))},curveBy:function(){var i=arguments,r=L.read(i),u=L.read(i),c=o.read(i),p=e(this)._point;this.curveTo(p.add(r),p.add(u),c)},cubicCurveBy:function(){var i=arguments,r=L.read(i),u=L.read(i),c=L.read(i),p=e(this)._point;this.cubicCurveTo(p.add(r),p.add(u),p.add(c))},quadraticCurveBy:function(){var i=arguments,r=L.read(i),u=L.read(i),c=e(this)._point;this.quadraticCurveTo(c.add(r),c.add(u))},arcBy:function(){var i=arguments,r=e(this)._point,u=r.add(L.read(i)),c=o.pick(o.peek(i),!0);typeof c=="boolean"?this.arcTo(u,c):this.arcTo(u,r.add(L.read(i)))},closePath:function(i){this.setClosed(!0),this.join(this,i)}}},{_getBounds:function(e,i){var r=i.handle?"getHandleBounds":i.stroke?"getStrokeBounds":"getBounds";return Ve[r](this._segments,this._closed,this,e,i)},statics:{getBounds:function(e,i,r,u,c,p){var m=e[0];if(!m)return new J;var _=new Array(6),y=m._transformCoordinates(u,new Array(6)),x=y.slice(0,2),T=x.slice(),M=new Array(2);function P(z){z._transformCoordinates(u,_);for(var V=0;V<2;V++)de._addBounds(y[V],y[V+4],_[V+2],_[V],V,p?p[V]:0,x,T,M);var I=y;y=_,_=I}for(var C=1,B=e.length;C<B;C++)P(e[C]);return i&&P(m),new J(x[0],x[1],T[0]-x[0],T[1]-x[1])},getStrokeBounds:function(e,i,r,u,c){var p=r.getStyle(),m=p.hasStroke(),_=p.getStrokeWidth(),y=m&&r._getStrokeMatrix(u,c),x=m&&Ve._getStrokePadding(_,y),T=Ve.getBounds(e,i,r,u,c,x);if(!m)return T;var M=_/2,P=p.getStrokeJoin(),C=p.getStrokeCap(),B=p.getMiterLimit(),z=new J(new Z(x));function V(H){T=T.include(H)}function I(H){T=T.unite(z.setCenter(H._point.transform(u)))}function R(H,D){D==="round"||H.isSmooth()?I(H):Ve._addBevelJoin(H,D,M,B,u,y,V)}function b(H,D){D==="round"?I(H):Ve._addSquareCap(H,D,M,u,y,V)}var N=e.length-(i?0:1);if(N>0){for(var U=1;U<N;U++)R(e[U],P);i?R(e[0],P):(b(e[0],C),b(e[e.length-1],C))}return T},_getStrokePadding:function(e,i){if(!i)return[e,e];var r=new L(e,0).transform(i),u=new L(0,e).transform(i),c=r.getAngleInRadians(),p=r.getLength(),m=u.getLength(),_=Math.sin(c),y=Math.cos(c),x=Math.tan(c),T=Math.atan2(m*x,p),M=Math.atan2(m,x*p);return[Math.abs(p*Math.cos(T)*y+m*Math.sin(T)*_),Math.abs(m*Math.sin(M)*y+p*Math.cos(M)*_)]},_addBevelJoin:function(e,i,r,u,c,p,m,_){var y=e.getCurve(),x=y.getPrevious(),T=y.getPoint1().transform(c),M=x.getNormalAtTime(1).multiply(r).transform(p),P=y.getNormalAtTime(0).multiply(r).transform(p),C=M.getDirectedAngle(P);if((C<0||C>=180)&&(M=M.negate(),P=P.negate()),_&&m(T),m(T.add(M)),i==="miter"){var B=new be(T.add(M),new L(-M.y,M.x),!0).intersect(new be(T.add(P),new L(-P.y,P.x),!0),!0);B&&T.getDistance(B)<=u*r&&m(B)}m(T.add(P))},_addSquareCap:function(e,i,r,u,c,p,m){var _=e._point.transform(u),y=e.getLocation(),x=y.getNormal().multiply(y.getTime()===0?r:-r).transform(c);i==="square"&&(m&&(p(_.subtract(x)),p(_.add(x))),_=_.add(x.rotate(-90))),p(_.add(x)),p(_.subtract(x))},getHandleBounds:function(e,i,r,u,c){var p=r.getStyle(),m=c.stroke&&p.hasStroke(),_,y;if(m){var x=r._getStrokeMatrix(u,c),T=p.getStrokeWidth()/2,M=T;p.getStrokeJoin()==="miter"&&(M=T*p.getMiterLimit()),p.getStrokeCap()==="square"&&(M=Math.max(M,T*Math.SQRT2)),_=Ve._getStrokePadding(T,x),y=Ve._getStrokePadding(M,x)}for(var P=new Array(6),C=1/0,B=-C,z=C,V=B,I=0,R=e.length;I<R;I++){var b=e[I];b._transformCoordinates(u,P);for(var N=0;N<6;N+=2){var U=N?_:y,H=U?U[0]:0,D=U?U[1]:0,G=P[N],K=P[N+1],X=G-H,$=G+H,j=K-D,Q=K+D;X<C&&(C=X),$>B&&(B=$),j<z&&(z=j),Q>V&&(V=Q)}}return new J(C,z,B-C,V-z)}}});Ve.inject({statics:new function(){var e=.5522847498307936,i=[new Se([-1,0],[0,e],[0,-e]),new Se([0,-1],[-e,0],[e,0]),new Se([1,0],[0,-e],[0,e]),new Se([0,1],[e,0],[-e,0])];function r(c,p,m){var _=o.getNamed(m),y=new Ve(_&&(_.insert==!0?O.INSERT:_.insert==!1?O.NO_INSERT:null));return y._add(c),y._closed=p,y.set(_,O.INSERT)}function u(c,p,m){for(var _=new Array(4),y=0;y<4;y++){var x=i[y];_[y]=new Se(x._point.multiply(p).add(c),x._handleIn.multiply(p),x._handleOut.multiply(p))}return r(_,!0,m)}return{Line:function(){var c=arguments;return r([new Se(L.readNamed(c,"from")),new Se(L.readNamed(c,"to"))],!1,c)},Circle:function(){var c=arguments,p=L.readNamed(c,"center"),m=o.readNamed(c,"radius");return u(p,new Z(m),c)},Rectangle:function(){var c=arguments,p=J.readNamed(c,"rectangle"),m=Z.readNamed(c,"radius",0,{readNull:!0}),_=p.getBottomLeft(!0),y=p.getTopLeft(!0),x=p.getTopRight(!0),T=p.getBottomRight(!0),M;if(!m||m.isZero())M=[new Se(_),new Se(y),new Se(x),new Se(T)];else{m=Z.min(m,p.getSize(!0).divide(2));var P=m.width,C=m.height,B=P*e,z=C*e;M=[new Se(_.add(P,0),null,[-B,0]),new Se(_.subtract(0,C),[0,z]),new Se(y.add(0,C),null,[0,-z]),new Se(y.add(P,0),[-B,0],null),new Se(x.subtract(P,0),null,[B,0]),new Se(x.add(0,C),[0,-z],null),new Se(T.subtract(0,C),null,[0,z]),new Se(T.subtract(P,0),[B,0])]}return r(M,!0,c)},RoundRectangle:"#Rectangle",Ellipse:function(){var c=arguments,p=me._readEllipse(c);return u(p.center,p.radius,c)},Oval:"#Ellipse",Arc:function(){var c=arguments,p=L.readNamed(c,"from"),m=L.readNamed(c,"through"),_=L.readNamed(c,"to"),y=o.getNamed(c),x=new Ve(y&&y.insert==!1&&O.NO_INSERT);return x.moveTo(p),x.arcTo(m,_),x.set(y)},RegularPolygon:function(){for(var c=arguments,p=L.readNamed(c,"center"),m=o.readNamed(c,"sides"),_=o.readNamed(c,"radius"),y=360/m,x=m%3===0,T=new L(0,x?-_:_),M=x?-1:.5,P=new Array(m),C=0;C<m;C++)P[C]=new Se(p.add(T.rotate((C+M)*y)));return r(P,!0,c)},Star:function(){for(var c=arguments,p=L.readNamed(c,"center"),m=o.readNamed(c,"points")*2,_=o.readNamed(c,"radius1"),y=o.readNamed(c,"radius2"),x=360/m,T=new L(0,-1),M=new Array(m),P=0;P<m;P++)M[P]=new Se(p.add(T.rotate(x*P).multiply(P%2?y:_)));return r(M,!0,c)}}}});var it=st.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(i){this._children=[],this._namedChildren={},this._initialize(i)||(typeof i=="string"?this.setPathData(i):this.addChildren(Array.isArray(i)?i:arguments))},insertChildren:function e(i,r){var u=r,c=u[0];c&&typeof c[0]=="number"&&(u=[u]);for(var p=r.length-1;p>=0;p--){var m=u[p];u===r&&!(m instanceof Ve)&&(u=o.slice(u)),Array.isArray(m)?u[p]=new Ve({segments:m,insert:!1}):m instanceof it&&(u.splice.apply(u,[p,1].concat(m.removeChildren())),m.remove())}return e.base.call(this,i,u)},reduce:function e(i){for(var r=this._children,u=r.length-1;u>=0;u--){var c=r[u].reduce(i);c.isEmpty()&&c.remove()}if(!r.length){var c=new Ve(O.NO_INSERT);return c.copyAttributes(this),c.insertAbove(this),this.remove(),c}return e.base.call(this)},isClosed:function(){for(var e=this._children,i=0,r=e.length;i<r;i++)if(!e[i]._closed)return!1;return!0},setClosed:function(e){for(var i=this._children,r=0,u=i.length;r<u;r++)i[r].setClosed(e)},getFirstSegment:function(){var e=this.getFirstChild();return e&&e.getFirstSegment()},getLastSegment:function(){var e=this.getLastChild();return e&&e.getLastSegment()},getCurves:function(){for(var e=this._children,i=[],r=0,u=e.length;r<u;r++)o.push(i,e[r].getCurves());return i},getFirstCurve:function(){var e=this.getFirstChild();return e&&e.getFirstCurve()},getLastCurve:function(){var e=this.getLastChild();return e&&e.getLastCurve()},getArea:function(){for(var e=this._children,i=0,r=0,u=e.length;r<u;r++)i+=e[r].getArea();return i},getLength:function(){for(var e=this._children,i=0,r=0,u=e.length;r<u;r++)i+=e[r].getLength();return i},getPathData:function(e,i){for(var r=this._children,u=[],c=0,p=r.length;c<p;c++){var m=r[c],_=m._matrix;u.push(m.getPathData(e&&!_.isIdentity()?e.appended(_):e,i))}return u.join("")},_hitTestChildren:function e(i,r,u){return e.base.call(this,i,r.class===Ve||r.type==="path"?r:o.set({},r,{fill:!1}),u)},_draw:function(e,i,r,u){var c=this._children;if(c.length){i=i.extend({dontStart:!0,dontFinish:!0}),e.beginPath();for(var p=0,m=c.length;p<m;p++)c[p].draw(e,i,u);if(!i.clip){this._setStyles(e,i,r);var _=this._style;_.hasFill()&&(e.fill(_.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),_.hasStroke()&&e.stroke()}}},_drawSelected:function(e,i,r){for(var u=this._children,c=0,p=u.length;c<p;c++){var m=u[c],_=m._matrix;r[m._id]||m._drawSelected(e,_.isIdentity()?i:i.appended(_))}}},new function(){function e(i,r){var u=i._children;if(r&&!u.length)throw new Error("Use a moveTo() command first");return u[u.length-1]}return o.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(i){this[i]=function(){var r=e(this,!0);r[i].apply(r,arguments)}},{moveTo:function(){var i=e(this),r=i&&i.isEmpty()?i:new Ve(O.NO_INSERT);r!==i&&this.addChild(r),r.moveTo.apply(r,arguments)},moveBy:function(){var i=e(this,!0),r=i&&i.getLastSegment(),u=L.read(arguments);this.moveTo(r?u.add(r._point):u)},closePath:function(i){e(this,!0).closePath(i)}})},o.each(["reverse","flatten","simplify","smooth"],function(e){this[e]=function(i){for(var r=this._children,u,c=0,p=r.length;c<p;c++)u=r[c][e](i)||u;return u}},{}));st.inject(new function(){var e=Math.min,i=Math.max,r=Math.abs,u={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function c(I){return I._children||[I]}function p(I,R){var b=I.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(R){for(var N=c(b),U=0,H=N.length;U<H;U++){var I=N[U];!I._closed&&!I.isEmpty()&&(I.closePath(1e-12),I.getFirstSegment().setHandleIn(0,0),I.getLastSegment().setHandleOut(0,0))}b=b.resolveCrossings().reorient(b.getFillRule()==="nonzero",!0)}return b}function m(I,R,b,N,U){var H=new it(O.NO_INSERT);return H.addChildren(I,!0),H=H.reduce({simplify:R}),U&&U.insert==!1||H.insertAbove(N&&b.isSibling(N)&&b.getIndex()<N.getIndex()?N:b),H.copyAttributes(b,!0),H}function _(I){return I.hasOverlap()||I.isCrossing()}function y(I,R,b,N){if(N&&(N.trace==!1||N.stroke)&&/^(subtract|intersect)$/.test(b))return x(I,R,b);var U=p(I,!0),H=R&&I!==R&&p(R,!0),D=u[b];D[b]=!0,H&&(D.subtract||D.exclude)^(H.isClockwise()^U.isClockwise())&&H.reverse();var G=C(Xe.expand(U.getIntersections(H,_))),K=c(U),X=H&&c(H),$=[],j=[],Q;function ee(Ne){for(var Be=0,Fe=Ne.length;Be<Fe;Be++){var Ge=Ne[Be];o.push($,Ge._segments),o.push(j,Ge.getCurves()),Ge._overlapsOnly=!0}}function re(Ne){for(var Be=[],Fe=0,Ge=Ne&&Ne.length;Fe<Ge;Fe++)Be.push(j[Ne[Fe]]);return Be}if(G.length){ee(K),X&&ee(X);for(var se=new Array(j.length),ue=0,xe=j.length;ue<xe;ue++)se[ue]=j[ue].getValues();for(var ke=S.findCurveBoundsCollisions(se,se,0,!0),Te={},ue=0;ue<j.length;ue++){var ze=j[ue],ge=ze._path._id,_e=Te[ge]=Te[ge]||{};_e[ze.getIndex()]={hor:re(ke[ue].hor),ver:re(ke[ue].ver)}}for(var ue=0,xe=G.length;ue<xe;ue++)z(G[ue]._segment,U,H,Te,D);for(var ue=0,xe=$.length;ue<xe;ue++){var Le=$[ue],Re=Le._intersection;Le._winding||z(Le,U,H,Te,D),Re&&Re._overlap||(Le._path._overlapsOnly=!1)}Q=V($,D)}else Q=P(X?K.concat(X):K.slice(),function(Ne){return!!D[Ne]});return m(Q,!0,I,R,N)}function x(I,R,b){var N=p(I),U=p(R),H=N.getIntersections(U,_),D=b==="subtract",G=b==="divide",K={},X=[];function $(ee){if(!K[ee._id]&&(G||U.contains(ee.getPointAt(ee.getLength()/2))^D))return X.unshift(ee),K[ee._id]=!0}for(var j=H.length-1;j>=0;j--){var Q=H[j].split();Q&&($(Q)&&Q.getFirstSegment().setHandleIn(0,0),N.getLastSegment().setHandleOut(0,0))}return $(N),m(X,!1,I,R)}function T(I,R){for(var b=I;b;){if(b===R)return;b=b._previous}for(;I._next&&I._next!==R;)I=I._next;if(!I._next){for(;R._previous;)R=R._previous;I._next=R,R._previous=I}}function M(I){for(var R=I.length-1;R>=0;R--)I[R].clearHandles()}function P(I,R,b){var N=I&&I.length;if(N){var U=o.each(I,function(ke,Te){this[ke._id]={container:null,winding:ke.isClockwise()?1:-1,index:Te}},{}),H=I.slice().sort(function(ke,Te){return r(Te.getArea())-r(ke.getArea())}),D=H[0],G=S.findItemBoundsCollisions(H,null,k.GEOMETRIC_EPSILON);b==null&&(b=D.isClockwise());for(var K=0;K<N;K++){var X=H[K],$=U[X._id],j=0,Q=G[K];if(Q){for(var ee=null,re=Q.length-1;re>=0;re--)if(Q[re]<K){ee=ee||X.getInteriorPoint();var se=H[Q[re]];if(se.contains(ee)){var ue=U[se._id];j=ue.winding,$.winding+=j,$.container=ue.exclude?ue.container:se;break}}}if(R($.winding)===R(j))$.exclude=!0,I[$.index]=null;else{var xe=$.container;X.setClockwise(xe?!xe.isClockwise():b)}}}return I}function C(I,R,b){var N=R&&[],U=1e-8,H=1-U,D=!1,G=b||[],K=b&&{},X,$,j;function Q(Be){return Be._path._id+"."+Be._segment1._index}for(var ee=(b&&b.length)-1;ee>=0;ee--){var re=b[ee];re._path&&(K[Q(re)]=!0)}for(var ee=I.length-1;ee>=0;ee--){var se=I[ee],ue=se._time,xe=ue,ke=R&&!R(se),re=se._curve,Te;if(re&&(re!==$?(D=!re.hasHandles()||K&&K[Q(re)],X=[],j=null,$=re):j>=U&&(ue/=j)),ke){X&&X.push(se);continue}else R&&N.unshift(se);if(j=xe,ue<U)Te=re._segment1;else if(ue>H)Te=re._segment2;else{var ze=re.divideAtTime(ue,!0);D&&G.push(re,ze),Te=ze._segment1;for(var ge=X.length-1;ge>=0;ge--){var _e=X[ge];_e._time=(_e._time-ue)/(1-ue)}}se._setSegment(Te);var Le=Te._intersection,Re=se._intersection;if(Le){T(Le,Re);for(var Ne=Le;Ne;)T(Ne._intersection,Le),Ne=Ne._next}else Te._intersection=Re}return b||M(G),N||I}function B(I,R,b,N,U){var H=Array.isArray(R)?R:R[b?"hor":"ver"],D=b?1:0,G=D^1,K=[I.x,I.y],X=K[D],$=K[G],j=1e-9,Q=1e-6,ee=X-j,re=X+j,se=0,ue=0,xe=0,ke=0,Te=!1,ze=!1,ge=1,_e=[],Le,Re;function Ne(Ie){var lt=Ie[G+0],ct=Ie[G+6];if(!($<e(lt,ct)||$>i(lt,ct))){var yt=Ie[D+0],Nt=Ie[D+2],Gt=Ie[D+4],Rt=Ie[D+6];if(lt===ct){(yt<re&&Rt>ee||Rt<re&&yt>ee)&&(Te=!0);return}var Dt=$===lt?0:$===ct||ee>i(yt,Nt,Gt,Rt)||re<e(yt,Nt,Gt,Rt)?1:de.solveCubic(Ie,G,$,_e,0,1)>0?_e[0]:1,kt=Dt===0?yt:Dt===1?Rt:de.getPoint(Ie,Dt)[b?"y":"x"],Lt=lt>ct?1:-1,jt=Le[G]>Le[G+6]?1:-1,xt=Le[D+6];return $!==lt?(kt<ee?xe+=Lt:kt>re?ke+=Lt:Te=!0,kt>X-Q&&kt<X+Q&&(ge/=2)):(Lt!==jt?yt<ee?xe+=Lt:yt>re&&(ke+=Lt):yt!=xt&&(xt<re&&kt>re?(ke+=Lt,Te=!0):xt>ee&&kt<ee&&(xe+=Lt,Te=!0)),ge/=4),Le=Ie,!U&&kt>ee&&kt<re&&de.getTangent(Ie,Dt)[b?"x":"y"]===0&&B(I,R,!b,N,!0)}}function Be(Ie){var lt=Ie[G+0],ct=Ie[G+2],yt=Ie[G+4],Nt=Ie[G+6];if($<=i(lt,ct,yt,Nt)&&$>=e(lt,ct,yt,Nt)){for(var Gt=Ie[D+0],Rt=Ie[D+2],Dt=Ie[D+4],kt=Ie[D+6],Lt=ee>i(Gt,Rt,Dt,kt)||re<e(Gt,Rt,Dt,kt)?[Ie]:de.getMonoCurves(Ie,b),jt,xt=0,It=Lt.length;xt<It;xt++)if(jt=Ne(Lt[xt]))return jt}}for(var Fe=0,Ge=H.length;Fe<Ge;Fe++){var Ke=H[Fe],Ue=Ke._path,vt=Ke.getValues(),gt;if((!Fe||H[Fe-1]._path!==Ue)&&(Le=null,Ue._closed||(Re=de.getValues(Ue.getLastCurve().getSegment2(),Ke.getSegment1(),null,!N),Re[G]!==Re[G+6]&&(Le=Re)),!Le)){Le=vt;for(var bt=Ue.getLastCurve();bt&&bt!==Ke;){var mt=bt.getValues();if(mt[G]!==mt[G+6]){Le=mt;break}bt=bt.getPrevious()}}if(gt=Be(vt))return gt;if(Fe+1===Ge||H[Fe+1]._path!==Ue){if(Re&&(gt=Be(Re)))return gt;Te&&!xe&&!ke&&(xe=ke=Ue.isClockwise(N)^b?1:-1),se+=xe,ue+=ke,xe=ke=0,Te&&(ze=!0,Te=!1),Re=null}}return se=r(se),ue=r(ue),{winding:i(se,ue),windingL:se,windingR:ue,quality:ge,onPath:ze}}function z(I,R,b,N,U){var H=[],D=I,G=0,j;do{var K=I.getCurve();if(K){var X=K.getLength();H.push({segment:I,curve:K,length:X}),G+=X}I=I.getNext()}while(I&&!I._intersection&&I!==D);for(var $=[.5,.25,.75],j={winding:0,quality:-1},Q=.001,ee=1-Q,re=0;re<$.length&&j.quality<.5;re++)for(var X=G*$[re],se=0,ue=H.length;se<ue;se++){var xe=H[se],ke=xe.length;if(X<=ke){var K=xe.curve,Te=K._path,ze=Te._parent,ge=ze instanceof it?ze:Te,_e=k.clamp(K.getTimeAt(X),Q,ee),Le=K.getPointAtTime(_e),Re=r(K.getTangentAtTime(_e).y)<Math.SQRT1_2,Ne=null;if(U.subtract&&b){var Be=ge===R?b:R,Fe=Be._getWinding(Le,Re,!0);if(ge===R&&Fe.winding||ge===b&&!Fe.winding){if(Fe.quality<1)continue;Ne={winding:0,quality:1}}}Ne=Ne||B(Le,N[Te._id][K.getIndex()],Re,!0),Ne.quality>j.quality&&(j=Ne);break}X-=ke}for(var se=H.length-1;se>=0;se--)H[se].segment._winding=j}function V(I,R){var b=[],N;function U(Ge){var Ke;return!!(Ge&&!Ge._visited&&(!R||R[(Ke=Ge._winding||{}).winding]&&!(R.unite&&Ke.winding===2&&Ke.windingL&&Ke.windingR)))}function H(Ge){if(Ge){for(var Ke=0,Ue=N.length;Ke<Ue;Ke++)if(Ge===N[Ke])return!0}return!1}function D(Ge){for(var Ke=Ge._segments,Ue=0,vt=Ke.length;Ue<vt;Ue++)Ke[Ue]._visited=!0}function G(Ge,Ke){var Ue=Ge._intersection,vt=Ue,gt=[];Ke&&(N=[Ge]);function bt(mt,Ie){for(;mt&&mt!==Ie;){var lt=mt._segment,ct=lt&&lt._path;if(ct){var yt=lt.getNext()||ct.getFirstSegment(),Nt=yt._intersection;lt!==Ge&&(H(lt)||H(yt)||yt&&U(lt)&&(U(yt)||Nt&&U(Nt._segment)))&&gt.push(lt),Ke&&N.push(lt)}mt=mt._next}}if(Ue){for(bt(Ue);Ue&&Ue._previous;)Ue=Ue._previous;bt(Ue,vt)}return gt}I.sort(function(Ge,Ke){var Ue=Ge._intersection,vt=Ke._intersection,gt=!!(Ue&&Ue._overlap),bt=!!(vt&&vt._overlap),mt=Ge._path,Ie=Ke._path;return gt^bt?gt?1:-1:!Ue^!vt?Ue?1:-1:mt!==Ie?mt._id-Ie._id:Ge._index-Ke._index});for(var K=0,X=I.length;K<X;K++){var $=I[K],j=U($),Q=null,ee=!1,re=!0,se=[],ue,xe,ke;if(j&&$._path._overlapsOnly){var Te=$._path,ze=$._intersection._segment._path;Te.compare(ze)&&(Te.getArea()&&b.push(Te.clone(!1)),D(Te),D(ze),j=!1)}for(;j;){var ge=!Q,_e=G($,ge),Le=_e.shift(),ee=!ge&&(H($)||H(Le)),Re=!ee&&Le;if(ge&&(Q=new Ve(O.NO_INSERT),ue=null),ee){($.isFirst()||$.isLast())&&(re=$._path._closed),$._visited=!0;break}if(Re&&ue&&(se.push(ue),ue=null),ue||(Re&&_e.push($),ue={start:Q._segments.length,crossings:_e,visited:xe=[],handleIn:ke}),Re&&($=Le),!U($)){Q.removeSegments(ue.start);for(var Ne=0,Be=xe.length;Ne<Be;Ne++)xe[Ne]._visited=!1;xe.length=0;do $=ue&&ue.crossings.shift(),(!$||!$._path)&&($=null,ue=se.pop(),ue&&(xe=ue.visited,ke=ue.handleIn));while(ue&&!U($));if(!$)break}var Fe=$.getNext();Q.add(new Se($._point,ke,Fe&&$._handleOut)),$._visited=!0,xe.push($),$=Fe||$._path.getFirstSegment(),ke=Fe&&Fe._handleIn}ee&&(re&&(Q.getFirstSegment().setHandleIn(ke),Q.setClosed(re)),Q.getArea()!==0&&b.push(Q))}return b}return{_getWinding:function(I,R,b){return B(I,this.getCurves(),R,b)},unite:function(I,R){return y(this,I,"unite",R)},intersect:function(I,R){return y(this,I,"intersect",R)},subtract:function(I,R){return y(this,I,"subtract",R)},exclude:function(I,R){return y(this,I,"exclude",R)},divide:function(I,R){return R&&(R.trace==!1||R.stroke)?x(this,I,"divide"):m([this.subtract(I,R),this.intersect(I,R)],!0,this,I,R)},resolveCrossings:function(){var I=this._children,R=I||[this];function b(ue,xe){var ke=ue&&ue._intersection;return ke&&ke._overlap&&ke._path===xe}var N=!1,U=!1,H=this.getIntersections(null,function(ue){return ue.hasOverlap()&&(N=!0)||ue.isCrossing()&&(U=!0)}),D=N&&U&&[];if(H=Xe.expand(H),N)for(var G=C(H,function(ue){return ue.hasOverlap()},D),K=G.length-1;K>=0;K--){var X=G[K],$=X._path,j=X._segment,Q=j.getPrevious(),ee=j.getNext();b(Q,$)&&b(ee,$)&&(j.remove(),Q._handleOut._set(0,0),ee._handleIn._set(0,0),Q!==j&&!Q.getCurve().hasLength()&&(ee._handleIn.set(Q._handleIn),Q.remove()))}U&&(C(H,N&&function(ue){var xe=ue.getCurve(),ke=ue.getSegment(),Te=ue._intersection,ze=Te._curve,ge=Te._segment;if(xe&&ze&&xe._path&&ze._path)return!0;ke&&(ke._intersection=null),ge&&(ge._intersection=null)},D),D&&M(D),R=V(o.each(R,function(ue){o.push(this,ue._segments)},[])));var re=R.length,se;return re>1&&I?(R!==I&&this.setChildren(R),se=this):re===1&&!I&&(R[0]!==this&&this.setSegments(R[0].removeSegments()),se=this),se||(se=new it(O.NO_INSERT),se.addChildren(R),se=se.reduce(),se.copyAttributes(this),this.replaceWith(se)),se},reorient:function(I,R){var b=this._children;return b&&b.length?this.setChildren(P(this.removeChildren(),function(N){return!!(I?N:N&1)},R)):R!==a&&this.setClockwise(R),this},getInteriorPoint:function(){var I=this.getBounds(),R=I.getCenter(!0);if(!this.contains(R)){for(var b=this.getCurves(),N=R.y,U=[],H=[],D=0,G=b.length;D<G;D++){var K=b[D].getValues(),X=K[1],$=K[3],j=K[5],Q=K[7];if(N>=e(X,$,j,Q)&&N<=i(X,$,j,Q))for(var ee=de.getMonoCurves(K),re=0,se=ee.length;re<se;re++){var ue=ee[re],xe=ue[1],ke=ue[7];if(xe!==ke&&(N>=xe&&N<=ke||N>=ke&&N<=xe)){var Te=N===xe?ue[0]:N===ke?ue[6]:de.solveCubic(ue,1,N,H,0,1)===1?de.getPoint(ue,H[0]).x:(ue[0]+ue[6])/2;U.push(Te)}}}U.length>1&&(U.sort(function(ze,ge){return ze-ge}),R.x=(U[0]+U[1])/2)}return R}}});var Kt=o.extend({_class:"PathFlattener",initialize:function(e,i,r,u,c){var p=[],m=[],_=0,y=1/(r||32),x=e._segments,T=x[0],M;function P(V,I){var R=de.getValues(V,I,c);p.push(R),C(R,V._index,0,1)}function C(V,I,R,b){if(b-R>y&&!(u&&de.isStraight(V))&&!de.isFlatEnough(V,i||.25)){var N=de.subdivide(V,.5),U=(R+b)/2;C(N[0],I,R,U),C(N[1],I,U,b)}else{var H=V[6]-V[0],D=V[7]-V[1],G=Math.sqrt(H*H+D*D);G>0&&(_+=G,m.push({offset:_,curve:V,index:I,time:b}))}}for(var B=1,z=x.length;B<z;B++)M=x[B],P(T,M),T=M;e._closed&&P(M||T,x[0]),this.curves=p,this.parts=m,this.length=_,this.index=0},_get:function(e){for(var i=this.parts,r=i.length,u,c=this.index;u=c,!(!c||i[--c].offset<e););for(;u<r;u++){var p=i[u];if(p.offset>=e){this.index=u;var m=i[u-1],_=m&&m.index===p.index?m.time:0,y=m?m.offset:0;return{index:p.index,time:_+(p.time-_)*(e-y)/(p.offset-y)}}}return{index:i[r-1].index,time:1}},drawPart:function(e,i,r){for(var u=this._get(i),c=this._get(r),p=u.index,m=c.index;p<=m;p++){var _=de.getPart(this.curves[p],p===u.index?u.time:0,p===c.index?c.time:1);p===u.index&&e.moveTo(_[0],_[1]),e.bezierCurveTo.apply(e,_.slice(2))}}},o.each(de._evaluateMethods,function(e){this[e+"At"]=function(i){var r=this._get(i);return de[e](this.curves[r.index],r.time)}},{})),Bt=o.extend({initialize:function(e){for(var i=this.points=[],r=e._segments,u=e._closed,c=0,p,m=r.length;c<m;c++){var _=r[c].point;(!p||!p.equals(_))&&i.push(p=_.clone())}u&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=u},fit:function(e){var i=this.points,r=i.length,u=null;return r>0&&(u=[new Se(i[0])],r>1&&(this.fitCubic(u,e,0,r-1,i[1].subtract(i[0]),i[r-2].subtract(i[r-1])),this.closed&&(u.shift(),u.pop()))),u},fitCubic:function(e,i,r,u,c,p){var m=this.points;if(u-r===1){var _=m[r],y=m[u],x=_.getDistance(y)/3;this.addCurve(e,[_,_.add(c.normalize(x)),y.add(p.normalize(x)),y]);return}for(var T=this.chordLengthParameterize(r,u),M=Math.max(i,i*i),P,C=!0,B=0;B<=4;B++){var z=this.generateBezier(r,u,T,c,p),V=this.findMaxError(r,u,z,T);if(V.error<i&&C){this.addCurve(e,z);return}if(P=V.index,V.error>=M)break;C=this.reparameterize(r,u,T,z),M=V.error}var I=m[P-1].subtract(m[P+1]);this.fitCubic(e,i,r,P,c,I),this.fitCubic(e,i,P,u,I.negate(),p)},addCurve:function(e,i){var r=e[e.length-1];r.setHandleOut(i[1].subtract(i[0])),e.push(new Se(i[3],i[2].subtract(i[3])))},generateBezier:function(e,i,r,u,c){for(var p=1e-12,m=Math.abs,_=this.points,y=_[e],x=_[i],T=[[0,0],[0,0]],M=[0,0],P=0,C=i-e+1;P<C;P++){var B=r[P],z=1-B,V=3*B*z,I=z*z*z,R=V*z,b=V*B,N=B*B*B,U=u.normalize(R),H=c.normalize(b),D=_[e+P].subtract(y.multiply(I+R)).subtract(x.multiply(b+N));T[0][0]+=U.dot(U),T[0][1]+=U.dot(H),T[1][0]=T[0][1],T[1][1]+=H.dot(H),M[0]+=U.dot(D),M[1]+=H.dot(D)}var G=T[0][0]*T[1][1]-T[1][0]*T[0][1],K,X;if(m(G)>p){var $=T[0][0]*M[1]-T[1][0]*M[0],j=M[0]*T[1][1]-M[1]*T[0][1];K=j/G,X=$/G}else{var Q=T[0][0]+T[0][1],ee=T[1][0]+T[1][1];K=X=m(Q)>p?M[0]/Q:m(ee)>p?M[1]/ee:0}var re=x.getDistance(y),se=p*re,ue,xe;if(K<se||X<se)K=X=re/3;else{var ke=x.subtract(y);ue=u.normalize(K),xe=c.normalize(X),ue.dot(ke)-xe.dot(ke)>re*re&&(K=X=re/3,ue=xe=null)}return[y,y.add(ue||u.normalize(K)),x.add(xe||c.normalize(X)),x]},reparameterize:function(e,i,r,u){for(var c=e;c<=i;c++)r[c-e]=this.findRoot(u,this.points[c],r[c-e]);for(var c=1,p=r.length;c<p;c++)if(r[c]<=r[c-1])return!1;return!0},findRoot:function(e,i,r){for(var u=[],c=[],p=0;p<=2;p++)u[p]=e[p+1].subtract(e[p]).multiply(3);for(var p=0;p<=1;p++)c[p]=u[p+1].subtract(u[p]).multiply(2);var m=this.evaluate(3,e,r),_=this.evaluate(2,u,r),y=this.evaluate(1,c,r),x=m.subtract(i),T=_.dot(_)+x.dot(y);return k.isMachineZero(T)?r:r-x.dot(_)/T},evaluate:function(e,i,r){for(var u=i.slice(),c=1;c<=e;c++)for(var p=0;p<=e-c;p++)u[p]=u[p].multiply(1-r).add(u[p+1].multiply(r));return u[0]},chordLengthParameterize:function(e,i){for(var r=[0],u=e+1;u<=i;u++)r[u-e]=r[u-e-1]+this.points[u].getDistance(this.points[u-1]);for(var u=1,c=i-e;u<=c;u++)r[u]/=r[c];return r},findMaxError:function(e,i,r,u){for(var c=Math.floor((i-e+1)/2),p=0,m=e+1;m<i;m++){var _=this.evaluate(3,r,u[m-e]),y=_.subtract(this.points[m]),x=y.x*y.x+y.y*y.y;x>=p&&(p=x,c=m)}return{error:p,index:c}}}),Xt=O.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(i){this._content="",this._lines=[];var r=i&&o.isPlainObject(i)&&i.x===a&&i.y===a;this._initialize(r&&i,!r&&L.read(arguments))},_equals:function(e){return this._content===e._content},copyContent:function(e){this.setContent(e._content)},getContent:function(){return this._content},setContent:function(e){this._content=""+e,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Hi=Xt.extend({_class:"PointText",initialize:function(){Xt.apply(this,arguments)},getPoint:function(){var e=this._matrix.getTranslation();return new te(e.x,e.y,this,"setPoint")},setPoint:function(){var e=L.read(arguments);this.translate(e.subtract(this._matrix.getTranslation()))},_draw:function(e,i,r){if(this._content){this._setStyles(e,i,r);var u=this._lines,c=this._style,p=c.hasFill(),m=c.hasStroke(),_=c.getLeading(),y=e.shadowColor;e.font=c.getFontStyle(),e.textAlign=c.getJustification();for(var x=0,T=u.length;x<T;x++){e.shadowColor=y;var M=u[x];p&&(e.fillText(M,0,0),e.shadowColor="rgba(0,0,0,0)"),m&&e.strokeText(M,0,0),e.translate(0,_)}}},_getBounds:function(e,i){var r=this._style,u=this._lines,c=u.length,p=r.getJustification(),m=r.getLeading(),_=this.getView().getTextWidth(r.getFontStyle(),u),y=0;p!=="left"&&(y-=_/(p==="center"?2:1));var x=new J(y,c?-.75*m:0,_,c*m);return e?e._transformBounds(x,x):x}}),dt=o.extend(new function(){var e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},i={},r={transparent:[0,0,0,0]},u;function c(_){var y=_.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||_.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),x="rgb",T;if(y){var M=y[4]?4:3;T=new Array(M);for(var P=0;P<M;P++){var C=y[P+1];T[P]=parseInt(C.length==1?C+C:C,16)/255}}else if(y=_.match(/^(rgb|hsl)a?\((.*)\)$/)){x=y[1],T=y[2].trim().split(/[,\s]+/g);for(var B=x==="hsl",P=0,z=Math.min(T.length,4);P<z;P++){var V=T[P],C=parseFloat(V);if(B)if(P===0){var I=V.match(/([a-z]*)$/)[1];C*={turn:360,rad:180/Math.PI,grad:.9}[I]||1}else P<3&&(C/=100);else P<3&&(C/=/%$/.test(V)?100:255);T[P]=C}}else{var R=r[_];if(!R)if(l){u||(u=pt.getContext(1,1,{willReadFrequently:!0}),u.globalCompositeOperation="copy"),u.fillStyle="rgba(0,0,0,0)",u.fillStyle=_,u.fillRect(0,0,1,1);var b=u.getImageData(0,0,1,1).data;R=r[_]=[b[0]/255,b[1]/255,b[2]/255]}else R=[0,0,0];T=R.slice()}return[x,T]}var p=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],m={"rgb-hsb":function(_,y,x){var T=Math.max(_,y,x),M=Math.min(_,y,x),P=T-M,C=P===0?0:(T==_?(y-x)/P+(y<x?6:0):T==y?(x-_)/P+2:(_-y)/P+4)*60;return[C,T===0?0:P/T,T]},"hsb-rgb":function(_,y,x){_=(_/60%6+6)%6;var M=Math.floor(_),T=_-M,M=p[M],P=[x,x*(1-y),x*(1-y*T),x*(1-y*(1-T))];return[P[M[0]],P[M[1]],P[M[2]]]},"rgb-hsl":function(_,y,x){var T=Math.max(_,y,x),M=Math.min(_,y,x),P=T-M,C=P===0,B=C?0:(T==_?(y-x)/P+(y<x?6:0):T==y?(x-_)/P+2:(_-y)/P+4)*60,z=(T+M)/2,V=C?0:z<.5?P/(T+M):P/(2-T-M);return[B,V,z]},"hsl-rgb":function(_,y,x){if(_=(_/360%1+1)%1,y===0)return[x,x,x];for(var T=[_+1/3,_,_-1/3],M=x<.5?x*(1+y):x+y-x*y,P=2*x-M,C=[],B=0;B<3;B++){var z=T[B];z<0&&(z+=1),z>1&&(z-=1),C[B]=6*z<1?P+(M-P)*6*z:2*z<1?M:3*z<2?P+(M-P)*(2/3-z)*6:P}return C},"rgb-gray":function(_,y,x){return[_*.2989+y*.587+x*.114]},"gray-rgb":function(_){return[_,_,_]},"gray-hsb":function(_){return[0,0,_]},"gray-hsl":function(_){return[0,0,_]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return o.each(e,function(_,y){i[y]=[],o.each(_,function(x,T){var M=o.capitalize(x),P=/^(hue|saturation)$/.test(x),C=i[y][T]=y==="gradient"?x==="gradient"?function(B){var z=this._components[0];return B=mi.read(Array.isArray(B)?B:arguments,0,{readNull:!0}),z!==B&&(z&&z._removeOwner(this),B&&B._addOwner(this)),B}:function(){return L.read(arguments,0,{readNull:x==="highlight",clone:!0})}:function(B){return B==null||isNaN(B)?0:+B};this["get"+M]=function(){return this._type===y||P&&/^hs[bl]$/.test(this._type)?this._components[T]:this._convert(y)[T]},this["set"+M]=function(B){this._type!==y&&!(P&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(y),this._properties=e[y],this._type=y),this._components[T]=C.call(this,B),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function _(y){var x=arguments,T=this.__read,M=0,P,C,B,z;Array.isArray(y)&&(x=y,y=x[0]);var V=y!=null&&typeof y;if(V==="string"&&y in e&&(P=y,y=x[1],Array.isArray(y)?(C=y,B=x[2]):(T&&(M=1),x=o.slice(x,1),V=typeof y)),!C){if(z=V==="number"?x:V==="object"&&y.length!=null?y:null,z){P||(P=z.length>=3?"rgb":"gray");var I=e[P].length;B=z[I],T&&(M+=z===arguments?I+(B!=null?1:0):1),z.length>I&&(z=o.slice(z,0,I))}else if(V==="string"){var R=c(y);P=R[0],C=R[1],C.length===4&&(B=C[3],C.length--)}else if(V==="object")if(y.constructor===_){if(P=y._type,C=y._components.slice(),B=y._alpha,P==="gradient")for(var b=1,N=C.length;b<N;b++){var U=C[b];U&&(C[b]=U.clone())}}else if(y.constructor===mi)P="gradient",z=x;else{P="hue"in y?"lightness"in y?"hsl":"hsb":"gradient"in y||"stops"in y||"radial"in y?"gradient":"gray"in y?"gray":"rgb";var H=e[P],D=i[P];this._components=C=[];for(var b=0,N=H.length;b<N;b++){var G=y[H[b]];G==null&&!b&&P==="gradient"&&"stops"in y&&(G={stops:y.stops,radial:y.radial}),G=D[b].call(this,G),G!=null&&(C[b]=G)}B=y.alpha}T&&P&&(M=1)}if(this._type=P||"rgb",!C){this._components=C=[];for(var D=i[this._type],b=0,N=D.length;b<N;b++){var G=D[b].call(this,z&&z[b]);G!=null&&(C[b]=G)}}return this._components=C,this._properties=e[this._type],this._alpha=B,T&&(this.__read=M),this},set:"#initialize",_serialize:function(_,y){var x=this.getComponents();return o.serialize(/^(gray|rgb)$/.test(this._type)?x:[this._type].concat(x),_,!0,y)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(_){var y;return this._type===_?this._components.slice():(y=m[this._type+"-"+_])?y.apply(this,this._components):m["rgb-"+_].apply(this,m[this._type+"-rgb"].apply(this,this._components))},convert:function(_){return new dt(_,this._convert(_),this._alpha)},getType:function(){return this._type},setType:function(_){this._components=this._convert(_),this._properties=e[_],this._type=_},getComponents:function(){var _=this._components.slice();return this._alpha!=null&&_.push(this._alpha),_},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(_){this._alpha=_==null?null:Math.min(Math.max(_,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(_){var y=o.isPlainValue(_,!0)?dt.read(arguments):_;return y===this||y&&this._class===y._class&&this._type===y._type&&this.getAlpha()===y.getAlpha()&&o.equals(this._components,y._components)||!1},toString:function(){for(var _=this._properties,y=[],x=this._type==="gradient",T=E.instance,M=0,P=_.length;M<P;M++){var C=this._components[M];C!=null&&y.push(_[M]+": "+(x?C:T.number(C)))}return this._alpha!=null&&y.push("alpha: "+T.number(this._alpha)),"{ "+y.join(", ")+" }"},toCSS:function(_){var y=this._convert("rgb"),x=_||this._alpha==null?1:this._alpha;function T(M){return Math.round((M<0?0:M>1?1:M)*255)}return y=[T(y[0]),T(y[1]),T(y[2])],x<1&&y.push(x<0?0:x),_?"#"+((1<<24)+(y[0]<<16)+(y[1]<<8)+y[2]).toString(16).slice(1):(y.length==4?"rgba(":"rgb(")+y.join(",")+")"},toCanvasStyle:function(_,y){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var x=this._components,T=x[0],M=T._stops,P=x[1],C=x[2],B=x[3],z=y&&y.inverted(),V;if(z&&(P=z._transformPoint(P),C=z._transformPoint(C),B&&(B=z._transformPoint(B))),T._radial){var I=C.getDistance(P);if(B){var R=B.subtract(P);R.getLength()>I&&(B=P.add(R.normalize(I-.1)))}var b=B||P;V=_.createRadialGradient(b.x,b.y,0,P.x,P.y,I)}else V=_.createLinearGradient(P.x,P.y,C.x,C.y);for(var N=0,U=M.length;N<U;N++){var H=M[N],D=H._offset;V.addColorStop(D??N/(U-1),H._color.toCanvasStyle())}return this._canvasStyle=V},transform:function(_){if(this._type==="gradient"){for(var y=this._components,x=1,T=y.length;x<T;x++){var M=y[x];_._transformPoint(M,M,!0)}this._changed()}},statics:{_types:e,random:function(){var _=Math.random;return new dt(_(),_(),_())},_setOwner:function(_,y,x){return _&&(_._owner&&y&&_._owner!==y&&(_=_.clone()),!_._owner^!y&&(_._owner=y||null,_._setter=x||null)),_}}})},new function(){var e={add:function(i,r){return i+r},subtract:function(i,r){return i-r},multiply:function(i,r){return i*r},divide:function(i,r){return i/r}};return o.each(e,function(i,r){this[r]=function(u){u=dt.read(arguments);for(var c=this._type,p=this._components,m=u._convert(c),_=0,y=p.length;_<y;_++)m[_]=i(p[_],m[_]);return new dt(c,m,this._alpha!=null?i(this._alpha,u.getAlpha()):null)}},{})}),mi=o.extend({_class:"Gradient",initialize:function(i,r){this._id=q.get(),i&&o.isPlainObject(i)&&(this.set(i),i=r=null),this._stops==null&&this.setStops(i||["white","black"]),this._radial==null&&this.setRadial(typeof r=="string"&&r==="radial"||r||!1)},_serialize:function(e,i){return i.add(this,function(){return o.serialize([this._stops,this._radial],e,!0,i)})},_changed:function(){for(var e=0,i=this._owners&&this._owners.length;e<i;e++)this._owners[e]._changed()},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var i=this._owners?this._owners.indexOf(e):-1;i!=-1&&(this._owners.splice(i,1),this._owners.length||(this._owners=a))},clone:function(){for(var e=[],i=0,r=this._stops.length;i<r;i++)e[i]=this._stops[i].clone();return new mi(e,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var r=0,u=i.length;r<u;r++)i[r]._owner=a;i=this._stops=Gi.readList(e,0,{clone:!0});for(var r=0,u=i.length;r<u;r++)i[r]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(e){this._radial=e,this._changed()},equals:function(e){if(e===this)return!0;if(e&&this._class===e._class){var i=this._stops,r=e._stops,u=i.length;if(u===r.length){for(var c=0;c<u;c++)if(!i[c].equals(r[c]))return!1;return!0}}return!1}}),Gi=o.extend({_class:"GradientStop",initialize:function(i,r){var u=i,c=r;typeof i=="object"&&r===a&&(Array.isArray(i)&&typeof i[0]!="number"?(u=i[0],c=i[1]):("color"in i||"offset"in i||"rampPoint"in i)&&(u=i.color,c=i.offset||i.rampPoint||0)),this.setColor(u),this.setOffset(c)},clone:function(){return new Gi(this._color.clone(),this._offset)},_serialize:function(e,i){var r=this._color,u=this._offset;return o.serialize(u==null?[r]:[r,u],e,!0,i)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){dt._setOwner(this._color,null),this._color=dt._setOwner(dt.read(arguments,0),this,"setColor"),this._changed()},equals:function(e){return e===this||e&&this._class===e._class&&this._color.equals(e._color)&&this._offset==e._offset||!1}}),ji=o.extend(new function(){var e={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new L,selectedColor:null},i=o.set({},e,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),r=o.set({},i,{fillColor:new dt}),u={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},c={beans:!0},p={_class:"Style",beans:!0,initialize:function(_,y,x){this._values={},this._owner=y,this._project=y&&y._project||x||Ye.project,this._defaults=!y||y instanceof ye?i:y instanceof Xt?r:e,_&&this.set(_)}};return o.each(i,function(m,_){var y=/Color$/.test(_),x=_==="shadowOffset",T=o.capitalize(_),M=u[_],P="set"+T,C="get"+T;p[P]=function(B){var z=this._owner,V=z&&z._children,I=V&&V.length>0&&!(z instanceof it);if(I)for(var R=0,b=V.length;R<b;R++)V[R]._style[P](B);if((_==="selectedColor"||!I)&&_ in this._defaults){var N=this._values[_];N!==B&&(y&&(N&&(dt._setOwner(N,null),N._canvasStyle=null),B&&B.constructor===dt&&(B=dt._setOwner(B,z,I&&P))),this._values[_]=B,z&&z._changed(M||129))}},p[C]=function(B){var z=this._owner,V=z&&z._children,I=V&&V.length>0&&!(z instanceof it),R;if(I&&!B)for(var b=0,N=V.length;b<N;b++){var U=V[b]._style[C]();if(!b)R=U;else if(!o.equals(R,U))return a}else if(_ in this._defaults){var R=this._values[_];if(R===a)R=this._defaults[_],R&&R.clone&&(R=R.clone());else{var H=y?dt:x?L:null;H&&!(R&&R.constructor===H)&&(this._values[_]=R=H.read([R],0,{readNull:!0,clone:!0}))}}return R&&y&&(R=dt._setOwner(R,z,I&&P)),R},c[C]=function(B){return this._style[C](B)},c[P]=function(B){this._style[P](B)}}),o.each({Font:"FontFamily",WindingRule:"FillRule"},function(m,_){var y="get"+_,x="set"+_;p[y]=c[y]="#get"+m,p[x]=c[x]="#set"+m}),O.inject(c),p},{set:function(e){var i=e instanceof ji,r=i?e._values:e;if(r){for(var u in r)if(u in this._defaults){var c=r[u];this[u]=c&&i&&c.clone?c.clone():c}}},equals:function(e){function i(r,u,c){var p=r._values,m=u._values,_=u._defaults;for(var y in p){var x=p[y],T=m[y];if(!(c&&y in m)&&!o.equals(x,T===a?_[y]:T))return!1}return!0}return e===this||e&&this._class===e._class&&i(this,e)&&i(e,this,!0)||!1},_dispose:function(){var e;e=this.getFillColor(),e&&(e._canvasStyle=null),e=this.getStrokeColor(),e&&(e._canvasStyle=null),e=this.getShadowColor(),e&&(e._canvasStyle=null)},hasFill:function(){var e=this.getFillColor();return!!e&&e.alpha>0},hasStroke:function(){var e=this.getStrokeColor();return!!e&&e.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var e=this.getShadowColor();return!!e&&e.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var e=this.getFontSize();return this.getFontWeight()+" "+e+(/[a-z]/i.test(e+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function e(){var i=e.base.call(this),r=this.getFontSize();return/pt|em|%|px/.test(r)&&(r=this.getView().getPixelSize(r)),i??r*1.2}}),at=new function(){function e(i,r,u,c){for(var p=["","webkit","moz","Moz","ms","o"],m=r[0].toUpperCase()+r.substring(1),_=0;_<6;_++){var y=p[_],x=y?y+m:r;if(x in i){if(u)i[x]=c;else return i[x];break}}}return{getStyles:function(i){var r=i&&i.nodeType!==9?i.ownerDocument:i,u=r&&r.defaultView;return u&&u.getComputedStyle(i,"")},getBounds:function(i,r){var u=i.ownerDocument,c=u.body,p=u.documentElement,m;try{m=i.getBoundingClientRect()}catch{m={left:0,top:0,width:0,height:0}}var _=m.left-(p.clientLeft||c.clientLeft||0),y=m.top-(p.clientTop||c.clientTop||0);if(!r){var x=u.defaultView;_+=x.pageXOffset||p.scrollLeft||c.scrollLeft,y+=x.pageYOffset||p.scrollTop||c.scrollTop}return new J(_,y,m.width,m.height)},getViewportBounds:function(i){var r=i.ownerDocument,u=r.defaultView,c=r.documentElement;return new J(0,0,u.innerWidth||c.clientWidth,u.innerHeight||c.clientHeight)},getOffset:function(i,r){return at.getBounds(i,r).getPoint()},getSize:function(i){return at.getBounds(i,!0).getSize()},isInvisible:function(i){return at.getSize(i).equals(new Z(0,0))},isInView:function(i){return!at.isInvisible(i)&&at.getViewportBounds(i).intersects(at.getBounds(i,!0))},isInserted:function(i){return f.body.contains(i)},getPrefixed:function(i,r){return i&&e(i,r)},setPrefixed:function(i,r,u){if(typeof r=="object")for(var c in r)e(i,c,!0,r[c]);else e(i,r,!0,u)}}},ut={add:function(e,i){if(e)for(var r in i)for(var u=i[r],c=r.split(/[\s,]+/g),p=0,m=c.length;p<m;p++){var _=c[p],y=e===f&&(_==="touchstart"||_==="touchmove")?{passive:!1}:!1;e.addEventListener(_,u,y)}},remove:function(e,i){if(e)for(var r in i)for(var u=i[r],c=r.split(/[\s,]+/g),p=0,m=c.length;p<m;p++)e.removeEventListener(c[p],u,!1)},getPoint:function(e){var i=e.targetTouches?e.targetTouches.length?e.targetTouches[0]:e.changedTouches[0]:e;return new L(i.pageX||i.clientX+f.documentElement.scrollLeft,i.pageY||i.clientY+f.documentElement.scrollTop)},getTarget:function(e){return e.target||e.srcElement},getRelatedTarget:function(e){return e.relatedTarget||e.toElement},getOffset:function(e,i){return ut.getPoint(e).subtract(at.getOffset(i||ut.getTarget(e)))}};ut.requestAnimationFrame=new function(){var e=at.getPrefixed(l,"requestAnimationFrame"),i=!1,r=[],u;function c(){var p=r;r=[];for(var m=0,_=p.length;m<_;m++)p[m]();i=e&&r.length,i&&e(c)}return function(p){r.push(p),e?i||(e(c),i=!0):u||(u=setInterval(c,1e3/60))}};var ht=o.extend(g,{_class:"View",initialize:function e(i,r){function u(M){return r[M]||parseInt(r.getAttribute(M),10)}function c(){var M=at.getSize(r);return M.isNaN()||M.isZero()?new Z(u("width"),u("height")):M}var p;if(l&&r){this._id=r.getAttribute("id"),this._id==null&&r.setAttribute("id",this._id="paper-view-"+e._id++),ut.add(r,this._viewEvents);var m="none";if(at.setPrefixed(r.style,{userDrag:m,userSelect:m,touchCallout:m,contentZooming:m,tapHighlightColor:"rgba(0,0,0,0)"}),v.hasAttribute(r,"resize")){var _=this;ut.add(l,this._windowEvents={resize:function(){_.setViewSize(c())}})}if(p=c(),v.hasAttribute(r,"stats")&&typeof Stats<"u"){this._stats=new Stats;var y=this._stats.domElement,x=y.style,T=at.getOffset(r);x.position="absolute",x.left=T.x+"px",x.top=T.y+"px",f.body.appendChild(y)}}else p=new Z(r),r=null;this._project=i,this._scope=i._scope,this._element=r,this._pixelRatio||(this._pixelRatio=l&&l.devicePixelRatio||1),this._setElementSize(p.width,p.height),this._viewSize=p,e._views.push(this),e._viewsById[this._id]=this,(this._matrix=new ce)._owner=this,e._focused||(e._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!Ye.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;ht._focused===this&&(ht._focused=null),ht._views.splice(ht._views.indexOf(this),1),delete ht._viewsById[this._id];var e=this._project;return e._view===this&&(e._view=null),ut.remove(this._element,this._viewEvents),ut.remove(l,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:o.each(O._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(e){this[e]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(e){this._autoUpdate=e,e&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var e=this;ut.requestAnimationFrame(function(){if(e._requested=!1,e._animate){e.requestUpdate();var i=e._element;(!at.getPrefixed(f,"hidden")||v.getAttribute(i,"keepalive")==="true")&&at.isInView(i)&&e._handleFrame()}e._autoUpdate&&e.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){Ye=this._scope;var e=Date.now()/1e3,i=this._last?e-this._last:0;this._last=e,this.emit("frame",new o({delta:i,time:this._time+=i,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(e,i){var r=this._frameItems;i?(r[e._id]={item:e,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete r[e._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(e){for(var i in this._frameItems){var r=this._frameItems[i];r.item.emit("frame",new o(e,{time:r.time+=e.delta,count:r.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=a},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var e=this._viewSize;return new ne(e.width,e.height,this,"setViewSize")},setViewSize:function(){var e=Z.read(arguments),i=e.subtract(this._viewSize);i.isZero()||(this._setElementSize(e.width,e.height),this._viewSize.set(e),this._changed(),this.emit("resize",{size:e,delta:i}),this._autoUpdate&&this.update())},_setElementSize:function(e,i){var r=this._element;r&&(r.width!==e&&(r.width=e),r.height!==i&&(r.height=i))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new J(new L,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return at.isInView(this._element)},isInserted:function(){return at.isInserted(this._element)},getPixelSize:function(e){var i=this._element,r;if(i){var u=i.parentNode,c=f.createElement("div");c.style.fontSize=e,u.appendChild(c),r=parseFloat(at.getStyles(c).fontSize),u.removeChild(c)}else r=parseFloat(r);return r},getTextWidth:function(e,i){return 0}},o.each(["rotate","scale","shear","skew"],function(e){var i=e==="rotate";this[e]=function(){var r=arguments,u=(i?o:L).read(r),c=L.read(r,0,{readNull:!0});return this.transform(new ce()[e](u,c||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var e=new ce;return this.transform(e.translate.apply(e,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var e=L.read(arguments);this.translate(this.getCenter().subtract(e))},getZoom:function(){var e=this._decompose().scaling;return(e.x+e.y)/2},setZoom:function(e){this.transform(new ce().scale(e/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(e){var i=this.getRotation();i!=null&&e!=null&&this.rotate(e-i)},getScaling:function(){var e=this._decompose().scaling;return new te(e.x,e.y,this,"setScaling")},setScaling:function(){var e=this.getScaling(),i=L.read(arguments,0,{clone:!0,readNull:!0});e&&i&&this.scale(i.x/e.x,i.y/e.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},transform:function(e){this._matrix.append(e)},scrollBy:function(){this.translate(L.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(L.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(L.read(arguments))},getEventPoint:function(e){return this.viewToProject(ut.getOffset(e,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(e,i){f&&typeof i=="string"&&(i=f.getElementById(i));var r=l?Sn:ht;return new r(e,i)}}},new function(){if(!l)return;var e,i,r=!1,u=!1;function c(j){var Q=ut.getTarget(j);return Q.getAttribute&&ht._viewsById[Q.getAttribute("id")]}function p(){var j=ht._focused;if(!j||!j.isVisible()){for(var Q=0,ee=ht._views.length;Q<ee;Q++)if((j=ht._views[Q]).isVisible()){ht._focused=i=j;break}}}function m(j,Q,ee){j._handleMouseEvent("mousemove",Q,ee)}var _=l.navigator,y,x,T;_.pointerEnabled||_.msPointerEnabled?(y="pointerdown MSPointerDown",x="pointermove MSPointerMove",T="pointerup pointercancel MSPointerUp MSPointerCancel"):(y="touchstart",x="touchmove",T="touchend touchcancel","ontouchstart"in l&&_.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(y+=" mousedown",x+=" mousemove",T+=" mouseup"));var M={},P={mouseout:function(j){var Q=ht._focused,ee=ut.getRelatedTarget(j);if(Q&&(!ee||ee.nodeName==="HTML")){var re=ut.getOffset(j,Q._element),se=re.x,ue=Math.abs,xe=ue(se),ke=1<<25,Te=xe-ke;re.x=ue(Te)<xe?Te*(se<0?-1:1):se,m(Q,j,Q.viewToProject(re))}},scroll:p};M[y]=function(j){var Q=ht._focused=c(j);r||(r=!0,Q._handleMouseEvent("mousedown",j))},P[x]=function(j){var Q=ht._focused;if(!u){var ee=c(j);ee?Q!==ee&&(Q&&m(Q,j),e||(e=Q),Q=ht._focused=i=ee):i&&i===Q&&(e&&!e.isInserted()&&(e=null),Q=ht._focused=e,e=null,p())}Q&&m(Q,j)},P[y]=function(){u=!0},P[T]=function(j){var Q=ht._focused;Q&&r&&Q._handleMouseEvent("mouseup",j),u=r=!1},ut.add(f,P),ut.add(l,{load:p});var C=!1,B=!1,z={doubleclick:"click",mousedrag:"mousemove"},V=!1,I,R,b,N,U,H,D,G;function K(j,Q,ee,re,se,ue,xe){var ke=!1,Te;function ze(ge,_e){if(ge.responds(_e)){if(Te||(Te=new Pn(_e,re,se,Q||ge,ue?se.subtract(ue):null)),ge.emit(_e,Te)&&(C=!0,Te.prevented&&(B=!0),Te.stopped))return ke=!0}else{var Le=z[_e];if(Le)return ze(ge,Le)}}for(;j&&j!==xe&&!ze(j,ee);)j=j._parent;return ke}function X(j,Q,ee,re,se,ue){return j._project.removeOn(ee),B=C=!1,U&&K(U,null,ee,re,se,ue)||Q&&Q!==U&&!Q.isDescendant(U)&&K(Q,null,ee==="mousedrag"?"mousemove":ee,re,se,ue,U)||K(j,U||Q||j,ee,re,se,ue)}var $={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:M,_handleMouseEvent:function(j,Q,ee){var re=this._itemEvents,se=re.native[j],ue=j==="mousemove",xe=this._scope.tool,ke=this;function Te(Be){return re.virtual[Be]||ke.responds(Be)||xe&&xe.responds(Be)}ue&&r&&Te("mousedrag")&&(j="mousedrag"),ee||(ee=this.getEventPoint(Q));var ze=this.getBounds().contains(ee),ge=se&&ze&&ke._project.hitTest(ee,{tolerance:0,fill:!0,stroke:!0}),_e=ge&&ge.item||null,Le=!1,Re={};if(Re[j.substr(5)]=!0,se&&_e!==N&&(N&&K(N,null,"mouseleave",Q,ee),_e&&K(_e,null,"mouseenter",Q,ee),N=_e),V^ze&&(K(this,null,ze?"mouseenter":"mouseleave",Q,ee),Le=!0),(ze||Re.drag)&&!ee.equals(R)&&(X(this,_e,ue?j:"mousemove",Q,ee,R),Le=!0),V=ze,Re.down&&ze||Re.up&&I){if(X(this,_e,j,Q,ee,I),Re.down){if(G=_e===H&&Date.now()-D<300,b=H=_e,!B&&_e){for(var Ne=_e;Ne&&!Ne.responds("mousedrag");)Ne=Ne._parent;Ne&&(U=_e)}I=ee}else Re.up&&(!B&&_e===b&&(D=Date.now(),X(this,_e,G?"doubleclick":"click",Q,ee,I),G=!1),b=U=null);V=!1,Le=!0}R=ee,Le&&xe&&(C=xe._handleMouseEvent(j,Q,ee,Re)||C),Q.cancelable!==!1&&(C&&!Re.move||Re.down&&Te("mouseup"))&&Q.preventDefault()},_handleKeyEvent:function(j,Q,ee,re){var se=this._scope,ue=se.tool,xe;function ke(Te){Te.responds(j)&&(Ye=se,Te.emit(j,xe=xe||new Cn(j,Q,ee,re)))}this.isVisible()&&(ke(this),ue&&ue.responds(j)&&ke(ue))},_countItemEvent:function(j,Q){var ee=this._itemEvents,re=ee.native,se=ee.virtual;for(var ue in $)re[ue]=(re[ue]||0)+($[ue][j]||0)*Q;se[j]=(se[j]||0)+Q},statics:{updateFocus:p,_resetState:function(){r=u=C=V=!1,e=i=I=R=b=N=U=H=D=G=null}}}}),Sn=ht.extend({_class:"CanvasView",initialize:function(i,r){if(!(r instanceof l.HTMLCanvasElement)){var u=Z.read(arguments,1);if(u.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+o.slice(arguments,1));r=pt.getCanvas(u)}var c=this._context=r.getContext("2d");if(c.save(),this._pixelRatio=1,!/^off|false$/.test(v.getAttribute(r,"hidpi"))){var p=l.devicePixelRatio||1,m=at.getPrefixed(c,"backingStorePixelRatio")||1;this._pixelRatio=p/m}ht.call(this,i,r),this._needsUpdate=!0},remove:function e(){return this._context.restore(),e.base.call(this)},_setElementSize:function e(i,r){var u=this._pixelRatio;if(e.base.call(this,i*u,r*u),u!==1){var c=this._element,p=this._context;if(!v.hasAttribute(c,"resize")){var m=c.style;m.width=i+"px",m.height=r+"px"}p.restore(),p.save(),p.scale(u,u)}},getContext:function(){return this._context},getPixelSize:function e(i){var r=Ye.agent,u;if(r&&r.firefox)u=e.base.call(this,i);else{var c=this._context,p=c.font;c.font=i+" serif",u=parseFloat(c.font),c.font=p}return u},getTextWidth:function(e,i){var r=this._context,u=r.font,c=0;r.font=e;for(var p=0,m=i.length;p<m;p++)c=Math.max(c,r.measureText(i[p]).width);return r.font=u,c},update:function(){if(!this._needsUpdate)return!1;var e=this._project,i=this._context,r=this._viewSize;return i.clearRect(0,0,r.width+1,r.height+1),e&&e.draw(i,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),ai=o.extend({_class:"Event",initialize:function(i){this.event=i,this.type=i&&i.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return _i.modifiers}}),Cn=ai.extend({_class:"KeyEvent",initialize:function(i,r,u,c){this.type=i,this.event=r,this.key=u,this.character=c},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),_i=new function(){var e={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},i={tab:"	",space:" ",enter:"\r"},r={},u={},c,p,m=new o({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var x=Ye&&Ye.agent;return x&&x.mac?this.meta:this.control}}});function _(x){var T=x.key||x.keyIdentifier;return T=/^U\+/.test(T)?String.fromCharCode(parseInt(T.substr(2),16)):/^Arrow[A-Z]/.test(T)?T.substr(5):T==="Unidentified"||T===a?String.fromCharCode(x.keyCode):T,e[T]||(T.length>1?o.hyphenate(T):T.toLowerCase())}function y(x,T,M,P){var C=ht._focused,B;if(r[T]=x,x?u[T]=M:delete u[T],T.length>1&&(B=o.camelize(T))in m){m[B]=x;var z=Ye&&Ye.agent;if(B==="meta"&&z&&z.mac)if(x)c={};else{for(var V in c)V in u&&y(!1,V,c[V],P);c=null}}else x&&c&&(c[T]=M);C&&C._handleKeyEvent(x?"keydown":"keyup",P,T,M)}return ut.add(f,{keydown:function(x){var T=_(x),M=Ye&&Ye.agent;T.length>1||M&&M.chrome&&(x.altKey||M.mac&&x.metaKey||!M.mac&&x.ctrlKey)?y(!0,T,i[T]||(T.length>1?"":T),x):p=T},keypress:function(x){if(p){var T=_(x),M=x.charCode,P=M>=32?String.fromCharCode(M):T.length>1?"":T;T!==p&&(T=P.toLowerCase()),y(!0,T,P,x),p=null}},keyup:function(x){var T=_(x);T in u&&y(!1,T,u[T],x)}}),ut.add(l,{blur:function(x){for(var T in u)y(!1,T,u[T],x)}}),{modifiers:m,isDown:function(x){return!!r[x]}}},Pn=ai.extend({_class:"MouseEvent",initialize:function(i,r,u,c,p){this.type=i,this.event=r,this.point=u,this.target=c,this.delta=p},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),$t=ai.extend({_class:"ToolEvent",_item:null,initialize:function(i,r,u){this.tool=i,this.type=r,this.event=u},_choosePoint:function(e,i){return e||(i?i.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(e){this._point=e},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(e){this._lastPoint=e},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(e){this._downPoint=e},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(e){this._middlePoint=e},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(e){this._delta=e},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(e){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=e},getItem:function(){if(!this._item){var e=this.tool._scope.project.hitTest(this.getPoint());if(e){for(var i=e.item,r=i._parent;/^(Group|CompoundPath)$/.test(r._class);)i=r,r=r._parent;this._item=i}}return this._item},setItem:function(e){this._item=e},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),vi=w.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(i){w.call(this),this._moveCount=-1,this._downCount=-1,this.set(i)},getMinDistance:function(){return this._minDistance},setMinDistance:function(e){this._minDistance=e,e!=null&&this._maxDistance!=null&&e>this._maxDistance&&(this._maxDistance=e)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(e){this._maxDistance=e,this._minDistance!=null&&e!=null&&e<this._minDistance&&(this._minDistance=e)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(e){this._minDistance=this._maxDistance=e},_handleMouseEvent:function(e,i,r,u){Ye=this._scope,u.drag&&!this.responds(e)&&(e="mousemove");var c=u.move||u.drag,p=this.responds(e),m=!1,_=this;function y(T,M){var P=r,C=c?_._point:_._downPoint||P;if(c){if(_._moveCount>=0&&P.equals(C))return!1;if(C&&(T!=null||M!=null)){var B=P.subtract(C),z=B.getLength();if(z<(T||0))return!1;M&&(P=C.add(B.normalize(Math.min(z,M))))}_._moveCount++}return _._point=P,_._lastPoint=C||P,u.down&&(_._moveCount=-1,_._downPoint=P,_._downCount++),!0}function x(){p&&(m=_.emit(e,new $t(_,e,i))||m)}if(u.down)y(),x();else if(u.up)y(null,this._maxDistance),x();else if(p)for(;y(this._minDistance,this._maxDistance);)x();return m}}),Mi=o.extend(g,{_class:"Tween",statics:{easings:new o({linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:-1+2*(2-e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}})},initialize:function e(i,r,u,c,p,m){this.object=i;var _=typeof p,y=_==="function";this.type=y?_:_==="string"?p:"linear",this.easing=y?p:e.easings[this.type],this.duration=c,this.running=!1,this._then=null,this._startTime=null;var x=r||u;this._keys=x?Object.keys(x):[],this._parsedKeys=this._parseKeys(this._keys),this._from=x&&this._getState(r),this._to=x&&this._getState(u),m!==!1&&this.start()},then:function(e){return this._then=e,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(e){if(this.running){e>=1&&(e=1,this.running=!1);for(var i=this.easing(e),r=this._keys,u=function(T){return typeof T=="function"?T(i,e):T},c=0,p=r&&r.length;c<p;c++){var m=r[c],_=u(this._from[m]),y=u(this._to[m]),x=_&&y&&_.__add&&y.__add?y.__subtract(_).__multiply(i).__add(_):(y-_)*i+_;this._setProperty(this._parsedKeys[m],x)}this.responds("update")&&this.emit("update",new o({progress:e,factor:i})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(e){var i=this._startTime,r=i?(e-i)/this.duration:0;i||(this._startTime=e),this.update(r)},_getState:function(e){for(var i=this._keys,r={},u=0,c=i.length;u<c;u++){var p=i[u],m=this._parsedKeys[p],_=this._getProperty(m),y;if(e){var x=this._resolveValue(_,e[p]);this._setProperty(m,x),y=this._getProperty(m),y=y&&y.clone?y.clone():y,this._setProperty(m,_)}else y=_&&_.clone?_.clone():_;r[p]=y}return r},_resolveValue:function(e,i){if(i){if(Array.isArray(i)&&i.length===2){var r=i[0];return r&&r.match&&r.match(/^[+\-\*\/]=/)?this._calculate(e,r[0],i[1]):i}else if(typeof i=="string"){var u=i.match(/^[+\-*/]=(.*)/);if(u){var c=JSON.parse(u[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(e,i[0],c)}}}return i},_calculate:function(e,i,r){return Ye.PaperScript.calculateBinary(e,i,r)},_parseKeys:function(e){for(var i={},r=0,u=e.length;r<u;r++){var c=e[r],p=c.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");i[c]=p.split("/")}return i},_getProperty:function(e,i){for(var r=this.object,u=0,c=e.length-(i||0);u<c&&r;u++)r=r[e[u]];return r},_setProperty:function(e,i){var r=this._getProperty(e,1);r&&(r[e[e.length-1]]=i)}}),Li={request:function(e){var i=new s.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,o.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var r=i.status;r===0||r===200?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var r=i.status,u='Could not load "'+e.url+'" (Status: '+r+")";if(e.onError)e.onError(u,r);else throw new Error(u)},i.send(null)}},pt=o.exports.CanvasProvider={canvases:[],getCanvas:function(e,i,r){if(!l)return null;var u,c=!0;typeof e=="object"&&(i=e.height,e=e.width),this.canvases.length?u=this.canvases.pop():(u=f.createElement("canvas"),c=!1);var p=u.getContext("2d",r||{});if(!p)throw new Error("Canvas "+u+" is unable to provide a 2D context.");return u.width===e&&u.height===i?c&&p.clearRect(0,0,e+1,i+1):(u.width=e,u.height=i),p.save(),u},getContext:function(e,i,r){var u=this.getCanvas(e,i,r);return u?u.getContext("2d",r||{}):null},release:function(e){var i=e&&e.canvas?e.canvas:e;i&&i.getContext&&(i.getContext("2d").restore(),this.canvases.push(i))}},yi=new function(){var e=Math.min,i=Math.max,r=Math.abs,u,c,p,m,_,y,x,T,M,P,C;function B(U,H,D){return .2989*U+.587*H+.114*D}function z(U,H,D,X){var K=X-B(U,H,D);M=U+K,P=H+K,C=D+K;var X=B(M,P,C),$=e(M,P,C),j=i(M,P,C);if($<0){var Q=X-$;M=X+(M-X)*X/Q,P=X+(P-X)*X/Q,C=X+(C-X)*X/Q}if(j>255){var ee=255-X,re=j-X;M=X+(M-X)*ee/re,P=X+(P-X)*ee/re,C=X+(C-X)*ee/re}}function V(U,H,D){return i(U,H,D)-e(U,H,D)}function I(U,H,D,G){var K=[U,H,D],X=i(U,H,D),$=e(U,H,D),j;$=$===U?0:$===H?1:2,X=X===U?0:X===H?1:2,j=e($,X)===0?i($,X)===1?2:1:0,K[X]>K[$]?(K[j]=(K[j]-K[$])*G/(K[X]-K[$]),K[X]=G):K[j]=K[X]=0,K[$]=0,M=K[0],P=K[1],C=K[2]}var R={multiply:function(){M=_*u/255,P=y*c/255,C=x*p/255},screen:function(){M=_+u-_*u/255,P=y+c-y*c/255,C=x+p-x*p/255},overlay:function(){M=_<128?2*_*u/255:255-2*(255-_)*(255-u)/255,P=y<128?2*y*c/255:255-2*(255-y)*(255-c)/255,C=x<128?2*x*p/255:255-2*(255-x)*(255-p)/255},"soft-light":function(){var U=u*_/255;M=U+_*(255-(255-_)*(255-u)/255-U)/255,U=c*y/255,P=U+y*(255-(255-y)*(255-c)/255-U)/255,U=p*x/255,C=U+x*(255-(255-x)*(255-p)/255-U)/255},"hard-light":function(){M=u<128?2*u*_/255:255-2*(255-u)*(255-_)/255,P=c<128?2*c*y/255:255-2*(255-c)*(255-y)/255,C=p<128?2*p*x/255:255-2*(255-p)*(255-x)/255},"color-dodge":function(){M=_===0?0:u===255?255:e(255,255*_/(255-u)),P=y===0?0:c===255?255:e(255,255*y/(255-c)),C=x===0?0:p===255?255:e(255,255*x/(255-p))},"color-burn":function(){M=_===255?255:u===0?0:i(0,255-(255-_)*255/u),P=y===255?255:c===0?0:i(0,255-(255-y)*255/c),C=x===255?255:p===0?0:i(0,255-(255-x)*255/p)},darken:function(){M=_<u?_:u,P=y<c?y:c,C=x<p?x:p},lighten:function(){M=_>u?_:u,P=y>c?y:c,C=x>p?x:p},difference:function(){M=_-u,M<0&&(M=-M),P=y-c,P<0&&(P=-P),C=x-p,C<0&&(C=-C)},exclusion:function(){M=_+u*(255-_-_)/255,P=y+c*(255-y-y)/255,C=x+p*(255-x-x)/255},hue:function(){I(u,c,p,V(_,y,x)),z(M,P,C,B(_,y,x))},saturation:function(){I(_,y,x,V(u,c,p)),z(M,P,C,B(_,y,x))},luminosity:function(){z(_,y,x,B(u,c,p))},color:function(){z(u,c,p,B(_,y,x))},add:function(){M=e(_+u,255),P=e(y+c,255),C=e(x+p,255)},subtract:function(){M=i(_-u,0),P=i(y-c,0),C=i(x-p,0)},average:function(){M=(_+u)/2,P=(y+c)/2,C=(x+p)/2},negation:function(){M=255-r(255-u-_),P=255-r(255-c-y),C=255-r(255-p-x)}},b=this.nativeModes=o.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(U){this[U]=!0},{}),N=pt.getContext(1,1,{willReadFrequently:!0});N&&(o.each(R,function(U,H){var D=H==="darken",G=!1;N.save();try{N.fillStyle=D?"#300":"#a00",N.fillRect(0,0,1,1),N.globalCompositeOperation=H,N.globalCompositeOperation===H&&(N.fillStyle=D?"#a00":"#300",N.fillRect(0,0,1,1),G=N.getImageData(0,0,1,1).data[0]!==D?170:51)}catch{}N.restore(),b[H]=G}),pt.release(N)),this.process=function(U,H,D,G,K){var X=H.canvas,$=U==="normal";if($||b[U])D.save(),D.setTransform(1,0,0,1,0,0),D.globalAlpha=G,$||(D.globalCompositeOperation=U),D.drawImage(X,K.x,K.y),D.restore();else{var j=R[U];if(!j)return;for(var Q=D.getImageData(K.x,K.y,X.width,X.height),ee=Q.data,re=H.getImageData(0,0,X.width,X.height).data,se=0,ue=ee.length;se<ue;se+=4){u=re[se],_=ee[se],c=re[se+1],y=ee[se+1],p=re[se+2],x=ee[se+2],m=re[se+3],T=ee[se+3],j();var xe=m*G/255,ke=1-xe;ee[se]=xe*M+ke*_,ee[se+1]=xe*P+ke*y,ee[se+2]=xe*C+ke*x,ee[se+3]=m*G+ke*T}D.putImageData(Q,K.x,K.y)}}},nt=new function(){var e="http://www.w3.org/2000/svg",i="http://www.w3.org/2000/xmlns",r="http://www.w3.org/1999/xlink",u={href:r,xlink:i,xmlns:i+"/","xmlns:xlink":i+"/"};function c(_,y,x){return m(f.createElementNS(e,_),y,x)}function p(_,y){var x=u[y],T=x?_.getAttributeNS(x,y):_.getAttribute(y);return T==="null"?null:T}function m(_,y,x){for(var T in y){var M=y[T],P=u[T];typeof M=="number"&&x&&(M=x.number(M)),P?_.setAttributeNS(P,T,M):_.setAttribute(T,M)}return _}return{svg:e,xmlns:i,xlink:r,create:c,get:p,set:m}},Wi=o.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(e,i){return!i&&(e instanceof st||e instanceof me||e instanceof Xt)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(e,i){var r=o.capitalize(i),u=e[2];this[i]={type:e[1],property:i,attribute:e[0],toSVG:u,fromSVG:u&&o.each(u,function(c,p){this[c]=p},{}),exportFilter:e[3],get:"get"+r,set:"set"+r}},{});new function(){var e;function i(R,b,N){var U=new o,H=R.getTranslation();if(b){var D;R.isInvertible()?(R=R._shiftless(),D=R._inverseTransform(H),H=null):D=new L,U[N?"cx":"x"]=D.x,U[N?"cy":"y"]=D.y}if(!R.isIdentity()){var G=R.decompose();if(G){var K=[],X=G.rotation,$=G.scaling,j=G.skewing;H&&!H.isZero()&&K.push("translate("+e.point(H)+")"),X&&K.push("rotate("+e.number(X)+")"),(!k.isZero($.x-1)||!k.isZero($.y-1))&&K.push("scale("+e.point($)+")"),j.x&&K.push("skewX("+e.number(j.x)+")"),j.y&&K.push("skewY("+e.number(j.y)+")"),U.transform=K.join(" ")}else U.transform="matrix("+R.getValues().join(",")+")"}return U}function r(R,b){for(var N=i(R._matrix),U=R._children,H=nt.create("g",N,e),D=0,G=U.length;D<G;D++){var K=U[D],X=V(K,b);if(X)if(K.isClipMask()){var $=nt.create("clipPath");$.appendChild(X),B(K,$,"clip"),nt.set(H,{"clip-path":"url(#"+$.id+")"})}else H.appendChild(X)}return H}function u(R,b){var N=i(R._matrix,!0),U=R.getSize(),H=R.getImage();return N.x-=U.width/2,N.y-=U.height/2,N.width=U.width,N.height=U.height,N.href=b.embedImages==!1&&H&&H.src||R.toDataURL(),nt.create("image",N,e)}function c(R,b){var N=b.matchShapes;if(N){var U=R.toShape(!1);if(U)return p(U)}var H=R._segments,D=H.length,G,K=i(R._matrix);if(N&&D>=2&&!R.hasHandles())if(D>2){G=R._closed?"polygon":"polyline";for(var X=[],$=0;$<D;$++)X.push(e.point(H[$]._point));K.points=X.join(" ")}else{G="line";var j=H[0]._point,Q=H[1]._point;K.set({x1:j.x,y1:j.y,x2:Q.x,y2:Q.y})}else G="path",K.d=R.getPathData(null,b.precision);return nt.create(G,K,e)}function p(R){var b=R._type,N=R._radius,U=i(R._matrix,!0,b!=="rectangle");if(b==="rectangle"){b="rect";var H=R._size,D=H.width,G=H.height;U.x-=D/2,U.y-=G/2,U.width=D,U.height=G,N.isZero()&&(N=null)}return N&&(b==="circle"?U.r=N:(U.rx=N.width,U.ry=N.height)),nt.create(b,U,e)}function m(R,b){var N=i(R._matrix),U=R.getPathData(null,b.precision);return U&&(N.d=U),nt.create("path",N,e)}function _(R,b){var N=i(R._matrix,!0),U=R._definition,H=C(U,"symbol"),D=U._item,G=D.getStrokeBounds();return H||(H=nt.create("symbol",{viewBox:e.rectangle(G)}),H.appendChild(V(D,b)),B(U,H,"symbol")),N.href="#"+H.id,N.x+=G.x,N.y+=G.y,N.width=G.width,N.height=G.height,N.overflow="visible",nt.create("use",N,e)}function y(R){var b=C(R,"color");if(!b){var N=R.getGradient(),U=N._radial,H=R.getOrigin(),D=R.getDestination(),G;if(U){G={cx:H.x,cy:H.y,r:H.getDistance(D)};var K=R.getHighlight();K&&(G.fx=K.x,G.fy=K.y)}else G={x1:H.x,y1:H.y,x2:D.x,y2:D.y};G.gradientUnits="userSpaceOnUse",b=nt.create((U?"radial":"linear")+"Gradient",G,e);for(var X=N._stops,$=0,j=X.length;$<j;$++){var Q=X[$],ee=Q._color,re=ee.getAlpha(),se=Q._offset;G={offset:se??$/(j-1)},ee&&(G["stop-color"]=ee.toCSS(!0)),re<1&&(G["stop-opacity"]=re),b.appendChild(nt.create("stop",G,e))}B(R,b,"color")}return"url(#"+b.id+")"}function x(R){var b=nt.create("text",i(R._matrix,!0),e);return b.textContent=R._content,b}var T={Group:r,Layer:r,Raster:u,Path:c,Shape:p,CompoundPath:m,SymbolItem:_,PointText:x};function M(R,b,N,U){var H={},D=!U&&R.getParent(),G=[];return R._name!=null&&(H.id=R._name),o.each(Wi,function(K){var X=K.get,$=K.type,j=R[X]();if(K.exportFilter?K.exportFilter(R,j):N.reduceAttributes==!1||!D||!o.equals(D[X](),j)){if($==="color"&&j!=null){var Q=j.getAlpha();Q<1&&(H[K.attribute+"-opacity"]=Q)}$==="style"?G.push(K.attribute+": "+j):H[K.attribute]=j==null?"none":$==="color"?j.gradient?y(j):j.toCSS(!0):$==="array"?j.join(","):$==="lookup"?K.toSVG[j]:j}}),G.length&&(H.style=G.join(";")),H.opacity===1&&delete H.opacity,R._visible||(H.visibility="hidden"),nt.set(b,H,e)}var P;function C(R,b){return P||(P={ids:{},svgs:{}}),R&&P.svgs[b+"-"+(R._id||R.__id||(R.__id=q.get("svg")))]}function B(R,b,N){P||C();var U=P.ids[N]=(P.ids[N]||0)+1;b.id=N+"-"+U,P.svgs[N+"-"+(R._id||R.__id)]=b}function z(R,b){var N=R,U=null;if(P){N=R.nodeName.toLowerCase()==="svg"&&R;for(var H in P.svgs)U||(N||(N=nt.create("svg"),N.appendChild(R)),U=N.insertBefore(nt.create("defs"),N.firstChild)),U.appendChild(P.svgs[H]);P=null}return b.asString?new s.XMLSerializer().serializeToString(N):N}function V(R,b,N){var U=T[R._class],H=U&&U(R,b);if(H){var D=b.onExport;D&&(H=D(R,H,b)||H);var G=JSON.stringify(R._data);G&&G!=="{}"&&G!=="null"&&H.setAttribute("data-paper-data",G)}return H&&M(R,H,b,N)}function I(R){return R||(R={}),e=new E(R.precision),R}O.inject({exportSVG:function(R){return R=I(R),z(V(this,R,!0),R)}}),he.inject({exportSVG:function(R){R=I(R);var b=this._children,N=this.getView(),U=o.pick(R.bounds,"view"),H=R.matrix||U==="view"&&N._matrix,D=H&&ce.read([H]),G=U==="view"?new J([0,0],N.getViewSize()):U==="content"?O._getBounds(b,D,{stroke:!0}).rect:J.read([U],0,{readNull:!0}),K={version:"1.1",xmlns:nt.svg,"xmlns:xlink":nt.xlink};G&&(K.width=G.width,K.height=G.height,(G.x||G.x===0||G.y||G.y===0)&&(K.viewBox=e.rectangle(G)));var X=nt.create("svg",K,e),$=X;D&&!D.isIdentity()&&($=X.appendChild(nt.create("g",i(D),e)));for(var j=0,Q=b.length;j<Q;j++)$.appendChild(V(b[j],R,!0));return z(X,R)}})},new function(){var e={},i;function r(b,N,U,H,D,G){var K=nt.get(b,N)||G,X=K==null?H?null:U?"":0:U?K:parseFloat(K);return/%\s*$/.test(K)?X/100*(D?1:i[/x|^width/.test(N)?"width":"height"]):X}function u(b,N,U,H,D,G,K){return N=r(b,N||"x",!1,H,D,G),U=r(b,U||"y",!1,H,D,K),H&&(N==null||U==null)?null:new L(N,U)}function c(b,N,U,H,D){return N=r(b,N||"width",!1,H,D),U=r(b,U||"height",!1,H,D),H&&(N==null||U==null)?null:new Z(N,U)}function p(b,N,U){return b==="none"?null:N==="number"?parseFloat(b):N==="array"?b?b.split(/[\s,]+/g).map(parseFloat):[]:N==="color"?V(b)||b:N==="lookup"?U[b]:b}function m(b,N,U,H){var D=b.childNodes,G=N==="clippath",K=N==="defs",X=new ye,$=X._project,j=$._currentStyle,Q=[];if(!G&&!K&&(X=z(X,b,H),$._currentStyle=X._style.clone()),H)for(var ee=b.querySelectorAll("defs"),re=0,se=ee.length;re<se;re++)I(ee[re],U,!1);for(var re=0,se=D.length;re<se;re++){var ue=D[re],xe;ue.nodeType===1&&!/^defs$/i.test(ue.nodeName)&&(xe=I(ue,U,!1))&&!(xe instanceof Pe)&&Q.push(xe)}return X.addChildren(Q),G&&(X=z(X.reduce(),b,H)),$._currentStyle=j,(G||K)&&(X.remove(),X=null),X}function _(b,N){for(var U=b.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),H=[],D=0,G=U.length;D<G;D+=2)H.push(new L(parseFloat(U[D]),parseFloat(U[D+1])));var K=new Ve(H);return N==="polygon"&&K.closePath(),K}function y(b){return st.create(b.getAttribute("d"))}function x(b,N){var U=(r(b,"href",!0)||"").substring(1),H=N==="radialgradient",D;if(U)D=e[U].getGradient(),D._radial^H&&(D=D.clone(),D._radial=H);else{for(var G=b.childNodes,K=[],X=0,$=G.length;X<$;X++){var j=G[X];j.nodeType===1&&K.push(z(new Gi,j))}D=new mi(K,H)}var Q,ee,re,se=r(b,"gradientUnits",!0)!=="userSpaceOnUse";H?(Q=u(b,"cx","cy",!1,se,"50%","50%"),ee=Q.add(r(b,"r",!1,!1,se,"50%"),0),re=u(b,"fx","fy",!0,se)):(Q=u(b,"x1","y1",!1,se,"0%","0%"),ee=u(b,"x2","y2",!1,se,"100%","0%"));var ue=z(new dt(D,Q,ee,re),b);return ue._scaleToBounds=se,null}var T={"#document":function(b,N,U,H){for(var D=b.childNodes,G=0,K=D.length;G<K;G++){var X=D[G];if(X.nodeType===1)return I(X,U,H)}},g:m,svg:m,clippath:m,polygon:_,polyline:_,path:y,lineargradient:x,radialgradient:x,image:function(b){var N=new Ee(r(b,"href",!0));return N.on("load",function(){var U=c(b);this.setSize(U);var H=u(b).add(U.divide(2));this._matrix.append(new ce().translate(H))}),N},symbol:function(b,N,U,H){return new Pe(m(b,N,U,H),!0)},defs:m,use:function(b){var N=(r(b,"href",!0)||"").substring(1),U=e[N],H=u(b);return U?U instanceof Pe?U.place(H):U.clone().translate(H):null},circle:function(b){return new me.Circle(u(b,"cx","cy"),r(b,"r"))},ellipse:function(b){return new me.Ellipse({center:u(b,"cx","cy"),radius:c(b,"rx","ry")})},rect:function(b){return new me.Rectangle(new J(u(b),c(b)),c(b,"rx","ry"))},line:function(b){return new Ve.Line(u(b,"x1","y1"),u(b,"x2","y2"))},text:function(b){var N=new Hi(u(b).add(u(b,"dx","dy")));return N.setContent(b.textContent.trim()||""),N},switch:m};function M(b,N,U,H){if(b.transform){for(var D=(H.getAttribute(U)||"").split(/\)\s*/g),G=new ce,K=0,X=D.length;K<X;K++){var $=D[K];if(!$)break;for(var j=$.split(/\(\s*/),Q=j[0].trim(),ee=j[1].split(/[\s,]+/g),re=0,se=ee.length;re<se;re++)ee[re]=parseFloat(ee[re]);switch(Q){case"matrix":G.append(new ce(ee[0],ee[1],ee[2],ee[3],ee[4],ee[5]));break;case"rotate":G.rotate(ee[0],ee[1]||0,ee[2]||0);break;case"translate":G.translate(ee[0],ee[1]||0);break;case"scale":G.scale(ee);break;case"skewX":G.skew(ee[0],0);break;case"skewY":G.skew(0,ee[0]);break}}b.transform(G)}}function P(b,N,U){var H=U==="fill-opacity"?"getFillColor":"getStrokeColor",D=b[H]&&b[H]();D&&D.setAlpha(parseFloat(N))}var C=o.set(o.each(Wi,function(b){this[b.attribute]=function(N,U){if(N[b.set]&&(N[b.set](p(U,b.type,b.fromSVG)),b.type==="color")){var H=N[b.get]();if(H&&H._scaleToBounds){var D=N.getBounds();H.transform(new ce().translate(D.getPoint()).scale(D.getSize()))}}}},{}),{id:function(b,N){e[N]=b,b.setName&&b.setName(N)},"clip-path":function(b,N){var U=V(N);if(U)if(U=U.clone(),U.setClipMask(!0),b instanceof ye)b.insertChild(0,U);else return new ye(U,b)},gradientTransform:M,transform:M,"fill-opacity":P,"stroke-opacity":P,visibility:function(b,N){b.setVisible&&b.setVisible(N==="visible")},display:function(b,N){b.setVisible&&b.setVisible(N!==null)},"stop-color":function(b,N){b.setColor&&b.setColor(N)},"stop-opacity":function(b,N){b._color&&b._color.setAlpha(parseFloat(N))},offset:function(b,N){if(b.setOffset){var U=N.match(/(.*)%$/);b.setOffset(U?U[1]/100:parseFloat(N))}},viewBox:function(b,N,U,H,D){var G=new J(p(N,"array")),K=c(H,null,null,!0),X,$;if(b instanceof ye){var j=K?K.divide(G.getSize()):1,$=new ce().scale(j).translate(G.getPoint().negate());X=b}else b instanceof Pe&&(K&&G.setSize(K),X=b._item);if(X){if(B(H,"overflow",D)!=="visible"){var Q=new me.Rectangle(G);Q.setClipMask(!0),X.addChild(Q)}$&&X.transform($)}}});function B(b,N,U){var H=b.attributes[N],D=H&&H.value;if(!D&&b.style){var G=o.camelize(N);D=b.style[G],!D&&U.node[G]!==U.parent[G]&&(D=U.node[G])}return D?D==="none"?null:D:a}function z(b,N,U){var H=N.parentNode,D={node:at.getStyles(N)||{},parent:!U&&!/^defs$/i.test(H.tagName)&&at.getStyles(H)||{}};return o.each(C,function(G,K){var X=B(N,K,D);b=X!==a&&G(b,X,K,N,D)||b}),b}function V(b){var N=b&&b.match(/\((?:["'#]*)([^"')]+)/),U=N&&N[1],H=U&&e[l?U.replace(l.location.href.split("#")[0]+"#",""):U];return H&&H._scaleToBounds&&(H=H.clone(),H._scaleToBounds=!0),H}function I(b,N,U){var H=b.nodeName.toLowerCase(),D=H!=="#document",G=f.body,K,X,$;U&&D&&(i=Ye.getView().getSize(),i=c(b,null,null,!0)||i,K=nt.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),X=b.parentNode,$=b.nextSibling,K.appendChild(b),G.appendChild(K));var j=Ye.settings,Q=j.applyMatrix,ee=j.insertItems;j.applyMatrix=!1,j.insertItems=!1;var re=T[H],se=re&&re(b,H,N,U)||null;if(j.insertItems=ee,j.applyMatrix=Q,se){D&&!(se instanceof ye)&&(se=z(se,b,U));var ue=N.onImport,xe=D&&b.getAttribute("data-paper-data");ue&&(se=ue(b,se,N)||se),N.expandShapes&&se instanceof me&&(se.remove(),se=se.toPath()),xe&&(se._data=JSON.parse(xe))}return K&&(G.removeChild(K),X&&($?X.insertBefore(b,$):X.appendChild(b))),U&&(e={},se&&o.pick(N.applyMatrix,Q)&&se.matrix.apply(!0,!0)),se}function R(b,N,U){if(!b)return null;N=typeof N=="function"?{onLoad:N}:N||{};var H=Ye,D=null;function G(j){try{var Q=typeof j=="object"?j:new s.DOMParser().parseFromString(j.trim(),"image/svg+xml");if(!Q.nodeName)throw Q=null,new Error("Unsupported SVG source: "+b);Ye=H,D=I(Q,N,!0),(!N||N.insert!==!1)&&U._insertItem(a,D);var ee=N.onLoad;ee&&ee(D,j)}catch(re){K(re)}}function K(j,Q){var ee=N.onError;if(ee)ee(j,Q);else throw new Error(j)}if(typeof b=="string"&&!/^[\s\S]*</.test(b)){var X=f.getElementById(b);X?G(X):Li.request({url:b,async:!0,onLoad:G,onError:K})}else if(typeof File<"u"&&b instanceof File){var $=new FileReader;return $.onload=function(){G($.result)},$.onerror=function(){K($.error)},$.readAsText(b)}else G(b);return D}O.inject({importSVG:function(b,N){return R(b,N,this)}}),he.inject({importSVG:function(b,N){return this.activate(),R(b,N,this)}})},o.exports.PaperScript=(function(){var e=this,i=e.acorn;if(!i&&typeof Ju<"u")try{i=nh()}catch{}if(!i){var r,u;i=r=u={},(function(z,V){if(typeof r=="object"&&typeof u=="object")return V(r);if(typeof a=="function"&&a.amd)return a(["exports"],V);V(z.acorn||(z.acorn={}))})(this,function(z){z.version="0.5.0";var V,I,R,b;z.parse=function(Y,ie){return I=String(Y),R=I.length,U(ie),Xr(),Ma(V.program)};var N=z.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function U(Y){V=Y||{};for(var ie in N)Object.prototype.hasOwnProperty.call(V,ie)||(V[ie]=N[ie]);b=V.sourceFile||null}var H=z.getLineInfo=function(Y,ie){for(var fe=1,ve=0;;){zi.lastIndex=ve;var qe=zi.exec(Y);if(qe&&qe.index<ie)++fe,ve=qe.index+qe[0].length;else break}return{line:fe,column:ie-ve}};z.tokenize=function(Y,ie){I=String(Y),R=I.length,U(ie),Xr();var fe={};function ve(qe){return xe=K,Ci(qe),fe.start=G,fe.end=K,fe.startLoc=X,fe.endLoc=$,fe.type=j,fe.value=Q,fe}return ve.jumpTo=function(qe,je){if(D=qe,V.locations){re=1,se=zi.lastIndex=0;for(var Ze;(Ze=zi.exec(I))&&Ze.index<qe;)++re,se=Ze.index+Ze[0].length}ee=je,Ni()},ve};var D,G,K,X,$,j,Q,ee,re,se,ue,xe,ke,Te,ze,ge;function _e(Y,ie){var fe=H(I,Y);ie+=" ("+fe.line+":"+fe.column+")";var ve=new SyntaxError(ie);throw ve.pos=Y,ve.loc=fe,ve.raisedAt=D,ve}var Le=[],Re={type:"num"},Ne={type:"regexp"},Be={type:"string"},Fe={type:"name"},Ge={type:"eof"},Ke={keyword:"break"},Ue={keyword:"case",beforeExpr:!0},vt={keyword:"catch"},gt={keyword:"continue"},bt={keyword:"debugger"},mt={keyword:"default"},Ie={keyword:"do",isLoop:!0},lt={keyword:"else",beforeExpr:!0},ct={keyword:"finally"},yt={keyword:"for",isLoop:!0},Nt={keyword:"function"},Gt={keyword:"if"},Rt={keyword:"return",beforeExpr:!0},Dt={keyword:"switch"},kt={keyword:"throw",beforeExpr:!0},Lt={keyword:"try"},jt={keyword:"var"},xt={keyword:"while",isLoop:!0},It={keyword:"with"},kn={keyword:"new",beforeExpr:!0},Zi={keyword:"this"},In={keyword:"null",atomValue:null},En={keyword:"true",atomValue:!0},An={keyword:"false",atomValue:!1},Oi={keyword:"in",binop:7,beforeExpr:!0},oi={break:Ke,case:Ue,catch:vt,continue:gt,debugger:bt,default:mt,do:Ie,else:lt,finally:ct,for:yt,function:Nt,if:Gt,return:Rt,switch:Dt,throw:kt,try:Lt,var:jt,while:xt,with:It,null:In,true:En,false:An,new:kn,in:Oi,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:Zi,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},xi={type:"[",beforeExpr:!0},bi={type:"]"},Jt={type:"{",beforeExpr:!0},Ut={type:"}"},We={type:"(",beforeExpr:!0},Vt={type:")"},qt={type:",",beforeExpr:!0},Ft={type:";",beforeExpr:!0},ei={type:":",beforeExpr:!0},Ki={type:"."},Xi={type:"?",beforeExpr:!0},Yi={binop:10,beforeExpr:!0},n={isAssign:!0,beforeExpr:!0},d={isAssign:!0,beforeExpr:!0},A={postfix:!0,prefix:!0,isUpdate:!0},F={prefix:!0,beforeExpr:!0},W={binop:1,beforeExpr:!0},ae={binop:2,beforeExpr:!0},le={binop:3,beforeExpr:!0},Ce={binop:4,beforeExpr:!0},Oe={binop:5,beforeExpr:!0},He={binop:6,beforeExpr:!0},Qe={binop:7,beforeExpr:!0},ot={binop:8,beforeExpr:!0},St={binop:9,prefix:!0,beforeExpr:!0},wi={binop:10,beforeExpr:!0};z.tokTypes={bracketL:xi,bracketR:bi,braceL:Jt,braceR:Ut,parenL:We,parenR:Vt,comma:qt,semi:Ft,colon:ei,dot:Ki,question:Xi,slash:Yi,eq:n,name:Fe,eof:Ge,num:Re,regexp:Ne,string:Be};for(var ti in oi)z.tokTypes["_"+ti]=oi[ti];function Yt(Y){Y=Y.split(" ");var ie="",fe=[];e:for(var ve=0;ve<Y.length;++ve){for(var qe=0;qe<fe.length;++qe)if(fe[qe][0].length==Y[ve].length){fe[qe].push(Y[ve]);continue e}fe.push([Y[ve]])}function je(rt){if(rt.length==1)return ie+="return str === "+JSON.stringify(rt[0])+";";ie+="switch(str){";for(var Zt=0;Zt<rt.length;++Zt)ie+="case "+JSON.stringify(rt[Zt])+":";ie+="return true}return false;"}if(fe.length>3){fe.sort(function(rt,Zt){return Zt.length-rt.length}),ie+="switch(str.length){";for(var ve=0;ve<fe.length;++ve){var Ze=fe[ve];ie+="case "+Ze[0].length+":",je(Ze)}ie+="}"}else je(Y);return new Function("str",ie)}var ui=Yt("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),hi=Yt("class enum extends super const export import"),jr=Yt("implements interface let package private protected public static yield"),Tn=Yt("eval arguments"),ga=Yt("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),ma=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Wr="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",_a="------------------------------------------------------------------------------------------------------------------------------------------",Zr=new RegExp("["+Wr+"]"),va=new RegExp("["+Wr+_a+"]"),Mn=/[\n\r\u2028\u2029]/,zi=/\r\n|[\n\r\u2028\u2029]/g,Ln=z.isIdentifierStart=function(Y){return Y<65?Y===36:Y<91?!0:Y<97?Y===95:Y<123?!0:Y>=170&&Zr.test(String.fromCharCode(Y))},Kr=z.isIdentifierChar=function(Y){return Y<48?Y===36:Y<58?!0:Y<65?!1:Y<91?!0:Y<97?Y===95:Y<123?!0:Y>=170&&va.test(String.fromCharCode(Y))};function Si(){this.line=re,this.column=D-se}function Xr(){re=1,D=se=0,ee=!0,Ni()}function Ct(Y,ie){K=D,V.locations&&($=new Si),j=Y,Ni(),Q=ie,ee=Y.beforeExpr}function ya(){var Y=V.onComment&&V.locations&&new Si,ie=D,fe=I.indexOf("*/",D+=2);if(fe===-1&&_e(D-2,"Unterminated comment"),D=fe+2,V.locations){zi.lastIndex=ie;for(var ve;(ve=zi.exec(I))&&ve.index<D;)++re,se=ve.index+ve[0].length}V.onComment&&V.onComment(!0,I.slice(ie+2,fe),ie,D,Y,V.locations&&new Si)}function er(){for(var Y=D,ie=V.onComment&&V.locations&&new Si,fe=I.charCodeAt(D+=2);D<R&&fe!==10&&fe!==13&&fe!==8232&&fe!==8233;)++D,fe=I.charCodeAt(D);V.onComment&&V.onComment(!1,I.slice(Y+2,D),Y,D,ie,V.locations&&new Si)}function Ni(){for(;D<R;){var Y=I.charCodeAt(D);if(Y===32)++D;else if(Y===13){++D;var ie=I.charCodeAt(D);ie===10&&++D,V.locations&&(++re,se=D)}else if(Y===10||Y===8232||Y===8233)++D,V.locations&&(++re,se=D);else if(Y>8&&Y<14)++D;else if(Y===47){var ie=I.charCodeAt(D+1);if(ie===42)ya();else if(ie===47)er();else break}else if(Y===160)++D;else if(Y>=5760&&ma.test(String.fromCharCode(Y)))++D;else break}}function xa(){var Y=I.charCodeAt(D+1);return Y>=48&&Y<=57?Qr(!0):(++D,Ct(Ki))}function ba(){var Y=I.charCodeAt(D+1);return ee?(++D,Yr()):Y===61?Pt(d,2):Pt(Yi,1)}function wa(){var Y=I.charCodeAt(D+1);return Y===61?Pt(d,2):Pt(wi,1)}function Sa(Y){var ie=I.charCodeAt(D+1);return ie===Y?Pt(Y===124?W:ae,2):ie===61?Pt(d,2):Pt(Y===124?le:Oe,1)}function Ca(){var Y=I.charCodeAt(D+1);return Y===61?Pt(d,2):Pt(Ce,1)}function Pa(Y){var ie=I.charCodeAt(D+1);return ie===Y?ie==45&&I.charCodeAt(D+2)==62&&Mn.test(I.slice(xe,D))?(D+=3,er(),Ni(),Ci()):Pt(A,2):ie===61?Pt(d,2):Pt(St,1)}function ka(Y){var ie=I.charCodeAt(D+1),fe=1;return ie===Y?(fe=Y===62&&I.charCodeAt(D+2)===62?3:2,I.charCodeAt(D+fe)===61?Pt(d,fe+1):Pt(ot,fe)):ie==33&&Y==60&&I.charCodeAt(D+2)==45&&I.charCodeAt(D+3)==45?(D+=4,er(),Ni(),Ci()):(ie===61&&(fe=I.charCodeAt(D+2)===61?3:2),Pt(Qe,fe))}function Ia(Y){var ie=I.charCodeAt(D+1);return ie===61?Pt(He,I.charCodeAt(D+2)===61?3:2):Pt(Y===61?n:F,1)}function Ea(Y){switch(Y){case 46:return xa();case 40:return++D,Ct(We);case 41:return++D,Ct(Vt);case 59:return++D,Ct(Ft);case 44:return++D,Ct(qt);case 91:return++D,Ct(xi);case 93:return++D,Ct(bi);case 123:return++D,Ct(Jt);case 125:return++D,Ct(Ut);case 58:return++D,Ct(ei);case 63:return++D,Ct(Xi);case 48:var ie=I.charCodeAt(D+1);if(ie===120||ie===88)return Aa();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return Qr(!1);case 34:case 39:return Ta(Y);case 47:return ba();case 37:case 42:return wa();case 124:case 38:return Sa(Y);case 94:return Ca();case 43:case 45:return Pa(Y);case 60:case 62:return ka(Y);case 61:case 33:return Ia(Y);case 126:return Pt(F,1)}return!1}function Ci(Y){if(Y?D=G+1:G=D,V.locations&&(X=new Si),Y)return Yr();if(D>=R)return Ct(Ge);var ie=I.charCodeAt(D);if(Ln(ie)||ie===92)return Jr();var fe=Ea(ie);if(fe===!1){var ve=String.fromCharCode(ie);if(ve==="\\"||Zr.test(ve))return Jr();_e(D,"Unexpected character '"+ve+"'")}return fe}function Pt(Y,ie){var fe=I.slice(D,D+ie);D+=ie,Ct(Y,fe)}function Yr(){for(var qe="",Y,ie,fe=D;;){D>=R&&_e(fe,"Unterminated regular expression");var ve=I.charAt(D);if(Mn.test(ve)&&_e(fe,"Unterminated regular expression"),Y)Y=!1;else{if(ve==="[")ie=!0;else if(ve==="]"&&ie)ie=!1;else if(ve==="/"&&!ie)break;Y=ve==="\\"}++D}var qe=I.slice(fe,D);++D;var je=$r();je&&!/^[gmsiy]*$/.test(je)&&_e(fe,"Invalid regexp flag");try{var Ze=new RegExp(qe,je)}catch(rt){rt instanceof SyntaxError&&_e(fe,rt.message),_e(rt)}return Ct(Ne,Ze)}function Qi(Y,ie){for(var fe=D,ve=0,qe=0,je=ie??1/0;qe<je;++qe){var Ze=I.charCodeAt(D),rt;if(Ze>=97?rt=Ze-97+10:Ze>=65?rt=Ze-65+10:Ze>=48&&Ze<=57?rt=Ze-48:rt=1/0,rt>=Y)break;++D,ve=ve*Y+rt}return D===fe||ie!=null&&D-fe!==ie?null:ve}function Aa(){D+=2;var Y=Qi(16);return Y==null&&_e(G+2,"Expected hexadecimal number"),Ln(I.charCodeAt(D))&&_e(D,"Identifier directly after number"),Ct(Re,Y)}function Qr(Y){var ie=D,fe=!1,ve=I.charCodeAt(D)===48;!Y&&Qi(10)===null&&_e(ie,"Invalid number"),I.charCodeAt(D)===46&&(++D,Qi(10),fe=!0);var qe=I.charCodeAt(D);(qe===69||qe===101)&&(qe=I.charCodeAt(++D),(qe===43||qe===45)&&++D,Qi(10)===null&&_e(ie,"Invalid number"),fe=!0),Ln(I.charCodeAt(D))&&_e(D,"Identifier directly after number");var je=I.slice(ie,D),Ze;return fe?Ze=parseFloat(je):!ve||je.length===1?Ze=parseInt(je,10):/[89]/.test(je)||ge?_e(ie,"Invalid number"):Ze=parseInt(je,8),Ct(Re,Ze)}function Ta(Y){D++;for(var ie="";;){D>=R&&_e(G,"Unterminated string constant");var fe=I.charCodeAt(D);if(fe===Y)return++D,Ct(Be,ie);if(fe===92){fe=I.charCodeAt(++D);var ve=/^[0-7]+/.exec(I.slice(D,D+3));for(ve&&(ve=ve[0]);ve&&parseInt(ve,8)>255;)ve=ve.slice(0,-1);if(ve==="0"&&(ve=null),++D,ve)ge&&_e(D-2,"Octal literal in strict mode"),ie+=String.fromCharCode(parseInt(ve,8)),D+=ve.length-1;else switch(fe){case 110:ie+=`
`;break;case 114:ie+="\r";break;case 120:ie+=String.fromCharCode(On(2));break;case 117:ie+=String.fromCharCode(On(4));break;case 85:ie+=String.fromCharCode(On(8));break;case 116:ie+="	";break;case 98:ie+="\b";break;case 118:ie+="\v";break;case 102:ie+="\f";break;case 48:ie+="\0";break;case 13:I.charCodeAt(D)===10&&++D;case 10:V.locations&&(se=D,++re);break;default:ie+=String.fromCharCode(fe);break}}else(fe===13||fe===10||fe===8232||fe===8233)&&_e(G,"Unterminated string constant"),ie+=String.fromCharCode(fe),++D}}function On(Y){var ie=Qi(16,Y);return ie===null&&_e(G,"Bad character escape sequence"),ie}var Ri;function $r(){Ri=!1;for(var Y,ie=!0,fe=D;;){var ve=I.charCodeAt(D);if(Kr(ve))Ri&&(Y+=I.charAt(D)),++D;else if(ve===92){Ri||(Y=I.slice(fe,D)),Ri=!0,I.charCodeAt(++D)!=117&&_e(D,"Expecting Unicode escape sequence \\uXXXX"),++D;var qe=On(4),je=String.fromCharCode(qe);je||_e(D-1,"Invalid Unicode escape"),(ie?Ln(qe):Kr(qe))||_e(D-4,"Invalid Unicode escape"),Y+=je}else break;ie=!1}return Ri?Y:I.slice(fe,D)}function Jr(){var Y=$r(),ie=Fe;return!Ri&&ga(Y)&&(ie=oi[Y]),Ct(ie,Y)}function tt(){ue=G,xe=K,ke=$,Ci()}function tr(Y){if(ge=Y,D=G,V.locations)for(;D<se;)se=I.lastIndexOf(`
`,se-2)+1,--re;Ni(),Ci()}function es(){this.type=null,this.start=G,this.end=null}function ts(){this.start=X,this.end=null,b!==null&&(this.source=b)}function Et(){var Y=new es;return V.locations&&(Y.loc=new ts),V.directSourceFile&&(Y.sourceFile=V.directSourceFile),V.ranges&&(Y.range=[G,0]),Y}function li(Y){var ie=new es;return ie.start=Y.start,V.locations&&(ie.loc=new ts,ie.loc.start=Y.loc.start),V.ranges&&(ie.range=[Y.range[0],0]),ie}function $e(Y,ie){return Y.type=ie,Y.end=xe,V.locations&&(Y.loc.end=ke),V.ranges&&(Y.range[1]=xe),Y}function ir(Y){return V.ecmaVersion>=5&&Y.type==="ExpressionStatement"&&Y.expression.type==="Literal"&&Y.expression.value==="use strict"}function _t(Y){if(j===Y)return tt(),!0}function zn(){return!V.strictSemicolons&&(j===Ge||j===Ut||Mn.test(I.slice(xe,G)))}function Pi(){!_t(Ft)&&!zn()&&ii()}function wt(Y){j===Y?tt():ii()}function ii(){_e(G,"Unexpected token")}function Nn(Y){Y.type!=="Identifier"&&Y.type!=="MemberExpression"&&_e(Y.start,"Assigning to rvalue"),ge&&Y.type==="Identifier"&&Tn(Y.name)&&_e(Y.start,"Assigning to "+Y.name+" in strict mode")}function Ma(Y){ue=xe=D,V.locations&&(ke=new Si),Te=ge=null,ze=[],Ci();var ie=Y||Et(),fe=!0;for(Y||(ie.body=[]);j!==Ge;){var ve=Wt();ie.body.push(ve),fe&&ir(ve)&&tr(!0),fe=!1}return $e(ie,"Program")}var nr={kind:"loop"},La={kind:"switch"};function Wt(){(j===Yi||j===d&&Q=="/=")&&Ci(!0);var Y=j,ie=Et();switch(Y){case Ke:case gt:tt();var fe=Y===Ke;_t(Ft)||zn()?ie.label=null:j!==Fe?ii():(ie.label=ci(),Pi());for(var ve=0;ve<ze.length;++ve){var qe=ze[ve];if((ie.label==null||qe.name===ie.label.name)&&(qe.kind!=null&&(fe||qe.kind==="loop")||ie.label&&fe))break}return ve===ze.length&&_e(ie.start,"Unsyntactic "+Y.keyword),$e(ie,fe?"BreakStatement":"ContinueStatement");case bt:return tt(),Pi(),$e(ie,"DebuggerStatement");case Ie:return tt(),ze.push(nr),ie.body=Wt(),ze.pop(),wt(xt),ie.test=$i(),Pi(),$e(ie,"DoWhileStatement");case yt:if(tt(),ze.push(nr),wt(We),j===Ft)return rr(ie,null);if(j===jt){var je=Et();return tt(),ns(je,!0),$e(je,"VariableDeclaration"),je.declarations.length===1&&_t(Oi)?is(ie,je):rr(ie,je)}var je=At(!1,!0);return _t(Oi)?(Nn(je),is(ie,je)):rr(ie,je);case Nt:return tt(),hr(ie,!0);case Gt:return tt(),ie.test=$i(),ie.consequent=Wt(),ie.alternate=_t(lt)?Wt():null,$e(ie,"IfStatement");case Rt:return!Te&&!V.allowReturnOutsideFunction&&_e(G,"'return' outside of function"),tt(),_t(Ft)||zn()?ie.argument=null:(ie.argument=At(),Pi()),$e(ie,"ReturnStatement");case Dt:tt(),ie.discriminant=$i(),ie.cases=[],wt(Jt),ze.push(La);for(var Ze,rt;j!=Ut;)if(j===Ue||j===mt){var Zt=j===Ue;Ze&&$e(Ze,"SwitchCase"),ie.cases.push(Ze=Et()),Ze.consequent=[],tt(),Zt?Ze.test=At():(rt&&_e(ue,"Multiple default clauses"),rt=!0,Ze.test=null),wt(ei)}else Ze||ii(),Ze.consequent.push(Wt());return Ze&&$e(Ze,"SwitchCase"),tt(),ze.pop(),$e(ie,"SwitchStatement");case kt:return tt(),Mn.test(I.slice(xe,G))&&_e(xe,"Illegal newline after throw"),ie.argument=At(),Pi(),$e(ie,"ThrowStatement");case Lt:if(tt(),ie.block=Ji(),ie.handler=null,j===vt){var ki=Et();tt(),wt(We),ki.param=ci(),ge&&Tn(ki.param.name)&&_e(ki.param.start,"Binding "+ki.param.name+" in strict mode"),wt(Vt),ki.guard=null,ki.body=Ji(),ie.handler=$e(ki,"CatchClause")}return ie.guardedHandlers=Le,ie.finalizer=_t(ct)?Ji():null,!ie.handler&&!ie.finalizer&&_e(ie.start,"Missing catch or finally clause"),$e(ie,"TryStatement");case jt:return tt(),ns(ie),Pi(),$e(ie,"VariableDeclaration");case xt:return tt(),ie.test=$i(),ze.push(nr),ie.body=Wt(),ze.pop(),$e(ie,"WhileStatement");case It:return ge&&_e(G,"'with' in strict mode"),tt(),ie.object=$i(),ie.body=Wt(),$e(ie,"WithStatement");case Jt:return Ji();case Ft:return tt(),$e(ie,"EmptyStatement");default:var cr=Q,Rn=At();if(Y===Fe&&Rn.type==="Identifier"&&_t(ei)){for(var ve=0;ve<ze.length;++ve)ze[ve].name===cr&&_e(Rn.start,"Label '"+cr+"' is already declared");var Va=j.isLoop?"loop":j===Dt?"switch":null;return ze.push({name:cr,kind:Va}),ie.body=Wt(),ze.pop(),ie.label=Rn,$e(ie,"LabeledStatement")}else return ie.expression=Rn,Pi(),$e(ie,"ExpressionStatement")}}function $i(){wt(We);var Y=At();return wt(Vt),Y}function Ji(Y){var ie=Et(),fe=!0,ve=!1,qe;for(ie.body=[],wt(Jt);!_t(Ut);){var je=Wt();ie.body.push(je),fe&&Y&&ir(je)&&(qe=ve,tr(ve=!0)),fe=!1}return ve&&!qe&&tr(!1),$e(ie,"BlockStatement")}function rr(Y,ie){return Y.init=ie,wt(Ft),Y.test=j===Ft?null:At(),wt(Ft),Y.update=j===Vt?null:At(),wt(Vt),Y.body=Wt(),ze.pop(),$e(Y,"ForStatement")}function is(Y,ie){return Y.left=ie,Y.right=At(),wt(Vt),Y.body=Wt(),ze.pop(),$e(Y,"ForInStatement")}function ns(Y,ie){for(Y.declarations=[],Y.kind="var";;){var fe=Et();if(fe.id=ci(),ge&&Tn(fe.id.name)&&_e(fe.id.start,"Binding "+fe.id.name+" in strict mode"),fe.init=_t(n)?At(!0,ie):null,Y.declarations.push($e(fe,"VariableDeclarator")),!_t(qt))break}return Y}function At(Y,ie){var fe=sr(ie);if(!Y&&j===qt){var ve=li(fe);for(ve.expressions=[fe];_t(qt);)ve.expressions.push(sr(ie));return $e(ve,"SequenceExpression")}return fe}function sr(Y){var ie=Oa(Y);if(j.isAssign){var fe=li(ie);return fe.operator=Q,fe.left=ie,tt(),fe.right=sr(Y),Nn(ie),$e(fe,"AssignmentExpression")}return ie}function Oa(Y){var ie=za(Y);if(_t(Xi)){var fe=li(ie);return fe.test=ie,fe.consequent=At(!0),wt(ei),fe.alternate=At(!0,Y),$e(fe,"ConditionalExpression")}return ie}function za(Y){return ar(or(),-1,Y)}function ar(Y,ie,fe){var ve=j.binop;if(ve!=null&&(!fe||j!==Oi)&&ve>ie){var qe=li(Y);qe.left=Y,qe.operator=Q;var je=j;tt(),qe.right=ar(or(),ve,fe);var Ze=$e(qe,je===W||je===ae?"LogicalExpression":"BinaryExpression");return ar(Ze,ie,fe)}return Y}function or(){if(j.prefix){var Y=Et(),ie=j.isUpdate;return Y.operator=Q,Y.prefix=!0,ee=!0,tt(),Y.argument=or(),ie?Nn(Y.argument):ge&&Y.operator==="delete"&&Y.argument.type==="Identifier"&&_e(Y.start,"Deleting local variable in strict mode"),$e(Y,ie?"UpdateExpression":"UnaryExpression")}for(var fe=Na();j.postfix&&!zn();){var Y=li(fe);Y.operator=Q,Y.prefix=!1,Y.argument=fe,Nn(fe),tt(),fe=$e(Y,"UpdateExpression")}return fe}function Na(){return en(ur())}function en(Y,ie){if(_t(Ki)){var fe=li(Y);return fe.object=Y,fe.property=ci(!0),fe.computed=!1,en($e(fe,"MemberExpression"),ie)}else if(_t(xi)){var fe=li(Y);return fe.object=Y,fe.property=At(),fe.computed=!0,wt(bi),en($e(fe,"MemberExpression"),ie)}else if(!ie&&_t(We)){var fe=li(Y);return fe.callee=Y,fe.arguments=lr(Vt,!1),en($e(fe,"CallExpression"),ie)}else return Y}function ur(){switch(j){case Zi:var ve=Et();return tt(),$e(ve,"ThisExpression");case Fe:return ci();case Re:case Be:case Ne:var ve=Et();return ve.value=Q,ve.raw=I.slice(G,K),tt(),$e(ve,"Literal");case In:case En:case An:var ve=Et();return ve.value=j.atomValue,ve.raw=j.keyword,tt(),$e(ve,"Literal");case We:var Y=X,ie=G;tt();var fe=At();return fe.start=ie,fe.end=K,V.locations&&(fe.loc.start=Y,fe.loc.end=$),V.ranges&&(fe.range=[ie,K]),wt(Vt),fe;case xi:var ve=Et();return tt(),ve.elements=lr(bi,!0,!0),$e(ve,"ArrayExpression");case Jt:return Da();case Nt:var ve=Et();return tt(),hr(ve,!1);case kn:return Ra();default:ii()}}function Ra(){var Y=Et();return tt(),Y.callee=en(ur(),!0),_t(We)?Y.arguments=lr(Vt,!1):Y.arguments=Le,$e(Y,"NewExpression")}function Da(){var Y=Et(),ie=!0,fe=!1;for(Y.properties=[],tt();!_t(Ut);){if(ie)ie=!1;else if(wt(qt),V.allowTrailingCommas&&_t(Ut))break;var ve={key:rs()},qe=!1,je;if(_t(ei)?(ve.value=At(!0),je=ve.kind="init"):V.ecmaVersion>=5&&ve.key.type==="Identifier"&&(ve.key.name==="get"||ve.key.name==="set")?(qe=fe=!0,je=ve.kind=ve.key.name,ve.key=rs(),j!==We&&ii(),ve.value=hr(Et(),!1)):ii(),ve.key.type==="Identifier"&&(ge||fe))for(var Ze=0;Ze<Y.properties.length;++Ze){var rt=Y.properties[Ze];if(rt.key.name===ve.key.name){var Zt=je==rt.kind||qe&&rt.kind==="init"||je==="init"&&(rt.kind==="get"||rt.kind==="set");Zt&&!ge&&je==="init"&&rt.kind==="init"&&(Zt=!1),Zt&&_e(ve.key.start,"Redefinition of property")}}Y.properties.push(ve)}return $e(Y,"ObjectExpression")}function rs(){return j===Re||j===Be?ur():ci(!0)}function hr(Y,ie){j===Fe?Y.id=ci():ie?ii():Y.id=null,Y.params=[];var fe=!0;for(wt(We);!_t(Vt);)fe?fe=!1:wt(qt),Y.params.push(ci());var ve=Te,qe=ze;if(Te=!0,ze=[],Y.body=Ji(!0),Te=ve,ze=qe,ge||Y.body.body.length&&ir(Y.body.body[0]))for(var je=Y.id?-1:0;je<Y.params.length;++je){var Ze=je<0?Y.id:Y.params[je];if((jr(Ze.name)||Tn(Ze.name))&&_e(Ze.start,"Defining '"+Ze.name+"' in strict mode"),je>=0)for(var rt=0;rt<je;++rt)Ze.name===Y.params[rt].name&&_e(Ze.start,"Argument name clash in strict mode")}return $e(Y,ie?"FunctionDeclaration":"FunctionExpression")}function lr(Y,ie,fe){for(var ve=[],qe=!0;!_t(Y);){if(qe)qe=!1;else if(wt(qt),ie&&V.allowTrailingCommas&&_t(Y))break;fe&&j===qt?ve.push(null):ve.push(At(!0))}return ve}function ci(Y){var ie=Et();return Y&&V.forbidReserved=="everywhere"&&(Y=!1),j===Fe?(!Y&&(V.forbidReserved&&(V.ecmaVersion===3?ui:hi)(Q)||ge&&jr(Q))&&I.slice(G,K).indexOf("\\")==-1&&_e(G,"The keyword '"+Q+"' is reserved"),ie.name=Q):Y&&j.keyword?ie.name=j.keyword:ii(),ee=!1,tt(),$e(ie,"Identifier")}}),i.version||(i=null)}function c(z,V){return(e.acorn||i).parse(z,V)}var p={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},m={"-":"__negate","+":"__self"},_=o.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(z){this["__"+z]="#"+z},{__self:function(){return this}});L.inject(_),Z.inject(_),dt.inject(_);function y(z,V,I){var R=p[V];if(z&&z[R]){var b=z[R](I);return V==="!="?!b:b}switch(V){case"+":return z+I;case"-":return z-I;case"*":return z*I;case"/":return z/I;case"%":return z%I;case"==":return z==I;case"!=":return z!=I}}function x(z,V){var I=m[z];if(V&&V[I])return V[I]();switch(z){case"+":return+V;case"-":return-V}}function T(z,V){if(!z)return"";V=V||{};var I=[];function R(ge){for(var _e=0,Le=I.length;_e<Le;_e++){var Re=I[_e];if(Re[0]>=ge)break;ge+=Re[1]}return ge}function b(ge){return z.substring(R(ge.range[0]),R(ge.range[1]))}function N(ge,_e){return z.substring(R(ge.range[1]),R(_e.range[0]))}function U(ge,_e){for(var Le=R(ge.range[0]),Re=R(ge.range[1]),Ne=0,Be=I.length-1;Be>=0;Be--)if(Le>I[Be][0]){Ne=Be+1;break}I.splice(Ne,0,[Le,_e.length-Re+Le]),z=z.substring(0,Le)+_e+z.substring(Re)}function H(ge,_e){switch(ge.type){case"UnaryExpression":if(ge.operator in m&&ge.argument.type!=="Literal"){var Le=b(ge.argument);U(ge,'$__("'+ge.operator+'", '+Le+")")}break;case"BinaryExpression":if(ge.operator in p&&ge.left.type!=="Literal"){var Re=b(ge.left),Ne=b(ge.right),Be=N(ge.left,ge.right),Fe=ge.operator;U(ge,"__$__("+Re+","+Be.replace(new RegExp("\\"+Fe),'"'+Fe+'"')+", "+Ne+")")}break;case"UpdateExpression":case"AssignmentExpression":var Ge=_e&&_e.type;if(!(Ge==="ForStatement"||Ge==="BinaryExpression"&&/^[=!<>]/.test(_e.operator)||Ge==="MemberExpression"&&_e.computed)){if(ge.type==="UpdateExpression"){var Le=b(ge.argument),Ke="__$__("+Le+', "'+ge.operator[0]+'", 1)',Ue=Le+" = "+Ke;ge.prefix?Ue="("+Ue+")":(Ge==="AssignmentExpression"||Ge==="VariableDeclarator"||Ge==="BinaryExpression")&&(b(_e.left||_e.id)===Le&&(Ue=Ke),Ue=Le+"; "+Ue),U(ge,Ue)}else if(/^.=$/.test(ge.operator)&&ge.left.type!=="Literal"){var Re=b(ge.left),Ne=b(ge.right),Ke=Re+" = __$__("+Re+', "'+ge.operator[0]+'", '+Ne+")";U(ge,/^\(.*\)$/.test(b(ge))?"("+Ke+")":Ke)}}break}}function D(ge){switch(ge.type){case"ExportDefaultDeclaration":U({range:[ge.start,ge.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var _e=ge.declaration,Le=ge.specifiers;if(_e){var Re=_e.declarations;Re&&(Re.forEach(function(Be){U(Be,"module.exports."+b(Be))}),U({range:[ge.start,_e.start+_e.kind.length]},""))}else if(Le){var Ne=Le.map(function(Be){var Fe=b(Be);return"module.exports."+Fe+" = "+Fe+"; "}).join("");Ne&&U(ge,Ne)}break}}function G(ge,_e,Le){if(ge){for(var Re in ge)if(Re!=="range"&&Re!=="loc"){var Ne=ge[Re];if(Array.isArray(Ne))for(var Be=0,Fe=Ne.length;Be<Fe;Be++)G(Ne[Be],ge,Le);else Ne&&typeof Ne=="object"&&G(Ne,ge,Le)}Le.operatorOverloading!==!1&&H(ge,_e),Le.moduleExports!==!1&&D(ge)}}function K(ge){var _e="",Le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ge=(Math.abs(ge)<<1)+(ge<0?1:0);ge||!_e;){var Re=ge&31;ge>>=5,ge&&(Re|=32),_e+=Le[Re]}return _e}var X=V.url||"",$=V.sourceMaps,j=V.paperFeatures||{},Q=V.source||z,ee=V.offset||0,re=Ye.agent,se=re.versionNumber,ue=!1,xe=/\r\n|\n|\r/mg,ke;if($&&(re.chrome&&se>=30||re.webkit&&se>=537.76||re.firefox&&se>=23||re.node)){if(re.node)ee-=2;else if(l&&X&&!l.location.href.indexOf(X)){var Te=f.getElementsByTagName("html")[0].innerHTML;ee=Te.substr(0,Te.indexOf(z)+1).match(xe).length+1}ue=ee>0&&!(re.chrome&&se>=36||re.safari&&se>=600||re.firefox&&se>=40||re.node);var ze=["AA"+K(ue?0:ee)+"A"];ze.length=(z.match(xe)||[]).length+1+(ue?ee:0),ke={version:3,file:X,names:[],mappings:ze.join(";AACA"),sourceRoot:"",sources:[X],sourcesContent:[Q]}}return(j.operatorOverloading!==!1||j.moduleExports!==!1)&&G(c(z,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,j),ke&&(ue&&(z=new Array(ee+1).join(`
`)+z),/^(inline|both)$/.test($)&&(z+=`
//# sourceMappingURL=data:application/json;base64,`+s.btoa(unescape(encodeURIComponent(JSON.stringify(ke))))),z+=`
//# sourceURL=`+(X||"paperscript")),{url:X,source:Q,code:z,map:ke}}function M(z,V,I){Ye=V;var R=V.getView(),b=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(z)&&!/\bnew\s+Tool\b/.test(z)?new vi:null,N=b?b._events:[],U=["onFrame","onResize"].concat(N),H=[],D=[],G,K=typeof z=="object"?z:T(z,I);z=K.code;function X(se,ue){for(var xe in se)(ue||!/^_/.test(xe))&&new RegExp("([\\b\\s\\W]|^)"+xe.replace(/\$/g,"\\$")+"\\b").test(z)&&(H.push(xe),D.push(se[xe]))}X({__$__:y,$__:x,paper:V,tool:b},!0),X(V),z="var module = { exports: {} }; "+z;var ee=o.each(U,function(se){new RegExp("\\s+"+se+"\\b").test(z)&&(H.push(se),this.push("module.exports."+se+" = "+se+";"))},[]).join(`
`);ee&&(z+=`
`+ee),z+=`
return module.exports;`;var $=Ye.agent;if(f&&($.chrome||$.firefox&&$.versionNumber<40)){var j=f.createElement("script"),Q=f.head||f.getElementsByTagName("head")[0];$.firefox&&(z=`
`+z),j.appendChild(f.createTextNode("document.__paperscript__ = function("+H+") {"+z+`
}`)),Q.appendChild(j),G=f.__paperscript__,delete f.__paperscript__,Q.removeChild(j)}else G=Function(H,z);var ee=G&&G.apply(V,D),re=ee||{};return o.each(N,function(se){var ue=re[se];ue&&(b[se]=ue)}),R&&(re.onResize&&R.setOnResize(re.onResize),R.emit("resize",{size:R.size,delta:new L}),re.onFrame&&R.setOnFrame(re.onFrame),R.requestUpdate()),ee}function P(z){if(/^text\/(?:x-|)paperscript$/.test(z.type)&&v.getAttribute(z,"ignore")!=="true"){var V=v.getAttribute(z,"canvas"),I=f.getElementById(V),R=z.src||z.getAttribute("data-src"),b=v.hasAttribute(z,"async"),N="data-paper-scope";if(!I)throw new Error('Unable to find canvas with id "'+V+'"');var U=v.get(I.getAttribute(N))||new v().setup(I);return I.setAttribute(N,U._id),R?Li.request({url:R,async:b,mimeType:"text/plain",onLoad:function(H){M(H,U,R)}}):M(z.innerHTML,U,z.baseURI),z.setAttribute("data-paper-ignore","true"),U}}function C(){o.each(f&&f.getElementsByTagName("script"),P)}function B(z){return z?P(z):C()}return l&&(f.readyState==="complete"?setTimeout(C):ut.add(l,{load:C})),{compile:T,execute:M,load:B,parse:c,calculateBinary:y,calculateUnary:x}}).call(this);var Ye=new(v.inject(o.exports,{Base:o,Numerical:k,Key:_i,DomEvent:ut,DomElement:at,document:f,window:l,Symbol:Pe,PlacedSymbol:Me}));return Ye.agent.node&&Rs(Ye),typeof a=="function"&&a.amd?a("paper",Ye):h&&(h.exports=Ye),Ye}).call(rh,typeof self=="object"?self:null)})(jn)),jn.exports}var ah=sh();const Je=Vr(ah),Ir=10,Er="#2196F3",Fs=2,oh="#999999",uh=1,hh=[4,4],Bs=.5,lh=.1,ch=10,Ar=1,fh=.025,dh=[.25,.5,1,2,4],ph=["25%","50%","100%","200%","400%"];function gh(h){const s=[];if(h.segments.length===0)return s;const a=h.segments[0],l={type:"move",p:[a.point.x,a.point.y]};s.push(l);for(let f=1;f<h.segments.length;f++){const o=h.segments[f-1],g=h.segments[f];if(o.handleOut&&o.handleOut.length>0||g.handleIn&&g.handleIn.length>0){const w=o.handleOut?[o.point.x+o.handleOut.x,o.point.y+o.handleOut.y]:[o.point.x,o.point.y],S=g.handleIn?[g.point.x+g.handleIn.x,g.point.y+g.handleIn.y]:[g.point.x,g.point.y],E={type:"bezier",p1:w,p2:S,p3:[g.point.x,g.point.y]};s.push(E)}else{const w={type:"line",p:[g.point.x,g.point.y]};s.push(w)}}return s}function Us(h){const s=new Je.Path;if(h.length===0)return s;let a=null;for(const l of h)switch(l.type){case"move":{const[f,o]=l.p;a=new Je.Point(f,o),s.moveTo(a);break}case"line":{const[f,o]=l.p;a=new Je.Point(f,o),s.lineTo(a);break}case"bezier":{if(!a){console.warn("PathEditor: CurveTo command without a current point, skipping");break}const[f,o]=l.p1,[g,v]=l.p2,[w,S]=l.p3,E=new Je.Point(w,S),k=new Je.Point(f,o),q=new Je.Point(g,v);s.add(E);const L=s.lastSegment,te=q.subtract(E);if(L.handleIn=te,s.segments.length>=2){const Z=k.subtract(a);s.segments[s.segments.length-2].handleOut=Z}a=E;break}case"arc":console.warn("PathEditor: Arc commands not yet supported, skipping arc command");break}return s}let dn=null,pn=null,gn=null,mn=null,_n=null,Ai=null,ln=!1,Ii=null;function mh(h,s,a){const l=new Je.Tool;return dn=f=>{f.code==="Space"&&!h.isSpacebarPressed&&(h.isSpacebarPressed=!0,f.preventDefault())},pn=f=>{f.code==="Space"&&(h.isSpacebarPressed=!1,f.preventDefault())},gn=f=>{f.preventDefault();const o=-Math.sign(f.deltaY)*fh,g=Math.max(lh,Math.min(ch,h.zoom+o));if(g!==h.zoom){const v=new Je.Point(f.offsetX,f.offsetY),w=Je.view.viewToProject(v),S=g/h.zoom;Je.view.scale(S,w),h.zoom=g,a()}},mn=f=>{h.isSpacebarPressed&&(ln=!0,Ii={x:f.clientX,y:f.clientY},f.preventDefault())},_n=f=>{if(ln&&Ii){const o=f.clientX-Ii.x,g=f.clientY-Ii.y;Je.view.translate(new Je.Point(o,g)),Ii={x:f.clientX,y:f.clientY},f.preventDefault()}},Ai=()=>{ln&&(ln=!1,Ii=null)},window.addEventListener("keydown",dn),window.addEventListener("keyup",pn),h.canvas&&(h.canvas.addEventListener("wheel",gn,{passive:!1}),h.canvas.addEventListener("mousedown",mn),h.canvas.addEventListener("mousemove",_n),h.canvas.addEventListener("mouseup",Ai),h.canvas.addEventListener("mouseleave",Ai)),l.onMouseDown=f=>{h.isSpacebarPressed||(h.mode==="draw"?vh(h,f):xh(h,f))},l.onMouseDrag=f=>{h.isSpacebarPressed||(h.mode==="draw"?yh(h,f):bh(h,f))},l.onMouseUp=()=>{if(!h.isSpacebarPressed)if(h.mode==="draw"){if(h.pendingPoint&&h.path){if(h.isDraggingCurve&&h.previewPath&&h.previewPath.segments.length>0){const f=h.previewPath.lastSegment,o=new Je.Segment(h.pendingPoint,f.handleIn,f.handleOut);if(h.path.add(o),h.path.segments.length>1&&h.previewPath.segments.length>1){const g=h.path.segments[h.path.segments.length-2],v=h.previewPath.segments[0];g.handleOut=v.handleOut}}else h.path.add(h.pendingPoint);h.pendingPoint=null,h.isDraggingCurve=!1,h.previewPath&&(h.previewPath.removeSegments(),h.previewPath.visible=!1)}s()}else h.selectedSegment=null,h.selectedHandle=null,s()},l.onMouseMove=f=>{h.mode==="draw"&&!h.isSpacebarPressed&&pa(h,f.point)},l.activate(),l}function _h(h){dn&&(window.removeEventListener("keydown",dn),dn=null),pn&&(window.removeEventListener("keyup",pn),pn=null),h&&(gn&&(h.removeEventListener("wheel",gn),gn=null),mn&&(h.removeEventListener("mousedown",mn),mn=null),_n&&(h.removeEventListener("mousemove",_n),_n=null),Ai&&(h.removeEventListener("mouseup",Ai),h.removeEventListener("mouseleave",Ai),Ai=null)),ln=!1,Ii=null}function vh(h,s){if(h.path){if(h.path.segments.length>0){const a=h.path.lastSegment;a.handleOut&&a.handleOut.length>0&&(a.handleOut=new Je.Point(0,0))}h.pendingPoint=s.point.clone(),h.isDraggingCurve=!1,pa(h,s.point)}}function yh(h,s){if(!h.path||!h.previewPath||!h.pendingPoint)return;h.isDraggingCurve=!0;const a=h.pendingPoint,l=s.point.subtract(a),f=l.multiply(Bs),o=l.multiply(-Bs);let g=new Je.Point(0,0);if(h.path.segments.length>0){const v=h.path.lastSegment,w=a.subtract(v.point);if(h.path.segments.length>1)if(v.handleIn&&v.handleIn.length>0){const q=v.handleIn.normalize(),L=w.length;g=q.multiply(-L)}else if(h.path.segments.length>1){const q=h.path.segments[h.path.segments.length-2];g=v.point.subtract(q.point).multiply(.33)}else g=w.multiply(.33);h.previewPath.removeSegments();const S=new Je.Segment(v.point,new Je.Point(0,0),g);h.previewPath.add(S);const E=new Je.Segment(a,o,f);h.previewPath.add(E),h.previewPath.visible=!0}else{h.previewPath.removeSegments();const v=new Je.Segment(a,o,f);h.previewPath.add(v),h.previewPath.visible=!0}}function pa(h,s){if(!(!h.previewPath||!h.path))if(h.previewPath.removeSegments(),h.path.segments.length>0){const a=h.path.lastSegment.point;h.previewPath.moveTo(a),h.previewPath.lineTo(s),h.previewPath.visible=!0}else h.previewPath.visible=!1}function xh(h,s){if(!h.path)return;if(h.selectedSegment!==null||h.path.fullySelected){const o=h.path.hitTest(s.point,{handles:!0,tolerance:Ir});if(o?.type==="handle-in"||o?.type==="handle-out"){h.selectedHandle={segment:o.segment,type:o.type==="handle-in"?"handleIn":"handleOut"},h.selectedSegment=null;return}}const l=h.path.hitTest(s.point,{segments:!0,tolerance:Ir});if(l?.segment){for(const o of h.path.segments)o.selected=!1;h.selectedSegment=l.segment,h.selectedSegment.selected=!0,h.selectedHandle=null;return}if(h.path.hitTest(s.point,{stroke:!0,tolerance:Ir})){h.path.fullySelected=!0,h.selectedSegment=null,h.selectedHandle=null;return}h.selectedSegment=null,h.selectedHandle=null,h.path.selected=!1,h.path.fullySelected=!1;for(const o of h.path.segments)o.selected=!1}function bh(h,s){if(h.selectedSegment)h.selectedSegment.point=h.selectedSegment.point.add(s.delta);else if(h.selectedHandle){const{segment:a,type:l}=h.selectedHandle,f=s.point.subtract(a.point);l==="handleOut"?a.handleOut=f:a.handleIn=f}}const wh=()=>{const h={canvas:null,path:null,previewPath:null,mode:"draw",selectedSegment:null,selectedHandle:null,zoom:Ar,isSpacebarPressed:!1,pendingPoint:null,isDraggingCurve:!1};let s=null,a;const l=(S,E)=>{Je.setup(S),h.canvas=S,Je.view.viewSize=new Je.Size(E.width,E.height),Je.settings.handleSize=8;const k=E.initialPath&&E.initialPath.length>0;if(h.mode=k?"edit":"draw",h.path=new Je.Path,h.path.strokeColor=new Je.Color(E.strokeColor??Er),h.path.strokeWidth=Fs,k&&E.initialPath){const q=Us(E.initialPath);h.path.segments=q.segments,h.path.strokeColor=new Je.Color(E.strokeColor??Er),h.path.strokeWidth=Fs}h.previewPath=new Je.Path,h.previewPath.strokeColor=new Je.Color(oh),h.previewPath.strokeWidth=uh,h.previewPath.dashArray=hh,h.previewPath.visible=!1,s=mh(h,()=>{f(E)},()=>{oe.redraw()})},f=S=>{if(h.path){const E=gh(h.path);S.onPathChanged(E)}oe.redraw()},o=()=>{h.mode==="draw"&&(h.mode="edit",h.pendingPoint=null,h.isDraggingCurve=!1,h.previewPath&&(h.previewPath.removeSegments(),h.previewPath.visible=!1),oe.redraw())},g=()=>{s&&(s.remove(),s=null),_h(h.canvas),Je.project&&Je.project.remove(),h.canvas=null,h.path=null,h.previewPath=null,h.selectedSegment=null,h.selectedHandle=null},v=S=>{if(S===h.zoom)return;const E=S/h.zoom;Je.view.scale(E,Je.view.center),h.zoom=S,oe.redraw()},w=()=>`${Math.round(h.zoom*100)}%`;return{oncreate:({dom:S,attrs:E})=>{const k=S.querySelector("canvas");k&&(l(k,E),a=E.initialPath)},onupdate:({attrs:S})=>{if(!h.path||(S.strokeColor&&(h.path.strokeColor=new Je.Color(S.strokeColor)),S.initialPath===a))return;const E=a?.length??0,k=S.initialPath?.length??0;if(a=S.initialPath,!(E!==k)&&!(E===0&&k===0))return;if(!(S.initialPath&&S.initialPath.length>0))h.path.removeSegments(),h.mode="draw",h.selectedSegment=null,h.selectedHandle=null,h.pendingPoint=null,h.isDraggingCurve=!1,oe.redraw();else if(S.initialPath){h.path.removeSegments();const Z=Us(S.initialPath);h.path.segments=Z.segments,h.path.strokeColor=new Je.Color(S.strokeColor??Er),h.mode="edit",h.selectedSegment=null,h.selectedHandle=null,h.pendingPoint=null,h.isDraggingCurve=!1,oe.redraw()}},onremove:()=>{g()},view:({attrs:S})=>{const E=w();return oe(".path-editor",[oe("canvas",{style:`width: ${S.width}px; height: ${S.height}px;`}),oe(".path-editor-controls",[oe(".mode-indicator",`Mode: ${h.mode==="draw"?"Drawing":"Editing"}`),h.mode==="draw"&&oe("wa-button.end-drawing-button",{variant:"success",size:"small",onclick:o},"End Drawing"),oe("wa-dropdown.zoom-control",{"onwa-select":k=>{k.redraw=!1;const q=k.detail.item.value;if(q&&typeof q=="string"){const L=parseFloat(q);isNaN(L)||v(L)}}},[oe("wa-button",{slot:"trigger","with-caret":!0,size:"small",value:h.zoom},E),...dh.map((k,q)=>oe("wa-dropdown-item",{type:"checkbox",checked:h.zoom==k?!0:void 0,value:k.toString()},ph[q]))]),oe("wa-tooltip",{for:"recenter-button"},"Recenter view"),oe("wa-button#recenter-button",{appearance:"plain",size:"large",onclick:()=>{const k=Ar/h.zoom;Je.view.scale(k,Je.view.center),h.zoom=Ar,Je.view.center=new Je.Point(Je.view.viewSize.width/2,Je.view.viewSize.height/2)}},oe("wa-icon",{library:"material",name:"recenter",label:"Recenter view"}))])])}}},Sh=()=>{const h={initialPathToLoad:[],pathCommands:[],pathDataDisplay:"No path data yet"},s=f=>{h.pathCommands=f,h.pathDataDisplay=JSON.stringify(f,null,2)},a=()=>{h.initialPathToLoad=[],h.pathCommands=[],h.pathDataDisplay="No path data yet",oe.redraw()},l=()=>{const f=[{type:"move",p:[100,150]},{type:"line",p:[300,150]},{type:"bezier",p1:[350,180],p2:[350,280],p3:[300,350]},{type:"bezier",p1:[250,380],p2:[150,380],p3:[100,350]},{type:"bezier",p1:[70,300],p2:[70,200],p3:[100,150]}];h.initialPathToLoad=f,h.pathCommands=f,h.pathDataDisplay=JSON.stringify(f,null,2),oe.redraw()};return{view:()=>oe(".page",[oe("h1","Path Editor - Phase 4 Pan and Zoom"),oe("p","Testing the PathEditor component with pan and zoom support."),oe(".test-page",[oe(".test-area",[oe(wh,{width:800,height:600,initialPath:h.initialPathToLoad,onPathChanged:s,strokeColor:"#000000ff"})]),oe(".controls",[oe("h2","Controls"),oe(".button-group",[oe("button",{onclick:a,style:"background: #f44336;"},"Clear Canvas"),oe("button",{onclick:l,style:"background: #4CAF50;"},"Load Sample Path")]),oe(".instructions",[oe("h3",{style:"margin-top: 1rem;"},"Instructions:"),oe("p","The editor has two modes:"),oe("ul",{style:"margin: 0.5rem 0;"},[oe("li",oe("strong","Drawing Mode"),": Click to add points (straight lines), or click-drag to add points with smooth bezier curves"),oe("li","Stay in drawing mode until you click the ",oe("strong","End Drawing")," button"),oe("li",oe("strong","Editing Mode"),":"),oe("ul",{style:"margin-left: 1rem;"},[oe("li","Click anywhere on the path to select it and show all vertices"),oe("li","Click a specific vertex to select it, then drag to move it"),oe("li","Drag curve handles to adjust curve shape"),oe("li","Click empty space to deselect")]),oe("li","The mode indicator below the canvas shows the current mode")]),oe("h3",{style:"margin-top: 1rem;"},"Pan and Zoom:"),oe("ul",{style:"margin: 0.5rem 0;"},[oe("li","Hold ",oe("strong","Spacebar")," and drag to pan the canvas"),oe("li","Use ",oe("strong","mouse wheel")," to zoom in/out (zooms toward cursor position)"),oe("li","Use the ",oe("strong","Zoom dropdown")," to select preset zoom levels (25%, 50%, 100%, 200%, 400%)"),oe("li","Click the ",oe("strong","Recenter button")," to reset view to 100% zoom and center position")])])]),oe(".data-display",[oe("h2","Path Data"),oe("h3","PathCommand[] Format:"),oe("textarea",{readonly:!0,value:h.pathDataDisplay,rows:15,style:"font-family: monospace; font-size: 12px; width: 100%;"})]),oe(".findings",[oe("h2","Implementation Status"),oe("h3",{style:"margin-top: 1rem;"},"Phase 4 - Pan and Zoom:"),oe("ul",[oe("li"," Spacebar + drag to pan"),oe("li"," Mouse wheel to zoom (centered on cursor)"),oe("li"," Zoom dropdown with preset levels"),oe("li"," Recenter button to reset view")])])])])}};function Ch(){const h=window.matchMedia("(prefers-color-scheme: dark)");function s(){h.matches?document.documentElement.classList.add("wa-dark"):document.documentElement.classList.remove("wa-dark")}s(),h.addEventListener("change",s)}Ch();const qs={view:h=>[oe(Ua,{link:"https://github.com/weevilgenius/puzzle-generator"}),oe(qa),h.children]};Ba("material",{resolver:h=>{const s=h.match(/^(.*?)(_(rounded|sharp))?$/);return s?`https://cdn.jsdelivr.net/npm/@material-symbols/svg-400@0.32.0/${s[3]??"outlined"}/${s[1]}.svg`:""},mutator:h=>h.setAttribute("fill","currentColor")});oe.route(document.body,"/puzzle",{"/puzzle":{render:()=>oe(qs,oe($u))},"/test":{render:()=>oe(qs,oe(Sh))}});
//# sourceMappingURL=index-DxRtXxjJ.js.map
