import{m as z,g as Wt}from"./mithril-B5C7A48-.js";import{r as xn}from"./webawesome-BNu9ozLj.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const bn={view:({attrs:s})=>z("a.github-corner",{href:s.link,"aria-label":"View source on GitHub",title:"View source on GitHub",target:"_blank"},z("svg",{width:80,height:80,viewBox:"0 0 250 250","aria-hidden":"true"},[z("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),z("path.octo-arm",{fill:"currentColor",style:"transform-origin: 130px 106px;",d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"}),z("path.octo-body",{fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})]))};class Ue{generators=new Map;register(e,n,i){this.generators.has(e)&&console.warn(`Generator "${e}" is already registered, overwriting`),this.generators.set(e,{factory:n,uiMetadata:i})}create(e,n,i){const o=this.generators.get(i.name);if(!o)throw new Error(`Unknown generator "${i.name}". Is it registered?`);return o.factory(e,n,i)}getAvailableGenerators(){return Array.from(this.generators.values()).sort((e,n)=>e.uiMetadata.sortHint-n.uiMetadata.sortHint).map(e=>({name:e.uiMetadata.name,displayName:e.uiMetadata.displayName}))}getUIMetadata(e){return this.generators.get(e)?.uiMetadata}getDefaultConfig(e,n,i){const o={name:e,width:n,height:i},r=this.getUIMetadata(e);if(r)for(const a of r.controls)o[a.name]=a.defaultValue;return o}}const ve=new Ue,xe=new Ue,be=new Ue,te=new Ue;let wn=0;function Bt(){return wn++}const{abs:ce,cos:B,sin:ne,acos:_n,atan2:he,sqrt:K,pow:j}=Math;function ue(s){return s<0?-j(-s,1/3):j(s,1/3)}const Xt=Math.PI,Pe=2*Xt,Q=Xt/2,Pn=1e-6,Fe=Number.MAX_SAFE_INTEGER||9007199254740991,Ve=Number.MIN_SAFE_INTEGER||-9007199254740991,Mn={x:0,y:0,z:0},E={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(s,e){const n=e(s);let i=n.x*n.x+n.y*n.y;return typeof n.z<"u"&&(i+=n.z*n.z),K(i)},compute:function(s,e,n){if(s===0)return e[0].t=0,e[0];const i=e.length-1;if(s===1)return e[i].t=1,e[i];const o=1-s;let r=e;if(i===0)return e[0].t=s,e[0];if(i===1){const l={x:o*r[0].x+s*r[1].x,y:o*r[0].y+s*r[1].y,t:s};return n&&(l.z=o*r[0].z+s*r[1].z),l}if(i<4){let l=o*o,c=s*s,h,u,f,d=0;i===2?(r=[r[0],r[1],r[2],Mn],h=l,u=o*s*2,f=c):i===3&&(h=l*o,u=l*s*3,f=o*c*3,d=s*c);const p={x:h*r[0].x+u*r[1].x+f*r[2].x+d*r[3].x,y:h*r[0].y+u*r[1].y+f*r[2].y+d*r[3].y,t:s};return n&&(p.z=h*r[0].z+u*r[1].z+f*r[2].z+d*r[3].z),p}const a=JSON.parse(JSON.stringify(e));for(;a.length>1;){for(let l=0;l<a.length-1;l++)a[l]={x:a[l].x+(a[l+1].x-a[l].x)*s,y:a[l].y+(a[l+1].y-a[l].y)*s},typeof a[l].z<"u"&&(a[l].z=a[l].z+(a[l+1].z-a[l].z)*s);a.splice(a.length-1,1)}return a[0].t=s,a[0]},computeWithRatios:function(s,e,n,i){const o=1-s,r=n,a=e;let l=r[0],c=r[1],h=r[2],u=r[3],f;if(l*=o,c*=s,a.length===2)return f=l+c,{x:(l*a[0].x+c*a[1].x)/f,y:(l*a[0].y+c*a[1].y)/f,z:i?(l*a[0].z+c*a[1].z)/f:!1,t:s};if(l*=o,c*=2*o,h*=s*s,a.length===3)return f=l+c+h,{x:(l*a[0].x+c*a[1].x+h*a[2].x)/f,y:(l*a[0].y+c*a[1].y+h*a[2].y)/f,z:i?(l*a[0].z+c*a[1].z+h*a[2].z)/f:!1,t:s};if(l*=o,c*=1.5*o,h*=3*o,u*=s*s*s,a.length===4)return f=l+c+h+u,{x:(l*a[0].x+c*a[1].x+h*a[2].x+u*a[3].x)/f,y:(l*a[0].y+c*a[1].y+h*a[2].y+u*a[3].y)/f,z:i?(l*a[0].z+c*a[1].z+h*a[2].z+u*a[3].z)/f:!1,t:s}},derive:function(s,e){const n=[];for(let i=s,o=i.length,r=o-1;o>1;o--,r--){const a=[];for(let l=0,c;l<r;l++)c={x:r*(i[l+1].x-i[l].x),y:r*(i[l+1].y-i[l].y)},e&&(c.z=r*(i[l+1].z-i[l].z)),a.push(c);n.push(a),i=a}return n},between:function(s,e,n){return e<=s&&s<=n||E.approximately(s,e)||E.approximately(s,n)},approximately:function(s,e,n){return ce(s-e)<=(n||Pn)},length:function(s){const n=E.Tvalues.length;let i=0;for(let o=0,r;o<n;o++)r=.5*E.Tvalues[o]+.5,i+=E.Cvalues[o]*E.arcfn(r,s);return .5*i},map:function(s,e,n,i,o){const r=n-e,a=o-i,l=s-e,c=l/r;return i+a*c},lerp:function(s,e,n){const i={x:e.x+s*(n.x-e.x),y:e.y+s*(n.y-e.y)};return e.z!==void 0&&n.z!==void 0&&(i.z=e.z+s*(n.z-e.z)),i},pointToString:function(s){let e=s.x+"/"+s.y;return typeof s.z<"u"&&(e+="/"+s.z),e},pointsToString:function(s){return"["+s.map(E.pointToString).join(", ")+"]"},copy:function(s){return JSON.parse(JSON.stringify(s))},angle:function(s,e,n){const i=e.x-s.x,o=e.y-s.y,r=n.x-s.x,a=n.y-s.y,l=i*a-o*r,c=i*r+o*a;return he(l,c)},round:function(s,e){const n=""+s,i=n.indexOf(".");return parseFloat(n.substring(0,i+1+e))},dist:function(s,e){const n=s.x-e.x,i=s.y-e.y;return K(n*n+i*i)},closest:function(s,e){let n=j(2,63),i,o;return s.forEach(function(r,a){o=E.dist(e,r),o<n&&(n=o,i=a)}),{mdist:n,mpos:i}},abcratio:function(s,e){if(e!==2&&e!==3)return!1;if(typeof s>"u")s=.5;else if(s===0||s===1)return s;const n=j(s,e)+j(1-s,e),i=n-1;return ce(i/n)},projectionratio:function(s,e){if(e!==2&&e!==3)return!1;if(typeof s>"u")s=.5;else if(s===0||s===1)return s;const n=j(1-s,e),i=j(s,e)+n;return n/i},lli8:function(s,e,n,i,o,r,a,l){const c=(s*i-e*n)*(o-a)-(s-n)*(o*l-r*a),h=(s*i-e*n)*(r-l)-(e-i)*(o*l-r*a),u=(s-n)*(r-l)-(e-i)*(o-a);return u==0?!1:{x:c/u,y:h/u}},lli4:function(s,e,n,i){const o=s.x,r=s.y,a=e.x,l=e.y,c=n.x,h=n.y,u=i.x,f=i.y;return E.lli8(o,r,a,l,c,h,u,f)},lli:function(s,e){return E.lli4(s,s.c,e,e.c)},makeline:function(s,e){return new N(s.x,s.y,(s.x+e.x)/2,(s.y+e.y)/2,e.x,e.y)},findbbox:function(s){let e=Fe,n=Fe,i=Ve,o=Ve;return s.forEach(function(r){const a=r.bbox();e>a.x.min&&(e=a.x.min),n>a.y.min&&(n=a.y.min),i<a.x.max&&(i=a.x.max),o<a.y.max&&(o=a.y.max)}),{x:{min:e,mid:(e+i)/2,max:i,size:i-e},y:{min:n,mid:(n+o)/2,max:o,size:o-n}}},shapeintersections:function(s,e,n,i,o){if(!E.bboxoverlap(e,i))return[];const r=[],a=[s.startcap,s.forward,s.back,s.endcap],l=[n.startcap,n.forward,n.back,n.endcap];return a.forEach(function(c){c.virtual||l.forEach(function(h){if(h.virtual)return;const u=c.intersects(h,o);u.length>0&&(u.c1=c,u.c2=h,u.s1=s,u.s2=n,r.push(u))})}),r},makeshape:function(s,e,n){const i=e.points.length,o=s.points.length,r=E.makeline(e.points[i-1],s.points[0]),a=E.makeline(s.points[o-1],e.points[0]),l={startcap:r,forward:s,back:e,endcap:a,bbox:E.findbbox([r,s,e,a])};return l.intersections=function(c){return E.shapeintersections(l,l.bbox,c,c.bbox,n)},l},getminmax:function(s,e,n){if(!n)return{min:0,max:0};let i=Fe,o=Ve,r,a;n.indexOf(0)===-1&&(n=[0].concat(n)),n.indexOf(1)===-1&&n.push(1);for(let l=0,c=n.length;l<c;l++)r=n[l],a=s.get(r),a[e]<i&&(i=a[e]),a[e]>o&&(o=a[e]);return{min:i,mid:(i+o)/2,max:o,size:o-i}},align:function(s,e){const n=e.p1.x,i=e.p1.y,o=-he(e.p2.y-i,e.p2.x-n),r=function(a){return{x:(a.x-n)*B(o)-(a.y-i)*ne(o),y:(a.x-n)*ne(o)+(a.y-i)*B(o)}};return s.map(r)},roots:function(s,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=s.length-1,i=E.align(s,e),o=function(M){return 0<=M&&M<=1};if(n===2){const M=i[0].y,P=i[1].y,w=i[2].y,S=M-2*P+w;if(S!==0){const T=-K(P*P-M*w),k=-M+P,D=-(T+k)/S,R=-(-T+k)/S;return[D,R].filter(o)}else if(P!==w&&S===0)return[(2*P-w)/(2*P-2*w)].filter(o);return[]}const r=i[0].y,a=i[1].y,l=i[2].y,c=i[3].y;let h=-r+3*a-3*l+c,u=3*r-6*a+3*l,f=-3*r+3*a,d=r;if(E.approximately(h,0)){if(E.approximately(u,0))return E.approximately(f,0)?[]:[-d/f].filter(o);const M=K(f*f-4*u*d),P=2*u;return[(M-f)/P,(-f-M)/P].filter(o)}u/=h,f/=h,d/=h;const p=(3*f-u*u)/3,m=p/3,g=(2*u*u*u-9*u*f+27*d)/27,v=g/2,y=v*v+m*m*m;let x,_,I,b,C;if(y<0){const M=-p/3,P=M*M*M,w=K(P),S=-g/(2*w),T=S<-1?-1:S>1?1:S,k=_n(T),D=ue(w),R=2*D;return I=R*B(k/3)-u/3,b=R*B((k+Pe)/3)-u/3,C=R*B((k+2*Pe)/3)-u/3,[I,b,C].filter(o)}else{if(y===0)return x=v<0?ue(-v):-ue(v),I=2*x-u/3,b=-x-u/3,[I,b].filter(o);{const M=K(y);return x=ue(-v+M),_=ue(v+M),[x-_-u/3].filter(o)}}},droots:function(s){if(s.length===3){const e=s[0],n=s[1],i=s[2],o=e-2*n+i;if(o!==0){const r=-K(n*n-e*i),a=-e+n,l=-(r+a)/o,c=-(-r+a)/o;return[l,c]}else if(n!==i&&o===0)return[(2*n-i)/(2*(n-i))];return[]}if(s.length===2){const e=s[0],n=s[1];return e!==n?[e/(e-n)]:[]}return[]},curvature:function(s,e,n,i,o){let r,a,l,c,h=0,u=0;const f=E.compute(s,e),d=E.compute(s,n),p=f.x*f.x+f.y*f.y;if(i?(r=K(j(f.y*d.z-d.y*f.z,2)+j(f.z*d.x-d.z*f.x,2)+j(f.x*d.y-d.x*f.y,2)),a=j(p+f.z*f.z,3/2)):(r=f.x*d.y-f.y*d.x,a=j(p,3/2)),r===0||a===0)return{k:0,r:0};if(h=r/a,u=a/r,!o){const m=E.curvature(s-.001,e,n,i,!0).k,g=E.curvature(s+.001,e,n,i,!0).k;c=(g-h+(h-m))/2,l=(ce(g-h)+ce(h-m))/2}return{k:h,r:u,dk:c,adk:l}},inflections:function(s){if(s.length<4)return[];const e=E.align(s,{p1:s[0],p2:s.slice(-1)[0]}),n=e[2].x*e[1].y,i=e[3].x*e[1].y,o=e[1].x*e[2].y,r=e[3].x*e[2].y,a=18*(-3*n+2*i+3*o-r),l=18*(3*n-i-3*o),c=18*(o-n);if(E.approximately(a,0)){if(!E.approximately(l,0)){let d=-c/l;if(0<=d&&d<=1)return[d]}return[]}const h=2*a;if(E.approximately(h,0))return[];const u=l*l-4*a*c;if(u<0)return[];const f=Math.sqrt(u);return[(f-l)/h,-(l+f)/h].filter(function(d){return 0<=d&&d<=1})},bboxoverlap:function(s,e){const n=["x","y"],i=n.length;for(let o=0,r,a,l,c;o<i;o++)if(r=n[o],a=s[r].mid,l=e[r].mid,c=(s[r].size+e[r].size)/2,ce(a-l)>=c)return!1;return!0},expandbox:function(s,e){e.x.min<s.x.min&&(s.x.min=e.x.min),e.y.min<s.y.min&&(s.y.min=e.y.min),e.z&&e.z.min<s.z.min&&(s.z.min=e.z.min),e.x.max>s.x.max&&(s.x.max=e.x.max),e.y.max>s.y.max&&(s.y.max=e.y.max),e.z&&e.z.max>s.z.max&&(s.z.max=e.z.max),s.x.mid=(s.x.min+s.x.max)/2,s.y.mid=(s.y.min+s.y.max)/2,s.z&&(s.z.mid=(s.z.min+s.z.max)/2),s.x.size=s.x.max-s.x.min,s.y.size=s.y.max-s.y.min,s.z&&(s.z.size=s.z.max-s.z.min)},pairiteration:function(s,e,n){const i=s.bbox(),o=e.bbox(),r=1e5,a=n||.5;if(i.x.size+i.y.size<a&&o.x.size+o.y.size<a)return[(r*(s._t1+s._t2)/2|0)/r+"/"+(r*(e._t1+e._t2)/2|0)/r];let l=s.split(.5),c=e.split(.5),h=[{left:l.left,right:c.left},{left:l.left,right:c.right},{left:l.right,right:c.right},{left:l.right,right:c.left}];h=h.filter(function(f){return E.bboxoverlap(f.left.bbox(),f.right.bbox())});let u=[];return h.length===0||(h.forEach(function(f){u=u.concat(E.pairiteration(f.left,f.right,a))}),u=u.filter(function(f,d){return u.indexOf(f)===d})),u},getccenter:function(s,e,n){const i=e.x-s.x,o=e.y-s.y,r=n.x-e.x,a=n.y-e.y,l=i*B(Q)-o*ne(Q),c=i*ne(Q)+o*B(Q),h=r*B(Q)-a*ne(Q),u=r*ne(Q)+a*B(Q),f=(s.x+e.x)/2,d=(s.y+e.y)/2,p=(e.x+n.x)/2,m=(e.y+n.y)/2,g=f+l,v=d+c,y=p+h,x=m+u,_=E.lli8(f,d,g,v,p,m,y,x),I=E.dist(_,s);let b=he(s.y-_.y,s.x-_.x),C=he(e.y-_.y,e.x-_.x),M=he(n.y-_.y,n.x-_.x),P;return b<M?((b>C||C>M)&&(b+=Pe),b>M&&(P=M,M=b,b=P)):M<C&&C<b?(P=M,M=b,b=P):M+=Pe,_.s=b,_.e=M,_.r=I,_},numberSort:function(s,e){return s-e}};class me{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return E.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,n){return e+n})}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var n=e[0].bbox(),i=1;i<e.length;i++)E.expandbox(n,e[i].bbox());return n}offset(e){const n=[];return this.curves.forEach(function(i){n.push(...i.offset(e))}),new me(n)}}const{abs:fe,min:gt,max:mt,cos:zn,sin:En,acos:Cn,sqrt:de}=Math,In=Math.PI;class N{constructor(e){let n=e&&e.forEach?e:Array.from(arguments).slice(),i=!1;if(typeof n[0]=="object"){i=n.length;const p=[];n.forEach(function(m){["x","y","z"].forEach(function(g){typeof m[g]<"u"&&p.push(m[g])})}),n=p}let o=!1;const r=n.length;if(i){if(i>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");o=!0}}else if(r!==6&&r!==8&&r!==9&&r!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const a=this._3d=!o&&(r===9||r===12)||e&&e[0]&&typeof e[0].z<"u",l=this.points=[];for(let p=0,m=a?3:2;p<r;p+=m){var c={x:n[p],y:n[p+1]};a&&(c.z=n[p+2]),l.push(c)}const h=this.order=l.length-1,u=this.dims=["x","y"];a&&u.push("z"),this.dimlen=u.length;const f=E.align(l,{p1:l[0],p2:l[h]}),d=E.dist(l[0],l[h]);this._linear=f.reduce((p,m)=>p+fe(m.y),0)<d/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,n,i,o){if(typeof o>"u"&&(o=.5),o===0)return new N(n,n,i);if(o===1)return new N(e,n,n);const r=N.getABC(2,e,n,i,o);return new N(e,r.A,i)}static cubicFromPoints(e,n,i,o,r){typeof o>"u"&&(o=.5);const a=N.getABC(3,e,n,i,o);typeof r>"u"&&(r=E.dist(n,a.C));const l=r*(1-o)/o,c=E.dist(e,i),h=(i.x-e.x)/c,u=(i.y-e.y)/c,f=r*h,d=r*u,p=l*h,m=l*u,g={x:n.x-f,y:n.y-d},v={x:n.x+p,y:n.y+m},y=a.A,x={x:y.x+(g.x-y.x)/(1-o),y:y.y+(g.y-y.y)/(1-o)},_={x:y.x+(v.x-y.x)/o,y:y.y+(v.y-y.y)/o},I={x:e.x+(x.x-e.x)/o,y:e.y+(x.y-e.y)/o},b={x:i.x+(_.x-i.x)/(1-o),y:i.y+(_.y-i.y)/(1-o)};return new N(e,I,b,i)}static getUtils(){return E}getUtils(){return N.getUtils()}static get PolyBezier(){return me}valueOf(){return this.toString()}toString(){return E.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,n=e[0].x,i=e[0].y,o=["M",n,i,this.order===2?"Q":"C"];for(let r=1,a=e.length;r<a;r++)o.push(e[r].x),o.push(e[r].y);return o.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,n){return""+n+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=E.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,n=E.angle(e[0],e[this.order],e[1]);this.clockwise=n>0}length(){return E.length(this.derivative.bind(this))}static getABC(e=2,n,i,o,r=.5){const a=E.projectionratio(r,e),l=1-a,c={x:a*n.x+l*o.x,y:a*n.y+l*o.y},h=E.abcratio(r,e);return{A:{x:i.x+(i.x-c.x)/h,y:i.y+(i.y-c.y)/h},B:i,C:c,S:n,E:o}}getABC(e,n){n=n||this.get(e);let i=this.points[0],o=this.points[this.order];return N.getABC(this.order,i,n,o,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e+1)return this._lut;this._lut=[],e++,this._lut=[];for(let n=0,i,o;n<e;n++)o=n/(e-1),i=this.compute(o),i.t=o,this._lut.push(i);return this._lut}on(e,n){n=n||5;const i=this.getLUT(),o=[];for(let r=0,a,l=0;r<i.length;r++)a=i[r],E.dist(a,e)<n&&(o.push(a),l+=r/i.length);return o.length?t/=o.length:!1}project(e){const n=this.getLUT(),i=n.length-1,o=E.closest(n,e),r=o.mpos,a=(r-1)/i,l=(r+1)/i,c=.1/i;let h=o.mdist,u=a,f=u,d;h+=1;for(let p;u<l+c;u+=c)d=this.compute(u),p=E.dist(e,d),p<h&&(h=p,f=u);return f=f<0?0:f>1?1:f,d=this.compute(f),d.t=f,d.d=h,d}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?E.computeWithRatios(e,this.points,this.ratios,this._3d):E.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,n=[e[0]],i=e.length;for(let o=1,r,a;o<i;o++)r=e[o],a=e[o-1],n[o]={x:(i-o)/i*r.x+o/i*a.x,y:(i-o)/i*r.y+o/i*a.y};return n[i]=e[i-1],new N(n)}derivative(e){return E.compute(e,this.dpoints[0],this._3d)}dderivative(e){return E.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new N(E.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return E.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return E.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const n=this.derivative(e),i=de(n.x*n.x+n.y*n.y);return{t:e,x:-n.y/i,y:n.x/i}}__normal3(e){const n=this.derivative(e),i=this.derivative(e+.01),o=de(n.x*n.x+n.y*n.y+n.z*n.z),r=de(i.x*i.x+i.y*i.y+i.z*i.z);n.x/=o,n.y/=o,n.z/=o,i.x/=r,i.y/=r,i.z/=r;const a={x:i.y*n.z-i.z*n.y,y:i.z*n.x-i.x*n.z,z:i.x*n.y-i.y*n.x},l=de(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=l,a.y/=l,a.z/=l;const c=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:e,x:c[0]*n.x+c[1]*n.y+c[2]*n.z,y:c[3]*n.x+c[4]*n.y+c[5]*n.z,z:c[6]*n.x+c[7]*n.y+c[8]*n.z}}hull(e){let n=this.points,i=[],o=[],r=0;for(o[r++]=n[0],o[r++]=n[1],o[r++]=n[2],this.order===3&&(o[r++]=n[3]);n.length>1;){i=[];for(let a=0,l,c=n.length-1;a<c;a++)l=E.lerp(e,n[a],n[a+1]),o[r++]=l,i.push(l);n=i}return o}split(e,n){if(e===0&&n)return this.split(n).left;if(n===1)return this.split(e).right;const i=this.hull(e),o={left:this.order===2?new N([i[0],i[3],i[5]]):new N([i[0],i[4],i[7],i[9]]),right:this.order===2?new N([i[5],i[4],i[2]]):new N([i[9],i[8],i[6],i[3]]),span:i};return o.left._t1=E.map(0,0,1,this._t1,this._t2),o.left._t2=E.map(e,0,1,this._t1,this._t2),o.right._t1=E.map(e,0,1,this._t1,this._t2),o.right._t2=E.map(1,0,1,this._t1,this._t2),n?(n=E.map(n,e,1,0,1),o.right.split(n).left):o}extrema(){const e={};let n=[];return this.dims.forEach((function(i){let o=function(a){return a[i]},r=this.dpoints[0].map(o);e[i]=E.droots(r),this.order===3&&(r=this.dpoints[1].map(o),e[i]=e[i].concat(E.droots(r))),e[i]=e[i].filter(function(a){return a>=0&&a<=1}),n=n.concat(e[i].sort(E.numberSort))}).bind(this)),e.values=n.sort(E.numberSort).filter(function(i,o){return n.indexOf(i)===o}),e}bbox(){const e=this.extrema(),n={};return this.dims.forEach((function(i){n[i]=E.getminmax(this,i,e[i])}).bind(this)),n}overlaps(e){const n=this.bbox(),i=e.bbox();return E.bboxoverlap(n,i)}offset(e,n){if(typeof n<"u"){const i=this.get(e),o=this.normal(e),r={c:i,n:o,x:i.x+o.x*n,y:i.y+o.y*n};return this._3d&&(r.z=i.z+o.z*n),r}if(this._linear){const i=this.normal(0),o=this.points.map(function(r){const a={x:r.x+e*i.x,y:r.y+e*i.y};return r.z&&i.z&&(a.z=r.z+e*i.z),a});return[new N(o)]}return this.reduce().map(function(i){return i._linear?i.offset(e)[0]:i.scale(e)})}simple(){if(this.order===3){const o=E.angle(this.points[0],this.points[3],this.points[1]),r=E.angle(this.points[0],this.points[3],this.points[2]);if(o>0&&r<0||o<0&&r>0)return!1}const e=this.normal(0),n=this.normal(1);let i=e.x*n.x+e.y*n.y;return this._3d&&(i+=e.z*n.z),fe(Cn(i))<In/3}reduce(){let e,n=0,i=0,o=.01,r,a=[],l=[],c=this.extrema().values;for(c.indexOf(0)===-1&&(c=[0].concat(c)),c.indexOf(1)===-1&&c.push(1),n=c[0],e=1;e<c.length;e++)i=c[e],r=this.split(n,i),r._t1=n,r._t2=i,a.push(r),n=i;return a.forEach(function(h){for(n=0,i=0;i<=1;)for(i=n+o;i<=1+o;i+=o)if(r=h.split(n,i),!r.simple()){if(i-=o,fe(n-i)<o)return[];r=h.split(n,i),r._t1=E.map(n,0,1,h._t1,h._t2),r._t2=E.map(i,0,1,h._t1,h._t2),l.push(r),n=i;break}n<1&&(r=h.split(n,1),r._t1=E.map(n,0,1,h._t1,h._t2),r._t2=h._t2,l.push(r))}),l}translate(e,n,i){i=typeof i=="number"?i:n;const o=this.order;let r=this.points.map((a,l)=>(1-l/o)*n+l/o*i);return new N(this.points.map((a,l)=>({x:a.x+e.x*r[l],y:a.y+e.y*r[l]})))}scale(e){const n=this.order;let i=!1;if(typeof e=="function"&&(i=e),i&&n===2)return this.raise().scale(i);const o=this.clockwise,r=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):e,i?i(1):e);const a=i?i(0):e,l=i?i(1):e,c=[this.offset(0,10),this.offset(1,10)],h=[],u=E.lli4(c[0],c[0].c,c[1],c[1].c);if(!u)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(f){const d=h[f*n]=E.copy(r[f*n]);d.x+=(f?l:a)*c[f].n.x,d.y+=(f?l:a)*c[f].n.y}),i?([0,1].forEach(function(f){if(!(n===2&&f)){var d=r[f+1],p={x:d.x-u.x,y:d.y-u.y},m=i?i((f+1)/n):e;i&&!o&&(m=-m);var g=de(p.x*p.x+p.y*p.y);p.x/=g,p.y/=g,h[f+1]={x:d.x+m*p.x,y:d.y+m*p.y}}}),new N(h)):([0,1].forEach(f=>{if(n===2&&f)return;const d=h[f*n],p=this.derivative(f),m={x:d.x+p.x,y:d.y+p.y};h[f+1]=E.lli4(d,m,u,r[f+1])}),new N(h))}outline(e,n,i,o){if(n=n===void 0?e:n,this._linear){const b=this.normal(0),C=this.points[0],M=this.points[this.points.length-1];let P,w,S;i===void 0&&(i=e,o=n),P={x:C.x+b.x*e,y:C.y+b.y*e},S={x:M.x+b.x*i,y:M.y+b.y*i},w={x:(P.x+S.x)/2,y:(P.y+S.y)/2};const T=[P,w,S];P={x:C.x-b.x*n,y:C.y-b.y*n},S={x:M.x-b.x*o,y:M.y-b.y*o},w={x:(P.x+S.x)/2,y:(P.y+S.y)/2};const k=[S,w,P],D=E.makeline(k[2],T[0]),R=E.makeline(T[2],k[0]),$=[D,new N(T),R,new N(k)];return new me($)}const r=this.reduce(),a=r.length,l=[];let c=[],h,u=0,f=this.length();const d=typeof i<"u"&&typeof o<"u";function p(b,C,M,P,w){return function(S){const T=P/M,k=(P+w)/M,D=C-b;return E.map(S,0,1,b+T*D,b+k*D)}}r.forEach(function(b){const C=b.length();d?(l.push(b.scale(p(e,i,f,u,C))),c.push(b.scale(p(-n,-o,f,u,C)))):(l.push(b.scale(e)),c.push(b.scale(-n))),u+=C}),c=c.map(function(b){return h=b.points,h[3]?b.points=[h[3],h[2],h[1],h[0]]:b.points=[h[2],h[1],h[0]],b}).reverse();const m=l[0].points[0],g=l[a-1].points[l[a-1].points.length-1],v=c[a-1].points[c[a-1].points.length-1],y=c[0].points[0],x=E.makeline(v,m),_=E.makeline(g,y),I=[x].concat(l).concat([_]).concat(c);return new me(I)}outlineshapes(e,n,i){n=n||e;const o=this.outline(e,n).curves,r=[];for(let a=1,l=o.length;a<l/2;a++){const c=E.makeshape(o[a],o[l-a],i);c.startcap.virtual=a>1,c.endcap.virtual=a<l/2-1,r.push(c)}return r}intersects(e,n){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof N&&(e=e.reduce()),this.curveintersects(this.reduce(),e,n)):this.selfintersects(n)}lineIntersects(e){const n=gt(e.p1.x,e.p2.x),i=gt(e.p1.y,e.p2.y),o=mt(e.p1.x,e.p2.x),r=mt(e.p1.y,e.p2.y);return E.roots(this.points,e).filter(a=>{var l=this.get(a);return E.between(l.x,n,o)&&E.between(l.y,i,r)})}selfintersects(e){const n=this.reduce(),i=n.length-2,o=[];for(let r=0,a,l,c;r<i;r++)l=n.slice(r,r+1),c=n.slice(r+2),a=this.curveintersects(l,c,e),o.push(...a);return o}curveintersects(e,n,i){const o=[];e.forEach(function(a){n.forEach(function(l){a.overlaps(l)&&o.push({left:a,right:l})})});let r=[];return o.forEach(function(a){const l=E.pairiteration(a.left,a.right,i);l.length>0&&(r=r.concat(l))}),r}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,n,i,o){const r=(o-i)/4,a=this.get(i+r),l=this.get(o-r),c=E.dist(e,n),h=E.dist(e,a),u=E.dist(e,l);return fe(h-c)+fe(u-c)}_iterate(e,n){let i=0,o=1,r;do{r=0,o=1;let a=this.get(i),l,c,h,u,f=!1,d=!1,p,m=o,g=1;do if(d=f,u=h,m=(i+o)/2,l=this.get(m),c=this.get(o),h=E.getccenter(a,l,c),h.interval={start:i,end:o},f=this._error(h,a,i,o)<=e,p=d&&!f,p||(g=o),f){if(o>=1){if(h.interval.end=g=1,u=h,o>1){let y={x:h.x+h.r*zn(h.e),y:h.y+h.r*En(h.e)};h.e+=E.angle({x:h.x,y:h.y},y,this.get(1))}break}o=o+(o-i)/2}else o=m;while(!p&&r++<100);if(r>=100)break;u=u||h,n.push(u),i=g}while(o<1);return n}}var Sn=(function(){function s(e,n){var i=[],o=!0,r=!1,a=void 0;try{for(var l=e[Symbol.iterator](),c;!(o=(c=l.next()).done)&&(i.push(c.value),!(n&&i.length===n));o=!0);}catch(h){r=!0,a=h}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}return i}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return s(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),ye=Math.PI*2,qe=function(e,n,i,o,r,a,l){var c=e.x,h=e.y;c*=n,h*=i;var u=o*c-r*h,f=r*c+o*h;return{x:u+a,y:f+l}},Tn=function(e,n){var i=n===1.5707963267948966?.551915024494:n===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(n/4),o=Math.cos(e),r=Math.sin(e),a=Math.cos(e+n),l=Math.sin(e+n);return[{x:o-r*i,y:r+o*i},{x:a+l*i,y:l-a*i},{x:a,y:l}]},yt=function(e,n,i,o){var r=e*o-n*i<0?-1:1,a=e*i+n*o;return a>1&&(a=1),a<-1&&(a=-1),r*Math.acos(a)},kn=function(e,n,i,o,r,a,l,c,h,u,f,d){var p=Math.pow(r,2),m=Math.pow(a,2),g=Math.pow(f,2),v=Math.pow(d,2),y=p*m-p*v-m*g;y<0&&(y=0),y/=p*v+m*g,y=Math.sqrt(y)*(l===c?-1:1);var x=y*r/a*d,_=y*-a/r*f,I=u*x-h*_+(e+i)/2,b=h*x+u*_+(n+o)/2,C=(f-x)/r,M=(d-_)/a,P=(-f-x)/r,w=(-d-_)/a,S=yt(1,0,C,M),T=yt(C,M,P,w);return c===0&&T>0&&(T-=ye),c===1&&T<0&&(T+=ye),[I,b,S,T]},Dn=function(e){var n=e.px,i=e.py,o=e.cx,r=e.cy,a=e.rx,l=e.ry,c=e.xAxisRotation,h=c===void 0?0:c,u=e.largeArcFlag,f=u===void 0?0:u,d=e.sweepFlag,p=d===void 0?0:d,m=[];if(a===0||l===0)return[];var g=Math.sin(h*ye/360),v=Math.cos(h*ye/360),y=v*(n-o)/2+g*(i-r)/2,x=-g*(n-o)/2+v*(i-r)/2;if(y===0&&x===0)return[];a=Math.abs(a),l=Math.abs(l);var _=Math.pow(y,2)/Math.pow(a,2)+Math.pow(x,2)/Math.pow(l,2);_>1&&(a*=Math.sqrt(_),l*=Math.sqrt(_));var I=kn(n,i,o,r,a,l,f,p,g,v,y,x),b=Sn(I,4),C=b[0],M=b[1],P=b[2],w=b[3],S=Math.abs(w)/(ye/4);Math.abs(1-S)<1e-7&&(S=1);var T=Math.max(Math.ceil(S),1);w/=T;for(var k=0;k<T;k++)m.push(Tn(P,w)),P+=w;return m.map(function(D){var R=qe(D[0],a,l,v,g,C,M),$=R.x,A=R.y,L=qe(D[1],a,l,v,g,C,M),U=L.x,O=L.y,H=qe(D[2],a,l,v,g,C,M),le=H.x,Ge=H.y;return{x1:$,y1:A,x2:U,y2:O,x:le,y:Ge}})};function An(s,e){return s>e?1:s<e?-1:0}class ct{constructor(e=An,n=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!n}rotateLeft(e){var n=e.right;n&&(e.right=n.left,n.left&&(n.left.parent=e),n.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=n:e.parent.right=n:this._root=n,n&&(n.left=e),e.parent=n}rotateRight(e){var n=e.left;n&&(e.left=n.right,n.right&&(n.right.parent=e),n.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=n:e.parent.right=n:this._root=n,n&&(n.right=e),e.parent=n}_splay(e){for(;e.parent;){var n=e.parent;n.parent?n.left===e&&n.parent.left===n?(this.rotateRight(n.parent),this.rotateRight(n)):n.right===e&&n.parent.right===n?(this.rotateLeft(n.parent),this.rotateLeft(n)):n.left===e&&n.parent.right===n?(this.rotateRight(n),this.rotateLeft(n)):(this.rotateLeft(n),this.rotateRight(n)):n.left===e?this.rotateRight(n):this.rotateLeft(n)}}splay(e){for(var n,i,o,r,a;e.parent;)n=e.parent,i=n.parent,i&&i.parent?(o=i.parent,o.left===i?o.left=e:o.right=e,e.parent=o):(e.parent=null,this._root=e),r=e.left,a=e.right,e===n.left?(i&&(i.left===n?(n.right?(i.left=n.right,i.left.parent=i):i.left=null,n.right=i,i.parent=n):(r?(i.right=r,r.parent=i):i.right=null,e.left=i,i.parent=e)),a?(n.left=a,a.parent=n):n.left=null,e.right=n,n.parent=e):(i&&(i.right===n?(n.left?(i.right=n.left,i.right.parent=i):i.right=null,n.left=i,i.parent=n):(a?(i.left=a,a.parent=i):i.left=null,e.right=i,i.parent=e)),r?(n.right=r,r.parent=n):n.right=null,e.left=n,n.parent=e)}replace(e,n){e.parent?e===e.parent.left?e.parent.left=n:e.parent.right=n:this._root=n,n&&(n.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,n){var i=this._root,o=null,r=this._compare,a;if(this._noDuplicates)for(;i;){if(o=i,a=r(i.key,e),a===0)return;r(i.key,e)<0?i=i.right:i=i.left}else for(;i;)o=i,r(i.key,e)<0?i=i.right:i=i.left;return i={key:e,data:n,left:null,right:null,parent:o},o?r(o.key,i.key)<0?o.right=i:o.left=i:this._root=i,this.splay(i),this._size++,i}find(e){for(var n=this._root,i=this._compare;n;){var o=i(n.key,e);if(o<0)n=n.right;else if(o>0)n=n.left;else return n}return null}contains(e){for(var n=this._root,i=this._compare;n;){var o=i(e,n.key);if(o===0)return!0;o<0?n=n.left:n=n.right}return!1}remove(e){var n=this.find(e);if(!n)return!1;if(this.splay(n),!n.left)this.replace(n,n.right);else if(!n.right)this.replace(n,n.left);else{var i=this.minNode(n.right);i.parent!==n&&(this.replace(i,i.right),i.right=n.right,i.right.parent=i),this.replace(n,i),i.left=n.left,i.left.parent=i}return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),!e.left)this.replace(e,e.right);else if(!e.right)this.replace(e,e.left);else{var n=this.minNode(e.right);n.parent!==e&&(this.replace(n,n.right),n.right=e.right,n.right.parent=n),this.replace(e,n),n.left=e.left,n.left.parent=n}return this._size--,!0}erase(e){var n=this.find(e);if(n){this.splay(n);var i=n.left,o=n.right,r=null;i&&(i.parent=null,r=this.maxNode(i),this.splay(r),this._root=r),o&&(i?r.right=o:this._root=o,o.parent=r),this._size--}}pop(){var e=this._root,n=null;if(e){for(;e.left;)e=e.left;n={key:e.key,data:e.data},this.remove(e.key)}return n}next(e){var n=e;if(n)if(n.right)for(n=n.right;n&&n.left;)n=n.left;else for(n=e.parent;n&&n.right===e;)e=n,n=n.parent;return n}prev(e){var n=e;if(n)if(n.left)for(n=n.left;n&&n.right;)n=n.right;else for(n=e.parent;n&&n.left===e;)e=n,n=n.parent;return n}forEach(e){for(var n=this._root,i=[],o=!1,r=0;!o;)n?(i.push(n),n=n.left):i.length>0?(n=i.pop(),e(n,r++),n=n.right):o=!0;return this}range(e,n,i,o){const r=[],a=this._compare;let l=this._root,c;for(;r.length!==0||l;)if(l)r.push(l),l=l.left;else{if(l=r.pop(),c=a(l.key,n),c>0)break;if(a(l.key,e)>=0&&i.call(o,l))return this;l=l.right}return this}keys(){for(var e=this._root,n=[],i=[],o=!1;!o;)e?(n.push(e),e=e.left):n.length>0?(e=n.pop(),i.push(e.key),e=e.right):o=!0;return i}values(){for(var e=this._root,n=[],i=[],o=!1;!o;)e?(n.push(e),e=e.left):n.length>0?(e=n.pop(),i.push(e.data),e=e.right):o=!0;return i}at(e){for(var n=this._root,i=[],o=!1,r=0;!o;)if(n)i.push(n),n=n.left;else if(i.length>0){if(n=i.pop(),r===e)return n;r++,n=n.right}else o=!0;return null}load(e=[],n=[],i=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const o=e.length;return i&&it(e,n,0,o-1,this._compare),this._root=nt(null,e,n,0,o),this._size=o,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,n,i,o,r){return new ct(i,r).load(e,n,o)}}function nt(s,e,n,i,o){const r=o-i;if(r>0){const a=i+Math.floor(r/2),l=e[a],c=n[a],h={key:l,data:c,parent:s};return h.left=nt(h,e,n,i,a),h.right=nt(h,e,n,a+1,o),h}return null}function it(s,e,n,i,o){if(n>=i)return;const r=s[n+i>>1];let a=n-1,l=i+1;for(;;){do a++;while(o(s[a],r)<0);do l--;while(o(s[l],r)>0);if(a>=l)break;let c=s[a];s[a]=s[l],s[l]=c,c=e[a],e[a]=e[l],e[l]=c}it(s,e,n,l,o),it(s,e,l+1,i,o)}const Yt=0,Kt=1,Qt=2,Jt=3,ke=0,rt=1,De=2,Zt=3;function pe(s,e,n){e===null?(s.inOut=!1,s.otherInOut=!0):(s.isSubject===e.isSubject?(s.inOut=!e.inOut,s.otherInOut=e.otherInOut):(s.inOut=!e.otherInOut,s.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(s.prevInResult=!vt(e,n)||e.isVertical()?e.prevInResult:e)),vt(s,n)?s.resultTransition=Rn(s,n):s.resultTransition=0}function vt(s,e){switch(s.type){case Yt:switch(e){case ke:return!s.otherInOut;case rt:return s.otherInOut;case De:return s.isSubject&&s.otherInOut||!s.isSubject&&!s.otherInOut;case Zt:return!0}break;case Qt:return e===ke||e===rt;case Jt:return e===De;case Kt:return!1}return!1}function Rn(s,e){let n=!s.inOut,i=!s.otherInOut,o;switch(e){case ke:o=n&&i;break;case rt:o=n||i;break;case Zt:o=n^i;break;case De:s.isSubject?o=n&&!i:o=i&&!n;break}return o?1:-1}class ae{constructor(e,n,i,o,r){this.left=n,this.point=e,this.otherEvent=i,this.isSubject=o,this.type=r||Yt,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const n=this.point,i=this.otherEvent.point;return this.left?(n[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(n[1]-e[1])>0:(i[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(i[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new ae(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function W(s,e){return s[0]===e[0]?s[1]===e[1]:!1}const X=11102230246251565e-32,G=134217729,$n=(3+8*X)*X;function je(s,e,n,i,o){let r,a,l,c,h=e[0],u=i[0],f=0,d=0;u>h==u>-h?(r=h,h=e[++f]):(r=u,u=i[++d]);let p=0;if(f<s&&d<n)for(u>h==u>-h?(a=h+r,l=r-(a-h),h=e[++f]):(a=u+r,l=r-(a-u),u=i[++d]),r=a,l!==0&&(o[p++]=l);f<s&&d<n;)u>h==u>-h?(a=r+h,c=a-r,l=r-(a-c)+(h-c),h=e[++f]):(a=r+u,c=a-r,l=r-(a-c)+(u-c),u=i[++d]),r=a,l!==0&&(o[p++]=l);for(;f<s;)a=r+h,c=a-r,l=r-(a-c)+(h-c),h=e[++f],r=a,l!==0&&(o[p++]=l);for(;d<n;)a=r+u,c=a-r,l=r-(a-c)+(u-c),u=i[++d],r=a,l!==0&&(o[p++]=l);return(r!==0||p===0)&&(o[p++]=r),p}function Ln(s,e){let n=e[0];for(let i=1;i<s;i++)n+=e[i];return n}function we(s){return new Float64Array(s)}const Nn=(3+16*X)*X,On=(2+12*X)*X,Un=(9+64*X)*X*X,ie=we(4),xt=we(8),bt=we(12),wt=we(16),V=we(4);function Gn(s,e,n,i,o,r,a){let l,c,h,u,f,d,p,m,g,v,y,x,_,I,b,C,M,P;const w=s-o,S=n-o,T=e-r,k=i-r;I=w*k,d=G*w,p=d-(d-w),m=w-p,d=G*k,g=d-(d-k),v=k-g,b=m*v-(I-p*g-m*g-p*v),C=T*S,d=G*T,p=d-(d-T),m=T-p,d=G*S,g=d-(d-S),v=S-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,ie[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,ie[1]=_-(y+f)+(f-C),P=x+y,f=P-x,ie[2]=x-(P-f)+(y-f),ie[3]=P;let D=Ln(4,ie),R=On*a;if(D>=R||-D>=R||(f=s-w,l=s-(w+f)+(f-o),f=n-S,h=n-(S+f)+(f-o),f=e-T,c=e-(T+f)+(f-r),f=i-k,u=i-(k+f)+(f-r),l===0&&c===0&&h===0&&u===0)||(R=Un*a+$n*Math.abs(D),D+=w*u+k*l-(T*h+S*c),D>=R||-D>=R))return D;I=l*k,d=G*l,p=d-(d-l),m=l-p,d=G*k,g=d-(d-k),v=k-g,b=m*v-(I-p*g-m*g-p*v),C=c*S,d=G*c,p=d-(d-c),m=c-p,d=G*S,g=d-(d-S),v=S-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,V[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,V[1]=_-(y+f)+(f-C),P=x+y,f=P-x,V[2]=x-(P-f)+(y-f),V[3]=P;const $=je(4,ie,4,V,xt);I=w*u,d=G*w,p=d-(d-w),m=w-p,d=G*u,g=d-(d-u),v=u-g,b=m*v-(I-p*g-m*g-p*v),C=T*h,d=G*T,p=d-(d-T),m=T-p,d=G*h,g=d-(d-h),v=h-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,V[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,V[1]=_-(y+f)+(f-C),P=x+y,f=P-x,V[2]=x-(P-f)+(y-f),V[3]=P;const A=je($,xt,4,V,bt);I=l*u,d=G*l,p=d-(d-l),m=l-p,d=G*u,g=d-(d-u),v=u-g,b=m*v-(I-p*g-m*g-p*v),C=c*h,d=G*c,p=d-(d-c),m=c-p,d=G*h,g=d-(d-h),v=h-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,V[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,V[1]=_-(y+f)+(f-C),P=x+y,f=P-x,V[2]=x-(P-f)+(y-f),V[3]=P;const L=je(A,bt,4,V,wt);return wt[L-1]}function Fn(s,e,n,i,o,r){const a=(e-r)*(n-o),l=(s-o)*(i-r),c=a-l;if(a===0||l===0||a>0!=l>0)return c;const h=Math.abs(a+l);return Math.abs(c)>=Nn*h?c:-Gn(s,e,n,i,o,r,h)}function ot(s,e,n){const i=Fn(s[0],s[1],e[0],e[1],n[0],n[1]);return i>0?-1:i<0?1:0}function Z(s,e){const n=s.point,i=e.point;return n[0]>i[0]?1:n[0]<i[0]?-1:n[1]!==i[1]?n[1]>i[1]?1:-1:Vn(s,e,n)}function Vn(s,e,n,i){return s.left!==e.left?s.left?1:-1:ot(n,s.otherEvent.point,e.otherEvent.point)!==0?s.isBelow(e.otherEvent.point)?-1:1:!s.isSubject&&e.isSubject?1:-1}function J(s,e,n){const i=new ae(e,!1,s,s.isSubject),o=new ae(e,!0,s.otherEvent,s.isSubject);return W(s.point,s.otherEvent.point)&&console.warn("what is that, a collapsed segment?",s),i.contourId=o.contourId=s.contourId,Z(o,s.otherEvent)>0&&(s.otherEvent.left=!0,o.left=!1),s.otherEvent.otherEvent=o,s.otherEvent=i,n.push(o),n.push(i),n}function Me(s,e){return s[0]*e[1]-s[1]*e[0]}function He(s,e){return s[0]*e[0]+s[1]*e[1]}function qn(s,e,n,i,o){const r=[e[0]-s[0],e[1]-s[1]],a=[i[0]-n[0],i[1]-n[1]];function l(v,y,x){return[v[0]+y*x[0],v[1]+y*x[1]]}const c=[n[0]-s[0],n[1]-s[1]];let h=Me(r,a),u=h*h;const f=He(r,r);if(u>0){const v=Me(c,a)/h;if(v<0||v>1)return null;const y=Me(c,r)/h;return y<0||y>1?null:v===0||v===1?[l(s,v,r)]:y===0||y===1?[l(n,y,a)]:[l(s,v,r)]}if(h=Me(c,r),u=h*h,u>0)return null;const d=He(r,c)/f,p=d+He(r,a)/f,m=Math.min(d,p),g=Math.max(d,p);return m<=1&&g>=0?m===1?[l(s,m>0?m:0,r)]:g===0?[l(s,g<1?g:1,r)]:[l(s,m>0?m:0,r),l(s,g<1?g:1,r)]:null}function We(s,e,n){const i=qn(s.point,s.otherEvent.point,e.point,e.otherEvent.point),o=i?i.length:0;if(o===0||o===1&&(W(s.point,e.point)||W(s.otherEvent.point,e.otherEvent.point))||o===2&&s.isSubject===e.isSubject)return 0;if(o===1)return!W(s.point,i[0])&&!W(s.otherEvent.point,i[0])&&J(s,i[0],n),!W(e.point,i[0])&&!W(e.otherEvent.point,i[0])&&J(e,i[0],n),1;const r=[];let a=!1,l=!1;return W(s.point,e.point)?a=!0:Z(s,e)===1?r.push(e,s):r.push(s,e),W(s.otherEvent.point,e.otherEvent.point)?l=!0:Z(s.otherEvent,e.otherEvent)===1?r.push(e.otherEvent,s.otherEvent):r.push(s.otherEvent,e.otherEvent),a&&l||a?(e.type=Kt,s.type=e.inOut===s.inOut?Qt:Jt,a&&!l&&J(r[1].otherEvent,r[0].point,n),2):l?(J(r[0],r[1].point,n),3):r[0]!==r[3].otherEvent?(J(r[0],r[1].point,n),J(r[1],r[2].point,n),3):(J(r[0],r[1].point,n),J(r[3].otherEvent,r[2].point,n),3)}function jn(s,e){if(s===e)return 0;if(ot(s.point,s.otherEvent.point,e.point)!==0||ot(s.point,s.otherEvent.point,e.otherEvent.point)!==0)return W(s.point,e.point)?s.isBelow(e.otherEvent.point)?-1:1:s.point[0]===e.point[0]?s.point[1]<e.point[1]?-1:1:Z(s,e)===1?e.isAbove(s.point)?-1:1:s.isBelow(e.point)?-1:1;if(s.isSubject===e.isSubject){let n=s.point,i=e.point;if(n[0]===i[0]&&n[1]===i[1])return n=s.otherEvent.point,i=e.otherEvent.point,n[0]===i[0]&&n[1]===i[1]?0:s.contourId>e.contourId?1:-1}else return s.isSubject?-1:1;return Z(s,e)===1?1:-1}function Hn(s,e,n,i,o,r){const a=new ct(jn),l=[],c=Math.min(i[2],o[2]);let h,u,f;for(;s.length!==0;){let d=s.pop();if(l.push(d),d.point[0]>c||r===De)break;if(d.left){u=h=a.insert(d),f=a.minNode(),h!==f?h=a.prev(h):h=null,u=a.next(u);const p=h?h.key:null;let m;if(pe(d,p,r),u&&We(d,u.key,s)===2&&(pe(d,p,r),pe(u.key,d,r)),h&&We(h.key,d,s)===2){let g=h;g!==f?g=a.prev(g):g=null,m=g?g.key:null,pe(p,m,r),pe(d,p,r)}}else d=d.otherEvent,u=h=a.find(d),h&&u&&(h!==f?h=a.prev(h):h=null,u=a.next(u),a.remove(d),u&&h&&We(h.key,u.key,s))}return l}class Wn{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function Bn(s){let e,n,i,o;const r=[];for(n=0,i=s.length;n<i;n++)e=s[n],(e.left&&e.inResult||!e.left&&e.otherEvent.inResult)&&r.push(e);let a=!1;for(;!a;)for(a=!0,n=0,i=r.length;n<i;n++)n+1<i&&Z(r[n],r[n+1])===1&&(o=r[n],r[n]=r[n+1],r[n+1]=o,a=!1);for(n=0,i=r.length;n<i;n++)e=r[n],e.otherPos=n;for(n=0,i=r.length;n<i;n++)e=r[n],e.left||(o=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=o);return r}function Xn(s,e,n,i){let o=s+1,r=e[s].point,a;const l=e.length;for(o<l&&(a=e[o].point);o<l&&a[0]===r[0]&&a[1]===r[1];){if(n[o])o++;else return o;o<l&&(a=e[o].point)}for(o=s-1;n[o]&&o>i;)o--;return o}function Yn(s,e,n){const i=new Wn;if(s.prevInResult!=null){const o=s.prevInResult,r=o.outputContourId;if(o.resultTransition>0){const l=e[r];if(l.holeOf!=null){const c=l.holeOf;e[c].holeIds.push(n),i.holeOf=c,i.depth=e[r].depth}else e[r].holeIds.push(n),i.holeOf=r,i.depth=e[r].depth+1}else i.holeOf=null,i.depth=e[r].depth}else i.holeOf=null,i.depth=0;return i}function Kn(s){let e,n;const i=Bn(s),o={},r=[];for(e=0,n=i.length;e<n;e++){if(o[e])continue;const a=r.length,l=Yn(i[e],r,a),c=d=>{o[d]=!0,d<i.length&&i[d]&&(i[d].outputContourId=a)};let h=e,u=e;const f=i[e].point;for(l.points.push(f);c(h),h=i[h].otherPos,c(h),l.points.push(i[h].point),h=Xn(h,i,o,u),!(h==u||h>=i.length||!i[h]););r.push(l)}return r}var ze={exports:{}},_t;function Qn(){if(_t)return ze.exports;_t=1,ze.exports=s,ze.exports.default=s;function s(n,i){if(!(this instanceof s))return new s(n,i);if(this.data=n||[],this.length=this.data.length,this.compare=i||e,this.length>0)for(var o=(this.length>>1)-1;o>=0;o--)this._down(o)}function e(n,i){return n<i?-1:n>i?1:0}return s.prototype={push:function(n){this.data.push(n),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var n=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),n}},peek:function(){return this.data[0]},_up:function(n){for(var i=this.data,o=this.compare,r=i[n];n>0;){var a=n-1>>1,l=i[a];if(o(r,l)>=0)break;i[n]=l,n=a}i[n]=r},_down:function(n){for(var i=this.data,o=this.compare,r=this.length>>1,a=i[n];n<r;){var l=(n<<1)+1,c=l+1,h=i[l];if(c<this.length&&o(i[c],h)<0&&(l=c,h=i[c]),o(h,a)>=0)break;i[n]=h,n=l}i[n]=a}},ze.exports}var Jn=Qn();const Zn=Wt(Jn),Pt=Math.max,Mt=Math.min;let Ee=0;function zt(s,e,n,i,o,r){let a,l,c,h,u,f;for(a=0,l=s.length-1;a<l;a++){if(c=s[a],h=s[a+1],u=new ae(c,!1,void 0,e),f=new ae(h,!1,u,e),u.otherEvent=f,c[0]===h[0]&&c[1]===h[1])continue;u.contourId=f.contourId=n,r||(u.isExteriorRing=!1,f.isExteriorRing=!1),Z(u,f)>0?f.left=!0:u.left=!0;const d=c[0],p=c[1];o[0]=Mt(o[0],d),o[1]=Mt(o[1],p),o[2]=Pt(o[2],d),o[3]=Pt(o[3],p),i.push(u),i.push(f)}}function ei(s,e,n,i,o){const r=new Zn(null,Z);let a,l,c,h,u,f;for(c=0,h=s.length;c<h;c++)for(a=s[c],u=0,f=a.length;u<f;u++)l=u===0,l&&Ee++,zt(a[u],!0,Ee,r,n,l);for(c=0,h=e.length;c<h;c++)for(a=e[c],u=0,f=a.length;u<f;u++)l=u===0,l&&Ee++,zt(a[u],!1,Ee,r,i,l);return r}const Ae=[];function ti(s,e,n){let i=null;return s.length*e.length===0&&(i=Ae),i}function ni(s,e,n,i,o){let r=null;return(n[0]>i[2]||i[0]>n[2]||n[1]>i[3]||i[1]>n[3])&&(r=Ae),r}function ii(s,e,n){typeof s[0][0][0]=="number"&&(s=[s]),typeof e[0][0][0]=="number"&&(e=[e]);let i=ti(s,e);if(i)return i===Ae?null:i;const o=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],a=ei(s,e,o,r);if(i=ni(s,e,o,r),i)return i===Ae?null:i;const l=Hn(a,s,e,o,r,n),c=Kn(l),h=[];for(let u=0;u<c.length;u++){let f=c[u];if(f.isExterior()){let d=[f.points];for(let p=0;p<f.holeIds.length;p++){let m=f.holeIds[p];d.push(c[m].points)}h.push(d)}}return h}function ri(s,e){return ii(s,e,ke)}function Re(s,e){const n=s[0]-e[0],i=s[1]-e[1];return n*n+i*i}function oi(s){return{vertices:s.vertices,pieces:Array.from(s.pieces.entries()),edges:Array.from(s.edges.entries()),halfEdges:Array.from(s.halfEdges.entries()),boundary:s.boundary,borderPath:s.borderPath}}function en(s,e){let[n,i]=s,[o,r]=s;const a=l=>{n=Math.min(n,l[0]),i=Math.min(i,l[1]),o=Math.max(o,l[0]),r=Math.max(r,l[1])};for(const l of e)l.type==="line"?a(l.p):(a(l.p1),a(l.p2),a(l.p3));return[n,i,o,r]}function tn(s,e){let n=1/0,i=1/0,o=-1/0,r=-1/0;const a=s.halfEdge;let l=e.halfEdges.get(a);if(!l)return s.bounds;const c=h=>{n=Math.min(n,h[0]),i=Math.min(i,h[1]),o=Math.max(o,h[0]),r=Math.max(r,h[1])};do{if(c(l.origin),l.segments){const h=en(l.origin,l.segments);c([h[0],h[1]]),c([h[2],h[3]])}l=e.halfEdges.get(l.next)}while(l&&l.id!==a);return[n,i,o,r]}const Et=100,nn=Et*Et;function si(s,e){let n=-1,i=nn;for(let o=0;o<s.vertices.length;o++){const r=Re(s.vertices[o],e);r<i&&(i=r,n=o)}return n===-1?null:n}function ai(s,e){let n=null,i=nn;for(const o of s.pieces.values()){const r=Re(o.site,e);r<i&&(i=r,n=o.id)}return n}function st(s){if(s.length===0)return[0,0,0,0];let e=s[0][0],n=s[0][1],i=e,o=n;for(let r=1;r<s.length;r++){const a=s[r];e=Math.min(e,a[0]),n=Math.min(n,a[1]),i=Math.max(i,a[0]),o=Math.max(o,a[1])}return[e,n,i,o]}function li(s,e){return Math.abs(s[0]-e[0])<1e-6&&Math.abs(s[1]-e[1])<1e-6}function rn(s,e,n,i){if(!s.tabs)return;const o=e.halfEdges.get(s.heLeft),r=e.halfEdges.get(s.heRight),a=o.origin,l=r.origin,c=[];let h=a;s.tabs.sort((u,f)=>u.position-f.position);for(const u of s.tabs){const f=u.position-u.size/2,d=[a[0]+(l[0]-a[0])*f,a[1]+(l[1]-a[1])*f];Math.hypot(d[0]-h[0],d[1]-h[1])>1e-6&&c.push({type:"line",p:d});const p=[a[0]+(l[0]-a[0])*(f+u.size),a[1]+(l[1]-a[1])*(f+u.size)],m=n.createTabSegments(d,p,u,i);c.push(...m),h=p}Math.hypot(l[0]-h[0],l[1]-h[1])>1e-6&&c.push({type:"line",p:l}),o.segments=c,r.segments=ci(c,a),s.bounds=en(a,c)}function ci(s,e){const n=[];for(let i=s.length-1;i>=0;i--){const o=s[i];let r=e;if(i>0){const a=s[i-1];r=a.type==="line"?a.p:a.p3}o.type==="line"?n.push({type:"line",p:r}):n.push({type:"bezier",p1:o.p2,p2:o.p1,p3:r})}return n}function hi(s,e){const{p:n,radii:i,rotation:o,largeArc:r,sweep:a}=e,[l,c]=s,[h,u]=n,[f,d]=i;return Dn({px:l,py:c,cx:h,cy:u,rx:f,ry:d,xAxisRotation:o,largeArcFlag:r?1:0,sweepFlag:a?1:0}).map(g=>({type:"bezier",p1:[g.x1,g.y1],p2:[g.x2,g.y2],p3:[g.x,g.y]}))}function on(s){const e=[];let n=[];if(s.length===0||s[0].type!=="move")return[];let i=[0,0];for(const o of s)switch(o.type){case"move":n.length>0&&e.push(n),i=o.p,n=[i];break;case"line":n.push(o.p),i=o.p;break;case"bezier":{const{p1:r,p2:a,p3:l}=o,h=new N([...i,...r,...a,...l]).getLUT(100);n.push(...h.slice(1).map(u=>[u.x,u.y])),i=l;break}case"arc":{const r=hi(i,o);let a=i;for(const l of r){const h=new N([...a,...l.p1,...l.p2,...l.p3]).getLUT(100);n.push(...h.slice(1).map(u=>[u.x,u.y])),a=l.p3}i=o.p;break}}return n.length>0&&e.push(n),e}function ht(s,e){if(e.length>0&&e[0].type!=="move")throw new Error("Boundary path must start with a 'move' command.");const n=on(e);let i=0;for(const o of n)di(s,o)&&i++;return i%2===1}function ui(s){return Array.isArray(s[0])&&Array.isArray(s[0][0])&&typeof s[0][0][0]=="number"}function fi(s,e){const n=[s.map(r=>[r[0],r[1]])],i=[e.map(r=>[r[0],r[1]])],o=ri(n,i);return!o||o.length===0?null:ui(o)?o:o.map(r=>r[0].map(a=>[a[0],a[1]]))}function di(s,e){const[n,i]=s;let o=!1;for(let r=0,a=e.length-1;r<e.length;a=r++){const[l,c]=e[r],[h,u]=e[a];c>i!=u>i&&n<(h-l)*(i-c)/(u-c)+l&&(o=!o)}return o}function pi(s,e,n){const i=[];for(const r of s)n.vertices.find(a=>li(a,r))||n.vertices.push(r);for(const r of s){const a={id:Bt(),origin:r,twin:-1,next:-1,prev:-1,piece:e};i.push(a)}const o=i.length;for(let r=0;r<o;r++){const a=(r+1)%o,l=(r+o-1)%o;i[r].next=i[a].id,i[r].prev=i[l].id}return i.forEach(r=>n.halfEdges.set(r.id,r)),i}function sn(s,e,n,i){const o=(a,l)=>`${a[0]},${a[1]}-${l[0]},${l[1]}`,r=s.length;for(let a=0;a<r;a++){const l=s[a],c=l.origin,h=e.halfEdges.get(l.next).origin,u=o(h,c),f=n.get(u),d=Bt();let p;if(f!==void 0){const m=e.halfEdges.get(f);l.twin=m.id,m.twin=l.id,p={id:d,heLeft:m.id,heRight:l.id,bounds:st([c,h])},n.delete(u)}else{const m=o(c,h);if(n.set(m,l.id),i(c,h))p={id:d,heLeft:l.id,heRight:-1,bounds:st([c,h])},e.boundary.push(d);else continue}e.edges.set(d,p)}}function an(s){return function(){let e=s+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}async function $e(s){const{bounds:e,pieceSize:n,border:i}=s,{pointConfig:o,pieceConfig:r,placementConfig:a,tabConfig:l}=s;console.log(`rebuilding puzzle with dimensions ${e.width}x${e.height}, piece size ${n}`);const c=ve.create(i,e,o),h=xe.create(i,e,r),u=be.create(i,e,a),f=te.create(i,e,l),d=s.seed??new Date().getTime(),p=an(d),m=s.seedPoints??c.generatePoints({width:e.width,height:e.height,pieceSize:n,random:p,border:i});console.log(`${s.seedPoints?"Using":"Generated"} ${m.length} points`);const g=h.generatePieces(m,{random:p,pieceSize:n,border:i,bounds:e});if(console.log(`Generated ${g.pieces.size} pieces`),!s.skipTabs){u.placeTabs({topology:g,random:p});for(const y of g.edges.values())y.heRight!==-1&&y.tabs&&y.tabs.length>0&&rn(y,g,f,p)}return{created:new Date().toISOString(),seed:d,width:e.width,height:e.height,pieceSize:n,pointConfig:o,pieceConfig:r,placementConfig:a,tabConfig:l,seedPoints:m,vertices:g.vertices,boundary:g.boundary,borderPath:g.borderPath,pieces:g.pieces,edges:g.edges,halfEdges:g.halfEdges}}async function gi(s,e,n){const i=[...s.seedPoints];let o=0;for(const r of s.pieces.values()){if(r.id===e){i[o]=n;break}o++}return $e({bounds:{width:s.width,height:s.height},border:s.borderPath,pieceSize:s.pieceSize,pointConfig:s.pointConfig,pieceConfig:s.pieceConfig,placementConfig:s.placementConfig,tabConfig:s.tabConfig,seed:s.seed,seedPoints:i,skipTabs:!1})}function Ce(s,e,n,i){const o=e.getContext("2d");if(!o){console.error("Could not get 2D context from canvas");return}o.clearRect(0,0,e.width,e.height);{o.strokeStyle=n,o.lineWidth=1,o.beginPath();for(const r of s.edges.values()){const a=s.halfEdges.get(r.heLeft);if(a)if(o.moveTo(a.origin[0],a.origin[1]),a.segments&&a.segments.length>0)for(const l of a.segments)switch(l.type){case"bezier":o.bezierCurveTo(l.p1[0],l.p1[1],l.p2[0],l.p2[1],l.p3[0],l.p3[1]);break;case"line":o.lineTo(l.p[0],l.p[1]);break}else{let l;a.twin!==-1?l=s.halfEdges.get(a.twin).origin:l=s.halfEdges.get(a.next).origin,o.lineTo(l[0],l[1])}}o.stroke()}if(s.problems&&s.problems.length>0){o.lineWidth=2,o.strokeStyle="red";for(const r of s.problems){const[a,l]=r;o.beginPath(),o.arc(a,l,8,0,2*Math.PI),o.stroke()}}if(i){o.fillStyle=i;for(const r of s.pieces.values()){const[a,l]=r.site;o.beginPath(),o.arc(a,l,3,0,2*Math.PI),o.fill()}}}function at(s,e){return[{type:"move",p:[0,0]},{type:"line",p:[s,0]},{type:"line",p:[s,e]},{type:"line",p:[0,e]},{type:"line",p:[0,0]}]}function mi(s){const e=s/2,n=e;return[{type:"move",p:[0,n]},{type:"arc",p:[s,n],radii:[e,e],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,n],radii:[e,e],rotation:0,largeArc:!1,sweep:!0}]}function yi(s,e){const n=s/2,i=e/2;return[{type:"move",p:[0,i]},{type:"arc",p:[s,i],radii:[n,i],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,i],radii:[n,i],rotation:0,largeArc:!1,sweep:!0}]}function vi(s,e,n){const i=Math.min(s,e)/2,o=Math.min(n,i);return[{type:"move",p:[o,0]},{type:"line",p:[s-o,0]},{type:"arc",p:[s,o],radii:[o,o],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[s,e-o]},{type:"arc",p:[s-o,e],radii:[o,o],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[o,e]},{type:"arc",p:[0,e-o],radii:[o,o],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[0,o]},{type:"arc",p:[o,0],radii:[o,o],rotation:0,largeArc:!1,sweep:!0}]}function xi(s,e,n){if(e<0||e>=s.vertices.length){console.warn("moveVertex called with invalid vertex index:",e);return}const i=s.vertices[e];s.vertices[e]=n;const o=[];for(const l of s.halfEdges.values())l.origin[0]===i[0]&&l.origin[1]===i[1]&&o.push(l);const r=new Set,a=[n[0]-i[0],n[1]-i[1]];for(const l of o){l.origin=n,r.add(l.piece);const c=s.halfEdges.get(l.prev);if(c?.segments){const h=c.segments[c.segments.length-1];h.type==="line"?h.p=n:(h.p3=n,h.p1=[h.p1[0]+a[0],h.p1[1]+a[1]],h.p2=[h.p2[0]+a[0],h.p2[1]+a[1]]),r.add(c.piece)}}bi(s,e);for(const l of r){const c=s.pieces.get(l);c&&(c.bounds=tn(c,s))}}function bi(s,e){const{seed:n,width:i,height:o,placementConfig:r,tabConfig:a}=s,l=an(n),c=at(i,o),h={width:i,height:o},u=be.create(c,h,r),f=te.create(c,h,a),d=new Set,p=s.vertices[e],m=new Map;for(const v of s.edges.values())m.set(v.heLeft,v),v.heRight!==-1&&m.set(v.heRight,v);for(const v of s.halfEdges.values()){const y=s.halfEdges.get(v.next)?.origin;if(v.origin===p||y===p){const I=m.get(v.id);I&&d.add(I)}}u.updateTabPlacements(Array.from(d),{topology:s,random:l});const g=new Set;for(const v of d)if(v.heRight!==-1){const x=s.halfEdges.get(v.heLeft);x&&(x.segments=void 0,g.add(s.pieces.get(x.piece)));const _=s.halfEdges.get(v.heRight);_&&(_.segments=void 0,g.add(s.pieces.get(_.piece))),rn(v,s,f,l)}for(const v of g)v.bounds=tn(v,s)}const Ct=50,It=5,St=It*It,wi=()=>{const s={canvas:null,isDragging:!1,draggedVertexId:-1,draggedSeedPointId:-1,lastRegenerationTime:0,pendingRegeneration:null,documentMouseMove:null,documentMouseUp:null},e=(h,u)=>{if(u.pointColor){for(const f of u.puzzle.pieces.values())if(Re(f.site,h)<St)return!0}for(const f of u.puzzle.vertices)if(Re(f,h)<St)return!0;return!1},n=h=>{if(!s.canvas)return[0,0];const u=s.canvas.getBoundingClientRect();if(h instanceof TouchEvent){if(h.changedTouches.length>0){const f=h.changedTouches[0];return[f.clientX-u.left,f.clientY-u.top]}}else return[h.clientX-u.left,h.clientY-u.top];return[0,0]},i=(h,u)=>{if(u.pointColor){const d=ai(u.puzzle,h);if(d!==null)return{type:"seedPoint",id:d}}const f=si(u.puzzle,h);return f!==null?{type:"vertex",id:f}:{type:"none"}},o=(h,u)=>{if(h.redraw=!1,s.isDragging)return;const f=n(h),d=e(f,u);s.canvas&&(s.canvas.style.cursor=d?"grab":"default")},r=(h,u,f)=>{const d=[...h.puzzle.seedPoints];let p=0;for(const m of h.puzzle.pieces.values()){if(m.id===u){d[p]=f;break}p++}$e({bounds:{width:h.puzzle.width,height:h.puzzle.height},border:h.puzzle.borderPath,pieceSize:h.puzzle.pieceSize,pointConfig:h.puzzle.pointConfig,pieceConfig:h.puzzle.pieceConfig,placementConfig:h.puzzle.placementConfig,tabConfig:h.puzzle.tabConfig,seed:h.puzzle.seed,seedPoints:d,skipTabs:!0}).then(m=>{s.draggedSeedPointId===u&&Ce(m,s.canvas,h.color,h.pointColor)}).catch(m=>{console.error("Failed to regenerate preview:",m)})},a=(h,u)=>{if(h.redraw=!1,h instanceof TouchEvent&&h.touches.length>1){s.isDragging=!1,s.draggedVertexId=-1,s.draggedSeedPointId=-1;return}if(h instanceof MouseEvent&&h.button!==0)return;const f=n(h),d=i(f,u);d.type==="vertex"?s.draggedVertexId=d.id:d.type==="seedPoint"&&(s.draggedSeedPointId=d.id),h instanceof MouseEvent&&(s.draggedVertexId>=0||s.draggedSeedPointId>=0)&&(s.documentMouseMove=p=>{const m=p;m.redraw=!1,l(m,u)},s.documentMouseUp=p=>{const m=p;m.redraw=!1,c(m,u)},document.addEventListener("mousemove",s.documentMouseMove),document.addEventListener("mouseup",s.documentMouseUp))},l=(h,u)=>{h.redraw=!1;const f=n(h);if(s.draggedVertexId>=0){s.isDragging=!0,h.preventDefault(),s.canvas&&(s.canvas.style.cursor="grabbing"),xi(u.puzzle,s.draggedVertexId,f),Ce(u.puzzle,s.canvas,u.color,u.pointColor);return}if(s.draggedSeedPointId>=0){s.isDragging=!0,h.preventDefault(),s.canvas&&(s.canvas.style.cursor="grabbing");const d=performance.now();if(d-s.lastRegenerationTime<Ct){s.pendingRegeneration&&clearTimeout(s.pendingRegeneration),s.pendingRegeneration=window.setTimeout(()=>{r(u,s.draggedSeedPointId,f)},Ct);return}s.lastRegenerationTime=d,r(u,s.draggedSeedPointId,f)}},c=(h,u)=>{h.redraw=!1,s.pendingRegeneration&&(clearTimeout(s.pendingRegeneration),s.pendingRegeneration=null);const f=s.draggedVertexId>=0&&s.isDragging,d=s.draggedSeedPointId>=0&&s.isDragging;if(f&&(h.preventDefault(),u.onPuzzleChanged(u.puzzle)),d){h.preventDefault();const p=s.draggedSeedPointId,m=n(h);u.onSeedPointMoved&&u.onSeedPointMoved(p,m)}s.documentMouseMove&&(document.removeEventListener("mousemove",s.documentMouseMove),s.documentMouseMove=null),s.documentMouseUp&&(document.removeEventListener("mouseup",s.documentMouseUp),s.documentMouseUp=null),s.canvas&&(s.canvas.style.cursor="default"),s.isDragging=!1,s.draggedVertexId=-1,s.draggedSeedPointId=-1,s.lastRegenerationTime=0};return{oncreate:({dom:h,attrs:u})=>{if(s.canvas=h.querySelector("canvas.puzzle"),!s.canvas){console.log("couldn't get canvas element");return}u.isDirty||Ce(u.puzzle,s.canvas,u.color,u.pointColor)},onupdate:({attrs:h})=>{if(!s.canvas){console.log("couldn't get canvas element");return}h.isDirty||Ce(h.puzzle,s.canvas,h.color,h.pointColor)},onremove:()=>{s.documentMouseMove&&(document.removeEventListener("mousemove",s.documentMouseMove),s.documentMouseMove=null),s.documentMouseUp&&(document.removeEventListener("mouseup",s.documentMouseUp),s.documentMouseUp=null)},view:({attrs:h})=>z(".puzzle-stack",[z("img.background",{width:h.width,height:h.height,src:h.imageUrl}),z("canvas.puzzle",{width:h.width,height:h.height,style:{width:`${h.width}px`,height:`${h.height}px`,touchAction:"manipulation"},onmousedown:u=>a(u,h),onmousemove:u=>{o(u,h),l(u,h)},onmouseup:u=>c(u,h),ontouchstart:u=>a(u,h),ontouchmove:u=>l(u,h),ontouchend:u=>c(u,h),ontouchcancel:u=>c(u,h)})])}};function _i(s,e,n,i="black"){const r=[];for(const c of s.edges.values()){const h=s.halfEdges.get(c.heLeft);if(h)if(r.push(`M ${h.origin[0].toFixed(3)} ${h.origin[1].toFixed(3)}`),h.segments)for(const u of h.segments)switch(u.type){case"bezier":r.push(`C ${u.p1[0].toFixed(3)} ${u.p1[1].toFixed(3)}, ${u.p2[0].toFixed(3)} ${u.p2[1].toFixed(3)}, ${u.p3[0].toFixed(3)} ${u.p3[1].toFixed(3)}`);break;case"line":r.push(`L ${u.p[0].toFixed(3)} ${u.p[1].toFixed(3)}`);break}else{let u;h.twin!==-1?u=s.halfEdges.get(h.twin).origin:u=s.halfEdges.get(h.next).origin,r.push(`L ${u[0].toFixed(3)} ${u[1].toFixed(3)}`)}}const a=r.join(" ");return`
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg
  width="${e}"
  height="${n}"
  viewBox="0 0 ${e} ${n}"
  xmlns="http://www.w3.org/2000/svg"
  version="1.1"
>
  <path
    d="${a}"
    fill="none"
    stroke="${i}"
    stroke-width="1"
    vector-effect="non-scaling-stroke"
  />
</svg>`.trim().replace(/\r\n/g,`
`)}function Pi(s,e="puzzle.svg"){const n=new Blob([s],{type:"image/svg+xml"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.hidden=!0,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(i),100)}const Mi={view:({attrs:s})=>z("wa-button.download-svg",{size:"small",onclick:()=>{const e=_i(s.puzzle,s.width,s.height,s.color);Pi(e,s.filename??"puzzle.svg")}},"Download SVG")},zi={view:({attrs:s})=>{const e=s.progressPercent!==void 0&&s.progressPercent<100,n=!e&&s.problems!==void 0&&s.problems==0,i=!e&&s.problems!==void 0&&s.problems>0;return z(".geometry-check-indicator",[z(".label","Geometry Check:"),z("wa-tooltip",{for:"check-geometry-now"},"Check geometry now"),z("wa-button#check-geometry-now",{variant:"neutral",appearance:"plain",size:"small",disabled:e,onclick:o=>{o.redraw=!1,s.onCheckRequested?.()}},z("wa-icon",{library:"material",name:"editor_choice",label:"Check geometry now"})),z("wa-tooltip",{for:"auto-check-geometry"},"Check geometry after every change"),z("wa-checkbox#auto-check-geometry",{checked:s.autoCheck,disabled:e,size:"small",onchange:o=>{o.redraw=!1;const r=o.target;s.onAutocheckChanged?.(r.checked)}},"auto check"),e&&z("wa-progress-bar",{label:"Geometry check progress",value:s.progressPercent??0}),n&&z("wa-badge",{variant:"success",pill:!0},"OK"),i&&z("wa-badge",{variant:"danger",pill:!0},`${s.problems} issue${s.problems===1?"":"s"}`)])}};function Ei(s,e,n=800){if(s<=n)return{width:s,height:e};const i=e/s;return{width:n,height:Math.round(n*i)}}const Ci=()=>{const s={inputElement:void 0};return{view:({attrs:e})=>[z("wa-button.upload-button",{size:"small",disabled:e.disabled===!0,onclick:()=>{s.inputElement&&s.inputElement.click()}},e.label??"Upload Image"),z("input[type=file]",{style:{display:"none"},accept:"image/*",oncreate:({dom:n})=>{s.inputElement=n},onchange:n=>{if(n.redraw=!1,s.inputElement){const i=s.inputElement.files?.[0];i?.type.startsWith("image/")&&createImageBitmap(i).then(o=>{const{width:r,height:a}=Ei(o.width,o.height),l=URL.createObjectURL(i);o.close(),e.onUpload(l,i.name,r,a)}).catch(o=>{console.error("could not create a bitmap image: ",o)})}}})]}},ln=()=>({view:({attrs:s})=>z("wa-checkbox.boolean-input",{hint:s.config.helpText,disabled:s.disabled,checked:s.value,onchange:e=>{const i=e.target.checked;s.onChange(i)}},s.config.label)}),Te=()=>({view:({attrs:s})=>z("wa-input.number-input",{label:s.config.label,hint:s.config.helpText,type:"number",inputmode:"numeric",size:"small",disabled:s.disabled,value:s.value,min:s.config.min,max:s.config.max,onchange:e=>{const n=e.target,i=parseFloat(n.value??"");s.onChange(isNaN(i)?void 0:i)}})}),Ii=()=>({view:({attrs:s})=>z("wa-slider.range-input",{label:s.config.label,hint:s.config.helpText,disabled:s.disabled,value:s.value,min:s.config.min,max:s.config.max,step:s.config.step,"with-tooltip":!0,onchange:e=>{const i=e.target.value;s.onChange(isNaN(i)?void 0:i)}})}),Si=()=>({view:({attrs:s})=>z("wa-input.string-input",{label:s.config.label,hint:s.config.helpText,type:"text",inputmode:"text",size:"small",disabled:s.disabled,value:s.value,onchange:e=>{const i=e.target.value??"";s.onChange(i.length>0?i:void 0)}})}),Ti=()=>({view:({attrs:s})=>{const e=s.registry.getAvailableGenerators();return z(".generator-picker",z("wa-tab-group",{active:s.generator,"onwa-tab-show":n=>{const i=n.detail.name;s.generator!==i&&s.onGeneratorChange(i)}},[...e.map(n=>{const i=s.registry.getUIMetadata(n.name),o=z("wa-tab",{panel:n.name},n.displayName),r=z("wa-tab-panel",{name:n.name},z(".controls",[i?.description?z("p",i.description):null,...i?.controls.map(a=>{switch(a.type){case"range":return z(Ii,{config:a,value:s.config?.[a.name]??a.defaultValue,onChange:l=>{s.onConfigChange(a.name,l)}});case"boolean":return z(ln,{config:a,value:(s.config?.[a.name]??a.defaultValue)===!0,onChange:l=>{s.onConfigChange(a.name,l)}});case"number":return z(Te,{config:a,value:s.config?.[a.name]??a.defaultValue,onChange:l=>{s.onConfigChange(a.name,l)}});case"string":return z(Si,{config:a,value:s.config?.[a.name]??a.defaultValue,onChange:l=>{s.onConfigChange(a.name,l)}})}})??[],!i?.description&&i?.controls.length==0?z("p","No controls for this strategy."):null]));return[o,r]})]))}}),Tt=[["Square","1:1",1],["Classic Photo","5:4",5/4],["Standard Photo","4:3",4/3],["35mm/DSLR","3:2",3/2],["Widescreen","16:9",16/9],["UltraWide","21:9",21/9],["Panorama","2:1",2/1],["Instagram Portrait","4:5",4/5],["Classic Portrait","3:4",3/4],["DSLR Portrait","2:3",2/3],["Phone Portrait","9:16",9/16],["Tall Poster","9:21",9/21],["Tall Panorama","1:2",1/2]],ki={view:({attrs:s})=>{const e=!Tt.some(([,,i])=>i===s.ratio),n=Tt.map(([i,o,r])=>z("wa-option",{value:String(r)},`${i} [${o}]`));return e&&n.unshift(z("wa-option",{value:"custom"},"Custom")),z(".aspect-ratio-picker",[z("wa-select",{label:"Aspect Ratio",size:"small",disabled:s.disabled,value:e?"custom":String(s.ratio),onchange:i=>{i.redraw=!1;const r=i.target.value;r&&r!=="custom"&&s.onChange(Number(r))}},n),z("wa-slider",{min:.25,max:4,step:.01,"with-tooltip":!0,size:"small",disabled:s.disabled,value:s.ratio,onchange:i=>{i.redraw=!1;const o=i.target;s.onChange(o.value)}})])}},kt={view:({attrs:s})=>z("wa-color-picker",{label:s.label,value:s.color,size:s.size??"medium",format:"rgb",onchange:e=>{e.redraw=!1;const n=e.target;s.onUpdate(n.value??"")}})},Di=[["rectangle","Rectangle"],["circle","Circle"],["ellipse","Ellipse"],["rounded-rect","Rounded Rectangle"]],Ai={view:({attrs:s})=>{const e=Di.map(([n,i])=>z("wa-option",{value:n},i));return z("wa-select",{label:"Border Shape",size:"small",disabled:s.disabled,value:s.shape,onchange:n=>{n.redraw=!1;const o=n.target.value;o&&s.onChange(o)}},e)}};var Be,Dt;function cn(){if(Dt)return Be;Dt=1;function s(n){var i=n.length,o=1,r=new Array(i),a;for(a=i;a>0;a--)r[a-1]=o,o=o*n[a-1];return{stride:r,data:new Uint32Array(o)}}function e(n){var i=n.length,o=1,r=new Array(i),a=[],l,c;for(l=i;l>0;l--)r[l-1]=o,o=o*n[l-1];for(c=0;c<o;c++)a.push([]);return{stride:r,data:a}}return Be={integer:s,array:e},Be}var Xe,At;function hn(){if(At)return Xe;At=1,Xe=s;function s(e,n){var i=new Array(e),o=Math.floor(e/2)<<1,r=0,a,l,c,h,u;for(u=0;u<o;u+=2)a=-2*Math.log(n()),l=Math.sqrt(a),c=2*Math.PI*n(),r+=a,i[u]=l*Math.cos(c),i[u+1]=l*Math.sin(c);if(e%2){var f=Math.sqrt(-2*Math.log(n()))*Math.cos(2*Math.PI*n());i[e-1]=f,r+=Math.pow(f,2)}for(h=1/Math.sqrt(r),u=0;u<e;++u)i[u]*=h;return i}return Xe}var Ye,Rt;function Ri(){return Rt||(Rt=1,Ye=function(e,n){e=e||1,n=n||2;for(var i=e*2+1,o=Math.pow(i,n)-1,r=new Array(o),a=0;a<o;a++)for(var l=r[a]=new Array(n),c=a<o/2?a:a+1,h=1;h<=n;h++){var u=c%Math.pow(i,h);l[h-1]=u/Math.pow(i,h-1)-e,c-=u}return r}),Ye}var Ke,$t;function un(){if($t)return Ke;$t=1;var s=Ri();function e(o){var r=s(2,o),a=[],l;for(r=r.filter(function(c){for(var h=0,u=0;u<o;u++)h+=Math.pow(Math.max(0,Math.abs(c[u])-1),2);return h<o}),l=0;l<o;l++)a.push(0);return r.push(a),r.sort(function(c,h){var u=0,f=0,d;for(d=0;d<o;d++)u+=Math.pow(c[d],2),f+=Math.pow(h[d],2);return u<f?-1:u>f?1:0}),r}var n={};function i(o){return n[o]||(n[o]=e(o)),n[o]}return Ke=i,Ke}var Qe,Lt;function $i(){if(Lt)return Qe;Lt=1;var s=cn().integer,e=hn(),n=un();function i(r,a){for(var l=0,c=0;c<r.length;c++)l+=Math.pow(r[c]-a[c],2);return l}function o(r,a){if(typeof r.distanceFunction=="function")throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=r.shape,this.minDistance=r.minDistance,this.maxDistance=r.maxDistance||r.minDistance*2,this.maxTries=Math.ceil(Math.max(1,r.tries||30)),this.rng=a||Math.random;for(var l=0,c=0;c<this.shape.length;c++)l=Math.max(l,this.shape[c]);var h=Math.max(1,l/128|0),u=1e-14*h;this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+u,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=n(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var c=0;c<this.dimension;c++)this.gridShape.push(Math.ceil(this.shape[c]/this.cellSize));this.grid=s(this.gridShape)}return o.prototype.shape=null,o.prototype.dimension=null,o.prototype.minDistance=null,o.prototype.maxDistance=null,o.prototype.minDistancePlusEpsilon=null,o.prototype.squaredMinDistance=null,o.prototype.deltaDistance=null,o.prototype.cellSize=null,o.prototype.maxTries=null,o.prototype.rng=null,o.prototype.neighbourhood=null,o.prototype.currentPoint=null,o.prototype.processList=null,o.prototype.samplePoints=null,o.prototype.gridShape=null,o.prototype.grid=null,o.prototype.addRandomPoint=function(){for(var r=new Array(this.dimension),a=0;a<this.dimension;a++)r[a]=this.rng()*this.shape[a];return this.directAddPoint(r)},o.prototype.addPoint=function(r){var a,l=!0;if(r.length===this.dimension)for(a=0;a<this.dimension&&l;a++)l=r[a]>=0&&r[a]<this.shape[a];else l=!1;return l?this.directAddPoint(r):null},o.prototype.directAddPoint=function(r){var a=0,l=this.grid.stride,c;for(this.processList.push(r),this.samplePoints.push(r),c=0;c<this.dimension;c++)a+=(r[c]/this.cellSize|0)*l[c];return this.grid.data[a]=this.samplePoints.length,r},o.prototype.inNeighbourhood=function(r){var a=this.dimension,l=this.grid.stride,c,h,u,f,d;for(c=0;c<this.neighbourhood.length;c++){for(h=0,u=0;u<a;u++){if(f=(r[u]/this.cellSize|0)+this.neighbourhood[c][u],f<0||f>=this.gridShape[u]){h=-1;break}h+=f*l[u]}if(h!==-1&&this.grid.data[h]!==0&&(d=this.samplePoints[this.grid.data[h]-1],i(r,d)<this.squaredMinDistance))return!0}return!1},o.prototype.next=function(){for(var r,a,l,c,h,u,f;this.processList.length>0;){for(this.currentPoint===null&&(this.currentPoint=this.processList.shift()),c=this.currentPoint,r=0;r<this.maxTries;r++){for(u=!0,l=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),this.dimension===2?(a=this.rng()*Math.PI*2,h=[Math.cos(a),Math.sin(a)]):h=e(this.dimension,this.rng),f=0;u&&f<this.dimension;f++)h[f]=c[f]+h[f]*l,u=h[f]>=0&&h[f]<this.shape[f];if(u&&!this.inNeighbourhood(h))return this.directAddPoint(h)}r===this.maxTries&&(this.currentPoint=null)}return null},o.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},o.prototype.getAllPoints=function(){return this.samplePoints},o.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")},o.prototype.reset=function(){var r=this.grid.data,a=0;for(a=0;a<r.length;a++)r[a]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0},Qe=o,Qe}var Je,Nt;function Li(){if(Nt)return Je;Nt=1;var s=cn().array,e=hn(),n=un();function i(r,a){for(var l=0,c=0;c<r.length;c++)l+=Math.pow(r[c]-a[c],2);return Math.sqrt(l)}function o(r,a){if(typeof r.distanceFunction!="function")throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=r.shape,this.minDistance=r.minDistance,this.maxDistance=r.maxDistance||r.minDistance*2,this.maxTries=Math.ceil(Math.max(1,r.tries||30)),this.distanceFunction=r.distanceFunction,this.bias=Math.max(0,Math.min(1,r.bias||0)),this.rng=a||Math.random;for(var l=0,c=0;c<this.shape.length;c++)l=Math.max(l,this.shape[c]);var h=Math.max(1,l/128|0),u=1e-14*h;this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+u,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=n(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var c=0;c<this.dimension;c++)this.gridShape.push(Math.ceil(this.shape[c]/this.cellSize));this.grid=s(this.gridShape)}return o.prototype.shape=null,o.prototype.dimension=null,o.prototype.minDistance=null,o.prototype.maxDistance=null,o.prototype.minDistancePlusEpsilon=null,o.prototype.deltaDistance=null,o.prototype.cellSize=null,o.prototype.maxTries=null,o.prototype.distanceFunction=null,o.prototype.bias=null,o.prototype.rng=null,o.prototype.neighbourhood=null,o.prototype.currentPoint=null,o.prototype.currentDistance=null,o.prototype.processList=null,o.prototype.samplePoints=null,o.prototype.sampleDistance=null,o.prototype.gridShape=null,o.prototype.grid=null,o.prototype.addRandomPoint=function(){for(var r=new Array(this.dimension),a=0;a<this.dimension;a++)r[a]=this.rng()*this.shape[a];return this.directAddPoint(r)},o.prototype.addPoint=function(r){var a,l=!0;if(r.length===this.dimension)for(a=0;a<this.dimension&&l;a++)l=r[a]>=0&&r[a]<this.shape[a];else l=!1;return l?this.directAddPoint(r):null},o.prototype.directAddPoint=function(r){var a=0,l=this.grid.stride,c=this.samplePoints.length,h;for(this.processList.push(c),this.samplePoints.push(r),this.sampleDistance.push(this.distanceFunction(r)),h=0;h<this.dimension;h++)a+=(r[h]/this.cellSize|0)*l[h];return this.grid.data[a].push(c),r},o.prototype.inNeighbourhood=function(r){var a=this.dimension,l=this.grid.stride,c,h,u,f,d,p,m=this.distanceFunction(r);for(c=0;c<this.neighbourhood.length;c++){for(h=0,u=0;u<a;u++){if(f=(r[u]/this.cellSize|0)+this.neighbourhood[c][u],f<0||f>=this.gridShape[u]){h=-1;break}h+=f*l[u]}if(h!==-1&&this.grid.data[h].length>0)for(var g=0;g<this.grid.data[h].length;g++){d=this.samplePoints[this.grid.data[h][g]],p=this.sampleDistance[this.grid.data[h][g]];var v=Math.min(p,m),y=Math.max(p,m),x=v+(y-v)*this.bias;if(i(r,d)<this.minDistance+this.deltaDistance*x)return!0}}return!1},o.prototype.next=function(){for(var r,a,l,c,h,u,f,d;this.processList.length>0;){if(this.currentPoint===null){var p=this.processList.shift();this.currentPoint=this.samplePoints[p],this.currentDistance=this.sampleDistance[p]}for(c=this.currentPoint,h=this.currentDistance,r=0;r<this.maxTries;r++){for(f=!0,l=this.minDistancePlusEpsilon+this.deltaDistance*(h+(1-h)*this.bias),this.dimension===2?(a=this.rng()*Math.PI*2,u=[Math.cos(a),Math.sin(a)]):u=e(this.dimension,this.rng),d=0;f&&d<this.dimension;d++)u[d]=c[d]+u[d]*l,f=u[d]>=0&&u[d]<this.shape[d];if(f&&!this.inNeighbourhood(u))return this.directAddPoint(u)}r===this.maxTries&&(this.currentPoint=null)}return null},o.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},o.prototype.getAllPoints=function(){return this.samplePoints},o.prototype.getAllPointsWithDistance=function(){var r=new Array(this.samplePoints.length),a=0,l=0,c;for(a=0;a<this.samplePoints.length;a++){for(c=new Array(this.dimension+1),l=0;l<this.dimension;l++)c[l]=this.samplePoints[a][l];c[this.dimension]=this.sampleDistance[a],r[a]=c}return r},o.prototype.reset=function(){var r=this.grid.data,a=0;for(a=0;a<r.length;a++)r[a]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0},Je=o,Je}var Ze,Ot;function Ni(){if(Ot)return Ze;Ot=1;var s=$i(),e=Li();function n(i,o){this.shape=i.shape,typeof i.distanceFunction=="function"?this.implementation=new e(i,o):this.implementation=new s(i,o)}return n.prototype.implementation=null,n.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()},n.prototype.addPoint=function(i){return this.implementation.addPoint(i)},n.prototype.next=function(){return this.implementation.next()},n.prototype.fill=function(){return this.implementation.fill()},n.prototype.getAllPoints=function(){return this.implementation.getAllPoints()},n.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()},n.prototype.reset=function(){this.implementation.reset()},Ze=n,Ze}var Oi=Ni();const Ui=Wt(Oi),ut="PoissonPointGenerator",Gi={name:ut,displayName:"Poisson",description:"Generate seed points using Poisson disk sampling. The algorithm produces points that are tightly-packed, but no closer to each other than a specified minimum distance (the piece size), resulting in a natural, organic look.",sortHint:1,controls:[]},Fi=(s,e,n)=>({generatePoints(o){const{width:r,height:a,pieceSize:l,random:c,border:h}=o;return new Ui({shape:[r,a],minDistance:l,tries:20},c).fill().filter(p=>ht(p,h))}});ve.register(ut,Fi,Gi);const Y=11102230246251565e-32,F=134217729,Vi=(3+8*Y)*Y;function et(s,e,n,i,o){let r,a,l,c,h=e[0],u=i[0],f=0,d=0;u>h==u>-h?(r=h,h=e[++f]):(r=u,u=i[++d]);let p=0;if(f<s&&d<n)for(u>h==u>-h?(a=h+r,l=r-(a-h),h=e[++f]):(a=u+r,l=r-(a-u),u=i[++d]),r=a,l!==0&&(o[p++]=l);f<s&&d<n;)u>h==u>-h?(a=r+h,c=a-r,l=r-(a-c)+(h-c),h=e[++f]):(a=r+u,c=a-r,l=r-(a-c)+(u-c),u=i[++d]),r=a,l!==0&&(o[p++]=l);for(;f<s;)a=r+h,c=a-r,l=r-(a-c)+(h-c),h=e[++f],r=a,l!==0&&(o[p++]=l);for(;d<n;)a=r+u,c=a-r,l=r-(a-c)+(u-c),u=i[++d],r=a,l!==0&&(o[p++]=l);return(r!==0||p===0)&&(o[p++]=r),p}function qi(s,e){let n=e[0];for(let i=1;i<s;i++)n+=e[i];return n}function _e(s){return new Float64Array(s)}const ji=(3+16*Y)*Y,Hi=(2+12*Y)*Y,Wi=(9+64*Y)*Y*Y,re=_e(4),Ut=_e(8),Gt=_e(12),Ft=_e(16),q=_e(4);function Bi(s,e,n,i,o,r,a){let l,c,h,u,f,d,p,m,g,v,y,x,_,I,b,C,M,P;const w=s-o,S=n-o,T=e-r,k=i-r;I=w*k,d=F*w,p=d-(d-w),m=w-p,d=F*k,g=d-(d-k),v=k-g,b=m*v-(I-p*g-m*g-p*v),C=T*S,d=F*T,p=d-(d-T),m=T-p,d=F*S,g=d-(d-S),v=S-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,re[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,re[1]=_-(y+f)+(f-C),P=x+y,f=P-x,re[2]=x-(P-f)+(y-f),re[3]=P;let D=qi(4,re),R=Hi*a;if(D>=R||-D>=R||(f=s-w,l=s-(w+f)+(f-o),f=n-S,h=n-(S+f)+(f-o),f=e-T,c=e-(T+f)+(f-r),f=i-k,u=i-(k+f)+(f-r),l===0&&c===0&&h===0&&u===0)||(R=Wi*a+Vi*Math.abs(D),D+=w*u+k*l-(T*h+S*c),D>=R||-D>=R))return D;I=l*k,d=F*l,p=d-(d-l),m=l-p,d=F*k,g=d-(d-k),v=k-g,b=m*v-(I-p*g-m*g-p*v),C=c*S,d=F*c,p=d-(d-c),m=c-p,d=F*S,g=d-(d-S),v=S-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,q[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,q[1]=_-(y+f)+(f-C),P=x+y,f=P-x,q[2]=x-(P-f)+(y-f),q[3]=P;const $=et(4,re,4,q,Ut);I=w*u,d=F*w,p=d-(d-w),m=w-p,d=F*u,g=d-(d-u),v=u-g,b=m*v-(I-p*g-m*g-p*v),C=T*h,d=F*T,p=d-(d-T),m=T-p,d=F*h,g=d-(d-h),v=h-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,q[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,q[1]=_-(y+f)+(f-C),P=x+y,f=P-x,q[2]=x-(P-f)+(y-f),q[3]=P;const A=et($,Ut,4,q,Gt);I=l*u,d=F*l,p=d-(d-l),m=l-p,d=F*u,g=d-(d-u),v=u-g,b=m*v-(I-p*g-m*g-p*v),C=c*h,d=F*c,p=d-(d-c),m=c-p,d=F*h,g=d-(d-h),v=h-g,M=m*v-(C-p*g-m*g-p*v),y=b-M,f=b-y,q[0]=b-(y+f)+(f-M),x=I+y,f=x-I,_=I-(x-f)+(y-f),y=_-C,f=_-y,q[1]=_-(y+f)+(f-C),P=x+y,f=P-x,q[2]=x-(P-f)+(y-f),q[3]=P;const L=et(A,Gt,4,q,Ft);return Ft[L-1]}function Ie(s,e,n,i,o,r){const a=(e-r)*(n-o),l=(s-o)*(i-r),c=a-l,h=Math.abs(a+l);return Math.abs(c)>=ji*h?c:-Bi(s,e,n,i,o,r,h)}const Vt=Math.pow(2,-52),Se=new Uint32Array(512);class Le{static from(e,n=Ji,i=Zi){const o=e.length,r=new Float64Array(o*2);for(let a=0;a<o;a++){const l=e[a];r[2*a]=n(l),r[2*a+1]=i(l)}return new Le(r)}constructor(e){const n=e.length>>1;if(n>0&&typeof e[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=e;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:e,_hullPrev:n,_hullNext:i,_hullTri:o,_hullHash:r}=this,a=e.length>>1;let l=1/0,c=1/0,h=-1/0,u=-1/0;for(let w=0;w<a;w++){const S=e[2*w],T=e[2*w+1];S<l&&(l=S),T<c&&(c=T),S>h&&(h=S),T>u&&(u=T),this._ids[w]=w}const f=(l+h)/2,d=(c+u)/2;let p,m,g;for(let w=0,S=1/0;w<a;w++){const T=tt(f,d,e[2*w],e[2*w+1]);T<S&&(p=w,S=T)}const v=e[2*p],y=e[2*p+1];for(let w=0,S=1/0;w<a;w++){if(w===p)continue;const T=tt(v,y,e[2*w],e[2*w+1]);T<S&&T>0&&(m=w,S=T)}let x=e[2*m],_=e[2*m+1],I=1/0;for(let w=0;w<a;w++){if(w===p||w===m)continue;const S=Ki(v,y,x,_,e[2*w],e[2*w+1]);S<I&&(g=w,I=S)}let b=e[2*g],C=e[2*g+1];if(I===1/0){for(let T=0;T<a;T++)this._dists[T]=e[2*T]-e[0]||e[2*T+1]-e[1];se(this._ids,this._dists,0,a-1);const w=new Uint32Array(a);let S=0;for(let T=0,k=-1/0;T<a;T++){const D=this._ids[T],R=this._dists[D];R>k&&(w[S++]=D,k=R)}this.hull=w.subarray(0,S),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Ie(v,y,x,_,b,C)<0){const w=m,S=x,T=_;m=g,x=b,_=C,g=w,b=S,C=T}const M=Qi(v,y,x,_,b,C);this._cx=M.x,this._cy=M.y;for(let w=0;w<a;w++)this._dists[w]=tt(e[2*w],e[2*w+1],M.x,M.y);se(this._ids,this._dists,0,a-1),this._hullStart=p;let P=3;i[p]=n[g]=m,i[m]=n[p]=g,i[g]=n[m]=p,o[p]=0,o[m]=1,o[g]=2,r.fill(-1),r[this._hashKey(v,y)]=p,r[this._hashKey(x,_)]=m,r[this._hashKey(b,C)]=g,this.trianglesLen=0,this._addTriangle(p,m,g,-1,-1,-1);for(let w=0,S,T;w<this._ids.length;w++){const k=this._ids[w],D=e[2*k],R=e[2*k+1];if(w>0&&Math.abs(D-S)<=Vt&&Math.abs(R-T)<=Vt||(S=D,T=R,k===p||k===m||k===g))continue;let $=0;for(let H=0,le=this._hashKey(D,R);H<this._hashSize&&($=r[(le+H)%this._hashSize],!($!==-1&&$!==i[$]));H++);$=n[$];let A=$,L;for(;L=i[A],Ie(D,R,e[2*A],e[2*A+1],e[2*L],e[2*L+1])>=0;)if(A=L,A===$){A=-1;break}if(A===-1)continue;let U=this._addTriangle(A,k,i[A],-1,-1,o[A]);o[k]=this._legalize(U+2),o[A]=U,P++;let O=i[A];for(;L=i[O],Ie(D,R,e[2*O],e[2*O+1],e[2*L],e[2*L+1])<0;)U=this._addTriangle(O,k,L,o[k],-1,o[O]),o[k]=this._legalize(U+2),i[O]=O,P--,O=L;if(A===$)for(;L=n[A],Ie(D,R,e[2*L],e[2*L+1],e[2*A],e[2*A+1])<0;)U=this._addTriangle(L,k,A,-1,o[A],o[L]),this._legalize(U+2),o[L]=U,i[A]=A,P--,A=L;this._hullStart=n[k]=A,i[A]=n[O]=k,i[k]=O,r[this._hashKey(D,R)]=k,r[this._hashKey(e[2*A],e[2*A+1])]=A}this.hull=new Uint32Array(P);for(let w=0,S=this._hullStart;w<P;w++)this.hull[w]=S,S=i[S];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,n){return Math.floor(Xi(e-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:n,_halfedges:i,coords:o}=this;let r=0,a=0;for(;;){const l=i[e],c=e-e%3;if(a=c+(e+2)%3,l===-1){if(r===0)break;e=Se[--r];continue}const h=l-l%3,u=c+(e+1)%3,f=h+(l+2)%3,d=n[a],p=n[e],m=n[u],g=n[f];if(Yi(o[2*d],o[2*d+1],o[2*p],o[2*p+1],o[2*m],o[2*m+1],o[2*g],o[2*g+1])){n[e]=g,n[l]=d;const y=i[f];if(y===-1){let _=this._hullStart;do{if(this._hullTri[_]===f){this._hullTri[_]=e;break}_=this._hullPrev[_]}while(_!==this._hullStart)}this._link(e,y),this._link(l,i[a]),this._link(a,f);const x=h+(l+1)%3;r<Se.length&&(Se[r++]=x)}else{if(r===0)break;e=Se[--r]}}return a}_link(e,n){this._halfedges[e]=n,n!==-1&&(this._halfedges[n]=e)}_addTriangle(e,n,i,o,r,a){const l=this.trianglesLen;return this._triangles[l]=e,this._triangles[l+1]=n,this._triangles[l+2]=i,this._link(l,o),this._link(l+1,r),this._link(l+2,a),this.trianglesLen+=3,l}}function Xi(s,e){const n=s/(Math.abs(s)+Math.abs(e));return(e>0?3-n:1+n)/4}function tt(s,e,n,i){const o=s-n,r=e-i;return o*o+r*r}function Yi(s,e,n,i,o,r,a,l){const c=s-a,h=e-l,u=n-a,f=i-l,d=o-a,p=r-l,m=c*c+h*h,g=u*u+f*f,v=d*d+p*p;return c*(f*v-g*p)-h*(u*v-g*d)+m*(u*p-f*d)<0}function Ki(s,e,n,i,o,r){const a=n-s,l=i-e,c=o-s,h=r-e,u=a*a+l*l,f=c*c+h*h,d=.5/(a*h-l*c),p=(h*u-l*f)*d,m=(a*f-c*u)*d;return p*p+m*m}function Qi(s,e,n,i,o,r){const a=n-s,l=i-e,c=o-s,h=r-e,u=a*a+l*l,f=c*c+h*h,d=.5/(a*h-l*c),p=s+(h*u-l*f)*d,m=e+(a*f-c*u)*d;return{x:p,y:m}}function se(s,e,n,i){if(i-n<=20)for(let o=n+1;o<=i;o++){const r=s[o],a=e[r];let l=o-1;for(;l>=n&&e[s[l]]>a;)s[l+1]=s[l--];s[l+1]=r}else{const o=n+i>>1;let r=n+1,a=i;ge(s,o,r),e[s[n]]>e[s[i]]&&ge(s,n,i),e[s[r]]>e[s[i]]&&ge(s,r,i),e[s[n]]>e[s[r]]&&ge(s,n,r);const l=s[r],c=e[l];for(;;){do r++;while(e[s[r]]<c);do a--;while(e[s[a]]>c);if(a<r)break;ge(s,r,a)}s[n+1]=s[a],s[a]=l,i-r+1>=a-n?(se(s,e,r,i),se(s,e,n,a-1)):(se(s,e,n,a-1),se(s,e,r,i))}}function ge(s,e,n){const i=s[e];s[e]=s[n],s[n]=i}function Ji(s){return s[0]}function Zi(s){return s[1]}const qt=1e-6;class ee{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,n){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,n){this._+=`L${this._x1=+e},${this._y1=+n}`}arc(e,n,i){e=+e,n=+n,i=+i;const o=e+i,r=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${o},${r}`:(Math.abs(this._x1-o)>qt||Math.abs(this._y1-r)>qt)&&(this._+="L"+o+","+r),i&&(this._+=`A${i},${i},0,1,1,${e-i},${n}A${i},${i},0,1,1,${this._x1=o},${this._y1=r}`)}rect(e,n,i,o){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${+i}v${+o}h${-i}Z`}value(){return this._||null}}class lt{constructor(){this._=[]}moveTo(e,n){this._.push([e,n])}closePath(){this._.push(this._[0].slice())}lineTo(e,n){this._.push([e,n])}value(){return this._.length?this._:null}}class er{constructor(e,[n,i,o,r]=[0,0,960,500]){if(!((o=+o)>=(n=+n))||!((r=+r)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(e.points.length*2),this.vectors=new Float64Array(e.points.length*2),this.xmax=o,this.xmin=n,this.ymax=r,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:n,triangles:i},vectors:o}=this;let r,a;const l=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let g=0,v=0,y=i.length,x,_;g<y;g+=3,v+=2){const I=i[g]*2,b=i[g+1]*2,C=i[g+2]*2,M=e[I],P=e[I+1],w=e[b],S=e[b+1],T=e[C],k=e[C+1],D=w-M,R=S-P,$=T-M,A=k-P,L=(D*A-R*$)*2;if(Math.abs(L)<1e-9){if(r===void 0){r=a=0;for(const O of n)r+=e[O*2],a+=e[O*2+1];r/=n.length,a/=n.length}const U=1e9*Math.sign((r-M)*A-(a-P)*$);x=(M+T)/2-U*A,_=(P+k)/2+U*$}else{const U=1/L,O=D*D+R*R,H=$*$+A*A;x=M+(A*O-R*H)*U,_=P+(D*H-$*O)*U}l[v]=x,l[v+1]=_}let c=n[n.length-1],h,u=c*4,f,d=e[2*c],p,m=e[2*c+1];o.fill(0);for(let g=0;g<n.length;++g)c=n[g],h=u,f=d,p=m,u=c*4,d=e[2*c],m=e[2*c+1],o[h+2]=o[u]=p-m,o[h+3]=o[u+1]=d-f}render(e){const n=e==null?e=new ee:void 0,{delaunay:{halfedges:i,inedges:o,hull:r},circumcenters:a,vectors:l}=this;if(r.length<=1)return null;for(let u=0,f=i.length;u<f;++u){const d=i[u];if(d<u)continue;const p=Math.floor(u/3)*2,m=Math.floor(d/3)*2,g=a[p],v=a[p+1],y=a[m],x=a[m+1];this._renderSegment(g,v,y,x,e)}let c,h=r[r.length-1];for(let u=0;u<r.length;++u){c=h,h=r[u];const f=Math.floor(o[h]/3)*2,d=a[f],p=a[f+1],m=c*4,g=this._project(d,p,l[m+2],l[m+3]);g&&this._renderSegment(d,p,g[0],g[1],e)}return n&&n.value()}renderBounds(e){const n=e==null?e=new ee:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(e,n){const i=n==null?n=new ee:void 0,o=this._clip(e);if(o===null||!o.length)return;n.moveTo(o[0],o[1]);let r=o.length;for(;o[0]===o[r-2]&&o[1]===o[r-1]&&r>1;)r-=2;for(let a=2;a<r;a+=2)(o[a]!==o[a-2]||o[a+1]!==o[a-1])&&n.lineTo(o[a],o[a+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let n=0,i=e.length/2;n<i;++n){const o=this.cellPolygon(n);o&&(o.index=n,yield o)}}cellPolygon(e){const n=new lt;return this.renderCell(e,n),n.value()}_renderSegment(e,n,i,o,r){let a;const l=this._regioncode(e,n),c=this._regioncode(i,o);l===0&&c===0?(r.moveTo(e,n),r.lineTo(i,o)):(a=this._clipSegment(e,n,i,o,l,c))&&(r.moveTo(a[0],a[1]),r.lineTo(a[2],a[3]))}contains(e,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(e,n,i)===e}*neighbors(e){const n=this._clip(e);if(n)for(const i of this.delaunay.neighbors(e)){const o=this._clip(i);if(o){e:for(let r=0,a=n.length;r<a;r+=2)for(let l=0,c=o.length;l<c;l+=2)if(n[r]===o[l]&&n[r+1]===o[l+1]&&n[(r+2)%a]===o[(l+c-2)%c]&&n[(r+3)%a]===o[(l+c-1)%c]){yield i;break e}}}}_cell(e){const{circumcenters:n,delaunay:{inedges:i,halfedges:o,triangles:r}}=this,a=i[e];if(a===-1)return null;const l=[];let c=a;do{const h=Math.floor(c/3);if(l.push(n[h*2],n[h*2+1]),c=c%3===2?c-2:c+1,r[c]!==e)break;c=o[c]}while(c!==a&&c!==-1);return l}_clip(e){if(e===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(e);if(n===null)return null;const{vectors:i}=this,o=e*4;return this._simplify(i[o]||i[o+1]?this._clipInfinite(e,n,i[o],i[o+1],i[o+2],i[o+3]):this._clipFinite(e,n))}_clipFinite(e,n){const i=n.length;let o=null,r,a,l=n[i-2],c=n[i-1],h,u=this._regioncode(l,c),f,d=0;for(let p=0;p<i;p+=2)if(r=l,a=c,l=n[p],c=n[p+1],h=u,u=this._regioncode(l,c),h===0&&u===0)f=d,d=0,o?o.push(l,c):o=[l,c];else{let m,g,v,y,x;if(h===0){if((m=this._clipSegment(r,a,l,c,h,u))===null)continue;[g,v,y,x]=m}else{if((m=this._clipSegment(l,c,r,a,u,h))===null)continue;[y,x,g,v]=m,f=d,d=this._edgecode(g,v),f&&d&&this._edge(e,f,d,o,o.length),o?o.push(g,v):o=[g,v]}f=d,d=this._edgecode(y,x),f&&d&&this._edge(e,f,d,o,o.length),o?o.push(y,x):o=[y,x]}if(o)f=d,d=this._edgecode(o[0],o[1]),f&&d&&this._edge(e,f,d,o,o.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return o}_clipSegment(e,n,i,o,r,a){const l=r<a;for(l&&([e,n,i,o,r,a]=[i,o,e,n,a,r]);;){if(r===0&&a===0)return l?[i,o,e,n]:[e,n,i,o];if(r&a)return null;let c,h,u=r||a;u&8?(c=e+(i-e)*(this.ymax-n)/(o-n),h=this.ymax):u&4?(c=e+(i-e)*(this.ymin-n)/(o-n),h=this.ymin):u&2?(h=n+(o-n)*(this.xmax-e)/(i-e),c=this.xmax):(h=n+(o-n)*(this.xmin-e)/(i-e),c=this.xmin),r?(e=c,n=h,r=this._regioncode(e,n)):(i=c,o=h,a=this._regioncode(i,o))}}_clipInfinite(e,n,i,o,r,a){let l=Array.from(n),c;if((c=this._project(l[0],l[1],i,o))&&l.unshift(c[0],c[1]),(c=this._project(l[l.length-2],l[l.length-1],r,a))&&l.push(c[0],c[1]),l=this._clipFinite(e,l))for(let h=0,u=l.length,f,d=this._edgecode(l[u-2],l[u-1]);h<u;h+=2)f=d,d=this._edgecode(l[h],l[h+1]),f&&d&&(h=this._edge(e,f,d,l,h),u=l.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(l=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return l}_edge(e,n,i,o,r){for(;n!==i;){let a,l;switch(n){case 5:n=4;continue;case 4:n=6,a=this.xmax,l=this.ymin;break;case 6:n=2;continue;case 2:n=10,a=this.xmax,l=this.ymax;break;case 10:n=8;continue;case 8:n=9,a=this.xmin,l=this.ymax;break;case 9:n=1;continue;case 1:n=5,a=this.xmin,l=this.ymin;break}(o[r]!==a||o[r+1]!==l)&&this.contains(e,a,l)&&(o.splice(r,0,a,l),r+=2)}return r}_project(e,n,i,o){let r=1/0,a,l,c;if(o<0){if(n<=this.ymin)return null;(a=(this.ymin-n)/o)<r&&(c=this.ymin,l=e+(r=a)*i)}else if(o>0){if(n>=this.ymax)return null;(a=(this.ymax-n)/o)<r&&(c=this.ymax,l=e+(r=a)*i)}if(i>0){if(e>=this.xmax)return null;(a=(this.xmax-e)/i)<r&&(l=this.xmax,c=n+(r=a)*o)}else if(i<0){if(e<=this.xmin)return null;(a=(this.xmin-e)/i)<r&&(l=this.xmin,c=n+(r=a)*o)}return[l,c]}_edgecode(e,n){return(e===this.xmin?1:e===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(e,n){return(e<this.xmin?1:e>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let n=0;n<e.length;n+=2){const i=(n+2)%e.length,o=(n+4)%e.length;(e[n]===e[i]&&e[i]===e[o]||e[n+1]===e[i+1]&&e[i+1]===e[o+1])&&(e.splice(i,2),n-=2)}e.length||(e=null)}return e}}const tr=2*Math.PI,oe=Math.pow;function nr(s){return s[0]}function ir(s){return s[1]}function rr(s){const{triangles:e,coords:n}=s;for(let i=0;i<e.length;i+=3){const o=2*e[i],r=2*e[i+1],a=2*e[i+2];if((n[a]-n[o])*(n[r+1]-n[o+1])-(n[r]-n[o])*(n[a+1]-n[o+1])>1e-10)return!1}return!0}function or(s,e,n){return[s+Math.sin(s+e)*n,e+Math.cos(s-e)*n]}class ft{static from(e,n=nr,i=ir,o){return new ft("length"in e?sr(e,n,i,o):Float64Array.from(ar(e,n,i,o)))}constructor(e){this._delaunator=new Le(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,n=this.points;if(e.hull&&e.hull.length>2&&rr(e)){this.collinear=Int32Array.from({length:n.length/2},(d,p)=>p).sort((d,p)=>n[2*d]-n[2*p]||n[2*d+1]-n[2*p+1]);const c=this.collinear[0],h=this.collinear[this.collinear.length-1],u=[n[2*c],n[2*c+1],n[2*h],n[2*h+1]],f=1e-8*Math.hypot(u[3]-u[1],u[2]-u[0]);for(let d=0,p=n.length/2;d<p;++d){const m=or(n[2*d],n[2*d+1],f);n[2*d]=m[0],n[2*d+1]=m[1]}this._delaunator=new Le(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,o=this.hull=this._delaunator.hull,r=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),l=this._hullIndex.fill(-1);for(let c=0,h=i.length;c<h;++c){const u=r[c%3===2?c-2:c+1];(i[c]===-1||a[u]===-1)&&(a[u]=c)}for(let c=0,h=o.length;c<h;++c)l[o[c]]=c;o.length<=2&&o.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=o[0],a[o[0]]=1,o.length===2&&(a[o[1]]=0,this.triangles[1]=o[1],this.triangles[2]=o[1]))}voronoi(e){return new er(this,e)}*neighbors(e){const{inedges:n,hull:i,_hullIndex:o,halfedges:r,triangles:a,collinear:l}=this;if(l){const f=l.indexOf(e);f>0&&(yield l[f-1]),f<l.length-1&&(yield l[f+1]);return}const c=n[e];if(c===-1)return;let h=c,u=-1;do{if(yield u=a[h],h=h%3===2?h-2:h+1,a[h]!==e)return;if(h=r[h],h===-1){const f=i[(o[e]+1)%i.length];f!==u&&(yield f);return}}while(h!==c)}find(e,n,i=0){if(e=+e,e!==e||(n=+n,n!==n))return-1;const o=i;let r;for(;(r=this._step(i,e,n))>=0&&r!==i&&r!==o;)i=r;return r}_step(e,n,i){const{inedges:o,hull:r,_hullIndex:a,halfedges:l,triangles:c,points:h}=this;if(o[e]===-1||!h.length)return(e+1)%(h.length>>1);let u=e,f=oe(n-h[e*2],2)+oe(i-h[e*2+1],2);const d=o[e];let p=d;do{let m=c[p];const g=oe(n-h[m*2],2)+oe(i-h[m*2+1],2);if(g<f&&(f=g,u=m),p=p%3===2?p-2:p+1,c[p]!==e)break;if(p=l[p],p===-1){if(p=r[(a[e]+1)%r.length],p!==m&&oe(n-h[p*2],2)+oe(i-h[p*2+1],2)<f)return p;break}}while(p!==d);return u}render(e){const n=e==null?e=new ee:void 0,{points:i,halfedges:o,triangles:r}=this;for(let a=0,l=o.length;a<l;++a){const c=o[a];if(c<a)continue;const h=r[a]*2,u=r[c]*2;e.moveTo(i[h],i[h+1]),e.lineTo(i[u],i[u+1])}return this.renderHull(e),n&&n.value()}renderPoints(e,n){n===void 0&&(!e||typeof e.moveTo!="function")&&(n=e,e=null),n=n==null?2:+n;const i=e==null?e=new ee:void 0,{points:o}=this;for(let r=0,a=o.length;r<a;r+=2){const l=o[r],c=o[r+1];e.moveTo(l+n,c),e.arc(l,c,n,0,tr)}return i&&i.value()}renderHull(e){const n=e==null?e=new ee:void 0,{hull:i,points:o}=this,r=i[0]*2,a=i.length;e.moveTo(o[r],o[r+1]);for(let l=1;l<a;++l){const c=2*i[l];e.lineTo(o[c],o[c+1])}return e.closePath(),n&&n.value()}hullPolygon(){const e=new lt;return this.renderHull(e),e.value()}renderTriangle(e,n){const i=n==null?n=new ee:void 0,{points:o,triangles:r}=this,a=r[e*=3]*2,l=r[e+1]*2,c=r[e+2]*2;return n.moveTo(o[a],o[a+1]),n.lineTo(o[l],o[l+1]),n.lineTo(o[c],o[c+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:e}=this;for(let n=0,i=e.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(e){const n=new lt;return this.renderTriangle(e,n),n.value()}}function sr(s,e,n,i){const o=s.length,r=new Float64Array(o*2);for(let a=0;a<o;++a){const l=s[a];r[a*2]=e.call(i,l,a,s),r[a*2+1]=n.call(i,l,a,s)}return r}function*ar(s,e,n,i){let o=0;for(const r of s)yield e.call(i,r,o,s),yield n.call(i,r,o,s),++o}function fn(s){return{originalBorder:s,flattenedPolygon:on(s)[0]}}function lr(s){if(s.length===0)return[0,0];const e=s.reduce((n,i)=>[n[0]+i[0],n[1]+i[1]],[0,0]);return[e[0]/s.length,e[1]/s.length]}function dn(s,e,n){const i={id:s,site:lr(e),halfEdge:-1,bounds:st(e)},o=pi(e,s,n);return o.length>0&&(i.halfEdge=o[0].id),i}function pn(s,e){const i=s.map(r=>ht(r,e.originalBorder)).filter(Boolean).length;return i===0?null:i===s.length?s:fi(s,e.flattenedPolygon)?.[0]??null}const dt="VoronoiPieceGenerator",cr={name:dt,displayName:"Voronoi",description:"Construct pieces by building a Voronoi diagram from the seed points. Each piece consists of all area of the plane closer to its seed point than any other seed point. In practice, this creates irregular polygons with 3-8 sides.",sortHint:1,controls:[]};function hr(s){return`${s[0].toPrecision(7)},${s[1].toPrecision(7)}`}function jt(s,e){const i=e.flattenedPolygon;for(let o=0;o<i.length;o++){const r=i[o],a=i[(o+1)%i.length];if(ur(s,r,a)<.001)return!0}return!1}function ur(s,e,n){const[i,o]=s,[r,a]=e,[l,c]=n,h=l-r,u=c-a,f=h*h+u*u;if(f===0)return Math.hypot(i-r,o-a);let d=((i-r)*h+(o-a)*u)/f;d=Math.max(0,Math.min(1,d));const p=r+d*h,m=a+d*u;return Math.hypot(i-p,o-m)}const fr=(s,e,n)=>{const{width:i,height:o}=e,r=fn(s);return{generatePieces(l,c){const{border:h}=c;console.log(`VoronoiPieceGenerator using dimensions ${i}x${o}`);const f=ft.from(l).voronoi([0,0,i,o]),d={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:h},p=new Map;let m=0;for(let v=0;v<l.length;v++){const y=l[v],x=f.cellPolygon(v);if(!x)continue;const _=pn(x,r);if(!_)continue;const I=m++,b=dn(I,_,d);b.site=y,d.pieces.set(I,b);const C=[];let M=b.halfEdge;if(M!==-1){const P=M;do{const w=d.halfEdges.get(M);C.push(w),M=w.next}while(M!==P)}sn(C,d,p,(P,w)=>jt(P,r)&&jt(w,r))}const g=new Map;for(const v of d.halfEdges.values()){const y=hr(v.origin);g.has(y)||g.set(y,v.origin)}return d.vertices=Array.from(g.values()),d}}};xe.register(dt,fr,cr);const Ne="SimpleTabPlacementStrategy",dr={name:Ne,displayName:"Simple",description:"Creates a single tab in the center of each edge with a random orientation.",sortHint:1,controls:[{type:"range",name:"tabSize",label:"Tab Size",optional:!0,min:.01,max:1,step:.01,defaultValue:.5,helpText:"The width of the tab as a fraction of the edge length"},{type:"number",name:"minEdgeLength",label:"Minimum Edge Length",optional:!0,defaultValue:15,helpText:"Edges shorter than this value will not have a tab"},{type:"number",name:"maxTabSize",label:"Maximum Tab Size",helpText:"Maximum width of a generated tab"}]};function Ht(s,e,n,i){if(s.tabs=void 0,!(s.heRight!==-1))return;const r=e.halfEdges.get(s.heLeft),a=e.halfEdges.get(s.heRight);if(!r||!a)return;const l=r.origin,c=a.origin,h=Math.hypot(c[0]-l[0],c[1]-l[1]);if(h>=n.minEdgeLength){let u=n.tabSize;n.maxTabSize&&h*u>n.maxTabSize&&(u=n.maxTabSize/h);const f={position:.5,size:u,convex:i()>.5};s.tabs=[f]}}const pr=(s,e,n)=>{const{tabSize:i=.5,minEdgeLength:o=0,maxTabSize:r}=n,a={tabSize:i,minEdgeLength:o,maxTabSize:r};return{placeTabs(l){const{topology:c,random:h}=l;for(const u of c.edges.values())Ht(u,c,a,h)},updateTabPlacements(l,c){const{topology:h,random:u}=c;for(const f of l)Ht(f,h,a,u)}}};be.register(Ne,pr,dr);const pt="TraditionalTabGenerator",gr={name:pt,displayName:"Traditional",description:"Creates a traditional rounded tab for each (internal) piece edge.",sortHint:1,controls:[{type:"range",name:"jitter",label:"Randomness",defaultValue:8,min:0,max:100,step:1,helpText:"Adds randomness to the tab shape. 0 means completely uniform tabs"},{type:"range",name:"heightToWidthRatio",label:"Tab Height",defaultValue:50,min:5,max:100,step:5,helpText:"The height of the tab as a percent of its width"}]};function mr(s,e,n,i,o,r=!1){const a=e[0]-s[0],l=e[1]-s[1],c=Math.hypot(a,l);if(c===0)return console.warn("Edge has zero length"),[];const h=[a/c,l/c],u=[-h[1],h[0]],f=(k,D)=>[s[0]+(h[0]*k+u[0]*D)*c,s[1]+(h[1]*k+u[1]*D)*c],d=n/100,p=()=>(o()*2-1)*d,m=p(),g=p(),v=p(),y=p(),x=p(),_=.1625,I=r?-1:1,b=i,C=b/3,P=[[0,0],[.2,m*C],[.5+g+y,I*(-C+v*b)],[.5-_+g,I*(C+v*b)],[.5-2*_+g-y,I*(b+v*b)],[.5+2*_+g-y,I*(b+v*b)],[.5+_+g,I*(C+v*b)],[.5+g+y,I*(-C+v*b)],[.8,x*C],[1,0]].map(([k,D])=>f(k,D)),w={type:"bezier",p1:P[1],p2:P[2],p3:P[3]},S={type:"bezier",p1:P[4],p2:P[5],p3:P[6]},T={type:"bezier",p1:P[7],p2:P[8],p3:P[9]};return[w,S,T]}const yr=(s,e,n)=>{const{jitter:i=8,heightToWidthRatio:o=50}=n;return{createTabSegments(a,l,c,h){const u=!c.convex;return mr(a,l,i,o/100,h,u)}}};te.register(pt,yr,gr);function vr(s){return new Worker("/puzzle-generator/assets/CheckGeometryWorker-oLMqduM_.js",{name:s?.name})}function xr(s,e){return new Promise((n,i)=>{const o=new vr;o.onmessage=a=>{const l=a.data;switch(l.type){case"progress":e?.(l.processed,l.total);break;case"done":n(l.results),o.terminate();break;case"error":i(new Error(l.message)),o.terminate();break}},o.onerror=a=>{i(new Error(a.message)),o.terminate()};const r={topology:oi(s)};o.postMessage(r)})}const gn="GridJitterPointGenerator",br={name:gn,displayName:"Grid",description:"Generate seed points using a grid with optional random jitter. Has a uniform, regular look, especially with low randomness values.",sortHint:2,controls:[{type:"range",name:"jitter",label:"Randomness",min:0,max:100,step:5,defaultValue:50,helpText:"Amount of jitter to apply to each grid point (0 to 100%)"}]},wr=(s,e,n)=>{const{jitter:i=50}=n;return{generatePoints(r){const{width:a,height:l,pieceSize:c,random:h,border:u}=r,f=[];for(let d=0;d<a;d+=c)for(let p=0;p<l;p+=c){const m=[d+c/2,p+c/2];i>0&&(m[0]+=(h()-.5)*(i/100)*c,m[1]+=(h()-.5)*(i/100)*c),ht(m,u)&&f.push(m)}return f}}};ve.register(gn,wr,br);const mn="RectangularPieceGenerator",_r={name:mn,displayName:"Rectangular",description:"Construct pieces from a regular grid. All pieces have 4 sides and are the same size (except when the border is irregular). This generator ignores seed points.",sortHint:2,controls:[]},Pr=(s,e,n)=>{const{width:i,height:o}=e,r=fn(s);return{generatePieces(l,c){const{pieceSize:h,border:u}=c,f={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:u},d=Math.ceil(i/h),p=Math.ceil(o/h),m=Math.round(i/d),g=Math.round(o/p),v=[];for(let x=0;x<=p;x++){const _=[];for(let I=0;I<=d;I++){const b=I*m,C=x*g;_.push([b,C])}v.push(_)}f.vertices=v.flat();const y=new Map;for(let x=0;x<p;x++)for(let _=0;_<d;_++){const I=x*d+_,b=v[x][_],C=v[x][_+1],M=v[x+1][_],P=v[x+1][_+1],S=pn([b,C,P,M],r);if(!S)continue;const T=dn(I,S,f);f.pieces.set(I,T);const k=[];let D=T.halfEdge;if(D!==-1){const R=D;do{const $=f.halfEdges.get(D);k.push($),D=$.next}while(D!==R)}sn(k,f,y,(R,$)=>{const A=(le,Ge)=>Math.abs(le-Ge)<1e-6,L=A(R[1],b[1])&&A($[1],b[1]),U=A(R[0],C[0])&&A($[0],C[0]),O=A(R[1],M[1])&&A($[1],M[1]),H=A(R[0],b[0])&&A($[0],b[0]);return!(L||U||O||H)})}return f}}};xe.register(mn,Pr,_r);const yn="NullTabGenerator",Mr={name:yn,displayName:"None",description:"Do not generate tabs. All pieces have straight edges.",sortHint:3,controls:[]},zr=(s,e,n)=>({createTabSegments(o,r,a,l){return[]}});te.register(yn,zr,Mr);const vn="TriangleTabGenerator",Er={name:vn,displayName:"Triangle",description:"Creates a simple triangle between each (internal) piece edge.",sortHint:2,controls:[]},Cr=(s,e,n)=>({createTabSegments(o,r,a,l){const c=[r[0]-o[0],r[1]-o[1]],h=Math.hypot(c[0],c[1]);if(h<1e-6)return[];const u=[c[0]/h,c[1]/h],f=[-u[1],u[0]],d=[o[0]+c[0]/2,o[1]+c[1]/2],p=a.convex?1:-1,m=h*a.size*p,g=[d[0]+f[0]*m,d[1]+f[1]*m],v=[];return v.push({type:"line",p:o}),v.push({type:"line",p:g}),v.push({type:"line",p:r}),v}});te.register(vn,Cr,Er);let Oe=!1;function Ir(){const s=window.matchMedia("(prefers-color-scheme: dark)");function e(){s.matches?(document.documentElement.classList.add("wa-dark"),Oe=!0):(document.documentElement.classList.remove("wa-dark"),Oe=!1)}e(),s.addEventListener("change",e)}Ir();const Sr=()=>{const n=ut,i=dt,o=pt,r={seed:new Date().getTime()%10240,canvasWidth:800,canvasHeight:600,aspectRatio:800/600,distance:40,color:Oe?"#DDDDDD":"#333333",drawPoints:!1,pointColor:Oe?"#FF0000":"#0000FF",borderShape:"rectangle",borderCornerRadius:50,geometryProblems:{autoCheck:!1,problems:void 0,progress:void 0},dirty:!0,generators:{point:{label:"Seed Points",registry:ve,name:n,config:ve.getDefaultConfig(n,800,600)},piece:{label:"Piece Generation",registry:xe,name:i,config:xe.getDefaultConfig(i,800,600)},placement:{label:"Tab Placement",registry:be,name:Ne,config:be.getDefaultConfig(Ne,800,600)},tab:{label:"Tabs",registry:te,name:o,config:te.getDefaultConfig(o,800,600)}},puzzle:void 0,backgroundImageUrl:void 0,backgroundImageName:""};function a(){const{canvasWidth:c,canvasHeight:h,borderShape:u,borderCornerRadius:f}=r;switch(u){case"rectangle":return at(c,h);case"circle":return mi(Math.min(c,h));case"ellipse":return yi(c,h);case"rounded-rect":return vi(c,h,f);default:return at(c,h)}}function l(){r.puzzle&&(r.geometryProblems.progress=0,z.redraw(),xr(r.puzzle,(c,h)=>{r.geometryProblems.progress=c/h*100,z.redraw()}).then(c=>{r.geometryProblems.problems=c.length,r.geometryProblems.progress=void 0,r.puzzle&&(r.puzzle.problems=c),z.redraw()}).catch(c=>{r.geometryProblems.progress=void 0,console.error(c),z.redraw()}))}return{oncreate:()=>{$e({bounds:{width:r.canvasWidth,height:r.canvasHeight},border:a(),pieceSize:r.distance,pointConfig:r.generators.point.config,pieceConfig:r.generators.piece.config,placementConfig:r.generators.placement.config,tabConfig:r.generators.tab.config,seed:r.seed}).then(c=>{r.puzzle=c,z.redraw(),r.geometryProblems.autoCheck&&l()}).catch(c=>{console.error(c)})},onupdate:()=>{r.dirty&&(r.dirty=!1,$e({bounds:{width:r.canvasWidth,height:r.canvasHeight},border:a(),pieceSize:r.distance,pointConfig:r.generators.point.config,pieceConfig:r.generators.piece.config,placementConfig:r.generators.placement.config,tabConfig:r.generators.tab.config,seed:r.seed}).then(c=>{r.geometryProblems.problems=void 0,r.geometryProblems.progress=void 0,r.puzzle=c,z.redraw(),r.geometryProblems.autoCheck&&l()}).catch(c=>{console.error(c)}))},onremove:()=>{r.backgroundImageUrl&&(URL.revokeObjectURL(r.backgroundImageUrl),r.backgroundImageUrl=void 0)},view:()=>z(".page",[z(bn,{link:"https://github.com/weevilgenius/puzzle-generator"}),z("h1","Puzzle Generator"),z(".container",[r.puzzle&&z(".puzzle-stack",[z(wi,{width:r.canvasWidth,height:r.canvasHeight,color:r.color,imageUrl:r.backgroundImageUrl,puzzle:r.puzzle,isDirty:r.dirty,pointColor:r.drawPoints?r.pointColor:void 0,onPuzzleChanged:c=>{r.puzzle=c,z.redraw()},onSeedPointMoved:(c,h)=>{r.dirty=!1,r.puzzle&&gi(r.puzzle,c,h).then(u=>{r.geometryProblems.problems=void 0,r.geometryProblems.progress=void 0,r.puzzle=u,z.redraw(),r.geometryProblems.autoCheck&&l()}).catch(u=>{console.error("Failed to rebuild puzzle with updated seed point:",u)})}}),z(".actions",[z(Mi,{puzzle:r.puzzle,width:r.canvasWidth,height:r.canvasHeight,color:r.color}),z(zi,{autoCheck:r.geometryProblems.autoCheck,problems:r.geometryProblems.problems,progressPercent:r.geometryProblems.progress,onCheckRequested:()=>{r.dirty||l(),z.redraw()},onAutocheckChanged:c=>{c!==r.geometryProblems.autoCheck&&(r.geometryProblems.autoCheck=c,z.redraw())}})])]),z(".controls",[z(".background-image",[z(Ci,{label:"Background Image",onUpload:(c,h,u,f)=>{r.backgroundImageUrl&&URL.revokeObjectURL(r.backgroundImageUrl),r.canvasWidth=u,r.canvasHeight=f,r.aspectRatio=u/f,r.backgroundImageUrl=c,r.backgroundImageName=h,r.dirty=!0,z.redraw()}}),z("span.background-image-label",r.backgroundImageName)]),z(ki,{ratio:r.aspectRatio,disabled:r.backgroundImageUrl!==void 0,onChange:c=>{r.aspectRatio=c,r.canvasWidth=r.canvasHeight*c,r.dirty=!0,z.redraw()}}),z(Ai,{shape:r.borderShape,disabled:r.backgroundImageUrl!==void 0,onChange:c=>{r.borderShape=c,r.dirty=!0,z.redraw()}}),r.borderShape==="rounded-rect"&&z(Te,{config:{name:"cornerRadius",label:"Corner Radius",type:"number"},value:r.borderCornerRadius,onChange:c=>{r.borderCornerRadius=c??50,r.dirty=!0,z.redraw()}}),z(Te,{config:{name:"seed",label:"Seed",type:"number"},value:r.seed,onChange:c=>{r.seed=c??0,r.dirty=!0,z.redraw()}}),z(Te,{config:{name:"pieceSize",label:"Piece size",type:"number"},value:r.distance,onChange:c=>{r.distance=c??0,r.dirty=!0,z.redraw()}}),z(kt,{label:"Piece color",color:r.color,size:"small",onUpdate:c=>{r.color=c,z.redraw()}}),z(".draw-points",[z(ln,{config:{name:"drawPoints",label:"Draw seed points",type:"boolean"},value:r.drawPoints,onChange:c=>{r.drawPoints=c,z.redraw()}}),r.drawPoints&&z(kt,{label:"Seed points color",color:r.pointColor,size:"small",onUpdate:c=>{r.pointColor=c,z.redraw()}})]),...Object.entries(r.generators).map(([c,h])=>z("label",[h.label+":",z(Ti,{generator:h.name,registry:h.registry,config:h.config,onGeneratorChange:u=>{u!=h.name&&(console.log(`${c} generator changed to ${u}`),h.name=u,r.generators[c].config=h.registry.getDefaultConfig(u,r.canvasWidth,r.canvasHeight),r.dirty=!0,z.redraw())},onConfigChange:(u,f)=>{console.log(`${c} generator config "${u}" changed to ${String(f)}`),h.config[u]=f,r.dirty=!0,z.redraw()}})]))])])])}};xn("material",{resolver:s=>{const e=s.match(/^(.*?)(_(rounded|sharp))?$/);return e?`https://cdn.jsdelivr.net/npm/@material-symbols/svg-400@0.32.0/${e[3]??"outlined"}/${e[1]}.svg`:""},mutator:s=>s.setAttribute("fill","currentColor")});z.mount(document.body,Sr);
//# sourceMappingURL=index-CH9Hs6Jz.js.map
