import{m as y,g as Qe}from"./mithril-DD6GaBKN.js";import{r as Ze}from"./webawesome-BOW-VaTR.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const s of e.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?e.credentials="include":n.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(n){if(n.ep)return;n.ep=!0;const e=i(n);fetch(n.href,e)}})();const et={view:({attrs:a})=>y("a.github-corner",{href:a.link,"aria-label":"View source on GitHub",title:"View source on GitHub",target:"_blank"},y("svg",{width:80,height:80,viewBox:"0 0 250 250","aria-hidden":"true"},[y("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),y("path.octo-arm",{fill:"currentColor",style:"transform-origin: 130px 106px;",d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"}),y("path.octo-body",{fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})]))};class oe{generators=new Map;register(t,i,r){this.generators.has(t)&&console.warn(`Generator "${t}" is already registered, overwriting`),this.generators.set(t,{factory:i,uiMetadata:r})}create(t,i,r){const n=this.generators.get(r.name);if(!n)throw new Error(`Unknown generator "${r.name}". Is it registered?`);return n.factory(t,i,r)}getAvailableGenerators(){return Array.from(this.generators.values()).sort((t,i)=>t.uiMetadata.sortHint-i.uiMetadata.sortHint).map(t=>({name:t.uiMetadata.name,displayName:t.uiMetadata.displayName}))}getUIMetadata(t){return this.generators.get(t)?.uiMetadata}getDefaultConfig(t,i,r){const n={name:t,width:i,height:r},e=this.getUIMetadata(t);if(e)for(const s of e.controls)n[s.name]=s.defaultValue;return n}}const Y=new oe,J=new oe,Q=new oe,H=new oe;function tt(a,t){const i=a[0]-t[0],r=a[1]-t[1];return i*i+r*r}function nt(a){return{vertices:a.vertices,pieces:Array.from(a.pieces.entries()),edges:Array.from(a.edges.entries()),halfEdges:Array.from(a.halfEdges.entries()),boundary:a.boundary}}function Ue(a,t){let[i,r]=a,[n,e]=a;const s=o=>{i=Math.min(i,o[0]),r=Math.min(r,o[1]),n=Math.max(n,o[0]),e=Math.max(e,o[1])};for(const o of t)o.type==="line"?s(o.p):(s(o.p1),s(o.p2),s(o.p3));return[i,r,n,e]}function Fe(a,t){let i=1/0,r=1/0,n=-1/0,e=-1/0;const s=a.halfEdge;let o=t.halfEdges.get(s);if(!o)return a.bounds;const l=c=>{i=Math.min(i,c[0]),r=Math.min(r,c[1]),n=Math.max(n,c[0]),e=Math.max(e,c[1])};do{if(l(o.origin),o.segments){const c=Ue(o.origin,o.segments);l([c[0],c[1]]),l([c[2],c[3]])}o=t.halfEdges.get(o.next)}while(o&&o.id!==s);return[i,r,n,e]}const _e=100,it=_e*_e;function st(a,t){let i=-1,r=it;for(let n=0;n<a.vertices.length;n++){const e=tt(a.vertices[n],t);e<r&&(r=e,i=n)}return i===-1?null:i}function X(a){if(a.length===0)return[0,0,0,0];let t=a[0][0],i=a[0][1],r=t,n=i;for(let e=1;e<a.length;e++){const s=a[e];t=Math.min(t,s[0]),i=Math.min(i,s[1]),r=Math.max(r,s[0]),n=Math.max(n,s[1])}return[t,i,r,n]}function ot(a,t){return Math.abs(a[0]-t[0])<1e-6&&Math.abs(a[1]-t[1])<1e-6}function Ne(a,t,i,r){if(!a.tabs)return;const n=t.halfEdges.get(a.heLeft),e=t.halfEdges.get(a.heRight),s=n.origin,o=e.origin,l=[];let c=s;a.tabs.sort((h,d)=>h.position-d.position);for(const h of a.tabs){const d=h.position-h.size/2,u=[s[0]+(o[0]-s[0])*d,s[1]+(o[1]-s[1])*d];Math.hypot(u[0]-c[0],u[1]-c[1])>1e-6&&l.push({type:"line",p:u});const g=[s[0]+(o[0]-s[0])*(d+h.size),s[1]+(o[1]-s[1])*(d+h.size)],p=i.createTabSegments(u,g,h,r);l.push(...p),c=g}Math.hypot(o[0]-c[0],o[1]-c[1])>1e-6&&l.push({type:"line",p:o}),n.segments=l,e.segments=rt(l,s),a.bounds=Ue(s,l)}function rt(a,t){const i=[];for(let r=a.length-1;r>=0;r--){const n=a[r];let e=t;if(r>0){const s=a[r-1];e=s.type==="line"?s.p:s.p3}n.type==="line"?i.push({type:"line",p:e}):i.push({type:"bezier",p1:n.p2,p2:n.p1,p3:e})}return i}function He(a){return function(){let t=a+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}async function xe(a){const{width:t,height:i,pieceSize:r}=a,{pointConfig:n,pieceConfig:e,placementConfig:s,tabConfig:o}=a;console.log(`rebuilding puzzle with dimensions ${t}x${i}, piece size ${r}`);const l=Y.create(t,i,n),c=J.create(t,i,e),h=Q.create(t,i,s),d=H.create(t,i,o),u=a.seed??new Date().getTime(),g=He(u),p=l.generatePoints({width:t,height:i,pieceSize:r,random:g});console.log(`Generated ${p.length} points`);const f=c.generatePieces(p,{random:g,pieceSize:r});console.log(`Generated ${f.pieces.size} pieces`),h.placeTabs({topology:f,random:g});for(const m of f.edges.values())m.heRight!==-1&&m.tabs&&m.tabs.length>0&&Ne(m,f,d,g);return{created:new Date().toISOString(),seed:u,width:t,height:i,pieceSize:r,pointConfig:n,pieceConfig:e,placementConfig:s,tabConfig:o,vertices:f.vertices,boundary:f.boundary,pieces:f.pieces,edges:f.edges,halfEdges:f.halfEdges}}function re(a,t,i,r){const n=t.getContext("2d");if(!n){console.error("Could not get 2D context from canvas");return}n.clearRect(0,0,t.width,t.height);{n.strokeStyle=i,n.lineWidth=1,n.beginPath();for(const e of a.edges.values()){const s=a.halfEdges.get(e.heLeft);if(s)if(n.moveTo(s.origin[0],s.origin[1]),s.segments&&s.segments.length>0)for(const o of s.segments)switch(o.type){case"bezier":n.bezierCurveTo(o.p1[0],o.p1[1],o.p2[0],o.p2[1],o.p3[0],o.p3[1]);break;case"line":n.lineTo(o.p[0],o.p[1]);break}else{let o;s.twin!==-1?o=a.halfEdges.get(s.twin).origin:o=a.halfEdges.get(s.next).origin,n.lineTo(o[0],o[1])}}n.stroke()}if(a.problems&&a.problems.length>0){n.lineWidth=2,n.strokeStyle="red";for(const e of a.problems){const[s,o]=e;n.beginPath(),n.arc(s,o,8,0,2*Math.PI),n.stroke()}}if(r){n.fillStyle=r;for(const e of a.pieces.values()){const[s,o]=e.site;n.beginPath(),n.arc(s,o,3,0,2*Math.PI),n.fill()}}}function at(a,t,i){if(t<0||t>=a.vertices.length){console.warn("moveVertex called with invalid vertex index:",t);return}const r=a.vertices[t];a.vertices[t]=i;const n=[];for(const o of a.halfEdges.values())o.origin[0]===r[0]&&o.origin[1]===r[1]&&n.push(o);const e=new Set,s=[i[0]-r[0],i[1]-r[1]];for(const o of n){o.origin=i,e.add(o.piece);const l=a.halfEdges.get(o.prev);if(l?.segments){const c=l.segments[l.segments.length-1];c.type==="line"?c.p=i:(c.p3=i,c.p1=[c.p1[0]+s[0],c.p1[1]+s[1]],c.p2=[c.p2[0]+s[0],c.p2[1]+s[1]]),e.add(l.piece)}}lt(a,t);for(const o of e){const l=a.pieces.get(o);l&&(l.bounds=Fe(l,a))}}function lt(a,t){const{seed:i,width:r,height:n,placementConfig:e,tabConfig:s}=a,o=He(i),l=Q.create(r,n,e),c=H.create(r,n,s),h=new Set,d=a.vertices[t],u=new Map;for(const p of a.edges.values())u.set(p.heLeft,p),p.heRight!==-1&&u.set(p.heRight,p);for(const p of a.halfEdges.values()){const f=a.halfEdges.get(p.next)?.origin;if(p.origin===d||f===d){const w=u.get(p.id);w&&h.add(w)}}l.updateTabPlacements(Array.from(h),{topology:a,random:o});const g=new Set;for(const p of h)if(p.heRight!==-1){const b=a.halfEdges.get(p.heLeft);b&&(b.segments=void 0,g.add(a.pieces.get(b.piece)));const m=a.halfEdges.get(p.heRight);m&&(m.segments=void 0,g.add(a.pieces.get(m.piece))),Ne(p,a,c,o)}for(const p of g)p.bounds=Fe(p,a)}const ct=()=>{const a={canvas:null,isDragging:!1,draggedVertexId:-1},t=e=>{if(!a.canvas)return[0,0];const s=a.canvas.getBoundingClientRect();if(e instanceof TouchEvent){if(e.changedTouches.length>0){const o=e.changedTouches[0];return[o.clientX-s.left,o.clientY-s.top]}}else return[e.clientX-s.left,e.clientY-s.top];return[0,0]},i=(e,s)=>{if(e.redraw=!1,e instanceof TouchEvent&&e.touches.length>1){a.isDragging=!1,a.draggedVertexId=-1;return}if(e instanceof MouseEvent&&e.button!==0)return;const o=t(e),l=st(s.puzzle,o);l!==null&&(a.draggedVertexId=l)},r=(e,s)=>{if(e.redraw=!1,a.draggedVertexId<0)return;a.isDragging=!0,e.preventDefault();const o=t(e);at(s.puzzle,a.draggedVertexId,o),re(s.puzzle,a.canvas,s.color)},n=(e,s)=>{e.redraw=!1,!(a.draggedVertexId<0)&&(e.preventDefault(),a.isDragging&&s.onPuzzleChanged(s.puzzle),a.isDragging=!1,a.draggedVertexId=-1)};return{oncreate:({dom:e,attrs:s})=>{if(a.canvas=e.querySelector("canvas.puzzle"),!a.canvas){console.log("couldn't get canvas element");return}s.isDirty||re(s.puzzle,a.canvas,s.color,s.pointColor)},onupdate:({attrs:e})=>{if(!a.canvas){console.log("couldn't get canvas element");return}e.isDirty||re(e.puzzle,a.canvas,e.color,e.pointColor)},view:({attrs:e})=>y(".puzzle-stack",[y("img.background",{width:e.width,height:e.height,src:e.imageUrl}),y("canvas.puzzle",{width:e.width,height:e.height,style:{width:`${e.width}px`,height:`${e.height}px`,touchAction:"manipulation"},onmousedown:s=>i(s,e),onmousemove:s=>r(s,e),onmouseup:s=>n(s,e),onmouseleave:s=>n(s,e),ontouchstart:s=>i(s,e),ontouchmove:s=>r(s,e),ontouchend:s=>n(s,e),ontouchcancel:s=>n(s,e)})])}};function ht(a,t,i,r="black"){const e=[];for(const l of a.edges.values()){const c=a.halfEdges.get(l.heLeft);if(c)if(e.push(`M ${c.origin[0].toFixed(3)} ${c.origin[1].toFixed(3)}`),c.segments)for(const h of c.segments)switch(h.type){case"bezier":e.push(`C ${h.p1[0].toFixed(3)} ${h.p1[1].toFixed(3)}, ${h.p2[0].toFixed(3)} ${h.p2[1].toFixed(3)}, ${h.p3[0].toFixed(3)} ${h.p3[1].toFixed(3)}`);break;case"line":e.push(`L ${h.p[0].toFixed(3)} ${h.p[1].toFixed(3)}`);break}else{let h;c.twin!==-1?h=a.halfEdges.get(c.twin).origin:h=a.halfEdges.get(c.next).origin,e.push(`L ${h[0].toFixed(3)} ${h[1].toFixed(3)}`)}}const s=e.join(" ");return`
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg
  width="${t}"
  height="${i}"
  viewBox="0 0 ${t} ${i}"
  xmlns="http://www.w3.org/2000/svg"
  version="1.1"
>
  <path
    d="${s}"
    fill="none"
    stroke="${r}"
    stroke-width="1"
    vector-effect="non-scaling-stroke"
  />
</svg>`.trim().replace(/\r\n/g,`
`)}function dt(a,t="puzzle.svg"){const i=new Blob([a],{type:"image/svg+xml"}),r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=t,n.hidden=!0,document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>URL.revokeObjectURL(r),100)}const ut={view:({attrs:a})=>y("wa-button.download-svg",{size:"small",onclick:()=>{const t=ht(a.puzzle,a.width,a.height,a.color);dt(t,a.filename??"puzzle.svg")}},"Download SVG")},gt={view:({attrs:a})=>{const t=a.progressPercent!==void 0&&a.progressPercent<100,i=!t&&a.problems!==void 0&&a.problems==0,r=!t&&a.problems!==void 0&&a.problems>0;return y(".geometry-check-indicator",[y(".label","Geometry Check:"),y("wa-tooltip",{for:"check-geometry-now"},"Check geometry now"),y("wa-button#check-geometry-now",{variant:"neutral",appearance:"plain",size:"small",disabled:t,onclick:n=>{n.redraw=!1,a.onCheckRequested?.()}},y("wa-icon",{library:"material",name:"editor_choice",label:"Check geometry now"})),y("wa-tooltip",{for:"auto-check-geometry"},"Check geometry after every change"),y("wa-checkbox#auto-check-geometry",{checked:a.autoCheck,disabled:t,size:"small",onchange:n=>{n.redraw=!1;const e=n.target;a.onAutocheckChanged?.(e.checked)}},"auto check"),t&&y("wa-progress-bar",{label:"Geometry check progress",value:a.progressPercent??0}),i&&y("wa-badge",{variant:"success",pill:!0},"OK"),r&&y("wa-badge",{variant:"danger",pill:!0},`${a.problems} issue${a.problems===1?"":"s"}`)])}};function ft(a,t,i=800){if(a<=i)return{width:a,height:t};const r=t/a;return{width:i,height:Math.round(i*r)}}const pt=()=>{const a={inputElement:void 0};return{view:({attrs:t})=>[y("wa-button.upload-button",{size:"small",disabled:t.disabled===!0,onclick:()=>{a.inputElement&&a.inputElement.click()}},t.label??"Upload Image"),y("input[type=file]",{style:{display:"none"},accept:"image/*",oncreate:({dom:i})=>{a.inputElement=i},onchange:i=>{if(i.redraw=!1,a.inputElement){const r=a.inputElement.files?.[0];r?.type.startsWith("image/")&&createImageBitmap(r).then(n=>{const{width:e,height:s}=ft(n.width,n.height),o=URL.createObjectURL(r);n.close(),t.onUpload(o,r.name,e,s)}).catch(n=>{console.error("could not create a bitmap image: ",n)})}}})]}},qe=()=>({view:({attrs:a})=>y("wa-checkbox.boolean-input",{hint:a.config.helpText,disabled:a.disabled,checked:a.value,onchange:t=>{const r=t.target.checked;a.onChange(r)}},a.config.label)}),me=()=>({view:({attrs:a})=>y("wa-input.number-input",{label:a.config.label,hint:a.config.helpText,type:"number",inputmode:"numeric",size:"small",disabled:a.disabled,value:a.value,min:a.config.min,max:a.config.max,onchange:t=>{const i=t.target,r=parseFloat(i.value??"");a.onChange(isNaN(r)?void 0:r)}})}),mt=()=>({view:({attrs:a})=>y("wa-slider.range-input",{label:a.config.label,hint:a.config.helpText,disabled:a.disabled,value:a.value,min:a.config.min,max:a.config.max,step:a.config.step,"with-tooltip":!0,onchange:t=>{const r=t.target.value;a.onChange(isNaN(r)?void 0:r)}})}),bt=()=>({view:({attrs:a})=>y("wa-input.string-input",{label:a.config.label,hint:a.config.helpText,type:"text",inputmode:"text",size:"small",disabled:a.disabled,value:a.value,onchange:t=>{const r=t.target.value??"";a.onChange(r.length>0?r:void 0)}})}),yt=()=>({view:({attrs:a})=>{const t=a.registry.getAvailableGenerators();return y(".generator-picker",y("wa-tab-group",{active:a.generator,"onwa-tab-show":i=>{const r=i.detail.name;a.generator!==r&&a.onGeneratorChange(r)}},[...t.map(i=>{const r=a.registry.getUIMetadata(i.name),n=y("wa-tab",{panel:i.name},i.displayName),e=y("wa-tab-panel",{name:i.name},y(".controls",[r?.description?y("p",r.description):null,...r?.controls.map(s=>{switch(s.type){case"range":return y(mt,{config:s,value:a.config?.[s.name]??s.defaultValue,onChange:o=>{a.onConfigChange(s.name,o)}});case"boolean":return y(qe,{config:s,value:(a.config?.[s.name]??s.defaultValue)===!0,onChange:o=>{a.onConfigChange(s.name,o)}});case"number":return y(me,{config:s,value:a.config?.[s.name]??s.defaultValue,onChange:o=>{a.onConfigChange(s.name,o)}});case"string":return y(bt,{config:s,value:a.config?.[s.name]??s.defaultValue,onChange:o=>{a.onConfigChange(s.name,o)}})}})??[],!r?.description&&r?.controls.length==0?y("p","No controls for this strategy."):null]));return[n,e]})]))}}),De=[["Square","1:1",1],["Classic Photo","5:4",5/4],["Standard Photo","4:3",4/3],["35mm/DSLR","3:2",3/2],["Widescreen","16:9",16/9],["UltraWide","21:9",21/9],["Panorama","2:1",2/1],["Instagram Portrait","4:5",4/5],["Classic Portrait","3:4",3/4],["DSLR Portrait","2:3",2/3],["Phone Portrait","9:16",9/16],["Tall Poster","9:21",9/21],["Tall Panorama","1:2",1/2]],wt={view:({attrs:a})=>{const t=!De.some(([,,r])=>r===a.ratio),i=De.map(([r,n,e])=>y("wa-option",{value:String(e)},`${r} [${n}]`));return t&&i.unshift(y("wa-option",{value:"custom"},"Custom")),y(".aspect-ratio-picker",[y("wa-select",{label:"Aspect Ratio",size:"small",disabled:a.disabled,value:t?"custom":String(a.ratio),onchange:r=>{r.redraw=!1;const e=r.target.value;e&&e!=="custom"&&a.onChange(Number(e))}},i),y("wa-slider",{min:.25,max:4,step:.01,"with-tooltip":!0,size:"small",disabled:a.disabled,value:a.ratio,onchange:r=>{r.redraw=!1;const n=r.target;a.onChange(n.value)}})])}},Me={view:({attrs:a})=>y("wa-color-picker",{label:a.label,value:a.color,size:a.size??"medium",format:"rgb",onchange:t=>{t.redraw=!1;const i=t.target;a.onUpdate(i.value??"")}})};var ae,Se;function je(){if(Se)return ae;Se=1;function a(i){var r=i.length,n=1,e=new Array(r),s;for(s=r;s>0;s--)e[s-1]=n,n=n*i[s-1];return{stride:e,data:new Uint32Array(n)}}function t(i){var r=i.length,n=1,e=new Array(r),s=[],o,l;for(o=r;o>0;o--)e[o-1]=n,n=n*i[o-1];for(l=0;l<n;l++)s.push([]);return{stride:e,data:s}}return ae={integer:a,array:t},ae}var le,Te;function We(){if(Te)return le;Te=1,le=a;function a(t,i){var r=new Array(t),n=Math.floor(t/2)<<1,e=0,s,o,l,c,h;for(h=0;h<n;h+=2)s=-2*Math.log(i()),o=Math.sqrt(s),l=2*Math.PI*i(),e+=s,r[h]=o*Math.cos(l),r[h+1]=o*Math.sin(l);if(t%2){var d=Math.sqrt(-2*Math.log(i()))*Math.cos(2*Math.PI*i());r[t-1]=d,e+=Math.pow(d,2)}for(c=1/Math.sqrt(e),h=0;h<t;++h)r[h]*=c;return r}return le}var ce,Ce;function vt(){return Ce||(Ce=1,ce=function(t,i){t=t||1,i=i||2;for(var r=t*2+1,n=Math.pow(r,i)-1,e=new Array(n),s=0;s<n;s++)for(var o=e[s]=new Array(i),l=s<n/2?s:s+1,c=1;c<=i;c++){var h=l%Math.pow(r,c);o[c-1]=h/Math.pow(r,c-1)-t,l-=h}return e}),ce}var he,ke;function Be(){if(ke)return he;ke=1;var a=vt();function t(n){var e=a(2,n),s=[],o;for(e=e.filter(function(l){for(var c=0,h=0;h<n;h++)c+=Math.pow(Math.max(0,Math.abs(l[h])-1),2);return c<n}),o=0;o<n;o++)s.push(0);return e.push(s),e.sort(function(l,c){var h=0,d=0,u;for(u=0;u<n;u++)h+=Math.pow(l[u],2),d+=Math.pow(c[u],2);return h<d?-1:h>d?1:0}),e}var i={};function r(n){return i[n]||(i[n]=t(n)),i[n]}return he=r,he}var de,Ee;function Pt(){if(Ee)return de;Ee=1;var a=je().integer,t=We(),i=Be();function r(e,s){for(var o=0,l=0;l<e.length;l++)o+=Math.pow(e[l]-s[l],2);return o}function n(e,s){if(typeof e.distanceFunction=="function")throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=e.shape,this.minDistance=e.minDistance,this.maxDistance=e.maxDistance||e.minDistance*2,this.maxTries=Math.ceil(Math.max(1,e.tries||30)),this.rng=s||Math.random;for(var o=0,l=0;l<this.shape.length;l++)o=Math.max(o,this.shape[l]);var c=Math.max(1,o/128|0),h=1e-14*c;this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+h,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=i(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var l=0;l<this.dimension;l++)this.gridShape.push(Math.ceil(this.shape[l]/this.cellSize));this.grid=a(this.gridShape)}return n.prototype.shape=null,n.prototype.dimension=null,n.prototype.minDistance=null,n.prototype.maxDistance=null,n.prototype.minDistancePlusEpsilon=null,n.prototype.squaredMinDistance=null,n.prototype.deltaDistance=null,n.prototype.cellSize=null,n.prototype.maxTries=null,n.prototype.rng=null,n.prototype.neighbourhood=null,n.prototype.currentPoint=null,n.prototype.processList=null,n.prototype.samplePoints=null,n.prototype.gridShape=null,n.prototype.grid=null,n.prototype.addRandomPoint=function(){for(var e=new Array(this.dimension),s=0;s<this.dimension;s++)e[s]=this.rng()*this.shape[s];return this.directAddPoint(e)},n.prototype.addPoint=function(e){var s,o=!0;if(e.length===this.dimension)for(s=0;s<this.dimension&&o;s++)o=e[s]>=0&&e[s]<this.shape[s];else o=!1;return o?this.directAddPoint(e):null},n.prototype.directAddPoint=function(e){var s=0,o=this.grid.stride,l;for(this.processList.push(e),this.samplePoints.push(e),l=0;l<this.dimension;l++)s+=(e[l]/this.cellSize|0)*o[l];return this.grid.data[s]=this.samplePoints.length,e},n.prototype.inNeighbourhood=function(e){var s=this.dimension,o=this.grid.stride,l,c,h,d,u;for(l=0;l<this.neighbourhood.length;l++){for(c=0,h=0;h<s;h++){if(d=(e[h]/this.cellSize|0)+this.neighbourhood[l][h],d<0||d>=this.gridShape[h]){c=-1;break}c+=d*o[h]}if(c!==-1&&this.grid.data[c]!==0&&(u=this.samplePoints[this.grid.data[c]-1],r(e,u)<this.squaredMinDistance))return!0}return!1},n.prototype.next=function(){for(var e,s,o,l,c,h,d;this.processList.length>0;){for(this.currentPoint===null&&(this.currentPoint=this.processList.shift()),l=this.currentPoint,e=0;e<this.maxTries;e++){for(h=!0,o=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),this.dimension===2?(s=this.rng()*Math.PI*2,c=[Math.cos(s),Math.sin(s)]):c=t(this.dimension,this.rng),d=0;h&&d<this.dimension;d++)c[d]=l[d]+c[d]*o,h=c[d]>=0&&c[d]<this.shape[d];if(h&&!this.inNeighbourhood(c))return this.directAddPoint(c)}e===this.maxTries&&(this.currentPoint=null)}return null},n.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},n.prototype.getAllPoints=function(){return this.samplePoints},n.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")},n.prototype.reset=function(){var e=this.grid.data,s=0;for(s=0;s<e.length;s++)e[s]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0},de=n,de}var ue,Ie;function _t(){if(Ie)return ue;Ie=1;var a=je().array,t=We(),i=Be();function r(e,s){for(var o=0,l=0;l<e.length;l++)o+=Math.pow(e[l]-s[l],2);return Math.sqrt(o)}function n(e,s){if(typeof e.distanceFunction!="function")throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=e.shape,this.minDistance=e.minDistance,this.maxDistance=e.maxDistance||e.minDistance*2,this.maxTries=Math.ceil(Math.max(1,e.tries||30)),this.distanceFunction=e.distanceFunction,this.bias=Math.max(0,Math.min(1,e.bias||0)),this.rng=s||Math.random;for(var o=0,l=0;l<this.shape.length;l++)o=Math.max(o,this.shape[l]);var c=Math.max(1,o/128|0),h=1e-14*c;this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+h,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=i(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var l=0;l<this.dimension;l++)this.gridShape.push(Math.ceil(this.shape[l]/this.cellSize));this.grid=a(this.gridShape)}return n.prototype.shape=null,n.prototype.dimension=null,n.prototype.minDistance=null,n.prototype.maxDistance=null,n.prototype.minDistancePlusEpsilon=null,n.prototype.deltaDistance=null,n.prototype.cellSize=null,n.prototype.maxTries=null,n.prototype.distanceFunction=null,n.prototype.bias=null,n.prototype.rng=null,n.prototype.neighbourhood=null,n.prototype.currentPoint=null,n.prototype.currentDistance=null,n.prototype.processList=null,n.prototype.samplePoints=null,n.prototype.sampleDistance=null,n.prototype.gridShape=null,n.prototype.grid=null,n.prototype.addRandomPoint=function(){for(var e=new Array(this.dimension),s=0;s<this.dimension;s++)e[s]=this.rng()*this.shape[s];return this.directAddPoint(e)},n.prototype.addPoint=function(e){var s,o=!0;if(e.length===this.dimension)for(s=0;s<this.dimension&&o;s++)o=e[s]>=0&&e[s]<this.shape[s];else o=!1;return o?this.directAddPoint(e):null},n.prototype.directAddPoint=function(e){var s=0,o=this.grid.stride,l=this.samplePoints.length,c;for(this.processList.push(l),this.samplePoints.push(e),this.sampleDistance.push(this.distanceFunction(e)),c=0;c<this.dimension;c++)s+=(e[c]/this.cellSize|0)*o[c];return this.grid.data[s].push(l),e},n.prototype.inNeighbourhood=function(e){var s=this.dimension,o=this.grid.stride,l,c,h,d,u,g,p=this.distanceFunction(e);for(l=0;l<this.neighbourhood.length;l++){for(c=0,h=0;h<s;h++){if(d=(e[h]/this.cellSize|0)+this.neighbourhood[l][h],d<0||d>=this.gridShape[h]){c=-1;break}c+=d*o[h]}if(c!==-1&&this.grid.data[c].length>0)for(var f=0;f<this.grid.data[c].length;f++){u=this.samplePoints[this.grid.data[c][f]],g=this.sampleDistance[this.grid.data[c][f]];var b=Math.min(g,p),m=Math.max(g,p),w=b+(m-b)*this.bias;if(r(e,u)<this.minDistance+this.deltaDistance*w)return!0}}return!1},n.prototype.next=function(){for(var e,s,o,l,c,h,d,u;this.processList.length>0;){if(this.currentPoint===null){var g=this.processList.shift();this.currentPoint=this.samplePoints[g],this.currentDistance=this.sampleDistance[g]}for(l=this.currentPoint,c=this.currentDistance,e=0;e<this.maxTries;e++){for(d=!0,o=this.minDistancePlusEpsilon+this.deltaDistance*(c+(1-c)*this.bias),this.dimension===2?(s=this.rng()*Math.PI*2,h=[Math.cos(s),Math.sin(s)]):h=t(this.dimension,this.rng),u=0;d&&u<this.dimension;u++)h[u]=l[u]+h[u]*o,d=h[u]>=0&&h[u]<this.shape[u];if(d&&!this.inNeighbourhood(h))return this.directAddPoint(h)}e===this.maxTries&&(this.currentPoint=null)}return null},n.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},n.prototype.getAllPoints=function(){return this.samplePoints},n.prototype.getAllPointsWithDistance=function(){var e=new Array(this.samplePoints.length),s=0,o=0,l;for(s=0;s<this.samplePoints.length;s++){for(l=new Array(this.dimension+1),o=0;o<this.dimension;o++)l[o]=this.samplePoints[s][o];l[this.dimension]=this.sampleDistance[s],e[s]=l}return e},n.prototype.reset=function(){var e=this.grid.data,s=0;for(s=0;s<e.length;s++)e[s]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0},ue=n,ue}var ge,ze;function xt(){if(ze)return ge;ze=1;var a=Pt(),t=_t();function i(r,n){this.shape=r.shape,typeof r.distanceFunction=="function"?this.implementation=new t(r,n):this.implementation=new a(r,n)}return i.prototype.implementation=null,i.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()},i.prototype.addPoint=function(r){return this.implementation.addPoint(r)},i.prototype.next=function(){return this.implementation.next()},i.prototype.fill=function(){return this.implementation.fill()},i.prototype.getAllPoints=function(){return this.implementation.getAllPoints()},i.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()},i.prototype.reset=function(){this.implementation.reset()},ge=i,ge}var Dt=xt();const Mt=Qe(Dt),ye="PoissonPointGenerator",St={name:ye,displayName:"Poisson",description:"Generate seed points using Poisson disk sampling. The algorithm produces points that are tightly-packed, but no closer to each other than a specified minimum distance (the piece size), resulting in a natural, organic look.",sortHint:1,controls:[]},Tt=(a,t,i)=>({generatePoints(n){const{width:e,height:s,pieceSize:o,random:l}=n;return new Mt({shape:[e,s],minDistance:o,tries:20},l).fill()}});Y.register(ye,Tt,St);const U=11102230246251565e-32,L=134217729,Ct=(3+8*U)*U;function fe(a,t,i,r,n){let e,s,o,l,c=t[0],h=r[0],d=0,u=0;h>c==h>-c?(e=c,c=t[++d]):(e=h,h=r[++u]);let g=0;if(d<a&&u<i)for(h>c==h>-c?(s=c+e,o=e-(s-c),c=t[++d]):(s=h+e,o=e-(s-h),h=r[++u]),e=s,o!==0&&(n[g++]=o);d<a&&u<i;)h>c==h>-c?(s=e+c,l=s-e,o=e-(s-l)+(c-l),c=t[++d]):(s=e+h,l=s-e,o=e-(s-l)+(h-l),h=r[++u]),e=s,o!==0&&(n[g++]=o);for(;d<a;)s=e+c,l=s-e,o=e-(s-l)+(c-l),c=t[++d],e=s,o!==0&&(n[g++]=o);for(;u<i;)s=e+h,l=s-e,o=e-(s-l)+(h-l),h=r[++u],e=s,o!==0&&(n[g++]=o);return(e!==0||g===0)&&(n[g++]=e),g}function kt(a,t){let i=t[0];for(let r=1;r<a;r++)i+=t[r];return i}function Z(a){return new Float64Array(a)}const Et=(3+16*U)*U,It=(2+12*U)*U,zt=(9+64*U)*U*U,j=Z(4),Ae=Z(8),$e=Z(12),Ge=Z(16),R=Z(4);function At(a,t,i,r,n,e,s){let o,l,c,h,d,u,g,p,f,b,m,w,_,M,S,C,I,x;const v=a-n,T=i-n,D=t-e,P=r-e;M=v*P,u=L*v,g=u-(u-v),p=v-g,u=L*P,f=u-(u-P),b=P-f,S=p*b-(M-g*f-p*f-g*b),C=D*T,u=L*D,g=u-(u-D),p=D-g,u=L*T,f=u-(u-T),b=T-f,I=p*b-(C-g*f-p*f-g*b),m=S-I,d=S-m,j[0]=S-(m+d)+(d-I),w=M+m,d=w-M,_=M-(w-d)+(m-d),m=_-C,d=_-m,j[1]=_-(m+d)+(d-C),x=w+m,d=x-w,j[2]=w-(x-d)+(m-d),j[3]=x;let E=kt(4,j),A=It*s;if(E>=A||-E>=A||(d=a-v,o=a-(v+d)+(d-n),d=i-T,c=i-(T+d)+(d-n),d=t-D,l=t-(D+d)+(d-e),d=r-P,h=r-(P+d)+(d-e),o===0&&l===0&&c===0&&h===0)||(A=zt*s+Ct*Math.abs(E),E+=v*h+P*o-(D*c+T*l),E>=A||-E>=A))return E;M=o*P,u=L*o,g=u-(u-o),p=o-g,u=L*P,f=u-(u-P),b=P-f,S=p*b-(M-g*f-p*f-g*b),C=l*T,u=L*l,g=u-(u-l),p=l-g,u=L*T,f=u-(u-T),b=T-f,I=p*b-(C-g*f-p*f-g*b),m=S-I,d=S-m,R[0]=S-(m+d)+(d-I),w=M+m,d=w-M,_=M-(w-d)+(m-d),m=_-C,d=_-m,R[1]=_-(m+d)+(d-C),x=w+m,d=x-w,R[2]=w-(x-d)+(m-d),R[3]=x;const $=fe(4,j,4,R,Ae);M=v*h,u=L*v,g=u-(u-v),p=v-g,u=L*h,f=u-(u-h),b=h-f,S=p*b-(M-g*f-p*f-g*b),C=D*c,u=L*D,g=u-(u-D),p=D-g,u=L*c,f=u-(u-c),b=c-f,I=p*b-(C-g*f-p*f-g*b),m=S-I,d=S-m,R[0]=S-(m+d)+(d-I),w=M+m,d=w-M,_=M-(w-d)+(m-d),m=_-C,d=_-m,R[1]=_-(m+d)+(d-C),x=w+m,d=x-w,R[2]=w-(x-d)+(m-d),R[3]=x;const k=fe($,Ae,4,R,$e);M=o*h,u=L*o,g=u-(u-o),p=o-g,u=L*h,f=u-(u-h),b=h-f,S=p*b-(M-g*f-p*f-g*b),C=l*c,u=L*l,g=u-(u-l),p=l-g,u=L*c,f=u-(u-c),b=c-f,I=p*b-(C-g*f-p*f-g*b),m=S-I,d=S-m,R[0]=S-(m+d)+(d-I),w=M+m,d=w-M,_=M-(w-d)+(m-d),m=_-C,d=_-m,R[1]=_-(m+d)+(d-C),x=w+m,d=x-w,R[2]=w-(x-d)+(m-d),R[3]=x;const z=fe(k,$e,4,R,Ge);return Ge[z-1]}function ee(a,t,i,r,n,e){const s=(t-e)*(i-n),o=(a-n)*(r-e),l=s-o,c=Math.abs(s+o);return Math.abs(l)>=Et*c?l:-At(a,t,i,r,n,e,c)}const Le=Math.pow(2,-52),te=new Uint32Array(512);class ne{static from(t,i=Vt,r=Ut){const n=t.length,e=new Float64Array(n*2);for(let s=0;s<n;s++){const o=t[s];e[2*s]=i(o),e[2*s+1]=r(o)}return new ne(e)}constructor(t){const i=t.length>>1;if(i>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*i-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(i)),this._hullPrev=new Uint32Array(i),this._hullNext=new Uint32Array(i),this._hullTri=new Uint32Array(i),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(i),this._dists=new Float64Array(i),this.update()}update(){const{coords:t,_hullPrev:i,_hullNext:r,_hullTri:n,_hullHash:e}=this,s=t.length>>1;let o=1/0,l=1/0,c=-1/0,h=-1/0;for(let v=0;v<s;v++){const T=t[2*v],D=t[2*v+1];T<o&&(o=T),D<l&&(l=D),T>c&&(c=T),D>h&&(h=D),this._ids[v]=v}const d=(o+c)/2,u=(l+h)/2;let g,p,f;for(let v=0,T=1/0;v<s;v++){const D=pe(d,u,t[2*v],t[2*v+1]);D<T&&(g=v,T=D)}const b=t[2*g],m=t[2*g+1];for(let v=0,T=1/0;v<s;v++){if(v===g)continue;const D=pe(b,m,t[2*v],t[2*v+1]);D<T&&D>0&&(p=v,T=D)}let w=t[2*p],_=t[2*p+1],M=1/0;for(let v=0;v<s;v++){if(v===g||v===p)continue;const T=Lt(b,m,w,_,t[2*v],t[2*v+1]);T<M&&(f=v,M=T)}let S=t[2*f],C=t[2*f+1];if(M===1/0){for(let D=0;D<s;D++)this._dists[D]=t[2*D]-t[0]||t[2*D+1]-t[1];B(this._ids,this._dists,0,s-1);const v=new Uint32Array(s);let T=0;for(let D=0,P=-1/0;D<s;D++){const E=this._ids[D],A=this._dists[E];A>P&&(v[T++]=E,P=A)}this.hull=v.subarray(0,T),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(ee(b,m,w,_,S,C)<0){const v=p,T=w,D=_;p=f,w=S,_=C,f=v,S=T,C=D}const I=Rt(b,m,w,_,S,C);this._cx=I.x,this._cy=I.y;for(let v=0;v<s;v++)this._dists[v]=pe(t[2*v],t[2*v+1],I.x,I.y);B(this._ids,this._dists,0,s-1),this._hullStart=g;let x=3;r[g]=i[f]=p,r[p]=i[g]=f,r[f]=i[p]=g,n[g]=0,n[p]=1,n[f]=2,e.fill(-1),e[this._hashKey(b,m)]=g,e[this._hashKey(w,_)]=p,e[this._hashKey(S,C)]=f,this.trianglesLen=0,this._addTriangle(g,p,f,-1,-1,-1);for(let v=0,T,D;v<this._ids.length;v++){const P=this._ids[v],E=t[2*P],A=t[2*P+1];if(v>0&&Math.abs(E-T)<=Le&&Math.abs(A-D)<=Le||(T=E,D=A,P===g||P===p||P===f))continue;let $=0;for(let q=0,Je=this._hashKey(E,A);q<this._hashSize&&($=e[(Je+q)%this._hashSize],!($!==-1&&$!==r[$]));q++);$=i[$];let k=$,z;for(;z=r[k],ee(E,A,t[2*k],t[2*k+1],t[2*z],t[2*z+1])>=0;)if(k=z,k===$){k=-1;break}if(k===-1)continue;let V=this._addTriangle(k,P,r[k],-1,-1,n[k]);n[P]=this._legalize(V+2),n[k]=V,x++;let G=r[k];for(;z=r[G],ee(E,A,t[2*G],t[2*G+1],t[2*z],t[2*z+1])<0;)V=this._addTriangle(G,P,z,n[P],-1,n[G]),n[P]=this._legalize(V+2),r[G]=G,x--,G=z;if(k===$)for(;z=i[k],ee(E,A,t[2*z],t[2*z+1],t[2*k],t[2*k+1])<0;)V=this._addTriangle(z,P,k,-1,n[k],n[z]),this._legalize(V+2),n[z]=V,r[k]=k,x--,k=z;this._hullStart=i[P]=k,r[k]=i[G]=P,r[P]=G,e[this._hashKey(E,A)]=P,e[this._hashKey(t[2*k],t[2*k+1])]=k}this.hull=new Uint32Array(x);for(let v=0,T=this._hullStart;v<x;v++)this.hull[v]=T,T=r[T];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,i){return Math.floor($t(t-this._cx,i-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:i,_halfedges:r,coords:n}=this;let e=0,s=0;for(;;){const o=r[t],l=t-t%3;if(s=l+(t+2)%3,o===-1){if(e===0)break;t=te[--e];continue}const c=o-o%3,h=l+(t+1)%3,d=c+(o+2)%3,u=i[s],g=i[t],p=i[h],f=i[d];if(Gt(n[2*u],n[2*u+1],n[2*g],n[2*g+1],n[2*p],n[2*p+1],n[2*f],n[2*f+1])){i[t]=f,i[o]=u;const m=r[d];if(m===-1){let _=this._hullStart;do{if(this._hullTri[_]===d){this._hullTri[_]=t;break}_=this._hullPrev[_]}while(_!==this._hullStart)}this._link(t,m),this._link(o,r[s]),this._link(s,d);const w=c+(o+1)%3;e<te.length&&(te[e++]=w)}else{if(e===0)break;t=te[--e]}}return s}_link(t,i){this._halfedges[t]=i,i!==-1&&(this._halfedges[i]=t)}_addTriangle(t,i,r,n,e,s){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=i,this._triangles[o+2]=r,this._link(o,n),this._link(o+1,e),this._link(o+2,s),this.trianglesLen+=3,o}}function $t(a,t){const i=a/(Math.abs(a)+Math.abs(t));return(t>0?3-i:1+i)/4}function pe(a,t,i,r){const n=a-i,e=t-r;return n*n+e*e}function Gt(a,t,i,r,n,e,s,o){const l=a-s,c=t-o,h=i-s,d=r-o,u=n-s,g=e-o,p=l*l+c*c,f=h*h+d*d,b=u*u+g*g;return l*(d*b-f*g)-c*(h*b-f*u)+p*(h*g-d*u)<0}function Lt(a,t,i,r,n,e){const s=i-a,o=r-t,l=n-a,c=e-t,h=s*s+o*o,d=l*l+c*c,u=.5/(s*c-o*l),g=(c*h-o*d)*u,p=(s*d-l*h)*u;return g*g+p*p}function Rt(a,t,i,r,n,e){const s=i-a,o=r-t,l=n-a,c=e-t,h=s*s+o*o,d=l*l+c*c,u=.5/(s*c-o*l),g=a+(c*h-o*d)*u,p=t+(s*d-l*h)*u;return{x:g,y:p}}function B(a,t,i,r){if(r-i<=20)for(let n=i+1;n<=r;n++){const e=a[n],s=t[e];let o=n-1;for(;o>=i&&t[a[o]]>s;)a[o+1]=a[o--];a[o+1]=e}else{const n=i+r>>1;let e=i+1,s=r;O(a,n,e),t[a[i]]>t[a[r]]&&O(a,i,r),t[a[e]]>t[a[r]]&&O(a,e,r),t[a[i]]>t[a[e]]&&O(a,i,e);const o=a[e],l=t[o];for(;;){do e++;while(t[a[e]]<l);do s--;while(t[a[s]]>l);if(s<e)break;O(a,e,s)}a[i+1]=a[s],a[s]=o,r-e+1>=s-i?(B(a,t,e,r),B(a,t,i,s-1)):(B(a,t,i,s-1),B(a,t,e,r))}}function O(a,t,i){const r=a[t];a[t]=a[i],a[i]=r}function Vt(a){return a[0]}function Ut(a){return a[1]}const Re=1e-6;class N{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,i){this._+=`L${this._x1=+t},${this._y1=+i}`}arc(t,i,r){t=+t,i=+i,r=+r;const n=t+r,e=i;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${n},${e}`:(Math.abs(this._x1-n)>Re||Math.abs(this._y1-e)>Re)&&(this._+="L"+n+","+e),r&&(this._+=`A${r},${r},0,1,1,${t-r},${i}A${r},${r},0,1,1,${this._x1=n},${this._y1=e}`)}rect(t,i,r,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+i}h${+r}v${+n}h${-r}Z`}value(){return this._||null}}class be{constructor(){this._=[]}moveTo(t,i){this._.push([t,i])}closePath(){this._.push(this._[0].slice())}lineTo(t,i){this._.push([t,i])}value(){return this._.length?this._:null}}class Ft{constructor(t,[i,r,n,e]=[0,0,960,500]){if(!((n=+n)>=(i=+i))||!((e=+e)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=n,this.xmin=i,this.ymax=e,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:i,triangles:r},vectors:n}=this;let e,s;const o=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let f=0,b=0,m=r.length,w,_;f<m;f+=3,b+=2){const M=r[f]*2,S=r[f+1]*2,C=r[f+2]*2,I=t[M],x=t[M+1],v=t[S],T=t[S+1],D=t[C],P=t[C+1],E=v-I,A=T-x,$=D-I,k=P-x,z=(E*k-A*$)*2;if(Math.abs(z)<1e-9){if(e===void 0){e=s=0;for(const G of i)e+=t[G*2],s+=t[G*2+1];e/=i.length,s/=i.length}const V=1e9*Math.sign((e-I)*k-(s-x)*$);w=(I+D)/2-V*k,_=(x+P)/2+V*$}else{const V=1/z,G=E*E+A*A,q=$*$+k*k;w=I+(k*G-A*q)*V,_=x+(E*q-$*G)*V}o[b]=w,o[b+1]=_}let l=i[i.length-1],c,h=l*4,d,u=t[2*l],g,p=t[2*l+1];n.fill(0);for(let f=0;f<i.length;++f)l=i[f],c=h,d=u,g=p,h=l*4,u=t[2*l],p=t[2*l+1],n[c+2]=n[h]=g-p,n[c+3]=n[h+1]=u-d}render(t){const i=t==null?t=new N:void 0,{delaunay:{halfedges:r,inedges:n,hull:e},circumcenters:s,vectors:o}=this;if(e.length<=1)return null;for(let h=0,d=r.length;h<d;++h){const u=r[h];if(u<h)continue;const g=Math.floor(h/3)*2,p=Math.floor(u/3)*2,f=s[g],b=s[g+1],m=s[p],w=s[p+1];this._renderSegment(f,b,m,w,t)}let l,c=e[e.length-1];for(let h=0;h<e.length;++h){l=c,c=e[h];const d=Math.floor(n[c]/3)*2,u=s[d],g=s[d+1],p=l*4,f=this._project(u,g,o[p+2],o[p+3]);f&&this._renderSegment(u,g,f[0],f[1],t)}return i&&i.value()}renderBounds(t){const i=t==null?t=new N:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),i&&i.value()}renderCell(t,i){const r=i==null?i=new N:void 0,n=this._clip(t);if(n===null||!n.length)return;i.moveTo(n[0],n[1]);let e=n.length;for(;n[0]===n[e-2]&&n[1]===n[e-1]&&e>1;)e-=2;for(let s=2;s<e;s+=2)(n[s]!==n[s-2]||n[s+1]!==n[s-1])&&i.lineTo(n[s],n[s+1]);return i.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let i=0,r=t.length/2;i<r;++i){const n=this.cellPolygon(i);n&&(n.index=i,yield n)}}cellPolygon(t){const i=new be;return this.renderCell(t,i),i.value()}_renderSegment(t,i,r,n,e){let s;const o=this._regioncode(t,i),l=this._regioncode(r,n);o===0&&l===0?(e.moveTo(t,i),e.lineTo(r,n)):(s=this._clipSegment(t,i,r,n,o,l))&&(e.moveTo(s[0],s[1]),e.lineTo(s[2],s[3]))}contains(t,i,r){return i=+i,i!==i||(r=+r,r!==r)?!1:this.delaunay._step(t,i,r)===t}*neighbors(t){const i=this._clip(t);if(i)for(const r of this.delaunay.neighbors(t)){const n=this._clip(r);if(n){e:for(let e=0,s=i.length;e<s;e+=2)for(let o=0,l=n.length;o<l;o+=2)if(i[e]===n[o]&&i[e+1]===n[o+1]&&i[(e+2)%s]===n[(o+l-2)%l]&&i[(e+3)%s]===n[(o+l-1)%l]){yield r;break e}}}}_cell(t){const{circumcenters:i,delaunay:{inedges:r,halfedges:n,triangles:e}}=this,s=r[t];if(s===-1)return null;const o=[];let l=s;do{const c=Math.floor(l/3);if(o.push(i[c*2],i[c*2+1]),l=l%3===2?l-2:l+1,e[l]!==t)break;l=n[l]}while(l!==s&&l!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const i=this._cell(t);if(i===null)return null;const{vectors:r}=this,n=t*4;return this._simplify(r[n]||r[n+1]?this._clipInfinite(t,i,r[n],r[n+1],r[n+2],r[n+3]):this._clipFinite(t,i))}_clipFinite(t,i){const r=i.length;let n=null,e,s,o=i[r-2],l=i[r-1],c,h=this._regioncode(o,l),d,u=0;for(let g=0;g<r;g+=2)if(e=o,s=l,o=i[g],l=i[g+1],c=h,h=this._regioncode(o,l),c===0&&h===0)d=u,u=0,n?n.push(o,l):n=[o,l];else{let p,f,b,m,w;if(c===0){if((p=this._clipSegment(e,s,o,l,c,h))===null)continue;[f,b,m,w]=p}else{if((p=this._clipSegment(o,l,e,s,h,c))===null)continue;[m,w,f,b]=p,d=u,u=this._edgecode(f,b),d&&u&&this._edge(t,d,u,n,n.length),n?n.push(f,b):n=[f,b]}d=u,u=this._edgecode(m,w),d&&u&&this._edge(t,d,u,n,n.length),n?n.push(m,w):n=[m,w]}if(n)d=u,u=this._edgecode(n[0],n[1]),d&&u&&this._edge(t,d,u,n,n.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return n}_clipSegment(t,i,r,n,e,s){const o=e<s;for(o&&([t,i,r,n,e,s]=[r,n,t,i,s,e]);;){if(e===0&&s===0)return o?[r,n,t,i]:[t,i,r,n];if(e&s)return null;let l,c,h=e||s;h&8?(l=t+(r-t)*(this.ymax-i)/(n-i),c=this.ymax):h&4?(l=t+(r-t)*(this.ymin-i)/(n-i),c=this.ymin):h&2?(c=i+(n-i)*(this.xmax-t)/(r-t),l=this.xmax):(c=i+(n-i)*(this.xmin-t)/(r-t),l=this.xmin),e?(t=l,i=c,e=this._regioncode(t,i)):(r=l,n=c,s=this._regioncode(r,n))}}_clipInfinite(t,i,r,n,e,s){let o=Array.from(i),l;if((l=this._project(o[0],o[1],r,n))&&o.unshift(l[0],l[1]),(l=this._project(o[o.length-2],o[o.length-1],e,s))&&o.push(l[0],l[1]),o=this._clipFinite(t,o))for(let c=0,h=o.length,d,u=this._edgecode(o[h-2],o[h-1]);c<h;c+=2)d=u,u=this._edgecode(o[c],o[c+1]),d&&u&&(c=this._edge(t,d,u,o,c),h=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,i,r,n,e){for(;i!==r;){let s,o;switch(i){case 5:i=4;continue;case 4:i=6,s=this.xmax,o=this.ymin;break;case 6:i=2;continue;case 2:i=10,s=this.xmax,o=this.ymax;break;case 10:i=8;continue;case 8:i=9,s=this.xmin,o=this.ymax;break;case 9:i=1;continue;case 1:i=5,s=this.xmin,o=this.ymin;break}(n[e]!==s||n[e+1]!==o)&&this.contains(t,s,o)&&(n.splice(e,0,s,o),e+=2)}return e}_project(t,i,r,n){let e=1/0,s,o,l;if(n<0){if(i<=this.ymin)return null;(s=(this.ymin-i)/n)<e&&(l=this.ymin,o=t+(e=s)*r)}else if(n>0){if(i>=this.ymax)return null;(s=(this.ymax-i)/n)<e&&(l=this.ymax,o=t+(e=s)*r)}if(r>0){if(t>=this.xmax)return null;(s=(this.xmax-t)/r)<e&&(o=this.xmax,l=i+(e=s)*n)}else if(r<0){if(t<=this.xmin)return null;(s=(this.xmin-t)/r)<e&&(o=this.xmin,l=i+(e=s)*n)}return[o,l]}_edgecode(t,i){return(t===this.xmin?1:t===this.xmax?2:0)|(i===this.ymin?4:i===this.ymax?8:0)}_regioncode(t,i){return(t<this.xmin?1:t>this.xmax?2:0)|(i<this.ymin?4:i>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let i=0;i<t.length;i+=2){const r=(i+2)%t.length,n=(i+4)%t.length;(t[i]===t[r]&&t[r]===t[n]||t[i+1]===t[r+1]&&t[r+1]===t[n+1])&&(t.splice(r,2),i-=2)}t.length||(t=null)}return t}}const Nt=2*Math.PI,W=Math.pow;function Ht(a){return a[0]}function qt(a){return a[1]}function jt(a){const{triangles:t,coords:i}=a;for(let r=0;r<t.length;r+=3){const n=2*t[r],e=2*t[r+1],s=2*t[r+2];if((i[s]-i[n])*(i[e+1]-i[n+1])-(i[e]-i[n])*(i[s+1]-i[n+1])>1e-10)return!1}return!0}function Wt(a,t,i){return[a+Math.sin(a+t)*i,t+Math.cos(a-t)*i]}class we{static from(t,i=Ht,r=qt,n){return new we("length"in t?Bt(t,i,r,n):Float64Array.from(Ot(t,i,r,n)))}constructor(t){this._delaunator=new ne(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,i=this.points;if(t.hull&&t.hull.length>2&&jt(t)){this.collinear=Int32Array.from({length:i.length/2},(u,g)=>g).sort((u,g)=>i[2*u]-i[2*g]||i[2*u+1]-i[2*g+1]);const l=this.collinear[0],c=this.collinear[this.collinear.length-1],h=[i[2*l],i[2*l+1],i[2*c],i[2*c+1]],d=1e-8*Math.hypot(h[3]-h[1],h[2]-h[0]);for(let u=0,g=i.length/2;u<g;++u){const p=Wt(i[2*u],i[2*u+1],d);i[2*u]=p[0],i[2*u+1]=p[1]}this._delaunator=new ne(i)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,n=this.hull=this._delaunator.hull,e=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let l=0,c=r.length;l<c;++l){const h=e[l%3===2?l-2:l+1];(r[l]===-1||s[h]===-1)&&(s[h]=l)}for(let l=0,c=n.length;l<c;++l)o[n[l]]=l;n.length<=2&&n.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=n[0],s[n[0]]=1,n.length===2&&(s[n[1]]=0,this.triangles[1]=n[1],this.triangles[2]=n[1]))}voronoi(t){return new Ft(this,t)}*neighbors(t){const{inedges:i,hull:r,_hullIndex:n,halfedges:e,triangles:s,collinear:o}=this;if(o){const d=o.indexOf(t);d>0&&(yield o[d-1]),d<o.length-1&&(yield o[d+1]);return}const l=i[t];if(l===-1)return;let c=l,h=-1;do{if(yield h=s[c],c=c%3===2?c-2:c+1,s[c]!==t)return;if(c=e[c],c===-1){const d=r[(n[t]+1)%r.length];d!==h&&(yield d);return}}while(c!==l)}find(t,i,r=0){if(t=+t,t!==t||(i=+i,i!==i))return-1;const n=r;let e;for(;(e=this._step(r,t,i))>=0&&e!==r&&e!==n;)r=e;return e}_step(t,i,r){const{inedges:n,hull:e,_hullIndex:s,halfedges:o,triangles:l,points:c}=this;if(n[t]===-1||!c.length)return(t+1)%(c.length>>1);let h=t,d=W(i-c[t*2],2)+W(r-c[t*2+1],2);const u=n[t];let g=u;do{let p=l[g];const f=W(i-c[p*2],2)+W(r-c[p*2+1],2);if(f<d&&(d=f,h=p),g=g%3===2?g-2:g+1,l[g]!==t)break;if(g=o[g],g===-1){if(g=e[(s[t]+1)%e.length],g!==p&&W(i-c[g*2],2)+W(r-c[g*2+1],2)<d)return g;break}}while(g!==u);return h}render(t){const i=t==null?t=new N:void 0,{points:r,halfedges:n,triangles:e}=this;for(let s=0,o=n.length;s<o;++s){const l=n[s];if(l<s)continue;const c=e[s]*2,h=e[l]*2;t.moveTo(r[c],r[c+1]),t.lineTo(r[h],r[h+1])}return this.renderHull(t),i&&i.value()}renderPoints(t,i){i===void 0&&(!t||typeof t.moveTo!="function")&&(i=t,t=null),i=i==null?2:+i;const r=t==null?t=new N:void 0,{points:n}=this;for(let e=0,s=n.length;e<s;e+=2){const o=n[e],l=n[e+1];t.moveTo(o+i,l),t.arc(o,l,i,0,Nt)}return r&&r.value()}renderHull(t){const i=t==null?t=new N:void 0,{hull:r,points:n}=this,e=r[0]*2,s=r.length;t.moveTo(n[e],n[e+1]);for(let o=1;o<s;++o){const l=2*r[o];t.lineTo(n[l],n[l+1])}return t.closePath(),i&&i.value()}hullPolygon(){const t=new be;return this.renderHull(t),t.value()}renderTriangle(t,i){const r=i==null?i=new N:void 0,{points:n,triangles:e}=this,s=e[t*=3]*2,o=e[t+1]*2,l=e[t+2]*2;return i.moveTo(n[s],n[s+1]),i.lineTo(n[o],n[o+1]),i.lineTo(n[l],n[l+1]),i.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let i=0,r=t.length/3;i<r;++i)yield this.trianglePolygon(i)}trianglePolygon(t){const i=new be;return this.renderTriangle(t,i),i.value()}}function Bt(a,t,i,r){const n=a.length,e=new Float64Array(n*2);for(let s=0;s<n;++s){const o=a[s];e[s*2]=t.call(r,o,s,a),e[s*2+1]=i.call(r,o,s,a)}return e}function*Ot(a,t,i,r){let n=0;for(const e of a)yield t.call(r,e,n,a),yield i.call(r,e,n,a),++n}let Kt=0;function F(){return Kt++}const ve="VoronoiPieceGenerator",Xt={name:ve,displayName:"Voronoi",description:"Construct pieces by building a Voronoi diagram from the seed points. Each piece consists of all area of the plane closer to its seed point than any other seed point. In practice, this creates irregular polygons with 3-8 sides.",sortHint:1,controls:[]};function Yt(a,t){const i=a.length;for(let r=0;r<i;r++){const n=t.get(a[r]);n.next=a[(r+1)%i],n.prev=a[(r-1+i)%i]}}function K(a){return`${a[0].toPrecision(7)},${a[1].toPrecision(7)}`}const Jt=(a,t,i)=>({generatePieces(n,e){console.log(`VoronoiPieceGenerator using dimensions ${a}x${t}`);const o=we.from(n).voronoi([0,0,a,t]),l={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[]},c=new Map;for(let d=0;d<n.length;d++){const u=n[d],g=o.cellPolygon(d);if(!g)continue;const p={id:d,site:u,halfEdge:-1,bounds:X(g)},f=[];for(let b=0;b<g.length-1;b++){const m=g[b],w=g[b+1];if(ot(m,w))continue;const _={id:F(),origin:m,twin:-1,next:-1,prev:-1,piece:d};l.halfEdges.set(_.id,_),f.push(_.id);const M=`${K(m)}-${K(w)}`;c.set(M,_.id)}f.length!==0&&(Yt(f,l.halfEdges),p.halfEdge=f[0],l.pieces.set(d,p))}for(const d of l.halfEdges.values()){if(d.twin!==-1)continue;const u=l.halfEdges.get(d.next),g=d.origin,p=u.origin,f=`${K(p)}-${K(g)}`,b=c.get(f),m=F();let w;if(b!==void 0){const _=l.halfEdges.get(b);d.twin=_.id,_.twin=d.id,w={id:m,heLeft:d.id,heRight:_.id,bounds:X([g,p])}}else w={id:m,heLeft:d.id,heRight:-1,bounds:X([g,p])},l.boundary.push(m);l.edges.set(m,w)}const h=new Map;for(const d of l.halfEdges.values()){const u=K(d.origin);h.has(u)||h.set(u,d.origin)}return l.vertices=Array.from(h.values()),l}});J.register(ve,Jt,Xt);const ie="SimpleTabPlacementStrategy",Qt={name:ie,displayName:"Simple",description:"Creates a single tab in the center of each edge with a random orientation.",sortHint:1,controls:[{type:"range",name:"tabSize",label:"Tab Size",optional:!0,min:.01,max:1,step:.01,defaultValue:.5,helpText:"The width of the tab as a fraction of the edge length"},{type:"number",name:"minEdgeLength",label:"Minimum Edge Length",optional:!0,defaultValue:15,helpText:"Edges shorter than this value will not have a tab"},{type:"number",name:"maxTabSize",label:"Maximum Tab Size",helpText:"Maximum width of a generated tab"}]};function Ve(a,t,i,r){if(a.tabs=void 0,!(a.heRight!==-1))return;const e=t.halfEdges.get(a.heLeft),s=t.halfEdges.get(a.heRight);if(!e||!s)return;const o=e.origin,l=s.origin,c=Math.hypot(l[0]-o[0],l[1]-o[1]);if(c>=i.minEdgeLength){let h=i.tabSize;i.maxTabSize&&c*h>i.maxTabSize&&(h=i.maxTabSize/c);const d={position:.5,size:h,convex:r()>.5};a.tabs=[d]}}const Zt=(a,t,i)=>{const{tabSize:r=.5,minEdgeLength:n=0,maxTabSize:e}=i,s={tabSize:r,minEdgeLength:n,maxTabSize:e};return{placeTabs(o){const{topology:l,random:c}=o;for(const h of l.edges.values())Ve(h,l,s,c)},updateTabPlacements(o,l){const{topology:c,random:h}=l;for(const d of o)Ve(d,c,s,h)}}};Q.register(ie,Zt,Qt);const Pe="TraditionalTabGenerator",en={name:Pe,displayName:"Traditional",description:"Creates a traditional rounded tab for each (internal) piece edge.",sortHint:1,controls:[{type:"range",name:"jitter",label:"Randomness",defaultValue:8,min:0,max:100,step:1,helpText:"Adds randomness to the tab shape. 0 means completely uniform tabs"},{type:"range",name:"heightToWidthRatio",label:"Tab Height",defaultValue:50,min:5,max:100,step:5,helpText:"The height of the tab as a percent of its width"}]};function tn(a,t,i,r,n,e=!1){const s=t[0]-a[0],o=t[1]-a[1],l=Math.hypot(s,o);if(l===0)return console.warn("Edge has zero length"),[];const c=[s/l,o/l],h=[-c[1],c[0]],d=(P,E)=>[a[0]+(c[0]*P+h[0]*E)*l,a[1]+(c[1]*P+h[1]*E)*l],u=i/100,g=()=>(n()*2-1)*u,p=g(),f=g(),b=g(),m=g(),w=g(),_=.1625,M=e?-1:1,S=r,C=S/3,x=[[0,0],[.2,p*C],[.5+f+m,M*(-C+b*S)],[.5-_+f,M*(C+b*S)],[.5-2*_+f-m,M*(S+b*S)],[.5+2*_+f-m,M*(S+b*S)],[.5+_+f,M*(C+b*S)],[.5+f+m,M*(-C+b*S)],[.8,w*C],[1,0]].map(([P,E])=>d(P,E)),v={type:"bezier",p1:x[1],p2:x[2],p3:x[3]},T={type:"bezier",p1:x[4],p2:x[5],p3:x[6]},D={type:"bezier",p1:x[7],p2:x[8],p3:x[9]};return[v,T,D]}const nn=(a,t,i)=>{const{jitter:r=8,heightToWidthRatio:n=50}=i;return{createTabSegments(s,o,l,c){const h=!l.convex;return tn(s,o,r,n/100,c,h)}}};H.register(Pe,nn,en);function sn(a){return new Worker("/puzzle-generator/assets/CheckGeometryWorker-BndIDE0q.js",{name:a?.name})}function on(a,t){return new Promise((i,r)=>{const n=new sn;n.onmessage=s=>{const o=s.data;switch(o.type){case"progress":t?.(o.processed,o.total);break;case"done":i(o.results),n.terminate();break;case"error":r(new Error(o.message)),n.terminate();break}},n.onerror=s=>{r(new Error(s.message)),n.terminate()};const e={topology:nt(a)};n.postMessage(e)})}const Oe="GridJitterPointGenerator",rn={name:Oe,displayName:"Grid",description:"Generate seed points using a grid with optional random jitter. Has a uniform, regular look, especially with low randomness values.",sortHint:2,controls:[{type:"range",name:"jitter",label:"Randomness",min:0,max:100,step:5,defaultValue:50,helpText:"Amount of jitter to apply to each grid point (0 to 100%)"}]},an=(a,t,i)=>{const{jitter:r=50}=i;return{generatePoints(e){const{width:s,height:o,pieceSize:l,random:c}=e,h=[];for(let d=0;d<s;d+=l)for(let u=0;u<o;u+=l){const g=[d+l/2,u+l/2];r>0&&(g[0]+=(c()-.5)*(r/100)*l,g[1]+=(c()-.5)*(r/100)*l),h.push(g)}return h}}};Y.register(Oe,an,rn);const Ke="RectangularPieceGenerator",ln={name:Ke,displayName:"Rectangular",description:"Construct pieces from a regular grid. All pieces have 4 sides and are the same size. This generator ignores seed points.",sortHint:2,controls:[]},cn=(a,t,i)=>({generatePieces(n,e){const{pieceSize:s}=e,o={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[]},l=Math.ceil(a/s),c=Math.ceil(t/s),h=Math.round(a/l),d=Math.round(t/c),u=[];for(let p=0;p<=c;p++){const f=[];for(let b=0;b<=l;b++){const m=b*h,w=p*d;f.push([m,w])}u.push(f)}o.vertices=u.flat();const g=new Map;for(let p=0;p<c;p++)for(let f=0;f<l;f++){const b=p*l+f,m=u[p][f],w=u[p][f+1],_=u[p+1][f],M=u[p+1][f+1],S={id:F(),origin:m,twin:-1,next:-1,prev:-1,piece:b},C={id:F(),origin:w,twin:-1,next:-1,prev:-1,piece:b},I={id:F(),origin:M,twin:-1,next:-1,prev:-1,piece:b},x={id:F(),origin:_,twin:-1,next:-1,prev:-1,piece:b};S.next=C.id,C.next=I.id,I.next=x.id,x.next=S.id,S.prev=x.id,x.prev=I.id,I.prev=C.id,C.prev=S.id,o.halfEdges.set(S.id,S),o.halfEdges.set(C.id,C),o.halfEdges.set(I.id,I),o.halfEdges.set(x.id,x);const v={id:b,site:[(m[0]+M[0])/2,(m[1]+M[1])/2],halfEdge:S.id,bounds:[m[0],m[1],M[0],M[1]]};o.pieces.set(b,v);const T=(P,E)=>`${P[0]},${P[1]}-${E[0]},${E[1]}`,D=[{he:S,p1:m,p2:w,isBoundary:p===0},{he:C,p1:w,p2:M,isBoundary:f===l-1},{he:I,p1:M,p2:_,isBoundary:p===c-1},{he:x,p1:_,p2:m,isBoundary:f===0}];for(const P of D){const E=T(P.p2,P.p1),A=g.get(E),$=F();let k;if(A!==void 0){const z=o.halfEdges.get(A);P.he.twin=z.id,z.twin=P.he.id,k={id:$,heLeft:z.id,heRight:P.he.id,bounds:X([P.p1,P.p2])},g.delete(E)}else{const z=T(P.p1,P.p2);if(g.set(z,P.he.id),P.isBoundary)k={id:$,heLeft:P.he.id,heRight:-1,bounds:X([P.p1,P.p2])},o.boundary.push($);else continue}o.edges.set($,k)}}return o}});J.register(Ke,cn,ln);const Xe="NullTabGenerator",hn={name:Xe,displayName:"None",description:"Do not generate tabs. All pieces have straight edges.",sortHint:3,controls:[]},dn=(a,t,i)=>({createTabSegments(n,e,s,o){return[]}});H.register(Xe,dn,hn);const Ye="TriangleTabGenerator",un={name:Ye,displayName:"Triangle",description:"Creates a simple triangle between each (internal) piece edge.",sortHint:2,controls:[]},gn=(a,t,i)=>({createTabSegments(n,e,s,o){const l=[e[0]-n[0],e[1]-n[1]],c=Math.hypot(l[0],l[1]);if(c<1e-6)return[];const h=[l[0]/c,l[1]/c],d=[-h[1],h[0]],u=[n[0]+l[0]/2,n[1]+l[1]/2],g=s.convex?1:-1,p=c*s.size*g,f=[u[0]+d[0]*p,u[1]+d[1]*p],b=[];return b.push({type:"line",p:n}),b.push({type:"line",p:f}),b.push({type:"line",p:e}),b}});H.register(Ye,gn,un);let se=!1;function fn(){const a=window.matchMedia("(prefers-color-scheme: dark)");function t(){a.matches?(document.documentElement.classList.add("wa-dark"),se=!0):(document.documentElement.classList.remove("wa-dark"),se=!1)}t(),a.addEventListener("change",t)}fn();const pn=()=>{const i=ye,r=ve,n=Pe,e={seed:new Date().getTime()%10240,canvasWidth:800,canvasHeight:600,aspectRatio:800/600,distance:40,color:se?"#DDDDDD":"#333333",drawPoints:!1,pointColor:se?"#FF0000":"#0000FF",geometryProblems:{autoCheck:!1,problems:void 0,progress:void 0},dirty:!0,generators:{point:{label:"Seed Points",registry:Y,name:i,config:Y.getDefaultConfig(i,800,600)},piece:{label:"Piece Generation",registry:J,name:r,config:J.getDefaultConfig(r,800,600)},placement:{label:"Tab Placement",registry:Q,name:ie,config:Q.getDefaultConfig(ie,800,600)},tab:{label:"Tabs",registry:H,name:n,config:H.getDefaultConfig(n,800,600)}},puzzle:void 0,backgroundImageUrl:void 0,backgroundImageName:""};function s(){e.puzzle&&(e.geometryProblems.progress=0,y.redraw(),on(e.puzzle,(o,l)=>{e.geometryProblems.progress=o/l*100,y.redraw()}).then(o=>{e.geometryProblems.problems=o.length,e.geometryProblems.progress=void 0,e.puzzle&&(e.puzzle.problems=o),y.redraw()}).catch(o=>{e.geometryProblems.progress=void 0,console.error(o),y.redraw()}))}return{oncreate:()=>{xe({width:e.canvasWidth,height:e.canvasHeight,pieceSize:e.distance,pointConfig:e.generators.point.config,pieceConfig:e.generators.piece.config,placementConfig:e.generators.placement.config,tabConfig:e.generators.tab.config,seed:e.seed}).then(o=>{e.puzzle=o,y.redraw(),e.geometryProblems.autoCheck&&s()}).catch(o=>{console.error(o)})},onupdate:()=>{e.dirty&&(e.dirty=!1,xe({width:e.canvasWidth,height:e.canvasHeight,pieceSize:e.distance,pointConfig:e.generators.point.config,pieceConfig:e.generators.piece.config,placementConfig:e.generators.placement.config,tabConfig:e.generators.tab.config,seed:e.seed}).then(o=>{e.geometryProblems.problems=void 0,e.geometryProblems.progress=void 0,e.puzzle=o,y.redraw(),e.geometryProblems.autoCheck&&s()}).catch(o=>{console.error(o)}))},onremove:()=>{e.backgroundImageUrl&&(URL.revokeObjectURL(e.backgroundImageUrl),e.backgroundImageUrl=void 0)},view:()=>y(".page",[y(et,{link:"https://github.com/weevilgenius/puzzle-generator"}),y("h1","Puzzle Generator"),y(".container",[e.puzzle&&y(".puzzle-stack",[y(ct,{width:e.canvasWidth,height:e.canvasHeight,color:e.color,imageUrl:e.backgroundImageUrl,puzzle:e.puzzle,isDirty:e.dirty,pointColor:e.drawPoints?e.pointColor:void 0,onPuzzleChanged:o=>{e.puzzle=o,y.redraw()}}),y(".actions",[y(ut,{puzzle:e.puzzle,width:e.canvasWidth,height:e.canvasHeight,color:e.color}),y(gt,{autoCheck:e.geometryProblems.autoCheck,problems:e.geometryProblems.problems,progressPercent:e.geometryProblems.progress,onCheckRequested:()=>{e.dirty||s(),y.redraw()},onAutocheckChanged:o=>{o!==e.geometryProblems.autoCheck&&(e.geometryProblems.autoCheck=o,y.redraw())}})])]),y(".controls",[y(".background-image",[y(pt,{label:"Background Image",onUpload:(o,l,c,h)=>{e.backgroundImageUrl&&URL.revokeObjectURL(e.backgroundImageUrl),e.canvasWidth=c,e.canvasHeight=h,e.aspectRatio=c/h,e.backgroundImageUrl=o,e.backgroundImageName=l,e.dirty=!0,y.redraw()}}),y("span.background-image-label",e.backgroundImageName)]),y(wt,{ratio:e.aspectRatio,disabled:e.backgroundImageUrl!==void 0,onChange:o=>{e.aspectRatio=o,e.canvasWidth=e.canvasHeight*o,e.dirty=!0,y.redraw()}}),y(me,{config:{name:"seed",label:"Seed",type:"number"},value:e.seed,onChange:o=>{e.seed=o??0,e.dirty=!0,y.redraw()}}),y(me,{config:{name:"pieceSize",label:"Piece size",type:"number"},value:e.distance,onChange:o=>{e.distance=o??0,e.dirty=!0,y.redraw()}}),y(Me,{label:"Piece color",color:e.color,size:"small",onUpdate:o=>{e.color=o,y.redraw()}}),y(".draw-points",[y(qe,{config:{name:"drawPoints",label:"Draw seed points",type:"boolean"},value:e.drawPoints,onChange:o=>{e.drawPoints=o,y.redraw()}}),e.drawPoints&&y(Me,{label:"Seed points color",color:e.pointColor,size:"small",onUpdate:o=>{e.pointColor=o,y.redraw()}})]),...Object.entries(e.generators).map(([o,l])=>y("label",[l.label+":",y(yt,{generator:l.name,registry:l.registry,config:l.config,onGeneratorChange:c=>{c!=l.name&&(console.log(`${o} generator changed to ${c}`),l.name=c,e.generators[o].config=l.registry.getDefaultConfig(c,e.canvasWidth,e.canvasHeight),e.dirty=!0,y.redraw())},onConfigChange:(c,h)=>{console.log(`${o} generator config "${c}" changed to ${String(h)}`),l.config[c]=h,e.dirty=!0,y.redraw()}})]))])])])}};Ze("material",{resolver:a=>{const t=a.match(/^(.*?)(_(rounded|sharp))?$/);return t?`https://cdn.jsdelivr.net/npm/@material-symbols/svg-400@0.32.0/${t[3]??"outlined"}/${t[1]}.svg`:""},mutator:a=>a.setAttribute("fill","currentColor")});y.mount(document.body,pn);
//# sourceMappingURL=index-D23LcfHD.js.map
